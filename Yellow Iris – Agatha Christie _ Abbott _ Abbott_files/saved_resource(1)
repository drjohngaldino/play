// ER JS built Mon, 21 Sep 2020 02:02:32 GMTvar jsts=1600653752;/*
	Modernizr 2.7.1 (Custom Build) | MIT & BSD
*/
;window.Modernizr=function(a,b,c){function A(a){j.cssText=a}function B(a,b){return A(m.join(a+";")+(b||""))}function C(a,b){return typeof a===b}function D(a,b){return!!~(""+a).indexOf(b)}function E(a,b){for(var d in a){var e=a[d];if(!D(e,"-")&&j[e]!==c)return b=="pfx"?e:!0}return!1}function F(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:C(f,"function")?f.bind(d||b):f}return!1}function G(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+o.join(d+" ")+d).split(" ");return C(b,"string")||C(b,"undefined")?E(e,b):(e=(a+" "+p.join(d+" ")+d).split(" "),F(e,b,c))}var d="2.7.1",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k,l={}.toString,m=" -webkit- -moz- -o- -ms- ".split(" "),n="Webkit Moz O ms",o=n.split(" "),p=n.toLowerCase().split(" "),q={},r={},s={},t=[],u=t.slice,v,w=function(a,c,d,e){var f,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),l.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),l.id=h,(m?l:n).innerHTML+=f,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=g.style.overflow,g.style.overflow="hidden",g.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),g.style.overflow=k),!!i},x=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=C(e[d],"function"),C(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),y={}.hasOwnProperty,z;!C(y,"undefined")&&!C(y.call,"undefined")?z=function(a,b){return y.call(a,b)}:z=function(a,b){return b in a&&C(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=u.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(u.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(u.call(arguments)))};return e}),q.geolocation=function(){return"geolocation"in navigator},q.websqldatabase=function(){return!!a.openDatabase},q.indexedDB=function(){return!!G("indexedDB",a)},q.history=function(){return!!a.history&&!!history.pushState},q.localstorage=function(){try{return localStorage.setItem(h,h),localStorage.removeItem(h),!0}catch(a){return!1}},q.sessionstorage=function(){try{return sessionStorage.setItem(h,h),sessionStorage.removeItem(h),!0}catch(a){return!1}},q.applicationcache=function(){return!!a.applicationCache};for(var H in q)z(q,H)&&(v=H.toLowerCase(),e[v]=q[H](),t.push((e[v]?"":"no-")+v));return e.addTest=function(a,b){if(typeof a=="object")for(var d in a)z(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof f!="undefined"&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},A(""),i=k=null,function(a,b){function l(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function m(){var a=s.elements;return typeof a=="string"?a.split(" "):a}function n(a){var b=j[a[h]];return b||(b={},i++,a[h]=i,j[i]=b),b}function o(a,c,d){c||(c=b);if(k)return c.createElement(a);d||(d=n(c));var g;return d.cache[a]?g=d.cache[a].cloneNode():f.test(a)?g=(d.cache[a]=d.createElem(a)).cloneNode():g=d.createElem(a),g.canHaveChildren&&!e.test(a)&&!g.tagUrn?d.frag.appendChild(g):g}function p(a,c){a||(a=b);if(k)return a.createDocumentFragment();c=c||n(a);var d=c.frag.cloneNode(),e=0,f=m(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function q(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return s.shivMethods?o(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+m().join().replace(/[\w\-]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(s,b.frag)}function r(a){a||(a=b);var c=n(a);return s.shivCSS&&!g&&!c.hasCSS&&(c.hasCSS=!!l(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),k||q(a,c),a}var c="3.7.0",d=a.html5||{},e=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,g,h="_html5shiv",i=0,j={},k;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",g="hidden"in a,k=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){g=!0,k=!0}})();var s={elements:d.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:c,shivCSS:d.shivCSS!==!1,supportsUnknownElements:k,shivMethods:d.shivMethods!==!1,type:"default",shivDocument:r,createElement:o,createDocumentFragment:p};a.html5=s,r(b)}(this,b),e._version=d,e._prefixes=m,e._domPrefixes=p,e._cssomPrefixes=o,e.hasEvent=x,e.testProp=function(a){return E([a])},e.testAllProps=G,e.testStyles=w,g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+t.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};
;if(typeof client_url=="undefined"){var client_url=""}if(user_territory_id==105){client_url=(typeof env_name=="undefined"||env_name=="live")?"concordtheatricals.co.uk":"staging.concordtheatricals.co.uk"}else{client_url=(typeof env_name=="undefined"||env_name=="live")?"concordtheatricals.com":"staging.concordtheatricals.com"}var display_message={};function display_messages_set(){display_message.book_read_info_buttons="For information on how to interact with the eBook, see the help page (also available in the side menu).";display_message.book_read_info_reveal_menu="To reveal the menu, drag down on your screen.";display_message.offline_access_info="To access a play when offline, make sure to download it to this device by tapping the icon in the reader menu.";display_message.fullscreen_incapable="Your browser does not have full-screen viewing capability.";display_message.store_book_to_use="The play must be stored on this device to use this feature.";display_message.buy_or_rent_book_to_use="This feature cannot be used without full access to the play.";display_message.book_just_expired="Your rental of this play has expired, so it has been removed from this device. If you choose to re-rent, remember to download it again.";display_message.book_auto_expired_new_access="This play was removed from this device when the previous rental expired. Would you like to store it on this device again?";display_message.search_this_book="Search inside this play";display_message.storing_book="Storing play...";display_message.deleting_book="Deleting play...";display_message.book_is_stored="This play is stored on this device.";display_message.book_not_stored="This play is not stored on this device.";display_message.store_book="Store on this device";display_message.store_book_confirm="Confirm download of [[size]]";display_message.remove_book="Remove from this device";display_message.remove_book_confirm="Remove the play from this device?";display_message.delete_highlight_ask="Delete this highlight?";display_message.delete_blackout_ask="Delete this blackout?";display_message.delete_bookmark_ask="Delete this bookmark?";display_message.delete_note_confirm="Are you sure you want to delete this note?";display_message.blackout="Blackout";display_message.highlight="Highlight";display_message.note="Note";display_message.bookmark="Bookmark";display_message.no_notes="You have no notes set in this play. Tap a paragraph to set a note.";display_message.no_bookmarks="You have no bookmarks set in this play. Tap a paragraph to set a bookmark.";display_message["delete"]="Delete";display_message.cancel="Cancel";display_message.close="Close";display_message.exit="Exit";display_message.ok="OK";display_message.search_term_not_found="Your search text cannot be found in this play";display_message.online_only="Only available when online";display_message.show_contents="Show contents";display_message.no_toc="This play does not have a contents list";display_message.and_others="and others";display_message.offline="Sorry, but I'm unable to connect to the server. Entering offline mode.";display_message.offline_and_no_data="Your Internet connection is down, and no data has been stored for use when offline";display_message.offline_and_logged_out="You are not logged in to "+sitename+". Your device must be online to log in.";display_message.read_more="Read more";display_message.loading="Loading...";display_message.redirecting_to="Redirecting to";display_message.loading_long_time="Just a little longer...";display_message.help_page_title="Help page";display_message.software_credits_title="Software acknowledgements";display_message.error_setting_value="Sorry, there was an error making that change";display_message.logging_in="Redirecting to "+client_url;display_message.logging_out="Logging out...";display_message.log_out_prompt="Logging out will remove all "+sitename+" user data from this device.";display_message.log_out_prompt_not_standalone="You will not be logged out of "+client_url+".";display_message.update_downloading="Downloading updateâ€¦";display_message.update_ready_prompt="An update has been downloaded. Choose 'OK' to reload now (required).";display_message.preview_of="You are reading a free preview of [[book_title]].";display_message.preview_restricted="Some ePlay features are restricted in preview mode.";display_message.preview_begin="Begin preview";display_message.preview_book="Free ePlay preview";display_message.tweet_prompt="Tweet about this play";display_message.tweet_success="Your tweet has been posted to your Twitter feed!";display_message.tweet_too_long="Your tweet is too long";display_message.tweet_general_error="There was an error posting to your Twitter feed";display_message.facebook_prompt="Post about this play on Facebook";display_message.facebook_success="Your status has been posted to Facebook!";display_message.facebook_general_error="There was an error posting to Facebook";display_message.book_social_share_text="I'm reading [[book_title]] on "+sitename+" #abbottreader";
display_message.book_social_preview_text="Read [[book_title]] on "+sitename+" #abbottreader";display_message.book_not_available="Sorry, but that title is not available";display_message.remove_current_auto_highlights="Remove current auto-highlights";display_message.article_not_found="Sorry, that article could not be found";display_message.feature_for_logged_in_only="Sorry, but you need to log in to use this feature"}display_messages_set();
;/*
	jQuery Address v1.6 | (c) 2009, 2013 Rostislav Hristov | jquery.org/license
*/
(function(c){c.address=function(){var s=function(a){a=c.extend(c.Event(a),function(){for(var b={},f=c.address.parameterNames(),m=0,p=f.length;m<p;m++)b[f[m]]=c.address.parameter(f[m]);return{value:c.address.value(),path:c.address.path(),pathNames:c.address.pathNames(),parameterNames:f,parameters:b,queryString:c.address.queryString()}}.call(c.address));c(c.address).trigger(a);return a},g=function(a){return Array.prototype.slice.call(a)},k=function(){c().bind.apply(c(c.address),Array.prototype.slice.call(arguments));
return c.address},da=function(){c().unbind.apply(c(c.address),Array.prototype.slice.call(arguments));return c.address},G=function(){return A.pushState&&d.state!==h},T=function(){return("/"+n.pathname.replace(new RegExp(d.state),"")+n.search+(H()?"#"+H():"")).replace(S,"/")},H=function(){var a=n.href.indexOf("#");return a!=-1?n.href.substr(a+1):""},q=function(){return G()?T():H()},U=function(){return"javascript"},M=function(a){a=a.toString();return(d.strict&&a.substr(0,1)!="/"?"/":"")+a},t=function(a,
b){return parseInt(a.css(b),10)},C=function(){if(!I){var a=q();if(decodeURI(e)!=decodeURI(a))if(v&&x<7)n.reload();else{v&&!J&&d.history&&u(N,50);e=a;B(o)}}},B=function(a){u(ea,10);return s(V).isDefaultPrevented()||s(a?W:X).isDefaultPrevented()},ea=function(){if(d.tracker!=="null"&&d.tracker!==D){var a=c.isFunction(d.tracker)?d.tracker:i[d.tracker],b=(n.pathname+n.search+(c.address&&!G()?c.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(c.isFunction(a))a(b);else if(c.isFunction(i.urchinTracker))i.urchinTracker(b);
else if(i.pageTracker!==h&&c.isFunction(i.pageTracker._trackPageview))i.pageTracker._trackPageview(b);else i._gaq!==h&&c.isFunction(i._gaq.push)&&i._gaq.push(["_trackPageview",decodeURI(b)])}},N=function(){var a=U()+":"+o+";document.open();document.writeln('<html><head><title>"+l.title.replace(/\'/g,"\\'")+"</title><script>var "+y+' = "'+encodeURIComponent(q()).replace(/\'/g,"\\'")+(l.domain!=n.hostname?'";document.domain="'+l.domain:"")+"\";<\/script></head></html>');document.close();";if(x<7)j.src=
a;else j.contentWindow.location.replace(a)},Z=function(){if(E&&Y!=-1){var a,b,f=E.substr(Y+1).split("&");for(a=0;a<f.length;a++){b=f[a].split("=");if(/^(autoUpdate|history|strict|wrap)$/.test(b[0]))d[b[0]]=isNaN(b[1])?/^(true|yes)$/i.test(b[1]):parseInt(b[1],10)!==0;if(/^(state|tracker)$/.test(b[0]))d[b[0]]=b[1]}E=D}e=q()},aa=function(){if(!$){$=r;Z();c('a[rel*="address:"]').address();if(d.wrap){var a=c("body");c("body > *").wrapAll('<div style="padding:'+(t(a,"marginTop")+t(a,"paddingTop"))+"px "+
(t(a,"marginRight")+t(a,"paddingRight"))+"px "+(t(a,"marginBottom")+t(a,"paddingBottom"))+"px "+(t(a,"marginLeft")+t(a,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+y+'" style="height:100%;overflow:auto;position:relative;'+(K&&!window.statusbar.visible?"resize:both;":"")+'" />');c("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});K&&c('<style type="text/css" />').appendTo("head").text("#"+y+"::-webkit-resizer { background-color: #fff; }")}if(v&&!J){a=l.getElementsByTagName("frameset")[0];
j=l.createElement((a?"":"i")+"frame");j.src=U()+":"+o;if(a){a.insertAdjacentElement("beforeEnd",j);a[a.cols?"cols":"rows"]+=",0";j.noResize=r;j.frameBorder=j.frameSpacing=0}else{j.style.display="none";j.style.width=j.style.height=0;j.tabIndex=-1;l.body.insertAdjacentElement("afterBegin",j)}u(function(){c(j).bind("load",function(){var b=j.contentWindow;e=b[y]!==h?b[y]:"";if(e!=q()){B(o);n.hash=e}});j.contentWindow[y]===h&&N()},50)}u(function(){s("init");B(o)},1);if(!G())if(v&&x>7||!v&&J)if(i.addEventListener)i.addEventListener(F,
C,o);else i.attachEvent&&i.attachEvent("on"+F,C);else fa(C,50);"state"in window.history&&c(window).trigger("popstate")}},ga=function(a){a=a.toLowerCase();a=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},h,D=null,y="jQueryAddress",F="hashchange",V="change",W="internalChange",X="externalChange",
r=true,o=false,d={autoUpdate:r,history:r,strict:r,wrap:o},z=function(){var a={},b=ga(navigator.userAgent);if(b.browser){a[b.browser]=true;a.version=b.version}if(a.chrome)a.webkit=true;else if(a.webkit)a.safari=true;return a}(),x=parseFloat(z.version),K=z.webkit||z.safari,v=!c.support.opacity,i=function(){try{return top.document!==h&&top.document.title!==h?top:window}catch(a){return window}}(),l=i.document,A=i.history,n=i.location,fa=setInterval,u=setTimeout,S=/\/{2,9}/g;z=navigator.userAgent;var J=
"on"+F in i,j,E=c("script:last").attr("src"),Y=E?E.indexOf("?"):-1,O=l.title,I=o,$=o,ba=r,L=o,e=q();if(v){x=parseFloat(z.substr(z.indexOf("MSIE")+4));if(l.documentMode&&l.documentMode!=x)x=l.documentMode!=8?7:8;var ca=l.onpropertychange;l.onpropertychange=function(){ca&&ca.call(l);if(l.title!=O&&l.title.indexOf("#"+q())!=-1)l.title=O}}if(A.navigationMode)A.navigationMode="compatible";if(document.readyState=="complete")var ha=setInterval(function(){if(c.address){aa();clearInterval(ha)}},50);else{Z();
c(aa)}c(window).bind("popstate",function(){if(decodeURI(e)!=decodeURI(q())){e=q();B(o)}}).bind("unload",function(){if(i.removeEventListener)i.removeEventListener(F,C,o);else i.detachEvent&&i.detachEvent("on"+F,C)});return{bind:function(){return k.apply(this,g(arguments))},unbind:function(){return da.apply(this,g(arguments))},init:function(){return k.apply(this,["init"].concat(g(arguments)))},change:function(){return k.apply(this,[V].concat(g(arguments)))},internalChange:function(){return k.apply(this,
[W].concat(g(arguments)))},externalChange:function(){return k.apply(this,[X].concat(g(arguments)))},baseURL:function(){var a=n.href;if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},autoUpdate:function(a){if(a!==h){d.autoUpdate=a;return this}return d.autoUpdate},history:function(a){if(a!==h){d.history=a;return this}return d.history},state:function(a){if(a!==h){d.state=a;var b=T();if(d.state!==h)if(A.pushState)b.substr(0,3)=="/#/"&&n.replace(d.state.replace(/^\/$/,
"")+b.substr(2));else b!="/"&&b.replace(/^\/#/,"")!=H()&&u(function(){n.replace(d.state.replace(/^\/$/,"")+"/#"+b)},1);return this}return d.state},strict:function(a){if(a!==h){d.strict=a;return this}return d.strict},tracker:function(a){if(a!==h){d.tracker=a;return this}return d.tracker},wrap:function(a){if(a!==h){d.wrap=a;return this}return d.wrap},update:function(){L=r;this.value(e);L=o;return this},title:function(a){if(a!==h){u(function(){O=l.title=a;if(ba&&j&&j.contentWindow&&j.contentWindow.document){j.contentWindow.document.title=
a;ba=o}},50);return this}return l.title},value:function(a){if(a!==h){a=M(a);if(a=="/")a="";if(e==a&&!L)return;e=a;if(d.autoUpdate||L){if(B(r))return this;if(G())A[d.history?"pushState":"replaceState"]({},"",d.state.replace(/\/$/,"")+(e===""?"/":e));else{I=r;if(K)if(d.history)n.hash="#"+e;else n.replace("#"+e);else if(e!=q())if(d.history)n.hash="#"+e;else n.replace("#"+e);v&&!J&&d.history&&u(N,50);if(K)u(function(){I=o},1);else I=o}}return this}return M(e)},path:function(a){if(a!==h){var b=this.queryString(),
f=this.hash();this.value(a+(b?"?"+b:"")+(f?"#"+f:""));return this}return M(e).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(S,"/").split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},queryString:function(a){if(a!==h){var b=this.hash();this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}a=e.split("?");return a.slice(1,a.length).join("?").split("#")[0]},parameter:function(a,b,f){var m,
p;if(b!==h){var P=this.parameterNames();p=[];b=b===h||b===D?"":b.toString();for(m=0;m<P.length;m++){var Q=P[m],w=this.parameter(Q);if(typeof w=="string")w=[w];if(Q==a)w=b===D||b===""?[]:f?w.concat([b]):[b];for(var R=0;R<w.length;R++)p.push(Q+"="+w[R])}c.inArray(a,P)==-1&&b!==D&&b!==""&&p.push(a+"="+b);this.queryString(p.join("&"));return this}if(b=this.queryString()){f=[];p=b.split("&");for(m=0;m<p.length;m++){b=p[m].split("=");b[0]==a&&f.push(b.slice(1).join("="))}if(f.length!==0)return f.length!=
1?f:f[0]}},parameterNames:function(){var a=this.queryString(),b=[];if(a&&a.indexOf("=")!=-1){a=a.split("&");for(var f=0;f<a.length;f++){var m=a[f].split("=")[0];c.inArray(m,b)==-1&&b.push(m)}}return b},hash:function(a){if(a!==h){this.value(e.split("#")[0]+(a?"#"+a:""));return this}a=e.split("#");return a.slice(1,a.length).join("#")}}}();c.fn.address=function(s){this.data("address")||this.on("click",function(g){if(g.shiftKey||g.ctrlKey||g.metaKey||g.which==2)return true;var k=g.currentTarget;if(c(k).is("a")){g.preventDefault();
g=s?s.call(k):/address:/.test(c(k).attr("rel"))?c(k).attr("rel").split("address:")[1].split(" ")[0]:c.address.state()!==undefined&&!/^\/?$/.test(c.address.state())?c(k).attr("href").replace(new RegExp("^(.*"+c.address.state()+"|\\.)"),""):c(k).attr("href").replace(/^(#\!?|\.)/,"");c.address.value(g)}}).on("submit",function(g){var k=g.currentTarget;if(c(k).is("form")){g.preventDefault();g=c(k).attr("action");k=s?s.call(k):(g.indexOf("?")!=-1?g.replace(/&$/,""):g+"?")+c(k).serialize();c.address.value(k)}}).data("address",true);return this}})(jQuery);
;/*
	jQuery UI v1.11.3, http://jqueryui.com, Copyright 2015 jQuery Foundation and other contributors; Licensed MIT
*/
(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var s=0,n=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,a=n.call(arguments,1),o=0,r=a.length;r>o;o++)for(i in a[o])s=a[o][i],a[o].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(a){var o="string"==typeof a,r=n.call(arguments,1),h=this;return o?this.each(function(){var i,n=e.data(this,s);return"instance"===a?(h=n,!1):n?e.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,r),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+a+"'")}):(r.length&&(a=e.widget.extend.apply(null,[a].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(a||{}),t._init&&t._init()):e.data(this,s,new i(a,this))})),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var a=!1;e(document).mouseup(function(){a=!1}),e.widget("ui.mouse",{version:"1.11.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!a){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),a=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),a=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,a,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=s.children()[0];return e("body").append(s),t=a.offsetWidth,s.css("overflow","scroll"),i=a.offsetWidth,t===i&&(i=s[0].clientWidth),s.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,a="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return f.apply(this,arguments);n=e.extend({},n);var p,m,g,v,y,b,_=e(n.of),x=e.position.getWithinInfo(n.within),w=e.position.getScrollInfo(x),k=(n.collision||"flip").split(" "),T={};return b=s(_),_[0].preventDefault&&(n.at="left top"),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===n.at[0]?y.left+=m:"center"===n.at[0]&&(y.left+=m/2),"bottom"===n.at[1]?y.top+=g:"center"===n.at[1]&&(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),D=d+f+i(this,"marginRight")+w.width,S=c+b+i(this,"marginBottom")+w.height,N=e.extend({},y),M=t(T.my,u.outerWidth(),u.outerHeight());"right"===n.my[0]?N.left-=d:"center"===n.my[0]&&(N.left-=d/2),"bottom"===n.my[1]?N.top-=c:"center"===n.my[1]&&(N.top-=c/2),N.left+=M[0],N.top+=M[1],a||(N.left=h(N.left),N.top=h(N.top)),s={marginLeft:f,marginTop:b},e.each(["left","top"],function(t,i){e.ui.position[k[t]]&&e.ui.position[k[t]][i](N,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+M[0],p[1]+M[1]],my:n.my,at:n.at,within:x,elem:u})}),n.using&&(l=function(e){var t=v.left-N.left,i=t+m-d,s=v.top-N.top,a=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:N.left,top:N.top,width:d,height:c},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":s>0?"bottom":"middle"};d>m&&m>r(t+i)&&(h.horizontal="center"),c>g&&g>r(s+a)&&(h.vertical="middle"),h.important=o(r(t),r(i))>o(r(s),r(a))?"horizontal":"vertical",n.using.call(this,e,h)}),u.offset(e.extend(N,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-a-n;t.collisionWidth>a?h>0&&0>=l?(i=e.left+h+t.collisionWidth-a-n,e.left+=h-i):e.left=l>0&&0>=h?n:h>l?n+a-t.collisionWidth:n:h>0?e.left+=h:l>0?e.left-=l:e.left=o(e.left-r,e.left)},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-a-n;t.collisionHeight>a?h>0&&0>=l?(i=e.top+h+t.collisionHeight-a-n,e.top+=h-i):e.top=l>0&&0>=h?n:h>l?n+a-t.collisionHeight:n:h>0?e.top+=h:l>0?e.top-=l:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,o=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+c+p+f+t.collisionWidth-o-a,(0>i||r(u)>i)&&(e.left+=c+p+f)):d>0&&(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s>0||d>r(s))&&(e.left+=c+p+f))},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,o=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c="top"===t.my[1],p=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-o-a,(0>s||r(u)>s)&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,(i>0||d>r(i))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,n,o,r=document.getElementsByTagName("body")[0],h=document.createElement("div");t=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",n=e(h).offset().left,a=n>10&&11>n,t.innerHTML="",i.removeChild(t)}()}(),e.ui.position,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n
})),n?(a.isOver||(a.isOver=1,a.currentItem=i.helper.appendTo(a.element).data("ui-sortable-item",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger("toSortable",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger("out",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),a=s.options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||a||o||r,"outer"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(n=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[s]>0?!0:(t[s]=1,n=t[s]>0,t[s]=0,n)},_create:function(){var t,i,s,n,a,o=this,r=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)s=e.trim(t[i]),a="ui-resizable-"+s,n=e("<div class='ui-resizable-handle "+a+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=this.element.children(this.handles[i]).first().show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),e(this.handles[i]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,s,n,a=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),a.containment&&(i+=e(a.containment).scrollLeft()||0,s+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),o.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,a=this.axis,o=t.pageX-n.left||0,r=t.pageY-n.top||0,h=this._change[a];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,u=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:u.sizeDiff.height,a=s?0:u.sizeDiff.width,o={width:u.helper.width()-a,height:u.helper.height()-n},r=parseInt(u.element.css("left"),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css("top"),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,a,o=this.options;a={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,n=a.maxWidth/this.aspectRatio,t>a.minWidth&&(a.minWidth=t),s>a.minHeight&&(a.minHeight=s),a.maxWidth>i&&(a.maxWidth=i),a.maxHeight>n&&(a.maxHeight=n)),this._vBoundaries=a},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===s&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===s&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,a=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return a&&(e.width=t.minWidth),o&&(e.height=t.minHeight),s&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),a&&l&&(e.left=r-t.minWidth),s&&l&&(e.left=r-t.maxWidth),o&&u&&(e.top=h-t.minHeight),n&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),o=a&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&&l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,s,n,a,o,r,h=e(this).resizable("instance"),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&&(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,s){i[e]=h._num(t.css("padding"+s))}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,a=h.containerSize.width,o=h._hasScroll(c,"left")?c.scrollWidth:a,r=h._hasScroll(c)?c.scrollHeight:n,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}))},resize:function(t){var i,s,n,a,o=e(this).resizable("instance"),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&&/static/.test(c.css("position"))&&(d=h),l.left<(o._helper?h.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top<(o._helper?h.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css("position")),n&&a?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,u&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-s,u&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,s=t.containerOffset,n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?s(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):e.each(i.alsoResize,function(e){s(e)})},resize:function(t,i){var s=e(this).resizable("instance"),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0},h=function(t,s){e(t).each(function(){var t=e(this),n=e(this).data("ui-resizable-alsoresize"),a={},o=s&&s.length?s:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var i=(n[t]||0)+(r[t]||0);i&&i>=0&&(a[t]=i||null)}),t.css(a)})};"object"!=typeof n.alsoResize||n.alsoResize.nodeType?h(n.alsoResize):e.each(n.alsoResize,function(e,t){h(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis,h="number"==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((n.width-a.width)/l)*l,c=Math.round((n.height-a.height)/u)*u,p=a.width+d,f=a.height+c,m=s.maxWidth&&p>s.maxWidth,g=s.maxHeight&&f>s.maxHeight,v=s.minWidth&&s.minWidth>p,y=s.minHeight&&s.minHeight>f;s.grid=h,v&&(p+=l),y&&(f+=u),m&&(p-=l),g&&(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0>=f-u||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),f-u>0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+a.height-f),p-l>0?(i.size.width=p,i.position.left=o.left-d):(p=l-t.width,i.size.width=p,i.position.left=o.left+a.width-p))}}),e.ui.resizable,e.widget("ui.menu",{version:"1.11.3",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,s,n,a,o=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:o=!1,s=this.previousFilter||"",n=String.fromCharCode(t.keyCode),a=!1,clearTimeout(this.filterTimer),n===s?a=!0:n=s+n,i=this._filterMenuItems(n),i=a&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}o&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(e):this.select(e))},refresh:function(){var t,i,s=this,n=this.options.icons.submenu,a=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),a.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.parent(),s=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(s),t.attr("aria-labelledby",i.attr("id"))}),t=a.add(this.element),i=t.find(this.options.items),i.not(".ui-menu-item").each(function(){var t=e(this);s._isDivider(t)&&t.addClass("ui-widget-content ui-menu-divider")}),i.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},focus:function(e,t){var i,s;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,s,n,a,o,r;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-s,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),r=t.outerHeight(),0>n?this.activeMenu.scrollTop(a+n):n+r>o&&this.activeMenu.scrollTop(a+n-o+r))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var s;this.active&&(s="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s)},nextPage:function(t){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),0>i.offset().top-s-n
}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(t),void 0)},previousPage:function(t){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-s+n>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first())),void 0):(this.next(t),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(e.trim(e(this).text()))})}}),e.widget("ui.autocomplete",{version:"1.11.3",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,o="input"===n;this.isMultiLine=a?!0:o?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[a||o?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,s=!0,i=!0,void 0;t=!1,s=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case a.UP:t=!0,this._keyEvent("previous",n);break;case a.DOWN:t=!0,this._keyEvent("next",n);break;case a.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(e){return s?(s=!1,e.preventDefault(),void 0):(this._searchTimeout(e),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(e),this._change(e),void 0)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&e.trim(s).length&&(this.liveRegion.children().hide(),e("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&&s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible"),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;(!t||t&&!i&&!s)&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").text(i.label).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}}),e.ui.autocomplete;var o,r="ui-button ui-widget ui-state-default ui-corner-all",h="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",l=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},u=function(t){var i=t.name,s=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?e(s).find("[name='"+i+"'][type=radio]"):e("[name='"+i+"'][type=radio]",t.ownerDocument).filter(function(){return!this.form})),n};e.widget("ui.button",{version:"1.11.3",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,l),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,s="checkbox"===this.type||"radio"===this.type,n=s?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(r).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===o&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||e(this).removeClass(n)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),s&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return i.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var s=t.element[0];u(s).not(s).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return i.disabled?!1:(e(this).addClass("ui-state-active"),o=this,t.document.one("mouseup",function(){o=null}),void 0)}).bind("mouseup"+this.eventNamespace,function(){return i.disabled?!1:(e(this).removeClass("ui-state-active"),void 0)}).bind("keydown"+this.eventNamespace,function(t){return i.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"),void 0)}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(r+" ui-state-active "+h).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),t&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")),void 0):(this._resetButton(),void 0)},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?u(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(h),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,a=[];s.primary||s.secondary?(this.options.text&&a.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(a.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):a.push("ui-button-text-only"),t.addClass(a.join(" "))}}),e.widget("ui.buttonset",{version:"1.11.3",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),s=i.filter(":ui-button");i.not(":ui-button").button(),s.button("refresh"),this.buttons=i.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),e.ui.button,e.widget("ui.dialog",{version:"1.11.3",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,s=this;if(this._isOpen&&this._trigger("beforeClose",t)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{i=this.document[0].activeElement,i&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(n){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),a=Math.max.apply(null,n);return a>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",a+1),s=!0),s&&!i&&this._trigger("focus",t),s},open:function(){var t=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),this.close(t),void 0;if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus()}),t.preventDefault()):(this._delay(function(){s.focus()}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?(this.uiDialog.removeClass("ui-dialog-buttons"),void 0):(e.each(i,function(i,s){var n,a;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(t.element[0],arguments)},a={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,e("<button></button>",s).button(a).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){e(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,t(n))},drag:function(e,s){i._trigger("drag",e,t(s))},stop:function(n,a){var o=a.offset.left-i.document.scrollLeft(),r=a.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(o>=0?"+":"")+o+" "+"top"+(r>=0?"+":"")+r,of:i.window},e(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,t(a))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,s=this.options,n=s.resizable,a=this.uiDialog.css("position"),o="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:o,start:function(s,n){e(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,t(n))},resize:function(e,s){i._trigger("resize",e,t(s))},stop:function(n,a){var o=i.uiDialog.offset(),r=o.left-i.document.scrollLeft(),h=o.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(h>=0?"+":"")+h,of:i.window},e(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,t(a))}}).css("position",a)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(s=!0),e in i.resizableRelatedOptions&&(n[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,s,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(i=n.is(":data(ui-draggable)"),i&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(s=n.is(":data(ui-resizable)"),s&&!t&&n.resizable("destroy"),s&&"string"==typeof t&&n.resizable("option","handles",t),s||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),e=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-e):"none","auto"===s.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),e.widget("ui.progressbar",{version:"1.11.3",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),this._refreshValue(),void 0)},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=e===!1,"number"!=typeof e&&(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}})});
;/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011â€“2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);
;var t1;var justSwiped=false;var justSwipedTimeout;function setJustSwiped(){clearTimeout(justSwipedTimeout);justSwipedTimeout=setTimeout(function(){justSwiped=false},125)}
/*!
	jQuery.detectSwipe Copyright (c) 2014 Marc-Andre Lafortune - http://github.com/marcandre/detect_swipe - Based on touchwipe by Andreas Waltl, netCU Internetagentur (http://www.netcu.de) - Modified for ExpressReads by Joe Costello
*/
(function(f){f.detectSwipe={version:"2.1.1-ER",enabled:"ontouchstart" in document.documentElement,preventDefault:true,threshold:25};var h,g,c,k=false;function b(){c.removeEventListener("touchmove",a);this.removeEventListener("touchend",b)}function j(){c.removeEventListener("touchmove",a);this.removeEventListener("touchend",j);k=false;if(justSwiped){setJustSwiped();f(this).trigger("swipestop")}}function a(p){if((window.top.smallscreen&&window.top.currentview=="book_read")){if(!f(p.target).closest(".scrollable").length){p.preventDefault()}}else{if(f.detectSwipe.preventDefault){p.preventDefault()}}if(k){var l=p.touches[0].pageX;var q=p.touches[0].pageY;var n=h-l;var m=g-q;var o;if(Math.abs(n)>=f.detectSwipe.threshold){p.preventDefault();o=n>0?"left":"right"}else{if(Math.abs(m)>=f.detectSwipe.threshold){o=m>0?"up":"down"}}if(o){justSwiped=true;f(p.target).on("touchend",setJustSwiped);b.call(this);f(this).trigger("swipe",o).trigger("swipe"+o)}}}function e(l){setUsingTouch();if(l.touches.length==1){f(l.target).on("touchmove",function(m){if((window.top.smallscreen&&window.top.currentview=="book_read")){if(!f(m.target).closest(".scrollable").length){m.preventDefault();return false}else{return true}}else{if(f.detectSwipe.preventDefault){m.preventDefault();return false}else{return true}}});h=l.touches[0].pageX;g=l.touches[0].pageY;k=true;c=l.target;l.target.addEventListener("touchmove",a,false);this.addEventListener("touchend",b,false);this.addEventListener("touchend",j,false)}}function d(){this.addEventListener&&this.addEventListener("touchstart",e,supportsPassive?{passive:true}:false)}function i(){this.removeEventListener("touchstart",e)}f.event.special.swipe={setup:d};f.each(["left","up","down","right"],function(){f.event.special["swipe"+this]={setup:function(){f(this).on("swipe",f.noop)}}})})(jQuery);(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){module.exports=a(require("jquery"))}else{a(jQuery)}}}(function(e){var b=e.event.dispatch||e.event.handle;var a=e.event.special,d="D"+(+new Date()),c="D"+(+new Date()+1);a.scrollstart={setup:function(h){var g=e.extend({latency:a.scrollstop.latency},h);var i,f=function(l){var j=this,k=arguments;if(i){clearTimeout(i)}else{l.type="scrollstart";b.apply(j,k)}i=setTimeout(function(){i=null},g.latency)};e(this).bind("scroll",f).data(d,f)},teardown:function(){e(this).unbind("scroll",e(this).data(d))}};a.scrollstop={latency:250,setup:function(h){var g=e.extend({latency:a.scrollstop.latency},h);var i,f=function(l){var j=this,k=arguments;if(i){clearTimeout(i)}i=setTimeout(function(){i=null;l.type="scrollstop";b.apply(j,k)},g.latency)};e(this).bind("scroll",f).data(c,f)},teardown:function(){e(this).unbind("scroll",e(this).data(c))}}}));
;/*
	jQuery.scrollTo v2.1.1 Copyright (c) 2007-2015 Ariel Flesler - aflesler<a>gmail<d>com | http://flesler.blogspot.com | MIT License
*/
;(function(f){"use strict";"function"===typeof define&&define.amd?define(["jquery"],f):"undefined"!==typeof module&&module.exports?module.exports=f(require("jquery")):f(jQuery)})(function($){"use strict";function n(a){return!a.nodeName||-1!==$.inArray(a.nodeName.toLowerCase(),["iframe","#document","html","body"])}function h(a){return $.isFunction(a)||$.isPlainObject(a)?a:{top:a,left:a}}var p=$.scrollTo=function(a,d,b){return $(window).scrollTo(a,d,b)};p.defaults={axis:"xy",duration:0,limit:!0};$.fn.scrollTo=function(a,d,b){"object"=== typeof d&&(b=d,d=0);"function"===typeof b&&(b={onAfter:b});"max"===a&&(a=9E9);b=$.extend({},p.defaults,b);d=d||b.duration;var u=b.queue&&1<b.axis.length;u&&(d/=2);b.offset=h(b.offset);b.over=h(b.over);return this.each(function(){function k(a){var k=$.extend({},b,{queue:!0,duration:d,complete:a&&function(){a.call(q,e,b)}});r.animate(f,k)}if(null!==a){var l=n(this),q=l?this.contentWindow||window:this,r=$(q),e=a,f={},t;switch(typeof e){case "number":case "string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(e)){e= h(e);break}e=l?$(e):$(e,q);if(!e.length)return;case "object":if(e.is||e.style)t=(e=$(e)).offset()}var v=$.isFunction(b.offset)&&b.offset(q,e)||b.offset;$.each(b.axis.split(""),function(a,c){var d="x"===c?"Left":"Top",m=d.toLowerCase(),g="scroll"+d,h=r[g](),n=p.max(q,c);t?(f[g]=t[m]+(l?0:h-r.offset()[m]),b.margin&&(f[g]-=parseInt(e.css("margin"+d),10)||0,f[g]-=parseInt(e.css("border"+d+"Width"),10)||0),f[g]+=v[m]||0,b.over[m]&&(f[g]+=e["x"===c?"width":"height"]()*b.over[m])):(d=e[m],f[g]=d.slice&& "%"===d.slice(-1)?parseFloat(d)/100*n:d);b.limit&&/^\d+$/.test(f[g])&&(f[g]=0>=f[g]?0:Math.min(f[g],n));!a&&1<b.axis.length&&(h===f[g]?f={}:u&&(k(b.onAfterFirst),f={}))});k(b.onAfter)}})};p.max=function(a,d){var b="x"===d?"Width":"Height",h="scroll"+b;if(!n(a))return a[h]-$(a)[b.toLowerCase()]();var b="client"+b,k=a.ownerDocument||a.document,l=k.documentElement,k=k.body;return Math.max(l[h],k[h])-Math.min(l[b],k[b])};$.Tween.propHooks.scrollLeft=$.Tween.propHooks.scrollTop={get:function(a){return $(a.elem)[a.prop]()}, set:function(a){var d=this.get(a);if(a.options.interrupt&&a._last&&a._last!==d)return $(a.elem).stop();var b=Math.round(a.now);d!==b&&($(a.elem)[a.prop](b),a._last=this.get(a))}};return p});
;window.jqNotify=function(d,b,c,a){if(typeof b=="undefined"){var b=false}notify(d,true,b,c,a)};window.notify=function(b,d,g,i,j){if(typeof d=="undefined"){var d=false}if(typeof g=="undefined"){var g=false}if(testing||d===true){var a=$(document.createElement("div"));if(g){a.addClass("noOverlayClose")}if(typeof b=="string"){a.html("<p>"+b+"</p>")}else{if(typeof b=="object"){var h="";for(var k in b){h+="<p>"+b[k]+"</p>"}a.html(h)}}var l={};var c=display_message.ok;if(typeof j=="string"&&c.length){c=j}l[c]=function(){a.dialog("close");a.remove()};var f={};f.resizable=false;f.draggable=false;f.modal=true;f.appendTo="body";f.buttons=l;if(typeof i=="string"){f.title=i}if(currentview=="book_read"){f.appendTo="#reader_container";if(smallscreen){f.position={of:$(window)}}else{f.position={of:$("#reader")}}}a.dialog(f)}};window.jqConfirm=function(a,f,h,c){var b=$(document.createElement("div"));if(typeof a=="string"){b.html("<p>"+a+"</p>")}else{if(typeof a=="object"){var g="";for(var i in a){g+="<p>"+a[i]+"</p>"}b.html(g)}}var j={};j[display_message.cancel]=function(){b.dialog("close");b.remove()};j[display_message.ok]=function(){b.dialog("close");b.remove();f()};if(typeof c=="object"){j.concat(c)}var d={};d.resizable=false;d.draggable=false;d.modal=true;d.appendTo="body";d.buttons=j;if(typeof h=="string"){d.title=h}if(currentview=="book_read"){d.appendTo="#reader_container";if(smallscreen){d.position={of:$(window)}}else{d.position={of:$("#reader")}}}b.dialog(d)};window.jqPrompt=function(a,f,g,j,c,h){if(typeof g!="string"){var g=""}if(typeof j!="string"){var j=""}if(typeof c!="string"){var c=null}if(typeof h!="string"){var h=""}var k="jqPrompt"+Date.now();var d=$(document.createElement("div"));d.attr("title",a);d.html("<textarea id='"+k+"' placeholder='"+h+"'>"+g+"</textarea>"+j);var i={};i[display_message.cancel]=function(){d.dialog("close");d.remove()};i[display_message.ok]=function(){var l=$("#"+k).val();d.dialog("close");d.remove();f(l)};var b={};b.resizable=false;b.draggable=false;b.modal=true;b.appendTo="body";b.buttons=i;if(c){b.position={of:c}}if(currentview=="book_read"){b.appendTo="#reader_container";if(smallscreen){b.position={of:$(window)}}else{b.position={of:$("#reader")}}}d.dialog(b);return k};if(!Date.now){Date.now=function(){return new Date().getTime()}}function isFunction(a){return(typeof(a)==typeof(Function))}var lastTime=Date.now();function timeSince(){var a=Date.now();var b=a-lastTime;lastTime=a;return(b/1000)+" seconds"}function hostReachable(){var b=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");b.open("HEAD","//"+window.location.hostname+"/?t="+Date.now(),false);try{b.send();return(b.status>=200&&(b.status<300||b.status===304))}catch(a){return false}}function ifServerOnline(a,b){if(checkOnline()){a&&a.constructor==Function&&a()}else{b&&b.constructor==Function&&b()}}function checkOnline(){var a=hostReachable();setOnline(a);return a}function setOnline(a){if(a){online=true;$(".online_only").off("click",false).removeClass("disabled").prop("title","").prop("disabled",false)}else{online=false;$(".online_only").on("click",false).addClass("disabled").prop("title",display_message.online_only).prop("disabled",true)}}function browser_support(a){try{return a in window&&window[a]!==null}catch(b){return false}}function xmlToString(a){try{return(new XMLSerializer()).serializeToString(a)}catch(b){try{return a.xml}catch(b){return false}}return false}function escapeRegExp(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function replaceAll(a,c,b){return a.replace(new RegExp(escapeRegExp(c),"g"),b)}function getObjectType(a){return Object.prototype.toString.call(a)}function getHTMLDocument(a){if(getObjectType(a)=="[object HTMLDocument]"){return a}else{if(getObjectType(a)=="[object HTMLIFrameElement]"){return a.contentDocument||a.contentWindow.document}else{return false}}}function hideKeyboard(a){var a=a||document;a.activeElement.blur();$(a).find("input").blur()}function getLocaleShortDateString(h){var c={"en-US":"MM/dd/yyyy","en-GB":"dd/MM/yyyy"};var b=navigator.language?navigator.language:navigator.userLanguage,i=h.getFullYear(),a=h.getMonth()+1,h=h.getDate();c=(b in c)?c[b]:"MM/dd/yyyy";function g(d){d=""+d;return d.length>1?d:"0"+d}c=c.replace(/yyyy/,i);c=c.replace(/yy/,String(i).substr(2));c=c.replace(/MM/,g(a));c=c.replace(/M/,a);c=c.replace(/dd/,g(h));c=c.replace(/d/,h);return c}function getTime(a){var b=a.getHours();var c="am";if(b>12){b-=12;c="pm"}noteTimeMinutes=a.getMinutes();return b+":"+noteTimeMinutes+c}function data_put(a,b){if(b===null||b==""){return data_del(a)}else{return amplify.store(a,b)}}function data_get(a){return amplify.store(a)}function data_del(a){return amplify.store(a,null)}function elementParentTop(d,c){return($("#"+c).offset().top-($("#"+d).offset().top-$("#"+d).scrollTop()))}function readerTop(){return elementParentTop("main","reader")}jQuery.fn.oneFingerScroll=function(){var b=0;var a=0;$(this).bind("touchstart",function(c){var d=c.originalEvent;b=$(this).scrollLeft()+d.touches[0].pageX;
a=$(this).scrollTop()+d.touches[0].pageY;d.preventDefault()});$(this).bind("touchmove",function(c){var d=c.originalEvent;$(this).scrollLeft(b-d.touches[0].pageX);$(this).scrollTop(a-d.touches[0].pageY);d.preventDefault()});return this};function unixTimestamp(a){if(typeof a=="undefined"){return Math.floor(Date.now()/1000)}else{return Math.floor(a/1000)}}if(!String.prototype.endsWith){String.prototype.endsWith=function(c,b){var a=this.toString();if(b===undefined||b>a.length){b=a.length}b-=c.length;var d=a.indexOf(c,b);return d!==-1&&d===b}}if(!String.prototype.toSafeDataAttrName){String.prototype.toSafeDataAttrName=function(){return this.toString().toLowerCase().replace(/[^a-z0-9]/g,"")}}function removeQueryParameter(d,f){if(d.substr(0,1)=="#"||d.substr(0,1)=="?"){d=d.substr(1)}var c=encodeURIComponent(f)+"=";var b=d.split(/[&;]/g);for(var a=b.length;a-->0;){if(b[a].lastIndexOf(c,0)!==-1){b.splice(a,1)}}return(b.length>0?b.join("&"):"")}function getQueryVar(a,c){if(typeof c=="undefined"||!c.length){var c=window.location.hash.substring(1)}if(c.substr(0,1)=="#"||c.substr(0,1)=="?"){c=c.substr(1)}var d=c.split("&");for(var b=0;b<d.length;b++){var f=d[b].split("=");if(f[0]==a){return f[1]||true}}return(false)}if(!String.prototype.startsWith){String.prototype.startsWith=function(b,a){a=a||0;return this.substr(a,b.length)===b}}var supportsPassive=false;try{var opts=Object.defineProperty({},"passive",{get:function(){supportsPassive=true}});window.addEventListener("testPassive",null,opts);window.removeEventListener("testPassive",null,opts)}catch(e){}var logToServer=false;var autoUpdateLog=true;var logRefresher=null;window.log=function(){if(env_name==="LIVE"){return}log.history=log.history||[];log.history.push(arguments);if(logToServer){var b=arguments[0];var a=Math.floor(Date.now()/1000);$.post("log-line-save.php",{ts:a,line:b})}if(testing){var b=arguments[0];if(typeof output=="string"){develMsg(escapeHtml(b))}else{develMsg(b)}}if(testing&&this.console){arguments.callee=arguments.callee.caller;console.log(Array.prototype.slice.call(arguments))}};(function(f){function i(){}for(var h="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),g;g=h.pop();){f[g]=f[g]||i}})(window.console=window.console||{});function escapeHtml(b){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};if(b.length){return b.replace(/[&<>"']/g,function(c){return a[c]})}else{return""}}function get_log(){var d=log.history;var b="";var g={};var f=new Array();for(var a in d){f.unshift(a)}for(var l=f.length,j=0;j<l;j++){var i=d[f[j]][0];b+="<p>"+f[j]+": ";if(typeof output=="string"){b+=escapeHtml(i)}else{b+=i}b+="</p>"}g.pagetitle="JS log";g.view="log";g.content="<h1>Technical information</h1>";g.content+="<p>Version "+appVersion+"</p>";if(typeof jsts=="undefined"){g.content+="<p>In devel mode (no build timestamp)</p>"}else{g.content+="<p>Built: "+(new Date(jsts*1000).toUTCString())+"</p>"}g.content+="<p><button onclick='logToServer=!logToServer;displayLog();return false;'>Log-to-server is "+((logToServer)?"on":"off")+"</button></p>";g.content+="<p><button onclick='autoUpdateLog=!autoUpdateLog;displayLog();return false;'>Auto-refresh is "+((autoUpdateLog)?"on":"off")+"</button> <button onclick='checkForUpdate();return false;'>Check for update</button> <button onclick='reloadApp();' class='site_button'>Reload</button></p>";g.content+="<p><button onclick='clearTempData();return false;'>Clear temporary data</button> <a href='#view=test_page' class='site_button'>Test page</a></p>";g.content+="<p><button onclick='logCurrentHref();return false;'>Current HREF</button></p>";g.content+="<h1>JS log output:</h1><pre style='text-align:left'>"+b+"</pre><hr><p>End of log</p><br>";return g}function logCurrentHref(){log(location.href)}function clearTempData(){data_del("user_books_data");data_del("booksBrowseListUpdated");data_del("booksBrowseListHTML");data_del("news_feed");data_del("booksBrowseListAlphaHTML");jqNotify("Temporary data cleared")}window.onerror=function(c,b,a){log('Error: "'+c+'", Script: '+b+", Line "+a)};function displayLog(){var a=get_log();displayPage(a);setTimeout(function(){if(smallscreen){$("#content").height($(window).height()).width($(window).width())}if(logRefresher===null&&autoUpdateLog){startLogRefresher()}},500)}function startLogRefresher(){logRefresher=setInterval(function(){if(currentview=="log"&&autoUpdateLog){displayLog()}else{window.clearInterval(logRefresher);logRefresher=null}},1000)}var develMsgTimeout;function develMsg(a){if(testing===true){$("#develMsg").html(a).show();clearTimeout(develMsgTimeout);develMsgTimeout=setTimeout(function(){$("#develMsg").hide()},3000)}}var testMsg=develMsg;
/*!
	ER system code written by Joe Costello, copyright 2015 - 2020 ExpressReads Ltd.
*/
;var appVersion="1.51";var test1;var usingTouch=null;var standalone=("standalone" in window.navigator&&window.navigator.standalone);if(!standalone){standalone=(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches)
}if(!standalone){standalone=(("external" in window&&typeof window.external.msIsSiteMode=="function")&&window.external.msIsSiteMode())?true:false}var online=null;var pageFuncs={};var currentview="";var hrefLoaded="";var hrefHistory=[];var fadeTime=250;var firstLoaded=false;var changeHashStarted=false;var barsHidden=false;var isLoading=true;var startLoadingTs=0;var url_base;var smallscreen=null;var lv=document.getElementById("loading_version");lv.innerHTML="Version "+appVersion;var secretAreaTapCount=0;var secretAreaTapLast=0;function set_feedback_debug_string(){var a="V"+appVersion+", ";if(typeof jsts!="undefined"){a+="built "+(new Date(jsts*1000).toUTCString())}else{a+="no build"}a+=", standalone="+standalone+", UA="+navigator.userAgent+", URL="+window.location.href+", user_id="+user_id+", ";a+="screenWidth="+screen.width+", screenHeight="+screen.height+", windowWidth="+window.innerWidth+", windowHeight="+window.innerHeight;$("#main_menu_feedback").prop("href","mailto:info@samuelfrench.com?subject=Abbott%20feedback&body="+encodeURIComponent("\n\n--------------------------\n\nAbbott debug info (do not edit):\n"+a+"\n\n"))}set_feedback_debug_string();var browserHasPlaceholderSupport=(function(){var a=document.createElement("input");return("placeholder" in a)})();function setUsingTouch(){if(!usingTouch){usingTouch=true;$(document).off("touchstart",setUsingTouch)}}$(window).ready(function(){url_base=$("base").attr("href")});$(document).ready(function(){$(document).on("touchstart",setUsingTouch);$("#main_menu_feedback").on("touchstart mousedown",function(a){set_feedback_debug_string()});screensize();setTimeout(function(){log("serviceWorkerUpdateFound = "+serviceWorkerUpdateFound);if(serviceWorkerUpdateFound===false){init_content_storage()}},1500)});function ready2(){localforage.config({name:sitename.replace(/\W+/g,"_")});if(localforage.config("driver")=="localStorageWrapper"){localforage_LocalStorage=true}else{localforage_LocalStorage=false}books_data_remove_from_LocalStorage();if(user_id){$(".main_menu_item").show();$(".logged_out_only").hide()}else{$(".logged_out_only").show()}$("#main_menu_log").show();ajaxify();if(typeof pageFuncs.page_header["loaded"]=="function"){pageFuncs.page_header["loaded"]()}new FastClick(document.body);$.address.change(function(j){var i=j.value;if(i.substr(0,1)=="/"||i.substr(0,1)=="#"){i=i.substr(1)}if(i!=hrefLoaded){if(i.length>1){loadPage(i)}}});if(standalone){$("html").addClass("standalone")}else{$("#backbutton").remove()}if(online&&user_id){update_user_books()}if(online&&user_territory_id==110){var c=data_get("news_feed_updated");if(typeof c=="undefined"){var c=0}var a=Date.now()-c;if(a>86400000){pageFuncs.news_feed.init(true)}}if(!standalone){setTimeout(function(){$.getScript("js/addtohomescreen-abbott.min.js",function(){addToHomescreen({modal:true,skipFirstVisit:false,startDelay:0,lifespan:0,maxDisplayCount:1})})},1000)}$.detectSwipe.preventDefault=false;$("#main_content").on("swipeup",function(){if(smallscreen&&currentview!="book_read"){topButtons(false)}}).on("swipedown",function(){if(smallscreen&&currentview!="book_read"){topButtons(true)}}).on("swipestop",function(){if(smallscreen&&currentview!="book_read"&&$("#main").scrollTop()<8){topButtons(true)}});if(smallscreen){$.event.special.scrollstop.latency=250;$("#main").on("scrollstop",function(){if(smallscreen&&currentview!="book_read"){if($("#main").scrollTop()<8){topButtons(true)}else{if($("#main").scrollTop()+$("#main").height()>=$("#main_content").height()){topButtons(false)}}}})}setTimeout(function(){$("#topbuttons").on("touchend",function(){if(secretAreaTapLast>Date.now()-400){secretAreaTapCount++;if(secretAreaTapCount>6){secretAreaTapLast=0;secretAreaTapCount=1;var i="Version "+appVersion;if(typeof jsts!="undefined"){i+=", built "+(new Date(jsts*1000).toUTCString())}jqConfirm(i+". View log?",function(){changeHash("view=log")})}}else{secretAreaTapLast=0;secretAreaTapCount=1}secretAreaTapLast=Date.now()})},1000);if(!online){var b=data_get("last_view")||"";if(getQueryVar("view",b)!="book_read"){b="view=user_books"}changeHash(b)}else{if(window.location.hash.length==0||standalone){var b="view=home";var g=data_get("last_view")||"";var d=data_get("last_view_timestamp")||0;if(last_view.length||g.length){if(last_view.length&&last_view_timestamp>d){b=last_view}else{if(g.length){b=g}}}if(getQueryVar("view",b)=="welcome"||b.length==0){b="view=home"}reloadPageHeader();if(user_territory_id==105&&(b=="view=news_feed"||b=="view=user_subscription_choose")){b="view=home"}changeHash(b)}else{var h=window.location.hash;if(getQueryVar("view",h.substring(1))=="welcome"||h.length==0){changeHash("view=home")}else{var f=getQueryVar("view",h.substring(1));if(user_territory_id==105&&(f=="news_feed"||f=="user_subscription_choose")){changeHash("view=home")}else{loadPage(h)}reloadPageHeader()}}}}function hideBars(){barsHidden=true;$("#main_content").addClass("no_header");$("#page_header").fadeTo(fadeTime,0,function(){$("#page_header").hide()});$("#topbuttons, #topspacer").hide()
}function showBars(){barsHidden=false;$("#main_content").removeClass("no_header");$("#page_header").show().fadeTo(fadeTime,1);if(smallscreen){$("#topbuttons, #topspacer").show()}}function toggleMenu(){if(smallscreen){if($("#page_header").offset().left<0){openMenu()}else{closeMenu()}}}function openMenu(){if(smallscreen){$("#search").val("");$("#page_header_inner").scrollTop(0);$("#page_header").stop(true).animate({left:0},fadeTime);$("#main_overlay").fadeIn(fadeTime).on("click",function(a){a.preventDefault;closeMenu()})}}function closeMenu(){if(smallscreen){var a=$("#page_header");a.stop(true).animate({left:0-Math.ceil(parseFloat(a.width()))},fadeTime);$("#main_overlay").fadeOut(fadeTime)}}function isMenuOpen(){if(barsHidden||$("#page_header").offset().left<0){return false}return true}var readerResizeTimer,supportsOrientationChange="onorientationchange" in window,orientationEvent=supportsOrientationChange?"orientationchange":"resize";window.addEventListener(orientationEvent,function(){if(window.spinner){window.spinner.spin()}clearTimeout(readerResizeTimer);readerResizeTimer=setTimeout(function(){screensize();if(typeof pageFuncs[currentview]=="object"&&typeof pageFuncs[currentview]["resized"]=="function"){pageFuncs[currentview]["resized"]()}},250)},false);function screensize(){if($(window).width()<=1024||$(window).height()<=600){smallscreen=true;$("html").addClass("smallscreen")}else{smallscreen=false;$("html").removeClass("smallscreen")}$("#content").width(Math.ceil($(window).width())).height(Math.ceil($(window).height()));if(smallscreen){if(!barsHidden){if($("#page_header").position().left>=0){topButtons(true,0);openMenu()}}}else{$("#content").height("auto");topButtons(false,0);if(!barsHidden){$("#page_header").animate({left:0},0)}}if(smallscreen){var a=parseInt($("#page_header_inner").css("margin-top").replace("px",""),10);$("#page_header_inner").height(Math.ceil($(window).height())-a)}}function ajaxify(a){if($.trim(a).length){a+=" "}else{a=""}if(!browserHasPlaceholderSupport){$(a+'input[type="text"][placeholder]').each(function(){var b=$(this);if(b.attr("placeholder")!=""){if(b.val()==""){b.val(b.attr("placeholder")).addClass("weak")}b.focus(function(){if(b.val()==b.attr("placeholder")){b.val("").removeClass("weak")}});b.blur(function(){if(b.val()==""){b.val(b.attr("placeholder")).addClass("weak")}})}})}$(a+"a").each(function(){var b=$(this).attr("href");if(typeof b=="string"&&b.length&&($(this).hasClass("no_ajaxify")||b.substr(0,4)=="http")){$(this).prop("target","_blank");if(!$(this).hasClass("no_ext_icon")&&!$(this).find("img.icon-external").length&&!$(this).find(".icon-link-external").length){$(this).append('<span class="icon-link-external"></span>')}return true}if(typeof b=="string"&&b.length&&!($(this).hasClass("no_ajaxify"))&&b.substr(0,6)!="#view="&&b.substr(0,10)!="#external="){b="#view="+b;b=b.replace(".php?","&");b=b.replace(".php","");if(b.length>7){$(this).prop("href",b)}return true}if(typeof b=="string"&&b.length&&!($(this).hasClass("no_ajaxify"))&&b.substr(0,10)=="#external="){$(this).on("click",function(c){c.preventDefault();changeHref($(this).attr("href").substr(10));return false});return true}});$(a+'form[class!="no_ajaxify"]').bind("submit",function(c){c.preventDefault();if(typeof formSubmit=="function"){formSubmit()}if($(this).attr("method").toUpperCase()=="GET"){var b=$(this).attr("action");if(typeof b=="string"&&b.length&&!($(this).hasClass("no_ajaxify"))&&b.substr(0,6)!="#view="&&b.substr(0,10)!="#external="){b="#view="+b;b=b.replace(".php?","&");b=b.replace(".php","&");b+=$(this).serialize()}changeHash(b)}else{var b=url_base+$(this).attr("action");if(b.match(/\?/g)){b+="&"}else{b+="?"}b+="ajax=1";if(testing){startLoading(b)}else{startLoading()}var d=$(this).serialize();setTimeout(function(){$.post(b,d,function(f){if(f.errors){jqNotify("ThereÂ was an error submitting that form")}else{if(f.redirect){if(f.reload_page_header){reloadPageHeader()}if(f.update_user_books){update_user_books()}if(f.redirect.substr(0,1)=="#"){changeHash(f.redirect)}else{changeHref(f.redirect)}}else{if(f.content){displayPage(f)}}}},"json")},fadeTime+50)}})}var loadingTimeout;function startLoading(d,f,a){clearTimeout(loadingTimeout);if(typeof f=="undefined"){var f=false}if(typeof a=="undefined"){var a=false}var c=isLoading;isLoading=true;var b=Date.now();startLoadingTs=b;$("a:focus").blur();if(typeof d!="string"){var d=display_message.loading}if(testing){d="TESTING MODE<br>"+d.replace("&ajax=1","");if(a){d+="<br>waitForever"}}$("#loading_message h1").html(d);if(testing){$("#content_loading").stop(true).fadeTo(fadeTime,0.5)}else{$("#content_loading").stop(true).fadeTo(fadeTime,1)}if(!f&&!c){setTimeout(function(){$("#main_content").html("");if(currentview.length){$("html, #content").removeClass(currentview)}$("html, body, #main").scrollTop(0)},fadeTime)}if(testing&&typeof d=="string"){$("#main_menu_info").html("<p>"+d+"</p>")}if(!a){if(f){loadingTimeout=setTimeout(function(){if(isLoading&&startLoadingTs==b){stopLoading();
changeHash("view=user_books")}},7500)}else{loadingTimeout=setTimeout(function(){if(isLoading&&startLoadingTs==b){startLoading(display_message.loading_long_time,true)}},fadeTime+7500)}}}function stopLoading(){isLoading=false;if(smallscreen&&($("#content").height<$(window).height||$("#main_content").width()<$(window).width())){$("#content").height($(window).height()).width($(window).width())}if(smallscreen){if(currentview=="book_read"){$("#main").scrollTop(readerTop())}else{$("#main").scrollTop(0);topButtons(true)}}$("#content_loading").fadeOut(fadeTime,function(){if(!firstLoaded){firstLoaded=true;$("#content_loading").addClass("firstLoaded")}})}function changeHref(a){var b=window.location.href.split("/")[2].replace("www.","");var c=a.split("/")[2].replace("www.","");if(c!=b){startLoading(display_message.redirecting_to+" "+c+"...",false,true)}else{if(a==app_url+"user_log_out.php"){startLoading(display_message.logging_out,false,true)}else{if(a==app_url+"user_log_in.php"){startLoading(display_message.logging_in,false,true)}else{startLoading()}}}setTimeout(function(){$("#main_content").html("")},fadeTime);window.location.href=a;return true}function changeHash(a){a=removeQueryParameter(a,"erts");if(a.substr(0,1)!="#"){a="#"+a}a+="&erts="+Date.now();window.location.hash=a}function loadPage(c){if(currentview=="book_read"){books_data_remove_from_LocalStorage();window.reader=null;window.placeSaver=null;window.spinner=null}if(currentview=="log"){window.clearInterval(logRefresher)}if(c.substr(0,1)=="/"||c.substr(0,1)=="#"){c=c.substr(1)}hrefLoaded=c;if(google_analytics_id!=""&&window.ga){var b=window.location.pathname+"#"+removeQueryParameter(c,"erts");window.ga("send","pageview",b)}var a=getQueryVar("view",c);showBars();hrefHistoryAdd(c);if(standalone&&hrefHistory.length>1){$("#backbutton").show()}var f="";var h="";if(c.substr(0,5)=="view="){f=c+"&ajax=1";h=url_base+"?"+f;if(a=="user_subscription_choose_do"||a=="basket_send"){if(testing){startLoading(f,false,true)}else{startLoading(null,false,true)}}else{if(testing){startLoading(f)}else{startLoading()}}closeMenu();$("#alphaList").fadeOut(fadeTime,function(){$("#alphaList").remove()});if(a=="log"){last_view_store(c);setTimeout(function(){displayLog();stopLoading()},fadeTime+10)}else{if(a=="news_feed"){last_view_store(c);setTimeout(function(){pageFuncs.news_feed["init"]()},fadeTime+10)}else{if(a=="help_page"||a=="software_credits"){last_view_store(c);setTimeout(function(){var i={};i.pagetitle=display_message[a+"_title"];i.view=a;i.content=data_get(a);displayPage(i)},fadeTime+10)}else{if(a=="book_read"){setTimeout(function(){var i=c.replace("view=book_read&book_id=","");i=parseInt(i);if(!isNaN(i)&&i>0){last_view_store(c);book_init(i)}else{changeHash("view=user_books")}$.get(h)},fadeTime+10)}else{var g=Date.now();var d=6000;if(a=="basket_send"){d=15000}last_view_store(c);$.ajax({url:h,dataType:"json",cache:false,timeout:d}).done(function(j){setOnline(true);if(j.redirect){if(j.reload_page_header){reloadPageHeader()}if(j.update_user_books){update_user_books()}if(j.redirect.substr(0,1)=="#"){changeHash(j.redirect)}else{changeHref(j.redirect)}}else{if(j.content){if(j.view=="user_books"){update_user_books(j)}var i=0-((Date.now()-g)-fadeTime);if(i<0){i=0}setTimeout(function(){displayPage(j)},i+10)}}}).fail(function(){setOnline(false);if(user_id){if(a!="user_books"){jqNotify(display_message.offline)}var i=0-((Date.now()-g)-fadeTime);if(i<0){i=0}setTimeout(function(){var j=data_get("user_books_data");if(j){displayPage(j)}else{stopLoading();jqNotify(display_message.offline_and_no_data)}},i+10)}else{stopLoading();a="offline_and_logged_out";setTimeout(function(){var j={};j.pagetitle=display_message[a+"_title"];j.view=a;j.content=data_get(a);displayPage(j);$("html").removeClass("offline_and_logged_out").addClass("user_log_in_prompt")},fadeTime+10)}})}}}}}else{if(c.substr(0,9)=="external="){h=c.substr(9);changeHref(h)}}}function displayPage(data,leaveLoading){if(typeof leaveLoading=="undefined"){leaveLoading=false}var pagetitle=sitename;if(typeof data.pagetitle!="undefined"&&data.pagetitle!=null){pagetitle=data.pagetitle+" | "+sitename}$("head title").html(pagetitle);if(currentview.length){$("html, #content").removeClass(currentview)}currentview=data.view;$("html, #content").addClass(currentview);var ts_string='<div id="topspacer"></div>';var topspacer=(!barsHidden&&data.content.indexOf(ts_string)<0)?ts_string:"";$("#main_content").html(topspacer).append(data.content);$(".main_menu_item").removeClass("active");$("#main_menu_"+currentview).addClass("active");ajaxify("#main_content");if(data.reload_page_header||getQueryVar("reload_page_header")==1){reloadPageHeader()}if(data.update_user_books||getQueryVar("update_user_books")==1){update_user_books()}showBars();data_del("welcomed");if(data.stylesheets){$(data.stylesheets).each(function(v){if(document.createStyleSheet){document.createStyleSheet(data.stylesheets[v])}else{$("head").append($("<link rel='stylesheet' href='"+data.stylesheets[v]+"' type='text/css' media='screen'>"))
}})}if(data.javascripts){$(data.javascripts).each(function(v){if(data.javascripts[v].match(/^javascript:/)){var str=""+data.javascripts[v].replace("javascript:","")+"";eval(str)}else{$.getScript(data.javascripts[v])}})}setTimeout(function(){new FastClick(document.getElementById("main_content"));if(!leaveLoading&&(!smallscreen||currentview!="book_read")&&currentview!="books_browse"&&currentview!="user_books"&&currentview!="home"){stopLoading()}if(currentview=="book_read"){$.detectSwipe.preventDefault=true}else{$.detectSwipe.preventDefault=false}if(typeof pageFuncs[currentview]=="object"&&typeof pageFuncs[currentview]["loaded"]=="function"){pageFuncs[currentview]["loaded"](data)}},250)}function reloadPageHeader(){if(!barsHidden){setTimeout(function(){$.ajax({url:"page_header.php?ajax=1&currentview="+currentview,dataType:"json",success:function(a){if(a.content){$("#header_bits").html(a.content);ajaxify("#header_bits");if(standalone&&hrefHistory.length>1){$("#backbutton").show()}else{$("#backbutton").hide()}if(typeof pageFuncs.page_header["loaded"]=="function"){pageFuncs.page_header["loaded"]()}}}})},250)}}function reloadTokensStatus(){$("#tokens_status").fadeOut(500);setTimeout(function(){$.ajax({url:"tokens_status.php?ajax=1",dataType:"json",success:function(a){if(a.content){$("#tokens_status").html(a.content);ajaxify("#tokens_status")}}})},500);update_user_books()}function init_content_storage(){if(Modernizr.localstorage){localStorageAvailable=true}else{localStorageAvailable=false}if(window.JSON){jsonAvailable=true}else{jsonAvailable=false}if(!jsonAvailable||!localStorageAvailable){canStoreOffline=false}else{canStoreOffline=true}$.ajax({type:"GET",url:"user_data.js.php",timeout:6000,dataType:"script"}).done(function(){setOnline(true);if(typeof template_book_read=="string"&&template_book_read.length){data_put("template_book_read",template_book_read)}if(typeof template_news_feed=="string"&&template_news_feed.length){data_put("template_news_feed",template_news_feed)}if(typeof template_news_feed_article=="string"&&template_news_feed_article.length){data_put("template_news_feed_article",template_news_feed_article)}if(typeof help_page=="string"&&help_page.length){data_put("help_page",help_page)}if(typeof software_credits=="string"&&software_credits.length){data_put("software_credits",software_credits)}if(typeof offline_and_logged_out=="string"&&offline_and_logged_out.length){data_put("offline_and_logged_out",offline_and_logged_out)}var a=data_get("user_id")||null;if(!a){data_put("user_id",user_id)}data_put("testing",testing);data_put("sitename",sitename);checkUser()}).fail(function(){setOnline(false);user_id=data_get("user_id")||null;testing=data_get("testing");sitename=data_get("sitename")}).always(function(){ready2()})}function goBack(){if(hrefHistory.length>1){var b=hrefHistory.pop();var a=hrefHistory.pop();changeHash(a)}else{if(hrefHistory.length==1){changeHash(hrefHistory[0])}}if(hrefHistory.length<2){$("#backbutton").hide()}}function bc(a){return bookClick(a)}function bookClick(a){if(online){changeHash("view=book_info&book_id="+a)}else{changeHash("view=book_read&book_id="+a)}return false}function topButtons(b,c){if(smallscreen){if(typeof c=="undefined"){c=fadeTime}var a=$("#topbuttons");a.stop(true);if(!barsHidden&&(b||isMenuOpen())){a.animate({top:0},c)}else{a.animate({top:0-a.outerHeight()},c)}}}$(document).on("click",".ui-widget-overlay",function(a){a.preventDefault();var b=$(this).siblings(".ui-dialog:visible").find(".ui-dialog-content");if(b.length&&b.dialog("isOpen")&&!b.hasClass("noOverlayClose")){b.dialog("close")}});$(document).keydown(function(a){if(typeof pageFuncs[currentview]=="object"){if(typeof pageFuncs[currentview]["keydownPreventDefault"]=="boolean"&&pageFuncs[currentview]["keydownPreventDefault"]==true){a.preventDefault()}if(typeof pageFuncs[currentview]["keydown"]=="function"){pageFuncs[currentview]["keydown"](a)}}});var last_views=new Array("welcome","home","book_read","book_info","books_browse","books_search","user_books","user_subscription_choose","user_subscription_rent_book","help_page","log","test_page","news_feed");function last_view_store(a){if(last_views.indexOf(getQueryVar("view",a))>-1){data_put("last_view",a);data_put("last_view_timestamp",Math.ceil(Date.now()/1000))}}function hrefHistoryAdd(a){if(last_views.indexOf(getQueryVar("view",a))>-1&&a!=hrefHistory[hrefHistory.length-1]){if(!(getQueryVar("view",a)=="book_info"&&!getQueryVar("book_id",a))){hrefHistory.push(a)}}}function homeClicked(){changeHash("view=home");return false}function checkUser(){var a=parseInt(getQueryVar("user_id"),10);if(!isNaN(a)&&user_id!=a){pageFuncs.user_subscription_choose["log_out"]()}}function logOutSelected(){closeMenu();var a=[];a.push(display_message.log_out_prompt);if(!standalone){a.push(display_message.log_out_prompt_not_standalone)}jqConfirm(a,logOutDo,$(this).text());return false}function logOutDo(){localforage.clear(function(b){$.each(amplify.store(),function(c){data_del(c)});var a="#external="+app_url+"user_log_out.php?";
if(standalone){a+="log_out_all=1"}changeHash(a)})}var serviceWorkerUpdateFound=false;var reg;if("serviceWorker" in navigator){window.addEventListener("load",function(){navigator.serviceWorker.register(app_url+"sw.php").then(function(a){window.reg=a;log("ServiceWorker registration successful with scope: "+a.scope);a.addEventListener("updatefound",function(){serviceWorkerUpdateFound=true;log("Updating appâ€¦");startLoading(display_message.update_downloading,false,true);const b=a.installing;b.addEventListener("statechange",function(){if(b.state=="activated"){a.update();reloadApp()}})})},function(a){log("ServiceWorker registration failed: ",a)})});var reloading;navigator.serviceWorker.addEventListener("controllerchange",function(){if(reloading){return}log("Reloading");reloading=true;if(firstLoaded){reloadApp()}else{reloadApp()}})}function checkForUpdate(){if(typeof window.reg=="undefined"){setTimeout(function(){window.reg.update()},1000)}else{window.reg.update()}}var isReloading=false;function reloadApp(){if(isReloading){return}isReloading=true;$("#content_loading").addClass("dark").html("").stop(true).fadeTo(fadeTime,1,function(){$("html").css("background","#000").html("")});setTimeout(function(){window.location.reload(false)},fadeTime*2)};
;(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):(global=global||self,global.twttr=global.twttr||{},global.twttr.txt=factory())})(this,function(){"use strict";var _isObject=function(it){return typeof it==="object"?it!==null:typeof it==="function"};var _isObject$1=Object.freeze({"default":_isObject,__moduleExports:_isObject});var isObject=_isObject$1&&_isObject||_isObject$1;var _anObject=function(it){if(!isObject(it))throw TypeError(it+" is not an object!");return it};var _anObject$1=Object.freeze({"default":_anObject,__moduleExports:_anObject});var _defined=function(it){if(it==undefined)throw TypeError("Can't call method on  "+it);return it};var _defined$1=Object.freeze({"default":_defined,__moduleExports:_defined});var defined=_defined$1&&_defined||_defined$1;var _toObject=function(it){return Object(defined(it))};var _toObject$1=Object.freeze({"default":_toObject,__moduleExports:_toObject});var ceil=Math.ceil;var floor=Math.floor;var _toInteger=function(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)};var _toInteger$1=Object.freeze({"default":_toInteger,__moduleExports:_toInteger});var toInteger=_toInteger$1&&_toInteger||_toInteger$1;var min=Math.min;var _toLength=function(it){return it>0?min(toInteger(it),9007199254740991):0};var _toLength$1=Object.freeze({"default":_toLength,__moduleExports:_toLength});var _stringAt=function(TO_STRING){return function(that,pos){var s=String(defined(that));var i=toInteger(pos);var l=s.length;var a,b;if(i<0||i>=l)return TO_STRING?"":undefined;a=s.charCodeAt(i);return a<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536}};var _stringAt$1=Object.freeze({"default":_stringAt,__moduleExports:_stringAt});var require$$0=_stringAt$1&&_stringAt||_stringAt$1;var at=require$$0(true);var _advanceStringIndex=function(S,index,unicode){return index+(unicode?at(S,index).length:1)};var _advanceStringIndex$1=Object.freeze({"default":_advanceStringIndex,__moduleExports:_advanceStringIndex});var toString={}.toString;var _cof=function(it){return toString.call(it).slice(8,-1)};var _cof$1=Object.freeze({"default":_cof,__moduleExports:_cof});var commonjsGlobal=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function unwrapExports(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x["default"]:x}function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}var _core=createCommonjsModule(function(module){var core=module.exports={version:"2.6.10"};if(typeof __e=="number")__e=core});var _core_1=_core.version;var _core$1=Object.freeze({"default":_core,__moduleExports:_core,version:_core_1});var _global=createCommonjsModule(function(module){var global=module.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();if(typeof __g=="number")__g=global});var _global$1=Object.freeze({"default":_global,__moduleExports:_global});var _library=false;var _library$1=Object.freeze({"default":_library,__moduleExports:_library});var require$$1=_core$1&&_core||_core$1;var require$$0$1=_global$1&&_global||_global$1;var LIBRARY=_library$1&&_library||_library$1;var _shared=createCommonjsModule(function(module){var SHARED="__core-js_shared__";var store=require$$0$1[SHARED]||(require$$0$1[SHARED]={});(module.exports=function(key,value){return store[key]||(store[key]=value!==undefined?value:{})})("versions",[]).push({version:require$$1.version,mode:LIBRARY?"pure":"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})});var _shared$1=Object.freeze({"default":_shared,__moduleExports:_shared});var id=0;var px=Math.random();var _uid=function(key){return"Symbol(".concat(key===undefined?"":key,")_",(++id+px).toString(36))};var _uid$1=Object.freeze({"default":_uid,__moduleExports:_uid});var require$$0$2=_shared$1&&_shared||_shared$1;var uid=_uid$1&&_uid||_uid$1;var _wks=createCommonjsModule(function(module){var store=require$$0$2("wks");var Symbol=require$$0$1.Symbol;var USE_SYMBOL=typeof Symbol=="function";var $exports=module.exports=function(name){return store[name]||(store[name]=USE_SYMBOL&&Symbol[name]||(USE_SYMBOL?Symbol:uid)("Symbol."+name))};$exports.store=store});var _wks$1=Object.freeze({"default":_wks,__moduleExports:_wks});var cof=_cof$1&&_cof||_cof$1;var require$$0$3=_wks$1&&_wks||_wks$1;var TAG=require$$0$3("toStringTag");var ARG=cof(function(){return arguments}())=="Arguments";var tryGet=function(it,key){try{return it[key]}catch(e){}};var _classof=function(it){var O,T,B;return it===undefined?"Undefined":it===null?"Null":typeof(T=tryGet(O=Object(it),TAG))=="string"?T:ARG?cof(O):(B=cof(O))=="Object"&&typeof O.callee=="function"?"Arguments":B};var _classof$1=Object.freeze({"default":_classof,__moduleExports:_classof});var classof=_classof$1&&_classof||_classof$1;var builtinExec=RegExp.prototype.exec;var _regexpExecAbstract=function(R,S){var exec=R.exec;if(typeof exec==="function"){var result=exec.call(R,S);if(typeof result!=="object"){throw new TypeError("RegExp exec method returned something other than an Object or null")}return result}if(classof(R)!=="RegExp"){throw new TypeError("RegExp#exec called on incompatible receiver")}return builtinExec.call(R,S)};var _regexpExecAbstract$1=Object.freeze({"default":_regexpExecAbstract,__moduleExports:_regexpExecAbstract});var anObject=_anObject$1&&_anObject||_anObject$1;var _flags=function(){var that=anObject(this);var result="";if(that.global)result+="g";if(that.ignoreCase)result+="i";if(that.multiline)result+="m";if(that.unicode)result+="u";if(that.sticky)result+="y";return result};var _flags$1=Object.freeze({"default":_flags,__moduleExports:_flags});var regexpFlags=_flags$1&&_flags||_flags$1;var nativeExec=RegExp.prototype.exec;var nativeReplace=String.prototype.replace;var patchedExec=nativeExec;var LAST_INDEX="lastIndex";var UPDATES_LAST_INDEX_WRONG=function(){var re1=/a/,re2=/b*/g;nativeExec.call(re1,"a");nativeExec.call(re2,"a");return re1[LAST_INDEX]!==0||re2[LAST_INDEX]!==0}();var NPCG_INCLUDED=/()??/.exec("")[1]!==undefined;var PATCH=UPDATES_LAST_INDEX_WRONG||NPCG_INCLUDED;if(PATCH){patchedExec=function exec(str){var re=this;var lastIndex,reCopy,match,i;if(NPCG_INCLUDED){reCopy=new RegExp("^"+re.source+"$(?!\\s)",regexpFlags.call(re))}if(UPDATES_LAST_INDEX_WRONG)lastIndex=re[LAST_INDEX];match=nativeExec.call(re,str);if(UPDATES_LAST_INDEX_WRONG&&match){re[LAST_INDEX]=re.global?match.index+match[0].length:lastIndex}if(NPCG_INCLUDED&&match&&match.length>1){nativeReplace.call(match[0],reCopy,function(){for(i=1;i<arguments.length-2;i++){if(arguments[i]===undefined)match[i]=undefined}})}return match}}var _regexpExec=patchedExec;var _regexpExec$1=Object.freeze({"default":_regexpExec,__moduleExports:_regexpExec});var _fails=function(exec){try{return!!exec()}catch(e){return true}};var _fails$1=Object.freeze({"default":_fails,__moduleExports:_fails});var require$$1$1=_fails$1&&_fails||_fails$1;var _descriptors=!require$$1$1(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7});var _descriptors$1=Object.freeze({"default":_descriptors,__moduleExports:_descriptors});var document=require$$0$1.document;var is=isObject(document)&&isObject(document.createElement);var _domCreate=function(it){return is?document.createElement(it):{}};var _domCreate$1=Object.freeze({"default":_domCreate,__moduleExports:_domCreate});var require$$0$4=_descriptors$1&&_descriptors||_descriptors$1;var require$$2=_domCreate$1&&_domCreate||_domCreate$1;var _ie8DomDefine=!require$$0$4&&!require$$1$1(function(){return Object.defineProperty(require$$2("div"),"a",{get:function(){return 7}}).a!=7});var _ie8DomDefine$1=Object.freeze({"default":_ie8DomDefine,__moduleExports:_ie8DomDefine});var _toPrimitive=function(it,S){if(!isObject(it))return it;var fn,val;if(S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;if(typeof(fn=it.valueOf)=="function"&&!isObject(val=fn.call(it)))return val;if(!S&&typeof(fn=it.toString)=="function"&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to primitive value")};var _toPrimitive$1=Object.freeze({"default":_toPrimitive,__moduleExports:_toPrimitive});var IE8_DOM_DEFINE=_ie8DomDefine$1&&_ie8DomDefine||_ie8DomDefine$1;var toPrimitive=_toPrimitive$1&&_toPrimitive||_toPrimitive$1;var dP=Object.defineProperty;var f=require$$0$4?Object.defineProperty:function defineProperty(O,P,Attributes){anObject(O);P=toPrimitive(P,true);anObject(Attributes);if(IE8_DOM_DEFINE)try{return dP(O,P,Attributes)}catch(e){}if("get"in Attributes||"set"in Attributes)throw TypeError("Accessors not supported!");if("value"in Attributes)O[P]=Attributes.value;return O};var _objectDp={f:f};var _objectDp$1=Object.freeze({"default":_objectDp,__moduleExports:_objectDp,f:f});var _propertyDesc=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value}};var _propertyDesc$1=Object.freeze({"default":_propertyDesc,__moduleExports:_propertyDesc});var require$$1$2=_objectDp$1&&_objectDp||_objectDp$1;var descriptor=_propertyDesc$1&&_propertyDesc||_propertyDesc$1;var _hide=require$$0$4?function(object,key,value){return require$$1$2.f(object,key,descriptor(1,value))}:function(object,key,value){object[key]=value;return object};var _hide$1=Object.freeze({"default":_hide,__moduleExports:_hide});var hasOwnProperty={}.hasOwnProperty;var _has=function(it,key){return hasOwnProperty.call(it,key)};var _has$1=Object.freeze({"default":_has,__moduleExports:_has});var _functionToString=require$$0$2("native-function-to-string",Function.toString);var _functionToString$1=Object.freeze({"default":_functionToString,__moduleExports:_functionToString});var require$$0$5=_hide$1&&_hide||_hide$1;var has=_has$1&&_has||_has$1;var $toString=_functionToString$1&&_functionToString||_functionToString$1;var _redefine=createCommonjsModule(function(module){var SRC=uid("src");var TO_STRING="toString";var TPL=(""+$toString).split(TO_STRING);require$$1.inspectSource=function(it){return $toString.call(it)};(module.exports=function(O,key,val,safe){var isFunction=typeof val=="function";if(isFunction)has(val,"name")||require$$0$5(val,"name",key);if(O[key]===val)return;if(isFunction)has(val,SRC)||require$$0$5(val,SRC,O[key]?""+O[key]:TPL.join(String(key)));if(O===require$$0$1){O[key]=val}else if(!safe){delete O[key];require$$0$5(O,key,val)}else if(O[key]){O[key]=val}else{require$$0$5(O,key,val)}})(Function.prototype,TO_STRING,function toString(){return typeof this=="function"&&this[SRC]||$toString.call(this)})});var _redefine$1=Object.freeze({"default":_redefine,__moduleExports:_redefine});var _aFunction=function(it){if(typeof it!="function")throw TypeError(it+" is not a function!");return it};var _aFunction$1=Object.freeze({"default":_aFunction,__moduleExports:_aFunction});var aFunction=_aFunction$1&&_aFunction||_aFunction$1;var _ctx=function(fn,that,length){aFunction(fn);if(that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}};var _ctx$1=Object.freeze({"default":_ctx,__moduleExports:_ctx});var redefine=_redefine$1&&_redefine||_redefine$1;var require$$0$6=_ctx$1&&_ctx||_ctx$1;var PROTOTYPE="prototype";var $export=function(type,name,source){var IS_FORCED=type&$export.F;var IS_GLOBAL=type&$export.G;var IS_STATIC=type&$export.S;var IS_PROTO=type&$export.P;var IS_BIND=type&$export.B;var target=IS_GLOBAL?require$$0$1:IS_STATIC?require$$0$1[name]||(require$$0$1[name]={}):(require$$0$1[name]||{})[PROTOTYPE];var exports=IS_GLOBAL?require$$1:require$$1[name]||(require$$1[name]={});var expProto=exports[PROTOTYPE]||(exports[PROTOTYPE]={});var key,own,out,exp;if(IS_GLOBAL)source=name;for(key in source){own=!IS_FORCED&&target&&target[key]!==undefined;out=(own?target:source)[key];exp=IS_BIND&&own?require$$0$6(out,require$$0$1):IS_PROTO&&typeof out=="function"?require$$0$6(Function.call,out):out;if(target)redefine(target,key,out,type&$export.U);if(exports[key]!=out)require$$0$5(exports,key,exp);if(IS_PROTO&&expProto[key]!=out)expProto[key]=out}};require$$0$1.core=require$$1;$export.F=1;$export.G=2;$export.S=4;$export.P=8;$export.B=16;$export.W=32;$export.U=64;$export.R=128;var _export=$export;var _export$1=Object.freeze({"default":_export,__moduleExports:_export});var regexpExec=_regexpExec$1&&_regexpExec||_regexpExec$1;var $export$1=_export$1&&_export||_export$1;$export$1({target:"RegExp",proto:true,forced:regexpExec!==/./.exec},{exec:regexpExec});var SPECIES=require$$0$3("species");var REPLACE_SUPPORTS_NAMED_GROUPS=!require$$1$1(function(){var re=/./;re.exec=function(){var result=[];result.groups={a:"7"};return result};return"".replace(re,"$<a>")!=="7"});var SPLIT_WORKS_WITH_OVERWRITTEN_EXEC=function(){var re=/(?:)/;var originalExec=re.exec;re.exec=function(){return originalExec.apply(this,arguments)};var result="ab".split(re);return result.length===2&&result[0]==="a"&&result[1]==="b"}();var _fixReWks=function(KEY,length,exec){var SYMBOL=require$$0$3(KEY);var DELEGATES_TO_SYMBOL=!require$$1$1(function(){var O={};O[SYMBOL]=function(){return 7};return""[KEY](O)!=7});var DELEGATES_TO_EXEC=DELEGATES_TO_SYMBOL?!require$$1$1(function(){var execCalled=false;var re=/a/;re.exec=function(){execCalled=true;return null};if(KEY==="split"){re.constructor={};re.constructor[SPECIES]=function(){return re}}re[SYMBOL]("");return!execCalled}):undefined;if(!DELEGATES_TO_SYMBOL||!DELEGATES_TO_EXEC||KEY==="replace"&&!REPLACE_SUPPORTS_NAMED_GROUPS||KEY==="split"&&!SPLIT_WORKS_WITH_OVERWRITTEN_EXEC){var nativeRegExpMethod=/./[SYMBOL];var fns=exec(defined,SYMBOL,""[KEY],function maybeCallNative(nativeMethod,regexp,str,arg2,forceStringMethod){if(regexp.exec===regexpExec){if(DELEGATES_TO_SYMBOL&&!forceStringMethod){return{done:true,value:nativeRegExpMethod.call(regexp,str,arg2)}}return{done:true,value:nativeMethod.call(str,regexp,arg2)}}return{done:false}});var strfn=fns[0];var rxfn=fns[1];redefine(String.prototype,KEY,strfn);require$$0$5(RegExp.prototype,SYMBOL,length==2?function(string,arg){return rxfn.call(string,this,arg)}:function(string){return rxfn.call(string,this)})}};var _fixReWks$1=Object.freeze({"default":_fixReWks,__moduleExports:_fixReWks});var toObject=_toObject$1&&_toObject||_toObject$1;var toLength=_toLength$1&&_toLength||_toLength$1;var advanceStringIndex=_advanceStringIndex$1&&_advanceStringIndex||_advanceStringIndex$1;var callRegExpExec=_regexpExecAbstract$1&&_regexpExecAbstract||_regexpExecAbstract$1;var require$$0$7=_fixReWks$1&&_fixReWks||_fixReWks$1;var max=Math.max;var min$1=Math.min;var floor$1=Math.floor;var SUBSTITUTION_SYMBOLS=/\$([$&`']|\d\d?|<[^>]*>)/g;var SUBSTITUTION_SYMBOLS_NO_NAMED=/\$([$&`']|\d\d?)/g;var maybeToString=function(it){return it===undefined?it:String(it)};require$$0$7("replace",2,function(defined,REPLACE,$replace,maybeCallNative){return[function replace(searchValue,replaceValue){var O=defined(this);var fn=searchValue==undefined?undefined:searchValue[REPLACE];return fn!==undefined?fn.call(searchValue,O,replaceValue):$replace.call(String(O),searchValue,replaceValue)},function(regexp,replaceValue){var res=maybeCallNative($replace,regexp,this,replaceValue);if(res.done)return res.value;var rx=anObject(regexp);var S=String(this);var functionalReplace=typeof replaceValue==="function";if(!functionalReplace)replaceValue=String(replaceValue);var global=rx.global;if(global){var fullUnicode=rx.unicode;rx.lastIndex=0}var results=[];while(true){var result=callRegExpExec(rx,S);if(result===null)break;results.push(result);if(!global)break;var matchStr=String(result[0]);if(matchStr==="")rx.lastIndex=advanceStringIndex(S,toLength(rx.lastIndex),fullUnicode)}var accumulatedResult="";var nextSourcePosition=0;for(var i=0;i<results.length;i++){result=results[i];var matched=String(result[0]);var position=max(min$1(toInteger(result.index),S.length),0);var captures=[];for(var j=1;j<result.length;j++)captures.push(maybeToString(result[j]));var namedCaptures=result.groups;if(functionalReplace){var replacerArgs=[matched].concat(captures,position,S);if(namedCaptures!==undefined)replacerArgs.push(namedCaptures);var replacement=String(replaceValue.apply(undefined,replacerArgs))}else{replacement=getSubstitution(matched,S,position,captures,namedCaptures,replaceValue)}if(position>=nextSourcePosition){accumulatedResult+=S.slice(nextSourcePosition,position)+replacement;nextSourcePosition=position+matched.length}}return accumulatedResult+S.slice(nextSourcePosition)}];function getSubstitution(matched,str,position,captures,namedCaptures,replacement){var tailPos=position+matched.length;var m=captures.length;var symbols=SUBSTITUTION_SYMBOLS_NO_NAMED;if(namedCaptures!==undefined){namedCaptures=toObject(namedCaptures);symbols=SUBSTITUTION_SYMBOLS}return $replace.call(replacement,symbols,function(match,ch){var capture;switch(ch.charAt(0)){case"$":return"$";case"&":return matched;case"`":return str.slice(0,position);case"'":return str.slice(tailPos);case"<":capture=namedCaptures[ch.slice(1,-1)];break;default:var n=+ch;if(n===0)return match;if(n>m){var f=floor$1(n/10);if(f===0)return match;if(f<=m)return captures[f-1]===undefined?ch.charAt(1):captures[f-1]+ch.charAt(1);return match}capture=captures[n-1]}return capture===undefined?"":capture})}});var _iobject=Object("z").propertyIsEnumerable(0)?Object:function(it){return cof(it)=="String"?it.split(""):Object(it)};var _iobject$1=Object.freeze({"default":_iobject,__moduleExports:_iobject});var IObject=_iobject$1&&_iobject||_iobject$1;var _toIobject=function(it){return IObject(defined(it))};var _toIobject$1=Object.freeze({"default":_toIobject,__moduleExports:_toIobject});var max$1=Math.max;var min$2=Math.min;var _toAbsoluteIndex=function(index,length){index=toInteger(index);return index<0?max$1(index+length,0):min$2(index,length)};var _toAbsoluteIndex$1=Object.freeze({"default":_toAbsoluteIndex,__moduleExports:_toAbsoluteIndex});var toIObject=_toIobject$1&&_toIobject||_toIobject$1;var toAbsoluteIndex=_toAbsoluteIndex$1&&_toAbsoluteIndex||_toAbsoluteIndex$1;var _arrayIncludes=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIObject($this);var length=toLength(O.length);var index=toAbsoluteIndex(fromIndex,length);var value;if(IS_INCLUDES&&el!=el)while(length>index){value=O[index++];if(value!=value)return true}else for(;length>index;index++)if(IS_INCLUDES||index in O){if(O[index]===el)return IS_INCLUDES||index||0}return!IS_INCLUDES&&-1}};var _arrayIncludes$1=Object.freeze({"default":_arrayIncludes,__moduleExports:_arrayIncludes});var _strictMethod=function(method,arg){return!!method&&require$$1$1(function(){arg?method.call(null,function(){},1):method.call(null)})};var _strictMethod$1=Object.freeze({"default":_strictMethod,__moduleExports:_strictMethod});var require$$0$8=_arrayIncludes$1&&_arrayIncludes||_arrayIncludes$1;var require$$0$9=_strictMethod$1&&_strictMethod||_strictMethod$1;var $indexOf=require$$0$8(false);var $native=[].indexOf;var NEGATIVE_ZERO=!!$native&&1/[1].indexOf(1,-0)<0;$export$1($export$1.P+$export$1.F*(NEGATIVE_ZERO||!require$$0$9($native)),"Array",{indexOf:function indexOf(searchElement){return NEGATIVE_ZERO?$native.apply(this,arguments)||0:$indexOf(this,searchElement,arguments[1])}});var cashtag=/[a-z]{1,6}(?:[._][a-z]{1,2})?/i;var punct=/\!'#%&'\(\)*\+,\\\-\.\/:;<=>\?@\[\]\^_{|}~\$/;var f$1={}.propertyIsEnumerable;var _objectPie={f:f$1};var _objectPie$1=Object.freeze({"default":_objectPie,__moduleExports:_objectPie,f:f$1});var pIE=_objectPie$1&&_objectPie||_objectPie$1;var gOPD=Object.getOwnPropertyDescriptor;var f$2=require$$0$4?gOPD:function getOwnPropertyDescriptor(O,P){O=toIObject(O);P=toPrimitive(P,true);if(IE8_DOM_DEFINE)try{return gOPD(O,P)}catch(e){}if(has(O,P))return descriptor(!pIE.f.call(O,P),O[P])};var _objectGopd={f:f$2};var _objectGopd$1=Object.freeze({"default":_objectGopd,__moduleExports:_objectGopd,f:f$2});var require$$1$3=_objectGopd$1&&_objectGopd||_objectGopd$1;var check=function(O,proto){anObject(O);if(!isObject(proto)&&proto!==null)throw TypeError(proto+": can't set as prototype!")};var _setProto={set:Object.setPrototypeOf||("__proto__"in{}?function(test,buggy,set){try{set=require$$0$6(Function.call,require$$1$3.f(Object.prototype,"__proto__").set,2);set(test,[]);buggy=!(test instanceof Array)}catch(e){buggy=true}return function setPrototypeOf(O,proto){check(O,proto);if(buggy)O.__proto__=proto;else set(O,proto);return O}}({},false):undefined),check:check};var _setProto_1=_setProto.set;var _setProto_2=_setProto.check;var _setProto$1=Object.freeze({"default":_setProto,__moduleExports:_setProto,set:_setProto_1,check:_setProto_2});var require$$0$a=_setProto$1&&_setProto||_setProto$1;var setPrototypeOf=require$$0$a.set;var _inheritIfRequired=function(that,target,C){var S=target.constructor;var P;if(S!==C&&typeof S=="function"&&(P=S.prototype)!==C.prototype&&isObject(P)&&setPrototypeOf){setPrototypeOf(that,P)}return that};var _inheritIfRequired$1=Object.freeze({"default":_inheritIfRequired,__moduleExports:_inheritIfRequired});var shared=require$$0$2("keys");var _sharedKey=function(key){return shared[key]||(shared[key]=uid(key))};var _sharedKey$1=Object.freeze({"default":_sharedKey,__moduleExports:_sharedKey});var require$$0$b=_sharedKey$1&&_sharedKey||_sharedKey$1;var arrayIndexOf=require$$0$8(false);var IE_PROTO=require$$0$b("IE_PROTO");var _objectKeysInternal=function(object,names){var O=toIObject(object);var i=0;var result=[];var key;for(key in O)if(key!=IE_PROTO)has(O,key)&&result.push(key);while(names.length>i)if(has(O,key=names[i++])){~arrayIndexOf(result,key)||result.push(key)}return result};var _objectKeysInternal$1=Object.freeze({"default":_objectKeysInternal,__moduleExports:_objectKeysInternal});var _enumBugKeys="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",");var _enumBugKeys$1=Object.freeze({"default":_enumBugKeys,__moduleExports:_enumBugKeys});var $keys=_objectKeysInternal$1&&_objectKeysInternal||_objectKeysInternal$1;var enumBugKeys=_enumBugKeys$1&&_enumBugKeys||_enumBugKeys$1;var hiddenKeys=enumBugKeys.concat("length","prototype");var f$3=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return $keys(O,hiddenKeys)};var _objectGopn={f:f$3};var _objectGopn$1=Object.freeze({"default":_objectGopn,__moduleExports:_objectGopn,f:f$3});var MATCH=require$$0$3("match");var _isRegexp=function(it){var isRegExp;return isObject(it)&&((isRegExp=it[MATCH])!==undefined?!!isRegExp:cof(it)=="RegExp")};var _isRegexp$1=Object.freeze({"default":_isRegexp,__moduleExports:_isRegexp});var SPECIES$1=require$$0$3("species");var _setSpecies=function(KEY){var C=require$$0$1[KEY];if(require$$0$4&&C&&!C[SPECIES$1])require$$1$2.f(C,SPECIES$1,{configurable:true,get:function(){return this}})};var _setSpecies$1=Object.freeze({"default":_setSpecies,__moduleExports:_setSpecies});var inheritIfRequired=_inheritIfRequired$1&&_inheritIfRequired||_inheritIfRequired$1;var require$$0$c=_objectGopn$1&&_objectGopn||_objectGopn$1;var isRegExp=_isRegexp$1&&_isRegexp||_isRegexp$1;var require$$6=_setSpecies$1&&_setSpecies||_setSpecies$1;var dP$1=require$$1$2.f;var gOPN=require$$0$c.f;var $RegExp=require$$0$1.RegExp;var Base=$RegExp;var proto=$RegExp.prototype;var re1=/a/g;var re2=/a/g;var CORRECT_NEW=new $RegExp(re1)!==re1;if(require$$0$4&&(!CORRECT_NEW||require$$1$1(function(){re2[require$$0$3("match")]=false;return $RegExp(re1)!=re1||$RegExp(re2)==re2||$RegExp(re1,"i")!="/a/i"}))){$RegExp=function RegExp(p,f){var tiRE=this instanceof $RegExp;var piRE=isRegExp(p);var fiU=f===undefined;return!tiRE&&piRE&&p.constructor===$RegExp&&fiU?p:inheritIfRequired(CORRECT_NEW?new Base(piRE&&!fiU?p.source:p,f):Base((piRE=p instanceof $RegExp)?p.source:p,piRE&&fiU?regexpFlags.call(p):f),tiRE?this:proto,$RegExp)};var proxy=function(key){key in $RegExp||dP$1($RegExp,key,{configurable:true,get:function(){return Base[key]},set:function(it){Base[key]=it}})};for(var keys=gOPN(Base),i=0;keys.length>i;)proxy(keys[i++]);proto.constructor=$RegExp;$RegExp.prototype=proto;redefine(require$$0$1,"RegExp",$RegExp)}require$$6("RegExp");function regexSupplant(regex,map,flags){flags=flags||"";if(typeof regex!=="string"){if(regex.global&&flags.indexOf("g")<0){flags+="g"}if(regex.ignoreCase&&flags.indexOf("i")<0){flags+="i"}if(regex.multiline&&flags.indexOf("m")<0){flags+="m"}regex=regex.source}return new RegExp(regex.replace(/#\{(\w+)\}/g,function(match,name){var newRegex=map[name]||"";if(typeof newRegex!=="string"){newRegex=newRegex.source}return newRegex}),flags)}var spacesGroup=/\x09-\x0D\x20\x85\xA0\u1680\u180E\u2000-\u200A\u2028\u2029\u202F\u205F\u3000/;var spaces=regexSupplant(/[#{spacesGroup}]/,{spacesGroup:spacesGroup});var validCashtag=regexSupplant("(^|#{spaces})(\\$)(#{cashtag})(?=$|\\s|[#{punct}])",{cashtag:cashtag,spaces:spaces,punct:punct},"gi");function extractCashtagsWithIndices(text){if(!text||text.indexOf("$")===-1){return[]}var tags=[];text.replace(validCashtag,function(match,before,dollar,cashtag,offset,chunk){var startPosition=offset+before.length;var endPosition=startPosition+cashtag.length+1;tags.push({cashtag:cashtag,indices:[startPosition,endPosition]})});return tags}require$$0$7("match",1,function(defined,MATCH,$match,maybeCallNative){return[function match(regexp){var O=defined(this);var fn=regexp==undefined?undefined:regexp[MATCH];return fn!==undefined?fn.call(regexp,O):new RegExp(regexp)[MATCH](String(O))},function(regexp){var res=maybeCallNative($match,regexp,this);if(res.done)return res.value;var rx=anObject(regexp);var S=String(this);if(!rx.global)return callRegExpExec(rx,S);var fullUnicode=rx.unicode;rx.lastIndex=0;var A=[];var n=0;var result;while((result=callRegExpExec(rx,S))!==null){var matchStr=String(result[0]);A[n]=matchStr;if(matchStr==="")rx.lastIndex=advanceStringIndex(S,toLength(rx.lastIndex),fullUnicode);n++}return n===0?null:A}]});var hashSigns=/[#ï¼ƒ]/;var endHashtagMatch=regexSupplant(/^(?:#{hashSigns}|:\/\/)/,{hashSigns:hashSigns});var validCCTLD=regexSupplant(RegExp("(?:(?:"+"í•œêµ­|é¦™æ¸¯|æ¾³é–€|æ–°åŠ å¡|å°ç£|å°æ¹¾|ä¸­åœ‹|ä¸­å›½|áƒ’áƒ”|à¹„à¸—à¸¢|à¶½à¶‚à¶šà·|à´­à´¾à´°à´¤à´‚|à²­à²¾à²°à²¤|à°­à°¾à°°à°¤à±|à®šà®¿à®™à¯à®•à®ªà¯à®ªà¯‚à®°à¯|à®‡à®²à®™à¯à®•à¯ˆ|à®‡à®¨à¯à®¤à®¿à®¯à®¾|à¬­à¬¾à¬°à¬¤|àª­àª¾àª°àª¤|"+"à¨­à¨¾à¨°à¨¤|à¦­à¦¾à§°à¦¤|à¦­à¦¾à¦°à¦¤|à¦¬à¦¾à¦‚à¦²à¦¾|à¤­à¤¾à¤°à¥‹à¤¤|à¤­à¤¾à¤°à¤¤à¤®à¥|à¤­à¤¾à¤°à¤¤|Ú€Ø§Ø±Øª|Ù¾Ø§Ú©Ø³ØªØ§Ù†|Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§|Ù…Ù„ÙŠØ³ÙŠØ§|Ù…ØµØ±|Ù‚Ø·Ø±|ÙÙ„Ø³Ø·ÙŠÙ†|Ø¹Ù…Ø§Ù†|Ø¹Ø±Ø§Ù‚|"+"Ø³ÙˆØ±ÙŠØ©|Ø³ÙˆØ¯Ø§Ù†|ØªÙˆÙ†Ø³|Ø¨Ú¾Ø§Ø±Øª|Ø¨Ø§Ø±Øª|Ø§ÛŒØ±Ø§Ù†|Ø§Ù…Ø§Ø±Ø§Øª|Ø§Ù„Ù…ØºØ±Ø¨|Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©|Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±|Ø§Ù„Ø§Ø±Ø¯Ù†|Õ°Õ¡Õµ|Ò›Ð°Ð·|ÑƒÐºÑ€|ÑÑ€Ð±|Ñ€Ñ„|"+"Ð¼Ð¾Ð½|Ð¼ÐºÐ´|ÐµÑŽ|Ð±ÐµÐ»|Ð±Ð³|ÎµÎ»|zw|zm|za|yt|ye|ws|wf|vu|vn|vi|vg|ve|vc|va|uz|uy|us|um|uk|ug|ua|tz|tw|tv|"+"tt|tr|tp|to|tn|tm|tl|tk|tj|th|tg|tf|td|tc|sz|sy|sx|sv|su|st|ss|sr|so|sn|sm|sl|sk|sj|si|sh|sg|"+"se|sd|sc|sb|sa|rw|ru|rs|ro|re|qa|py|pw|pt|ps|pr|pn|pm|pl|pk|ph|pg|pf|pe|pa|om|nz|nu|nr|np|no|"+"nl|ni|ng|nf|ne|nc|na|mz|my|mx|mw|mv|mu|mt|ms|mr|mq|mp|mo|mn|mm|ml|mk|mh|mg|mf|me|md|mc|ma|ly|"+"lv|lu|lt|ls|lr|lk|li|lc|lb|la|kz|ky|kw|kr|kp|kn|km|ki|kh|kg|ke|jp|jo|jm|je|it|is|ir|iq|io|in|"+"im|il|ie|id|hu|ht|hr|hn|hm|hk|gy|gw|gu|gt|gs|gr|gq|gp|gn|gm|gl|gi|gh|gg|gf|ge|gd|gb|ga|fr|fo|"+"fm|fk|fj|fi|eu|et|es|er|eh|eg|ee|ec|dz|do|dm|dk|dj|de|cz|cy|cx|cw|cv|cu|cr|co|cn|cm|cl|ck|ci|"+"ch|cg|cf|cd|cc|ca|bz|by|bw|bv|bt|bs|br|bq|bo|bn|bm|bl|bj|bi|bh|bg|bf|be|bd|bb|ba|az|ax|aw|au|"+"at|as|ar|aq|ao|an|am|al|ai|ag|af|ae|ad|ac"+")(?=[^0-9a-zA-Z@+-]|$))"));var directionalMarkersGroup=/\u202A-\u202E\u061C\u200E\u200F\u2066\u2067\u2068\u2069/;var invalidCharsGroup=/\uFFFE\uFEFF\uFFFF/;function stringSupplant(str,map){return str.replace(/#\{(\w+)\}/g,function(match,name){return map[name]||""})}var invalidDomainChars=stringSupplant("#{punct}#{spacesGroup}#{invalidCharsGroup}#{directionalMarkersGroup}",{punct:punct,spacesGroup:spacesGroup,invalidCharsGroup:invalidCharsGroup,directionalMarkersGroup:directionalMarkersGroup});var validDomainChars=regexSupplant(/[^#{invalidDomainChars}]/,{invalidDomainChars:invalidDomainChars});var validDomainName=regexSupplant(/(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\.)/,{validDomainChars:validDomainChars});var validGTLD=regexSupplant(RegExp("(?:(?:"+"ì‚¼ì„±|ë‹·ì»´|ë‹·ë„·|é¦™æ ¼é‡Œæ‹‰|é¤åŽ…|é£Ÿå“|é£žåˆ©æµ¦|é›»è¨Šç›ˆç§‘|é›†å›¢|é€šè²©|è´­ç‰©|è°·æ­Œ|è¯ºåŸºäºš|è”é€š|ç½‘ç»œ|ç½‘ç«™|ç½‘åº—|ç½‘å€|ç»„ç»‡æœºæž„|ç§»åŠ¨|ç å®|ç‚¹çœ‹|æ¸¸æˆ|æ·¡é©¬é”¡|æœºæž„|æ›¸ç±|æ—¶å°š|æ–°é—»|"+"æ”¿åºœ|æ”¿åŠ¡|æ‹›è˜|æ‰‹è¡¨|æ‰‹æœº|æˆ‘çˆ±ä½ |æ…ˆå–„|å¾®åš|å¹¿ä¸œ|å·¥è¡Œ|å®¶é›»|å¨±ä¹|å¤©ä¸»æ•™|å¤§æ‹¿|å¤§ä¼—æ±½è½¦|åœ¨çº¿|å˜‰é‡Œå¤§é…’åº—|å˜‰é‡Œ|å•†æ ‡|å•†åº—|å•†åŸŽ|å…¬ç›Š|å…¬å¸|å…«å¦|å¥åº·|ä¿¡æ¯|ä½›å±±|ä¼ä¸š|"+"ä¸­æ–‡ç½‘|ä¸­ä¿¡|ä¸–ç•Œ|ãƒã‚¤ãƒ³ãƒˆ|ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³|ã‚»ãƒ¼ãƒ«|ã‚¹ãƒˆã‚¢|ã‚³ãƒ |ã‚°ãƒ¼ã‚°ãƒ«|ã‚¯ãƒ©ã‚¦ãƒ‰|ã¿ã‚“ãª|à¸„à¸­à¸¡|à¤¸à¤‚à¤—à¤ à¤¨|à¤¨à¥‡à¤Ÿ|à¤•à¥‰à¤®|Ù‡Ù…Ø±Ø§Ù‡|Ù…ÙˆÙ‚Ø¹|Ù…ÙˆØ¨Ø§ÙŠÙ„ÙŠ|ÙƒÙˆÙ…|"+"ÙƒØ§Ø«ÙˆÙ„ÙŠÙƒ|Ø¹Ø±Ø¨|Ø´Ø¨ÙƒØ©|Ø¨ÙŠØªÙƒ|Ø¨Ø§Ø²Ø§Ø±|Ø§Ù„Ø¹Ù„ÙŠØ§Ù†|Ø§Ø±Ø§Ù…ÙƒÙˆ|Ø§ØªØµØ§Ù„Ø§Øª|Ø§Ø¨ÙˆØ¸Ø¨ÙŠ|×§×•×|ÑÐ°Ð¹Ñ‚|Ñ€ÑƒÑ|Ð¾Ñ€Ð³|Ð¾Ð½Ð»Ð°Ð¹Ð½|Ð¼Ð¾ÑÐºÐ²Ð°|ÐºÐ¾Ð¼|"+"ÐºÐ°Ñ‚Ð¾Ð»Ð¸Ðº|Ð´ÐµÑ‚Ð¸|zuerich|zone|zippo|zip|zero|zara|zappos|yun|youtube|you|yokohama|yoga|yodobashi|"+"yandex|yamaxun|yahoo|yachts|xyz|xxx|xperia|xin|xihuan|xfinity|xerox|xbox|wtf|wtc|wow|world|"+"works|work|woodside|wolterskluwer|wme|winners|wine|windows|win|williamhill|wiki|wien|whoswho|"+"weir|weibo|wedding|wed|website|weber|webcam|weatherchannel|weather|watches|watch|warman|"+"wanggou|wang|walter|walmart|wales|vuelos|voyage|voto|voting|vote|volvo|volkswagen|vodka|"+"vlaanderen|vivo|viva|vistaprint|vista|vision|visa|virgin|vip|vin|villas|viking|vig|video|"+"viajes|vet|versicherung|vermÃ¶gensberatung|vermÃ¶gensberater|verisign|ventures|vegas|vanguard|"+"vana|vacations|ups|uol|uno|university|unicom|uconnect|ubs|ubank|tvs|tushu|tunes|tui|tube|trv|"+"trust|travelersinsurance|travelers|travelchannel|travel|training|trading|trade|toys|toyota|"+"town|tours|total|toshiba|toray|top|tools|tokyo|today|tmall|tkmaxx|tjx|tjmaxx|tirol|tires|tips|"+"tiffany|tienda|tickets|tiaa|theatre|theater|thd|teva|tennis|temasek|telefonica|telecity|tel|"+"technology|tech|team|tdk|tci|taxi|tax|tattoo|tatar|tatamotors|target|taobao|talk|taipei|tab|"+"systems|symantec|sydney|swiss|swiftcover|swatch|suzuki|surgery|surf|support|supply|supplies|"+"sucks|style|study|studio|stream|store|storage|stockholm|stcgroup|stc|statoil|statefarm|"+"statebank|starhub|star|staples|stada|srt|srl|spreadbetting|spot|sport|spiegel|space|soy|sony|"+"song|solutions|solar|sohu|software|softbank|social|soccer|sncf|smile|smart|sling|skype|sky|"+"skin|ski|site|singles|sina|silk|shriram|showtime|show|shouji|shopping|shop|shoes|shiksha|shia|"+"shell|shaw|sharp|shangrila|sfr|sexy|sex|sew|seven|ses|services|sener|select|seek|security|"+"secure|seat|search|scot|scor|scjohnson|science|schwarz|schule|school|scholarships|schmidt|"+"schaeffler|scb|sca|sbs|sbi|saxo|save|sas|sarl|sapo|sap|sanofi|sandvikcoromant|sandvik|samsung|"+"samsclub|salon|sale|sakura|safety|safe|saarland|ryukyu|rwe|run|ruhr|rugby|rsvp|room|rogers|"+"rodeo|rocks|rocher|rmit|rip|rio|ril|rightathome|ricoh|richardli|rich|rexroth|reviews|review|"+"restaurant|rest|republican|report|repair|rentals|rent|ren|reliance|reit|reisen|reise|rehab|"+"redumbrella|redstone|red|recipes|realty|realtor|realestate|read|raid|radio|racing|qvc|quest|"+"quebec|qpon|pwc|pub|prudential|pru|protection|property|properties|promo|progressive|prof|"+"productions|prod|pro|prime|press|praxi|pramerica|post|porn|politie|poker|pohl|pnc|plus|"+"plumbing|playstation|play|place|pizza|pioneer|pink|ping|pin|pid|pictures|pictet|pics|piaget|"+"physio|photos|photography|photo|phone|philips|phd|pharmacy|pfizer|pet|pccw|pay|passagens|"+"party|parts|partners|pars|paris|panerai|panasonic|pamperedchef|page|ovh|ott|otsuka|osaka|"+"origins|orientexpress|organic|org|orange|oracle|open|ooo|onyourside|online|onl|ong|one|omega|"+"ollo|oldnavy|olayangroup|olayan|okinawa|office|off|observer|obi|nyc|ntt|nrw|nra|nowtv|nowruz|"+"now|norton|northwesternmutual|nokia|nissay|nissan|ninja|nikon|nike|nico|nhk|ngo|nfl|nexus|"+"nextdirect|next|news|newholland|new|neustar|network|netflix|netbank|net|nec|nba|navy|natura|"+"nationwide|name|nagoya|nadex|nab|mutuelle|mutual|museum|mtr|mtpc|mtn|msd|movistar|movie|mov|"+"motorcycles|moto|moscow|mortgage|mormon|mopar|montblanc|monster|money|monash|mom|moi|moe|moda|"+"mobily|mobile|mobi|mma|mls|mlb|mitsubishi|mit|mint|mini|mil|microsoft|miami|metlife|merckmsd|"+"meo|menu|men|memorial|meme|melbourne|meet|media|med|mckinsey|mcdonalds|mcd|mba|mattel|"+"maserati|marshalls|marriott|markets|marketing|market|map|mango|management|man|makeup|maison|"+"maif|madrid|macys|luxury|luxe|lupin|lundbeck|ltda|ltd|lplfinancial|lpl|love|lotto|lotte|"+"london|lol|loft|locus|locker|loans|loan|llc|lixil|living|live|lipsy|link|linde|lincoln|limo|"+"limited|lilly|like|lighting|lifestyle|lifeinsurance|life|lidl|liaison|lgbt|lexus|lego|legal|"+"lefrak|leclerc|lease|lds|lawyer|law|latrobe|latino|lat|lasalle|lanxess|landrover|land|lancome|"+"lancia|lancaster|lamer|lamborghini|ladbrokes|lacaixa|kyoto|kuokgroup|kred|krd|kpn|kpmg|kosher|"+"komatsu|koeln|kiwi|kitchen|kindle|kinder|kim|kia|kfh|kerryproperties|kerrylogistics|"+"kerryhotels|kddi|kaufen|juniper|juegos|jprs|jpmorgan|joy|jot|joburg|jobs|jnj|jmp|jll|jlc|jio|"+"jewelry|jetzt|jeep|jcp|jcb|java|jaguar|iwc|iveco|itv|itau|istanbul|ist|ismaili|iselect|irish|"+"ipiranga|investments|intuit|international|intel|int|insure|insurance|institute|ink|ing|info|"+"infiniti|industries|inc|immobilien|immo|imdb|imamat|ikano|iinet|ifm|ieee|icu|ice|icbc|ibm|"+"hyundai|hyatt|hughes|htc|hsbc|how|house|hotmail|hotels|hoteles|hot|hosting|host|hospital|"+"horse|honeywell|honda|homesense|homes|homegoods|homedepot|holiday|holdings|hockey|hkt|hiv|"+"hitachi|hisamitsu|hiphop|hgtv|hermes|here|helsinki|help|healthcare|health|hdfcbank|hdfc|hbo|"+"haus|hangout|hamburg|hair|guru|guitars|guide|guge|gucci|guardian|group|grocery|gripe|green|"+"gratis|graphics|grainger|gov|got|gop|google|goog|goodyear|goodhands|goo|golf|goldpoint|gold|"+"godaddy|gmx|gmo|gmbh|gmail|globo|global|gle|glass|glade|giving|gives|gifts|gift|ggee|george|"+"genting|gent|gea|gdn|gbiz|garden|gap|games|game|gallup|gallo|gallery|gal|fyi|futbol|furniture|"+"fund|fun|fujixerox|fujitsu|ftr|frontier|frontdoor|frogans|frl|fresenius|free|fox|foundation|"+"forum|forsale|forex|ford|football|foodnetwork|food|foo|fly|flsmidth|flowers|florist|flir|"+"flights|flickr|fitness|fit|fishing|fish|firmdale|firestone|fire|financial|finance|final|film|"+"fido|fidelity|fiat|ferrero|ferrari|feedback|fedex|fast|fashion|farmers|farm|fans|fan|family|"+"faith|fairwinds|fail|fage|extraspace|express|exposed|expert|exchange|everbank|events|eus|"+"eurovision|etisalat|esurance|estate|esq|erni|ericsson|equipment|epson|epost|enterprises|"+"engineering|engineer|energy|emerck|email|education|edu|edeka|eco|eat|earth|dvr|dvag|durban|"+"dupont|duns|dunlop|duck|dubai|dtv|drive|download|dot|doosan|domains|doha|dog|dodge|doctor|"+"docs|dnp|diy|dish|discover|discount|directory|direct|digital|diet|diamonds|dhl|dev|design|"+"desi|dentist|dental|democrat|delta|deloitte|dell|delivery|degree|deals|dealer|deal|dds|dclk|"+"day|datsun|dating|date|data|dance|dad|dabur|cyou|cymru|cuisinella|csc|cruises|cruise|crs|"+"crown|cricket|creditunion|creditcard|credit|courses|coupons|coupon|country|corsica|coop|cool|"+"cookingchannel|cooking|contractors|contact|consulting|construction|condos|comsec|computer|"+"compare|company|community|commbank|comcast|com|cologne|college|coffee|codes|coach|clubmed|"+"club|cloud|clothing|clinique|clinic|click|cleaning|claims|cityeats|city|citic|citi|citadel|"+"cisco|circle|cipriani|church|chrysler|chrome|christmas|chloe|chintai|cheap|chat|chase|charity|"+"channel|chanel|cfd|cfa|cern|ceo|center|ceb|cbs|cbre|cbn|cba|catholic|catering|cat|casino|cash|"+"caseih|case|casa|cartier|cars|careers|career|care|cards|caravan|car|capitalone|capital|"+"capetown|canon|cancerresearch|camp|camera|cam|calvinklein|call|cal|cafe|cab|bzh|buzz|buy|"+"business|builders|build|bugatti|budapest|brussels|brother|broker|broadway|bridgestone|"+"bradesco|box|boutique|bot|boston|bostik|bosch|boots|booking|book|boo|bond|bom|bofa|boehringer|"+"boats|bnpparibas|bnl|bmw|bms|blue|bloomberg|blog|blockbuster|blanco|blackfriday|black|biz|bio|"+"bingo|bing|bike|bid|bible|bharti|bet|bestbuy|best|berlin|bentley|beer|beauty|beats|bcn|bcg|"+"bbva|bbt|bbc|bayern|bauhaus|basketball|baseball|bargains|barefoot|barclays|barclaycard|"+"barcelona|bar|bank|band|bananarepublic|banamex|baidu|baby|azure|axa|aws|avianca|autos|auto|"+"author|auspost|audio|audible|audi|auction|attorney|athleta|associates|asia|asda|arte|art|arpa|"+"army|archi|aramco|arab|aquarelle|apple|app|apartments|aol|anz|anquan|android|analytics|"+"amsterdam|amica|amfam|amex|americanfamily|americanexpress|alstom|alsace|ally|allstate|"+"allfinanz|alipay|alibaba|alfaromeo|akdn|airtel|airforce|airbus|aigo|aig|agency|agakhan|africa|"+"afl|afamilycompany|aetna|aero|aeg|adult|ads|adac|actor|active|aco|accountants|accountant|"+"accenture|academy|abudhabi|abogado|able|abc|abbvie|abbott|abb|abarth|aarp|aaa|onion"+")(?=[^0-9a-zA-Z@+-]|$))"));
var validPunycode=/(?:xn--[\-0-9a-z]+)/;var validSubdomain=regexSupplant(/(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\.)/,{validDomainChars:validDomainChars});var validDomain=regexSupplant(/(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))/,{validDomainName:validDomainName,validSubdomain:validSubdomain,validGTLD:validGTLD,validCCTLD:validCCTLD,validPunycode:validPunycode});var validPortNumber=/[0-9]+/;var cyrillicLettersAndMarks=/\u0400-\u04FF/;var latinAccentChars=/\xC0-\xD6\xD8-\xF6\xF8-\xFF\u0100-\u024F\u0253\u0254\u0256\u0257\u0259\u025B\u0263\u0268\u026F\u0272\u0289\u028B\u02BB\u0300-\u036F\u1E00-\u1EFF/;var validGeneralUrlPathChars=regexSupplant(/[a-z#{cyrillicLettersAndMarks}0-9!\*';:=\+,\.\$\/%#\[\]\-\u2013_~@\|&#{latinAccentChars}]/i,{cyrillicLettersAndMarks:cyrillicLettersAndMarks,latinAccentChars:latinAccentChars});var validUrlBalancedParens=regexSupplant("\\("+"(?:"+"#{validGeneralUrlPathChars}+"+"|"+"(?:"+"#{validGeneralUrlPathChars}*"+"\\("+"#{validGeneralUrlPathChars}+"+"\\)"+"#{validGeneralUrlPathChars}*"+")"+")"+"\\)",{validGeneralUrlPathChars:validGeneralUrlPathChars},"i");var validUrlPathEndingChars=regexSupplant(/[\+\-a-z#{cyrillicLettersAndMarks}0-9=_#\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})/i,{cyrillicLettersAndMarks:cyrillicLettersAndMarks,latinAccentChars:latinAccentChars,validUrlBalancedParens:validUrlBalancedParens});var validUrlPath=regexSupplant("(?:"+"(?:"+"#{validGeneralUrlPathChars}*"+"(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*"+"#{validUrlPathEndingChars}"+")|(?:@#{validGeneralUrlPathChars}+/)"+")",{validGeneralUrlPathChars:validGeneralUrlPathChars,validUrlBalancedParens:validUrlBalancedParens,validUrlPathEndingChars:validUrlPathEndingChars},"i");var validUrlPrecedingChars=regexSupplant(/(?:[^A-Za-z0-9@ï¼ $#ï¼ƒ#{invalidCharsGroup}]|[#{directionalMarkersGroup}]|^)/,{invalidCharsGroup:invalidCharsGroup,directionalMarkersGroup:directionalMarkersGroup});var validUrlQueryChars=/[a-z0-9!?\*'@\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i;var validUrlQueryEndingChars=/[a-z0-9\-_&=#\/]/i;var extractUrl=regexSupplant("("+"(#{validUrlPrecedingChars})"+"("+"(https?:\\/\\/)?"+"(#{validDomain})"+"(?::(#{validPortNumber}))?"+"(\\/#{validUrlPath}*)?"+"(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?"+")"+")",{validUrlPrecedingChars:validUrlPrecedingChars,validDomain:validDomain,validPortNumber:validPortNumber,validUrlPath:validUrlPath,validUrlQueryChars:validUrlQueryChars,validUrlQueryEndingChars:validUrlQueryEndingChars},"gi");var invalidUrlWithoutProtocolPrecedingChars=/[-_.\/]$/;var SPECIES$2=require$$0$3("species");var _speciesConstructor=function(O,D){var C=anObject(O).constructor;var S;return C===undefined||(S=anObject(C)[SPECIES$2])==undefined?D:aFunction(S)};var _speciesConstructor$1=Object.freeze({"default":_speciesConstructor,__moduleExports:_speciesConstructor});var speciesConstructor=_speciesConstructor$1&&_speciesConstructor||_speciesConstructor$1;var $min=Math.min;var $push=[].push;var $SPLIT="split";var LENGTH="length";var LAST_INDEX$1="lastIndex";var MAX_UINT32=4294967295;var SUPPORTS_Y=!require$$1$1(function(){});require$$0$7("split",2,function(defined,SPLIT,$split,maybeCallNative){var internalSplit;if("abbc"[$SPLIT](/(b)*/)[1]=="c"||"test"[$SPLIT](/(?:)/,-1)[LENGTH]!=4||"ab"[$SPLIT](/(?:ab)*/)[LENGTH]!=2||"."[$SPLIT](/(.?)(.?)/)[LENGTH]!=4||"."[$SPLIT](/()()/)[LENGTH]>1||""[$SPLIT](/.?/)[LENGTH]){internalSplit=function(separator,limit){var string=String(this);if(separator===undefined&&limit===0)return[];if(!isRegExp(separator))return $split.call(string,separator,limit);var output=[];var flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.unicode?"u":"")+(separator.sticky?"y":"");var lastLastIndex=0;var splitLimit=limit===undefined?MAX_UINT32:limit>>>0;var separatorCopy=new RegExp(separator.source,flags+"g");var match,lastIndex,lastLength;while(match=regexpExec.call(separatorCopy,string)){lastIndex=separatorCopy[LAST_INDEX$1];if(lastIndex>lastLastIndex){output.push(string.slice(lastLastIndex,match.index));if(match[LENGTH]>1&&match.index<string[LENGTH])$push.apply(output,match.slice(1));lastLength=match[0][LENGTH];lastLastIndex=lastIndex;if(output[LENGTH]>=splitLimit)break}if(separatorCopy[LAST_INDEX$1]===match.index)separatorCopy[LAST_INDEX$1]++}if(lastLastIndex===string[LENGTH]){if(lastLength||!separatorCopy.test(""))output.push("")}else output.push(string.slice(lastLastIndex));return output[LENGTH]>splitLimit?output.slice(0,splitLimit):output}}else if("0"[$SPLIT](undefined,0)[LENGTH]){internalSplit=function(separator,limit){return separator===undefined&&limit===0?[]:$split.call(this,separator,limit)}}else{internalSplit=$split}return[function split(separator,limit){var O=defined(this);var splitter=separator==undefined?undefined:separator[SPLIT];return splitter!==undefined?splitter.call(separator,O,limit):internalSplit.call(String(O),separator,limit)},function(regexp,limit){var res=maybeCallNative(internalSplit,regexp,this,limit,internalSplit!==$split);if(res.done)return res.value;var rx=anObject(regexp);var S=String(this);var C=speciesConstructor(rx,RegExp);var unicodeMatching=rx.unicode;var flags=(rx.ignoreCase?"i":"")+(rx.multiline?"m":"")+(rx.unicode?"u":"")+(SUPPORTS_Y?"y":"g");var splitter=new C(SUPPORTS_Y?rx:"^(?:"+rx.source+")",flags);var lim=limit===undefined?MAX_UINT32:limit>>>0;if(lim===0)return[];if(S.length===0)return callRegExpExec(splitter,S)===null?[S]:[];var p=0;var q=0;var A=[];while(q<S.length){splitter.lastIndex=SUPPORTS_Y?q:0;var z=callRegExpExec(splitter,SUPPORTS_Y?S:S.slice(q));var e;if(z===null||(e=$min(toLength(splitter.lastIndex+(SUPPORTS_Y?0:q)),S.length))===p){q=advanceStringIndex(S,q,unicodeMatching)}else{A.push(S.slice(p,q));if(A.length===lim)return A;for(var i=1;i<=z.length-1;i++){A.push(z[i]);if(A.length===lim)return A}q=p=e}}A.push(S.slice(p));return A}]});var punycode=createCommonjsModule(function(module,exports){(function(root){var freeExports=exports&&!exports.nodeType&&exports;var freeModule=module&&!module.nodeType&&module;var freeGlobal=typeof commonjsGlobal=="object"&&commonjsGlobal;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(commonjsGlobal)});var validAsciiDomain=regexSupplant(/(?:(?:[\-a-z0-9#{latinAccentChars}]+)\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})/gi,{latinAccentChars:latinAccentChars,validGTLD:validGTLD,validCCTLD:validCCTLD,validPunycode:validPunycode});var MAX_DOMAIN_LABEL_LENGTH=63;var PUNYCODE_ENCODED_DOMAIN_PREFIX="xn--";var idna={toAscii:function toAscii(domain){if(domain.substring(0,4)===PUNYCODE_ENCODED_DOMAIN_PREFIX&&!domain.match(validAsciiDomain)){return}var labels=domain.split(".");for(var i=0;i<labels.length;i++){var label=labels[i];var punycodeEncodedLabel=punycode.toASCII(label);if(punycodeEncodedLabel.length<1||punycodeEncodedLabel.length>MAX_DOMAIN_LABEL_LENGTH){return}}return labels.join(".")}};var validTcoUrl=regexSupplant(/^https?:\/\/t\.co\/([a-z0-9]+)(?:\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?/,{validUrlQueryChars:validUrlQueryChars,validUrlQueryEndingChars:validUrlQueryEndingChars},"i");var DEFAULT_PROTOCOL="https://";var DEFAULT_PROTOCOL_OPTIONS={extractUrlsWithoutProtocol:true};var MAX_URL_LENGTH=4096;var MAX_TCO_SLUG_LENGTH=40;var extractUrlsWithIndices=function extractUrlsWithIndices(text){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_PROTOCOL_OPTIONS;if(!text||(options.extractUrlsWithoutProtocol?!text.match(/\./):!text.match(/:/))){return[]}var urls=[];var _loop=function _loop(){var before=RegExp.$2;var url=RegExp.$3;var protocol=RegExp.$4;var domain=RegExp.$5;var path=RegExp.$7;var endPosition=extractUrl.lastIndex;var startPosition=endPosition-url.length;if(!isValidUrl(url,protocol||DEFAULT_PROTOCOL,domain)){return"continue"}if(!protocol){if(!options.extractUrlsWithoutProtocol||before.match(invalidUrlWithoutProtocolPrecedingChars)){return"continue"}var lastUrl=null;var asciiEndPosition=0;domain.replace(validAsciiDomain,function(asciiDomain){var asciiStartPosition=domain.indexOf(asciiDomain,asciiEndPosition);asciiEndPosition=asciiStartPosition+asciiDomain.length;lastUrl={url:asciiDomain,indices:[startPosition+asciiStartPosition,startPosition+asciiEndPosition]};urls.push(lastUrl)});if(lastUrl==null){return"continue"}if(path){lastUrl.url=url.replace(domain,lastUrl.url);lastUrl.indices[1]=endPosition}}else{if(url.match(validTcoUrl)){var tcoUrlSlug=RegExp.$1;if(tcoUrlSlug&&tcoUrlSlug.length>MAX_TCO_SLUG_LENGTH){return"continue"}else{url=RegExp.lastMatch;endPosition=startPosition+url.length}}urls.push({url:url,indices:[startPosition,endPosition]})}};while(extractUrl.exec(text)){var _ret=_loop();if(_ret==="continue")continue}return urls};var isValidUrl=function isValidUrl(url,protocol,domain){var urlLength=url.length;var punycodeEncodedDomain=idna.toAscii(domain);if(!punycodeEncodedDomain||!punycodeEncodedDomain.length){return false}urlLength=urlLength+punycodeEncodedDomain.length-domain.length;return protocol.length+urlLength<=MAX_URL_LENGTH};var $sort=[].sort;var test=[1,2,3];$export$1($export$1.P+$export$1.F*(require$$1$1(function(){test.sort(undefined)})||!require$$1$1(function(){test.sort(null)})||!require$$0$9($sort)),"Array",{sort:function sort(comparefn){return comparefn===undefined?$sort.call(toObject(this)):$sort.call(toObject(this),aFunction(comparefn))}});function removeOverlappingEntities(entities){entities.sort(function(a,b){return a.indices[0]-b.indices[0]});var prev=entities[0];for(var i=1;i<entities.length;i++){if(prev.indices[1]>entities[i].indices[0]){entities.splice(i,1);i--}else{prev=entities[i]}}}var astralLetterAndMarks=/\ud800[\udc00-\udc0b\udc0d-\udc26\udc28-\udc3a\udc3c\udc3d\udc3f-\udc4d\udc50-\udc5d\udc80-\udcfa\uddfd\ude80-\ude9c\udea0-\uded0\udee0\udf00-\udf1f\udf30-\udf40\udf42-\udf49\udf50-\udf7a\udf80-\udf9d\udfa0-\udfc3\udfc8-\udfcf]|\ud801[\udc00-\udc9d\udd00-\udd27\udd30-\udd63\ude00-\udf36\udf40-\udf55\udf60-\udf67]|\ud802[\udc00-\udc05\udc08\udc0a-\udc35\udc37\udc38\udc3c\udc3f-\udc55\udc60-\udc76\udc80-\udc9e\udd00-\udd15\udd20-\udd39\udd80-\uddb7\uddbe\uddbf\ude00-\ude03\ude05\ude06\ude0c-\ude13\ude15-\ude17\ude19-\ude33\ude38-\ude3a\ude3f\ude60-\ude7c\ude80-\ude9c\udec0-\udec7\udec9-\udee6\udf00-\udf35\udf40-\udf55\udf60-\udf72\udf80-\udf91]|\ud803[\udc00-\udc48]|\ud804[\udc00-\udc46\udc7f-\udcba\udcd0-\udce8\udd00-\udd34\udd50-\udd73\udd76\udd80-\uddc4\uddda\ude00-\ude11\ude13-\ude37\udeb0-\udeea\udf01-\udf03\udf05-\udf0c\udf0f\udf10\udf13-\udf28\udf2a-\udf30\udf32\udf33\udf35-\udf39\udf3c-\udf44\udf47\udf48\udf4b-\udf4d\udf57\udf5d-\udf63\udf66-\udf6c\udf70-\udf74]|\ud805[\udc80-\udcc5\udcc7\udd80-\uddb5\uddb8-\uddc0\ude00-\ude40\ude44\ude80-\udeb7]|\ud806[\udca0-\udcdf\udcff\udec0-\udef8]|\ud808[\udc00-\udf98]|\ud80c[\udc00-\udfff]|\ud80d[\udc00-\udc2e]|\ud81a[\udc00-\ude38\ude40-\ude5e\uded0-\udeed\udef0-\udef4\udf00-\udf36\udf40-\udf43\udf63-\udf77\udf7d-\udf8f]|\ud81b[\udf00-\udf44\udf50-\udf7e\udf8f-\udf9f]|\ud82c[\udc00\udc01]|\ud82f[\udc00-\udc6a\udc70-\udc7c\udc80-\udc88\udc90-\udc99\udc9d\udc9e]|\ud834[\udd65-\udd69\udd6d-\udd72\udd7b-\udd82\udd85-\udd8b\uddaa-\uddad\ude42-\ude44]|\ud835[\udc00-\udc54\udc56-\udc9c\udc9e\udc9f\udca2\udca5\udca6\udca9-\udcac\udcae-\udcb9\udcbb\udcbd-\udcc3\udcc5-\udd05\udd07-\udd0a\udd0d-\udd14\udd16-\udd1c\udd1e-\udd39\udd3b-\udd3e\udd40-\udd44\udd46\udd4a-\udd50\udd52-\udea5\udea8-\udec0\udec2-\udeda\udedc-\udefa\udefc-\udf14\udf16-\udf34\udf36-\udf4e\udf50-\udf6e\udf70-\udf88\udf8a-\udfa8\udfaa-\udfc2\udfc4-\udfcb]|\ud83a[\udc00-\udcc4\udcd0-\udcd6]|\ud83b[\ude00-\ude03\ude05-\ude1f\ude21\ude22\ude24\ude27\ude29-\ude32\ude34-\ude37\ude39\ude3b\ude42\ude47\ude49\ude4b\ude4d-\ude4f\ude51\ude52\ude54\ude57\ude59\ude5b\ude5d\ude5f\ude61\ude62\ude64\ude67-\ude6a\ude6c-\ude72\ude74-\ude77\ude79-\ude7c\ude7e\ude80-\ude89\ude8b-\ude9b\udea1-\udea3\udea5-\udea9\udeab-\udebb]|\ud840[\udc00-\udfff]|\ud841[\udc00-\udfff]|\ud842[\udc00-\udfff]|\ud843[\udc00-\udfff]|\ud844[\udc00-\udfff]|\ud845[\udc00-\udfff]|\ud846[\udc00-\udfff]|\ud847[\udc00-\udfff]|\ud848[\udc00-\udfff]|\ud849[\udc00-\udfff]|\ud84a[\udc00-\udfff]|\ud84b[\udc00-\udfff]|\ud84c[\udc00-\udfff]|\ud84d[\udc00-\udfff]|\ud84e[\udc00-\udfff]|\ud84f[\udc00-\udfff]|\ud850[\udc00-\udfff]|\ud851[\udc00-\udfff]|\ud852[\udc00-\udfff]|\ud853[\udc00-\udfff]|\ud854[\udc00-\udfff]|\ud855[\udc00-\udfff]|\ud856[\udc00-\udfff]|\ud857[\udc00-\udfff]|\ud858[\udc00-\udfff]|\ud859[\udc00-\udfff]|\ud85a[\udc00-\udfff]|\ud85b[\udc00-\udfff]|\ud85c[\udc00-\udfff]|\ud85d[\udc00-\udfff]|\ud85e[\udc00-\udfff]|\ud85f[\udc00-\udfff]|\ud860[\udc00-\udfff]|\ud861[\udc00-\udfff]|\ud862[\udc00-\udfff]|\ud863[\udc00-\udfff]|\ud864[\udc00-\udfff]|\ud865[\udc00-\udfff]|\ud866[\udc00-\udfff]|\ud867[\udc00-\udfff]|\ud868[\udc00-\udfff]|\ud869[\udc00-\uded6\udf00-\udfff]|\ud86a[\udc00-\udfff]|\ud86b[\udc00-\udfff]|\ud86c[\udc00-\udfff]|\ud86d[\udc00-\udf34\udf40-\udfff]|\ud86e[\udc00-\udc1d]|\ud87e[\udc00-\ude1d]|\udb40[\udd00-\uddef]/;var bmpLetterAndMarks=/A-Za-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0300-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u0483-\u052f\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u05d0-\u05ea\u05f0-\u05f2\u0610-\u061a\u0620-\u065f\u066e-\u06d3\u06d5-\u06dc\u06df-\u06e8\u06ea-\u06ef\u06fa-\u06fc\u06ff\u0710-\u074a\u074d-\u07b1\u07ca-\u07f5\u07fa\u0800-\u082d\u0840-\u085b\u08a0-\u08b2\u08e4-\u0963\u0971-\u0983\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bc-\u09c4\u09c7\u09c8\u09cb-\u09ce\u09d7\u09dc\u09dd\u09df-\u09e3\u09f0\u09f1\u0a01-\u0a03\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a59-\u0a5c\u0a5e\u0a70-\u0a75\u0a81-\u0a83\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abc-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ad0\u0ae0-\u0ae3\u0b01-\u0b03\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3c-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5c\u0b5d\u0b5f-\u0b63\u0b71\u0b82\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd0\u0bd7\u0c00-\u0c03\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c58\u0c59\u0c60-\u0c63\u0c81-\u0c83\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbc-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0cde\u0ce0-\u0ce3\u0cf1\u0cf2\u0d01-\u0d03\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d-\u0d44\u0d46-\u0d48\u0d4a-\u0d4e\u0d57\u0d60-\u0d63\u0d7a-\u0d7f\u0d82\u0d83\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e01-\u0e3a\u0e40-\u0e4e\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb9\u0ebb-\u0ebd\u0ec0-\u0ec4\u0ec6\u0ec8-\u0ecd\u0edc-\u0edf\u0f00\u0f18\u0f19\u0f35\u0f37\u0f39\u0f3e-\u0f47\u0f49-\u0f6c\u0f71-\u0f84\u0f86-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u103f\u1050-\u108f\u109a-\u109d\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u135d-\u135f\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16f1-\u16f8\u1700-\u170c\u170e-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176c\u176e-\u1770\u1772\u1773\u1780-\u17d3\u17d7\u17dc\u17dd\u180b-\u180d\u1820-\u1877\u1880-\u18aa\u18b0-\u18f5\u1900-\u191e\u1920-\u192b\u1930-\u193b\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u1a00-\u1a1b\u1a20-\u1a5e\u1a60-\u1a7c\u1a7f\u1aa7\u1ab0-\u1abe\u1b00-\u1b4b\u1b6b-\u1b73\u1b80-\u1baf\u1bba-\u1bf3\u1c00-\u1c37\u1c4d-\u1c4f\u1c5a-\u1c7d\u1cd0-\u1cd2\u1cd4-\u1cf6\u1cf8\u1cf9\u1d00-\u1df5\u1dfc-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u20d0-\u20f0\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d7f-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2de0-\u2dff\u2e2f\u3005\u3006\u302a-\u302f\u3031-\u3035\u303b\u303c\u3041-\u3096\u3099\u309a\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua672\ua674-\ua67d\ua67f-\ua69d\ua69f-\ua6e5\ua6f0\ua6f1\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua7ad\ua7b0\ua7b1\ua7f7-\ua827\ua840-\ua873\ua880-\ua8c4\ua8e0-\ua8f7\ua8fb\ua90a-\ua92d\ua930-\ua953\ua960-\ua97c\ua980-\ua9c0\ua9cf\ua9e0-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa36\uaa40-\uaa4d\uaa60-\uaa76\uaa7a-\uaac2\uaadb-\uaadd\uaae0-\uaaef\uaaf2-\uaaf6\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab5f\uab64\uab65\uabc0-\uabea\uabec\uabed\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf870-\uf87f\uf882\uf884-\uf89f\uf8b8\uf8c1-\uf8d6\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe00-\ufe0f\ufe20-\ufe2d\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc/;var nonBmpCodePairs=/[\uD800-\uDBFF][\uDC00-\uDFFF]/gm;var hashtagAlpha=regexSupplant(/(?:[#{bmpLetterAndMarks}]|(?=#{nonBmpCodePairs})(?:#{astralLetterAndMarks}))/,{bmpLetterAndMarks:bmpLetterAndMarks,nonBmpCodePairs:nonBmpCodePairs,astralLetterAndMarks:astralLetterAndMarks});var astralNumerals=/\ud801[\udca0-\udca9]|\ud804[\udc66-\udc6f\udcf0-\udcf9\udd36-\udd3f\uddd0-\uddd9\udef0-\udef9]|\ud805[\udcd0-\udcd9\ude50-\ude59\udec0-\udec9]|\ud806[\udce0-\udce9]|\ud81a[\ude60-\ude69\udf50-\udf59]|\ud835[\udfce-\udfff]/;var bmpNumerals=/0-9\u0660-\u0669\u06f0-\u06f9\u07c0-\u07c9\u0966-\u096f\u09e6-\u09ef\u0a66-\u0a6f\u0ae6-\u0aef\u0b66-\u0b6f\u0be6-\u0bef\u0c66-\u0c6f\u0ce6-\u0cef\u0d66-\u0d6f\u0de6-\u0def\u0e50-\u0e59\u0ed0-\u0ed9\u0f20-\u0f29\u1040-\u1049\u1090-\u1099\u17e0-\u17e9\u1810-\u1819\u1946-\u194f\u19d0-\u19d9\u1a80-\u1a89\u1a90-\u1a99\u1b50-\u1b59\u1bb0-\u1bb9\u1c40-\u1c49\u1c50-\u1c59\ua620-\ua629\ua8d0-\ua8d9\ua900-\ua909\ua9d0-\ua9d9\ua9f0-\ua9f9\uaa50-\uaa59\uabf0-\uabf9\uff10-\uff19/;var hashtagSpecialChars=/_\u200c\u200d\ua67e\u05be\u05f3\u05f4\uff5e\u301c\u309b\u309c\u30a0\u30fb\u3003\u0f0b\u0f0c\xb7/;var hashtagAlphaNumeric=regexSupplant(/(?:[#{bmpLetterAndMarks}#{bmpNumerals}#{hashtagSpecialChars}]|(?=#{nonBmpCodePairs})(?:#{astralLetterAndMarks}|#{astralNumerals}))/,{bmpLetterAndMarks:bmpLetterAndMarks,bmpNumerals:bmpNumerals,hashtagSpecialChars:hashtagSpecialChars,nonBmpCodePairs:nonBmpCodePairs,astralLetterAndMarks:astralLetterAndMarks,astralNumerals:astralNumerals});var codePoint=/(?:[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF])/;var hashtagBoundary=regexSupplant(/(?:^|\uFE0E|\uFE0F|$|(?!#{hashtagAlphaNumeric}|&)#{codePoint})/,{codePoint:codePoint,hashtagAlphaNumeric:hashtagAlphaNumeric});var validHashtag=regexSupplant(/(#{hashtagBoundary})(#{hashSigns})(?!\uFE0F|\u20E3)(#{hashtagAlphaNumeric}*#{hashtagAlpha}#{hashtagAlphaNumeric}*)/gi,{hashtagBoundary:hashtagBoundary,hashSigns:hashSigns,hashtagAlphaNumeric:hashtagAlphaNumeric,hashtagAlpha:hashtagAlpha});var extractHashtagsWithIndices=function extractHashtagsWithIndices(text,options){if(!options){options={checkUrlOverlap:true}}if(!text||!text.match(hashSigns)){return[]}var tags=[];text.replace(validHashtag,function(match,before,hash,hashText,offset,chunk){var after=chunk.slice(offset+match.length);if(after.match(endHashtagMatch)){return}var startPosition=offset+before.length;var endPosition=startPosition+hashText.length+1;tags.push({hashtag:hashText,indices:[startPosition,endPosition]})});if(options.checkUrlOverlap){var urls=extractUrlsWithIndices(text);if(urls.length>0){var entities=tags.concat(urls);removeOverlappingEntities(entities);tags=[];for(var i=0;i<entities.length;i++){if(entities[i].hashtag){tags.push(entities[i])}}}}return tags};var atSigns=/[@ï¼ ]/;var endMentionMatch=regexSupplant(/^(?:#{atSigns}|[#{latinAccentChars}]|:\/\/)/,{atSigns:atSigns,latinAccentChars:latinAccentChars});var validMentionPrecedingChars=/(?:^|[^a-zA-Z0-9_!#$%&*@ï¼ ]|(?:^|[^a-zA-Z0-9_+~.-])(?:rt|RT|rT|Rt):?)/;var validMentionOrList=regexSupplant("(#{validMentionPrecedingChars})"+"(#{atSigns})"+"([a-zA-Z0-9_]{1,20})"+"(/[a-zA-Z][a-zA-Z0-9_-]{0,24})?",{validMentionPrecedingChars:validMentionPrecedingChars,atSigns:atSigns},"g");function extractMentionsOrListsWithIndices(text){if(!text||!text.match(atSigns)){return[]}var possibleNames=[];text.replace(validMentionOrList,function(match,before,atSign,screenName,slashListname,offset,chunk){var after=chunk.slice(offset+match.length);if(!after.match(endMentionMatch)){slashListname=slashListname||"";var startPosition=offset+before.length;var endPosition=startPosition+screenName.length+slashListname.length+1;possibleNames.push({screenName:screenName,listSlug:slashListname,indices:[startPosition,endPosition]})}});return possibleNames}function extractEntitiesWithIndices(text,options){var entities=extractUrlsWithIndices(text,options).concat(extractMentionsOrListsWithIndices(text)).concat(extractHashtagsWithIndices(text,{checkUrlOverlap:false})).concat(extractCashtagsWithIndices(text));if(entities.length==0){return[]}removeOverlappingEntities(entities);return entities}function clone(o){var r={};for(var k in o){if(o.hasOwnProperty(k)){r[k]=o[k]}}return r}var BOOLEAN_ATTRIBUTES={disabled:true,readonly:true,multiple:true,checked:true};var OPTIONS_NOT_ATTRIBUTES={urlClass:true,listClass:true,usernameClass:true,hashtagClass:true,cashtagClass:true,usernameUrlBase:true,listUrlBase:true,hashtagUrlBase:true,cashtagUrlBase:true,usernameUrlBlock:true,listUrlBlock:true,hashtagUrlBlock:true,linkUrlBlock:true,usernameIncludeSymbol:true,suppressLists:true,suppressNoFollow:true,targetBlank:true,suppressDataScreenName:true,urlEntities:true,symbolTag:true,textWithSymbolTag:true,urlTarget:true,invisibleTagAttrs:true,linkAttributeBlock:true,linkTextBlock:true,htmlEscapeNonEntities:true};function extractHtmlAttrsFromOptions(options){var htmlAttrs={};for(var k in options){var v=options[k];if(OPTIONS_NOT_ATTRIBUTES[k]){continue}if(BOOLEAN_ATTRIBUTES[k]){v=v?k:null}if(v==null){continue}htmlAttrs[k]=v}return htmlAttrs}var HTML_ENTITIES={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};function htmlEscape(text){return text&&text.replace(/[&"'><]/g,function(character){return HTML_ENTITIES[character]})}if(require$$0$4&&/./g.flags!="g")require$$1$2.f(RegExp.prototype,"flags",{configurable:true,get:regexpFlags});var TO_STRING="toString";var $toString$1=/./[TO_STRING];var define=function(fn){redefine(RegExp.prototype,TO_STRING,fn,true)};if(require$$1$1(function(){return $toString$1.call({source:"a",flags:"b"})!="/a/b"})){define(function toString(){var R=anObject(this);return"/".concat(R.source,"/","flags"in R?R.flags:!require$$0$4&&R instanceof RegExp?regexpFlags.call(R):undefined)})}else if($toString$1.name!=TO_STRING){define(function toString(){return $toString$1.call(this)})}var DateProto=Date.prototype;var INVALID_DATE="Invalid Date";var TO_STRING$1="toString";var $toString$2=DateProto[TO_STRING$1];var getTime=DateProto.getTime;if(new Date(NaN)+""!=INVALID_DATE){redefine(DateProto,TO_STRING$1,function toString(){var value=getTime.call(this);return value===value?$toString$2.call(this):INVALID_DATE})}var test$1={};test$1[require$$0$3("toStringTag")]="z";if(test$1+""!="[object z]"){redefine(Object.prototype,"toString",function toString(){return"[object "+classof(this)+"]"},true)}var BOOLEAN_ATTRIBUTES$1={disabled:true,readonly:true,multiple:true,checked:true};function tagAttrs(attributes){var htmlAttrs="";for(var k in attributes){var v=attributes[k];if(BOOLEAN_ATTRIBUTES$1[k]){v=v?k:null}if(v==null){continue}htmlAttrs+=" ".concat(htmlEscape(k),'="').concat(htmlEscape(v.toString()),'"')}return htmlAttrs}function linkToText(entity,text,attributes,options){if(!options.suppressNoFollow){attributes.rel="nofollow"}if(options.linkAttributeBlock){options.linkAttributeBlock(entity,attributes)}if(options.linkTextBlock){text=options.linkTextBlock(entity,text)}var d={text:text,attr:tagAttrs(attributes)};return stringSupplant("<a#{attr}>#{text}</a>",d)}function linkToTextWithSymbol(entity,symbol,text,attributes,options){var taggedSymbol=options.symbolTag?"<".concat(options.symbolTag,">").concat(symbol,"</").concat(options.symbolTag,">"):symbol;text=htmlEscape(text);var taggedText=options.textWithSymbolTag?"<".concat(options.textWithSymbolTag,">").concat(text,"</").concat(options.textWithSymbolTag,">"):text;if(options.usernameIncludeSymbol||!symbol.match(atSigns)){return linkToText(entity,taggedSymbol+taggedText,attributes,options)}else{return taggedSymbol+linkToText(entity,taggedText,attributes,options)}}function linkToCashtag(entity,text,options){var cashtag=htmlEscape(entity.cashtag);var attrs=clone(options.htmlAttrs||{});attrs.href=options.cashtagUrlBase+cashtag;attrs.title="$".concat(cashtag);attrs["class"]=options.cashtagClass;if(options.targetBlank){attrs.target="_blank"}return linkToTextWithSymbol(entity,"$",cashtag,attrs,options)}var rtlChars=/[\u0600-\u06FF]|[\u0750-\u077F]|[\u0590-\u05FF]|[\uFE70-\uFEFF]/gm;function linkToHashtag(entity,text,options){var hash=text.substring(entity.indices[0],entity.indices[0]+1);var hashtag=htmlEscape(entity.hashtag);var attrs=clone(options.htmlAttrs||{});attrs.href=options.hashtagUrlBase+hashtag;attrs.title="#".concat(hashtag);attrs["class"]=options.hashtagClass;if(hashtag.charAt(0).match(rtlChars)){attrs["class"]+=" rtl"}if(options.targetBlank){attrs.target="_blank"}return linkToTextWithSymbol(entity,hash,hashtag,attrs,options)}function linkTextWithEntity(entity,options){var displayUrl=entity.display_url;var expandedUrl=entity.expanded_url;var displayUrlSansEllipses=displayUrl.replace(/â€¦/g,"");if(expandedUrl.indexOf(displayUrlSansEllipses)!=-1){var displayUrlIndex=expandedUrl.indexOf(displayUrlSansEllipses);var v={displayUrlSansEllipses:displayUrlSansEllipses,beforeDisplayUrl:expandedUrl.substr(0,displayUrlIndex),afterDisplayUrl:expandedUrl.substr(displayUrlIndex+displayUrlSansEllipses.length),precedingEllipsis:displayUrl.match(/^â€¦/)?"â€¦":"",followingEllipsis:displayUrl.match(/â€¦$/)?"â€¦":""};for(var k in v){if(v.hasOwnProperty(k)){v[k]=htmlEscape(v[k])}}v["invisible"]=options.invisibleTagAttrs;return stringSupplant("<span class='tco-ellipsis'>#{precedingEllipsis}<span #{invisible}>&nbsp;</span></span><span #{invisible}>#{beforeDisplayUrl}</span><span class='js-display-url'>#{displayUrlSansEllipses}</span><span #{invisible}>#{afterDisplayUrl}</span><span class='tco-ellipsis'><span #{invisible}>&nbsp;</span>#{followingEllipsis}</span>",v);
}return displayUrl}var urlHasProtocol=/^https?:\/\//i;function linkToUrl(entity,text,options){var url=entity.url;var displayUrl=url;var linkText=htmlEscape(displayUrl);var urlEntity=options.urlEntities&&options.urlEntities[url]||entity;if(urlEntity.display_url){linkText=linkTextWithEntity(urlEntity,options)}var attrs=clone(options.htmlAttrs||{});if(!url.match(urlHasProtocol)){url="http://".concat(url)}attrs.href=url;if(options.targetBlank){attrs.target="_blank"}if(options.urlClass){attrs["class"]=options.urlClass}if(options.urlTarget){attrs.target=options.urlTarget}if(!options.title&&urlEntity.display_url){attrs.title=urlEntity.expanded_url}return linkToText(entity,linkText,attrs,options)}function linkToMentionAndList(entity,text,options){var at=text.substring(entity.indices[0],entity.indices[0]+1);var user=htmlEscape(entity.screenName);var slashListname=htmlEscape(entity.listSlug);var isList=entity.listSlug&&!options.suppressLists;var attrs=clone(options.htmlAttrs||{});attrs["class"]=isList?options.listClass:options.usernameClass;attrs.href=isList?options.listUrlBase+user+slashListname:options.usernameUrlBase+user;if(!isList&&!options.suppressDataScreenName){attrs["data-screen-name"]=user}if(options.targetBlank){attrs.target="_blank"}return linkToTextWithSymbol(entity,at,isList?user+slashListname:user,attrs,options)}var DEFAULT_LIST_CLASS="tweet-url list-slug";var DEFAULT_USERNAME_CLASS="tweet-url username";var DEFAULT_HASHTAG_CLASS="tweet-url hashtag";var DEFAULT_CASHTAG_CLASS="tweet-url cashtag";function autoLinkEntities(text,entities,options){var options=clone(options||{});options.hashtagClass=options.hashtagClass||DEFAULT_HASHTAG_CLASS;options.hashtagUrlBase=options.hashtagUrlBase||"https://twitter.com/search?q=%23";options.cashtagClass=options.cashtagClass||DEFAULT_CASHTAG_CLASS;options.cashtagUrlBase=options.cashtagUrlBase||"https://twitter.com/search?q=%24";options.listClass=options.listClass||DEFAULT_LIST_CLASS;options.usernameClass=options.usernameClass||DEFAULT_USERNAME_CLASS;options.usernameUrlBase=options.usernameUrlBase||"https://twitter.com/";options.listUrlBase=options.listUrlBase||"https://twitter.com/";options.htmlAttrs=extractHtmlAttrsFromOptions(options);options.invisibleTagAttrs=options.invisibleTagAttrs||"style='position:absolute;left:-9999px;'";var urlEntities,i,len;if(options.urlEntities){urlEntities={};for(i=0,len=options.urlEntities.length;i<len;i++){urlEntities[options.urlEntities[i].url]=options.urlEntities[i]}options.urlEntities=urlEntities}var result="";var beginIndex=0;entities.sort(function(a,b){return a.indices[0]-b.indices[0]});var nonEntity=options.htmlEscapeNonEntities?htmlEscape:function(text){return text};for(var i=0;i<entities.length;i++){var entity=entities[i];result+=nonEntity(text.substring(beginIndex,entity.indices[0]));if(entity.url){result+=linkToUrl(entity,text,options)}else if(entity.hashtag){result+=linkToHashtag(entity,text,options)}else if(entity.screenName){result+=linkToMentionAndList(entity,text,options)}else if(entity.cashtag){result+=linkToCashtag(entity,text,options)}beginIndex=entity.indices[1]}result+=nonEntity(text.substring(beginIndex,text.length));return result}function autoLink(text,options){var entities=extractEntitiesWithIndices(text,{extractUrlsWithoutProtocol:false});return autoLinkEntities(text,entities,options)}function autoLinkCashtags(text,options){var entities=extractCashtagsWithIndices(text);return autoLinkEntities(text,entities,options)}function autoLinkHashtags(text,options){var entities=extractHashtagsWithIndices(text);return autoLinkEntities(text,entities,options)}function autoLinkUrlsCustom(text,options){var entities=extractUrlsWithIndices(text,{extractUrlsWithoutProtocol:false});return autoLinkEntities(text,entities,options)}function autoLinkUsernamesOrLists(text,options){var entities=extractMentionsOrListsWithIndices(text);return autoLinkEntities(text,entities,options)}var convertUnicodeIndices=function convertUnicodeIndices(text,entities,indicesInUTF16){if(entities.length===0){return}var charIndex=0;var codePointIndex=0;entities.sort(function(a,b){return a.indices[0]-b.indices[0]});var entityIndex=0;var entity=entities[0];while(charIndex<text.length){if(entity.indices[0]===(indicesInUTF16?charIndex:codePointIndex)){var len=entity.indices[1]-entity.indices[0];entity.indices[0]=indicesInUTF16?codePointIndex:charIndex;entity.indices[1]=entity.indices[0]+len;entityIndex++;if(entityIndex===entities.length){break}entity=entities[entityIndex]}var c=text.charCodeAt(charIndex);if(c>=55296&&c<=56319&&charIndex<text.length-1){c=text.charCodeAt(charIndex+1);if(c>=56320&&c<=57343){charIndex++}}codePointIndex++;charIndex++}};function modifyIndicesFromUnicodeToUTF16(text,entities){convertUnicodeIndices(text,entities,false)}function autoLinkWithJSON(text,json,options){if(json.user_mentions){for(var i=0;i<json.user_mentions.length;i++){json.user_mentions[i].screenName=json.user_mentions[i].screen_name}}if(json.hashtags){for(var i=0;i<json.hashtags.length;i++){json.hashtags[i].hashtag=json.hashtags[i].text}}if(json.symbols){for(var i=0;i<json.symbols.length;i++){json.symbols[i].cashtag=json.symbols[i].text}}var entities=[];for(var key in json){entities=entities.concat(json[key])}modifyIndicesFromUnicodeToUTF16(text,entities);return autoLinkEntities(text,entities,options)}var configs={version1:{version:1,maxWeightedTweetLength:140,scale:1,defaultWeight:1,transformedURLLength:23,ranges:[]},version2:{version:2,maxWeightedTweetLength:280,scale:100,defaultWeight:200,transformedURLLength:23,ranges:[{start:0,end:4351,weight:100},{start:8192,end:8205,weight:100},{start:8208,end:8223,weight:100},{start:8242,end:8247,weight:100}]},version3:{version:3,maxWeightedTweetLength:280,scale:100,defaultWeight:200,emojiParsingEnabled:true,transformedURLLength:23,ranges:[{start:0,end:4351,weight:100},{start:8192,end:8205,weight:100},{start:8208,end:8223,weight:100},{start:8242,end:8247,weight:100}]},defaults:{version:3,maxWeightedTweetLength:280,scale:100,defaultWeight:200,emojiParsingEnabled:true,transformedURLLength:23,ranges:[{start:0,end:4351,weight:100},{start:8192,end:8205,weight:100},{start:8208,end:8223,weight:100},{start:8242,end:8247,weight:100}]}};function convertUnicodeIndices$1(text,entities,indicesInUTF16){if(entities.length==0){return}var charIndex=0;var codePointIndex=0;entities.sort(function(a,b){return a.indices[0]-b.indices[0]});var entityIndex=0;var entity=entities[0];while(charIndex<text.length){if(entity.indices[0]==(indicesInUTF16?charIndex:codePointIndex)){var len=entity.indices[1]-entity.indices[0];entity.indices[0]=indicesInUTF16?codePointIndex:charIndex;entity.indices[1]=entity.indices[0]+len;entityIndex++;if(entityIndex==entities.length){break}entity=entities[entityIndex]}var c=text.charCodeAt(charIndex);if(c>=55296&&c<=56319&&charIndex<text.length-1){c=text.charCodeAt(charIndex+1);if(c>=56320&&c<=57343){charIndex++}}codePointIndex++;charIndex++}}function extractCashtags(text){var cashtagsOnly=[],cashtagsWithIndices=extractCashtagsWithIndices(text);for(var i=0;i<cashtagsWithIndices.length;i++){cashtagsOnly.push(cashtagsWithIndices[i].cashtag)}return cashtagsOnly}function extractHashtags(text){var hashtagsOnly=[];var hashtagsWithIndices=extractHashtagsWithIndices(text);for(var i=0;i<hashtagsWithIndices.length;i++){hashtagsOnly.push(hashtagsWithIndices[i].hashtag)}return hashtagsOnly}function extractMentionsWithIndices(text){var mentions=[];var mentionOrList;var mentionsOrLists=extractMentionsOrListsWithIndices(text);for(var i=0;i<mentionsOrLists.length;i++){mentionOrList=mentionsOrLists[i];if(mentionOrList.listSlug===""){mentions.push({screenName:mentionOrList.screenName,indices:mentionOrList.indices})}}return mentions}function extractMentions(text){var screenNamesOnly=[],screenNamesWithIndices=extractMentionsWithIndices(text);for(var i=0;i<screenNamesWithIndices.length;i++){var screenName=screenNamesWithIndices[i].screenName;screenNamesOnly.push(screenName)}return screenNamesOnly}var validReply=regexSupplant(/^(?:#{spaces})*#{atSigns}([a-zA-Z0-9_]{1,20})/,{atSigns:atSigns,spaces:spaces});function extractReplies(text){if(!text){return null}var possibleScreenName=text.match(validReply);if(!possibleScreenName||RegExp.rightContext.match(endMentionMatch)){return null}return possibleScreenName[1]}function extractUrls(text,options){var urlsOnly=[];var urlsWithIndices=extractUrlsWithIndices(text,options);for(var i=0;i<urlsWithIndices.length;i++){urlsOnly.push(urlsWithIndices[i].url)}return urlsOnly}var _isArray=Array.isArray||function isArray(arg){return cof(arg)=="Array"};var _isArray$1=Object.freeze({"default":_isArray,__moduleExports:_isArray});var require$$0$d=_isArray$1&&_isArray||_isArray$1;$export$1($export$1.S,"Array",{isArray:require$$0$d});var getCharacterWeight=function getCharacterWeight(ch,options){var defaultWeight=options.defaultWeight,ranges=options.ranges;var weight=defaultWeight;var chCodePoint=ch.charCodeAt(0);if(Array.isArray(ranges)){for(var i=0,length=ranges.length;i<length;i++){var currRange=ranges[i];if(chCodePoint>=currRange.start&&chCodePoint<=currRange.end){weight=currRange.weight;break}}}return weight};function modifyIndicesFromUTF16ToUnicode(text,entities){convertUnicodeIndices(text,entities,true)}var _arrayReduce=function(that,callbackfn,aLen,memo,isRight){aFunction(callbackfn);var O=toObject(that);var self=IObject(O);var length=toLength(O.length);var index=isRight?length-1:0;var i=isRight?-1:1;if(aLen<2)for(;;){if(index in self){memo=self[index];index+=i;break}index+=i;if(isRight?index<0:length<=index){throw TypeError("Reduce of empty array with no initial value")}}for(;isRight?index>=0:length>index;index+=i)if(index in self){memo=callbackfn(memo,self[index],index,O)}return memo};var _arrayReduce$1=Object.freeze({"default":_arrayReduce,__moduleExports:_arrayReduce});var $reduce=_arrayReduce$1&&_arrayReduce||_arrayReduce$1;$export$1($export$1.P+$export$1.F*!require$$0$9([].reduce,true),"Array",{reduce:function reduce(callbackfn){return $reduce(this,callbackfn,arguments.length,arguments[1],false)}});var UNSCOPABLES=require$$0$3("unscopables");var ArrayProto=Array.prototype;if(ArrayProto[UNSCOPABLES]==undefined)require$$0$5(ArrayProto,UNSCOPABLES,{});var _addToUnscopables=function(key){ArrayProto[UNSCOPABLES][key]=true};var _addToUnscopables$1=Object.freeze({"default":_addToUnscopables,__moduleExports:_addToUnscopables});var _iterStep=function(done,value){return{value:value,done:!!done}};var _iterStep$1=Object.freeze({"default":_iterStep,__moduleExports:_iterStep});var _iterators={};var _iterators$1=Object.freeze({"default":_iterators,__moduleExports:_iterators});var _objectKeys=Object.keys||function keys(O){return $keys(O,enumBugKeys)};var _objectKeys$1=Object.freeze({"default":_objectKeys,__moduleExports:_objectKeys});var getKeys=_objectKeys$1&&_objectKeys||_objectKeys$1;var _objectDps=require$$0$4?Object.defineProperties:function defineProperties(O,Properties){anObject(O);var keys=getKeys(Properties);var length=keys.length;var i=0;var P;while(length>i)require$$1$2.f(O,P=keys[i++],Properties[P]);return O};var _objectDps$1=Object.freeze({"default":_objectDps,__moduleExports:_objectDps});var document$1=require$$0$1.document;var _html=document$1&&document$1.documentElement;var _html$1=Object.freeze({"default":_html,__moduleExports:_html});var dPs=_objectDps$1&&_objectDps||_objectDps$1;var require$$2$1=_html$1&&_html||_html$1;var IE_PROTO$1=require$$0$b("IE_PROTO");var Empty=function(){};var PROTOTYPE$1="prototype";var createDict=function(){var iframe=require$$2("iframe");var i=enumBugKeys.length;var lt="<";var gt=">";var iframeDocument;iframe.style.display="none";require$$2$1.appendChild(iframe);iframe.src="javascript:";iframeDocument=iframe.contentWindow.document;iframeDocument.open();iframeDocument.write(lt+"script"+gt+"document.F=Object"+lt+"/script"+gt);iframeDocument.close();createDict=iframeDocument.F;while(i--)delete createDict[PROTOTYPE$1][enumBugKeys[i]];return createDict()};var _objectCreate=Object.create||function create(O,Properties){var result;if(O!==null){Empty[PROTOTYPE$1]=anObject(O);result=new Empty;Empty[PROTOTYPE$1]=null;result[IE_PROTO$1]=O}else result=createDict();return Properties===undefined?result:dPs(result,Properties)};var _objectCreate$1=Object.freeze({"default":_objectCreate,__moduleExports:_objectCreate});var def=require$$1$2.f;var TAG$1=require$$0$3("toStringTag");var _setToStringTag=function(it,tag,stat){if(it&&!has(it=stat?it:it.prototype,TAG$1))def(it,TAG$1,{configurable:true,value:tag})};var _setToStringTag$1=Object.freeze({"default":_setToStringTag,__moduleExports:_setToStringTag});var create=_objectCreate$1&&_objectCreate||_objectCreate$1;var setToStringTag=_setToStringTag$1&&_setToStringTag||_setToStringTag$1;var IteratorPrototype={};require$$0$5(IteratorPrototype,require$$0$3("iterator"),function(){return this});var _iterCreate=function(Constructor,NAME,next){Constructor.prototype=create(IteratorPrototype,{next:descriptor(1,next)});setToStringTag(Constructor,NAME+" Iterator")};var _iterCreate$1=Object.freeze({"default":_iterCreate,__moduleExports:_iterCreate});var IE_PROTO$2=require$$0$b("IE_PROTO");var ObjectProto=Object.prototype;var _objectGpo=Object.getPrototypeOf||function(O){O=toObject(O);if(has(O,IE_PROTO$2))return O[IE_PROTO$2];if(typeof O.constructor=="function"&&O instanceof O.constructor){return O.constructor.prototype}return O instanceof Object?ObjectProto:null};var _objectGpo$1=Object.freeze({"default":_objectGpo,__moduleExports:_objectGpo});var Iterators=_iterators$1&&_iterators||_iterators$1;var $iterCreate=_iterCreate$1&&_iterCreate||_iterCreate$1;var getPrototypeOf=_objectGpo$1&&_objectGpo||_objectGpo$1;var ITERATOR=require$$0$3("iterator");var BUGGY=!([].keys&&"next"in[].keys());var FF_ITERATOR="@@iterator";var KEYS="keys";var VALUES="values";var returnThis=function(){return this};var _iterDefine=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCED){$iterCreate(Constructor,NAME,next);var getMethod=function(kind){if(!BUGGY&&kind in proto)return proto[kind];switch(kind){case KEYS:return function keys(){return new Constructor(this,kind)};case VALUES:return function values(){return new Constructor(this,kind)}}return function entries(){return new Constructor(this,kind)}};var TAG=NAME+" Iterator";var DEF_VALUES=DEFAULT==VALUES;var VALUES_BUG=false;var proto=Base.prototype;var $native=proto[ITERATOR]||proto[FF_ITERATOR]||DEFAULT&&proto[DEFAULT];var $default=$native||getMethod(DEFAULT);var $entries=DEFAULT?!DEF_VALUES?$default:getMethod("entries"):undefined;var $anyNative=NAME=="Array"?proto.entries||$native:$native;var methods,key,IteratorPrototype;if($anyNative){IteratorPrototype=getPrototypeOf($anyNative.call(new Base));if(IteratorPrototype!==Object.prototype&&IteratorPrototype.next){setToStringTag(IteratorPrototype,TAG,true);if(!LIBRARY&&typeof IteratorPrototype[ITERATOR]!="function")require$$0$5(IteratorPrototype,ITERATOR,returnThis)}}if(DEF_VALUES&&$native&&$native.name!==VALUES){VALUES_BUG=true;$default=function values(){return $native.call(this)}}if((!LIBRARY||FORCED)&&(BUGGY||VALUES_BUG||!proto[ITERATOR])){require$$0$5(proto,ITERATOR,$default)}Iterators[NAME]=$default;Iterators[TAG]=returnThis;if(DEFAULT){methods={values:DEF_VALUES?$default:getMethod(VALUES),keys:IS_SET?$default:getMethod(KEYS),entries:$entries};if(FORCED)for(key in methods){if(!(key in proto))redefine(proto,key,methods[key])}else $export$1($export$1.P+$export$1.F*(BUGGY||VALUES_BUG),NAME,methods)}return methods};var _iterDefine$1=Object.freeze({"default":_iterDefine,__moduleExports:_iterDefine});var addToUnscopables=_addToUnscopables$1&&_addToUnscopables||_addToUnscopables$1;var step=_iterStep$1&&_iterStep||_iterStep$1;var require$$1$4=_iterDefine$1&&_iterDefine||_iterDefine$1;var es6_array_iterator=require$$1$4(Array,"Array",function(iterated,kind){this._t=toIObject(iterated);this._i=0;this._k=kind},function(){var O=this._t;var kind=this._k;var index=this._i++;if(!O||index>=O.length){this._t=undefined;return step(1)}if(kind=="keys")return step(0,index);if(kind=="values")return step(0,O[index]);return step(0,[index,O[index]])},"values");Iterators.Arguments=Iterators.Array;addToUnscopables("keys");addToUnscopables("values");addToUnscopables("entries");var ITERATOR$1=require$$0$3("iterator");var TO_STRING_TAG=require$$0$3("toStringTag");var ArrayValues=Iterators.Array;var DOMIterables={CSSRuleList:true,CSSStyleDeclaration:false,CSSValueList:false,ClientRectList:false,DOMRectList:false,DOMStringList:false,DOMTokenList:true,DataTransferItemList:false,FileList:false,HTMLAllCollection:false,HTMLCollection:false,HTMLFormElement:false,HTMLSelectElement:false,MediaList:true,MimeTypeArray:false,NamedNodeMap:false,NodeList:true,PaintRequestList:false,Plugin:false,PluginArray:false,SVGLengthList:false,SVGNumberList:false,SVGPathSegList:false,SVGPointList:false,SVGStringList:false,SVGTransformList:false,SourceBufferList:false,StyleSheetList:true,TextTrackCueList:false,TextTrackList:false,TouchList:false};for(var collections=getKeys(DOMIterables),i$1=0;i$1<collections.length;i$1++){var NAME=collections[i$1];var explicit=DOMIterables[NAME];var Collection=require$$0$1[NAME];var proto$1=Collection&&Collection.prototype;var key;if(proto$1){if(!proto$1[ITERATOR$1])require$$0$5(proto$1,ITERATOR$1,ArrayValues);if(!proto$1[TO_STRING_TAG])require$$0$5(proto$1,TO_STRING_TAG,NAME);Iterators[NAME]=ArrayValues;if(explicit)for(key in es6_array_iterator)if(!proto$1[key])redefine(proto$1,key,es6_array_iterator[key],true)}}var _objectSap=function(KEY,exec){var fn=(require$$1.Object||{})[KEY]||Object[KEY];var exp={};exp[KEY]=exec(fn);$export$1($export$1.S+$export$1.F*require$$1$1(function(){fn(1)}),"Object",exp)};var _objectSap$1=Object.freeze({"default":_objectSap,__moduleExports:_objectSap});var require$$0$e=_objectSap$1&&_objectSap||_objectSap$1;require$$0$e("keys",function(){return function keys(it){return getKeys(toObject(it))}});var invalidChars=regexSupplant(/[#{invalidCharsGroup}]/,{invalidCharsGroup:invalidCharsGroup});function hasInvalidCharacters(text){return invalidChars.test(text)}var regex=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.default=/(?:\ud83d[\udc68\udc69])(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddb0-\uddb3])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[Â©Â®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a-\udc6d\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\udeeb\udeec\udef4-\udef9]|\ud83e[\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd40-\udd45\udd47-\udd70\udd73-\udd76\udd7a\udd7c-\udda2\uddb4\uddb7\uddc0-\uddc2\uddd0\uddde-\uddff]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g});var regex$1=unwrapExports(regex);var regex$2=Object.freeze({"default":regex$1,__moduleExports:regex});var _regex=regex$2&&regex$1||regex$2;var dist=createCommonjsModule(function(module,exports){Object.defineProperty(exports,"__esModule",{value:true});exports.TypeName=undefined;exports.parse=parse;exports.toCodePoints=toCodePoints;var _regex2=_interopRequireDefault(_regex);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var TypeName=exports.TypeName="emoji";function parse(text,options){var assetType=options&&options.assetType?options.assetType:"svg";var getTwemojiUrl=options&&options.buildUrl?options.buildUrl:function(codepoints,assetType){return assetType==="png"?"https://twemoji.maxcdn.com/2/72x72/"+codepoints+".png":"https://twemoji.maxcdn.com/2/svg/"+codepoints+".svg"};var entities=[];_regex2.default.lastIndex=0;while(true){var result=_regex2.default.exec(text);if(!result){break}var emojiText=result[0];var codepoints=toCodePoints(removeVS16s(emojiText)).join("-");entities.push({url:codepoints?getTwemojiUrl(codepoints,assetType):"",indices:[result.index,_regex2.default.lastIndex],text:emojiText,type:TypeName})}return entities}var vs16RegExp=/\uFE0F/g;var zeroWidthJoiner=String.fromCharCode(8205);var removeVS16s=function removeVS16s(rawEmoji){return rawEmoji.indexOf(zeroWidthJoiner)<0?rawEmoji.replace(vs16RegExp,""):rawEmoji};function toCodePoints(unicodeSurrogates){var points=[];var char=0;var previous=0;var i=0;while(i<unicodeSurrogates.length){char=unicodeSurrogates.charCodeAt(i++);if(previous){points.push((65536+(previous-55296<<10)+(char-56320)).toString(16));previous=0}else if(char>55296&&char<=56319){previous=char}else{points.push(char.toString(16))}}return points}});unwrapExports(dist);var dist_1=dist.TypeName;var dist_2=dist.parse;var dist_3=dist.toCodePoints;var urlHasHttps=/^https:\/\//i;var parseTweet=function parseTweet(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:configs.defaults;var mergedOptions=Object.keys(options).length?options:configs.defaults;var defaultWeight=mergedOptions.defaultWeight,emojiParsingEnabled=mergedOptions.emojiParsingEnabled,scale=mergedOptions.scale,maxWeightedTweetLength=mergedOptions.maxWeightedTweetLength,transformedURLLength=mergedOptions.transformedURLLength;var normalizedText=typeof String.prototype.normalize==="function"?text.normalize():text;var urlEntitiesMap=transformEntitiesToHash(extractUrlsWithIndices(normalizedText));var emojiEntitiesMap=emojiParsingEnabled?transformEntitiesToHash(dist_2(normalizedText)):[];var tweetLength=normalizedText.length;var weightedLength=0;var validDisplayIndex=0;var valid=true;for(var charIndex=0;charIndex<tweetLength;charIndex++){if(urlEntitiesMap[charIndex]){var _urlEntitiesMap$charI=urlEntitiesMap[charIndex],url=_urlEntitiesMap$charI.url,indices=_urlEntitiesMap$charI.indices;weightedLength+=transformedURLLength*scale;charIndex+=url.length-1}else if(emojiParsingEnabled&&emojiEntitiesMap[charIndex]){var _emojiEntitiesMap$cha=emojiEntitiesMap[charIndex],emoji=_emojiEntitiesMap$cha.text,_indices=_emojiEntitiesMap$cha.indices;weightedLength+=defaultWeight;charIndex+=emoji.length-1}else{charIndex+=isSurrogatePair(normalizedText,charIndex)?1:0;weightedLength+=getCharacterWeight(normalizedText.charAt(charIndex),mergedOptions)}if(valid){valid=!hasInvalidCharacters(normalizedText.substring(charIndex,charIndex+1))}if(valid&&weightedLength<=maxWeightedTweetLength*scale){validDisplayIndex=charIndex}}weightedLength=weightedLength/scale;valid=valid&&weightedLength>0&&weightedLength<=maxWeightedTweetLength;var permillage=Math.floor(weightedLength/maxWeightedTweetLength*1e3);var normalizationOffset=text.length-normalizedText.length;validDisplayIndex+=normalizationOffset;return{weightedLength:weightedLength,valid:valid,permillage:permillage,validRangeStart:0,validRangeEnd:validDisplayIndex,displayRangeStart:0,displayRangeEnd:text.length>0?text.length-1:0}};var transformEntitiesToHash=function transformEntitiesToHash(entities){return entities.reduce(function(map,entity){map[entity.indices[0]]=entity;return map},{})};var isSurrogatePair=function isSurrogatePair(text,cIndex){if(cIndex<text.length-1){var c=text.charCodeAt(cIndex);var cNext=text.charCodeAt(cIndex+1);return 55296<=c&&c<=56319&&56320<=cNext&&cNext<=57343}return false};var getTweetLength=function getTweetLength(text){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:configs.defaults;return parseTweet(text,options).weightedLength};function getUnicodeTextLength(text){return text.replace(nonBmpCodePairs," ").length}function splitTags(text){var firstSplits=text.split("<"),secondSplits,allSplits=[],split;for(var i=0;i<firstSplits.length;i+=1){split=firstSplits[i];if(!split){allSplits.push("")}else{secondSplits=split.split(">");for(var j=0;j<secondSplits.length;j+=1){allSplits.push(secondSplits[j])}}}return allSplits}function hitHighlight(text,hits,options){var defaultHighlightTag="em";hits=hits||[];options=options||{};if(hits.length===0){return text}var tagName=options.tag||defaultHighlightTag,tags=["<".concat(tagName,">"),"</".concat(tagName,">")],chunks=splitTags(text),i,j,result="",chunkIndex=0,chunk=chunks[0],prevChunksLen=0,chunkCursor=0,startInChunk=false,chunkChars=chunk,flatHits=[],index,hit,tag,placed,hitSpot;for(i=0;i<hits.length;i+=1){for(j=0;j<hits[i].length;j+=1){flatHits.push(hits[i][j])}}for(index=0;index<flatHits.length;index+=1){hit=flatHits[index];tag=tags[index%2];placed=false;while(chunk!=null&&hit>=prevChunksLen+chunk.length){result+=chunkChars.slice(chunkCursor);if(startInChunk&&hit===prevChunksLen+chunkChars.length){result+=tag;placed=true}if(chunks[chunkIndex+1]){result+="<".concat(chunks[chunkIndex+1],">")}prevChunksLen+=chunkChars.length;chunkCursor=0;chunkIndex+=2;chunk=chunks[chunkIndex];chunkChars=chunk;startInChunk=false}if(!placed&&chunk!=null){hitSpot=hit-prevChunksLen;result+=chunkChars.slice(chunkCursor,hitSpot)+tag;chunkCursor=hitSpot;if(index%2===0){startInChunk=true}else{startInChunk=false}}else if(!placed){placed=true;result+=tag}}if(chunk!=null){if(chunkCursor<chunkChars.length){result+=chunkChars.slice(chunkCursor)}for(index=chunkIndex+1;index<chunks.length;index+=1){result+=index%2===0?chunks[index]:"<".concat(chunks[index],">")}}return result}$export$1($export$1.S+$export$1.F*!require$$0$4,"Object",{defineProperty:require$$1$2.f});$export$1($export$1.S+$export$1.F*!require$$0$4,"Object",{defineProperties:dPs});var f$4=Object.getOwnPropertySymbols;var _objectGops={f:f$4};var _objectGops$1=Object.freeze({"default":_objectGops,__moduleExports:_objectGops,f:f$4});var gOPS=_objectGops$1&&_objectGops||_objectGops$1;var Reflect=require$$0$1.Reflect;var _ownKeys=Reflect&&Reflect.ownKeys||function ownKeys(it){var keys=require$$0$c.f(anObject(it));var getSymbols=gOPS.f;return getSymbols?keys.concat(getSymbols(it)):keys};var _ownKeys$1=Object.freeze({"default":_ownKeys,__moduleExports:_ownKeys});var _createProperty=function(object,index,value){if(index in object)require$$1$2.f(object,index,descriptor(0,value));else object[index]=value};var _createProperty$1=Object.freeze({"default":_createProperty,__moduleExports:_createProperty});var ownKeys=_ownKeys$1&&_ownKeys||_ownKeys$1;var createProperty=_createProperty$1&&_createProperty||_createProperty$1;
$export$1($export$1.S,"Object",{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(object){var O=toIObject(object);var getDesc=require$$1$3.f;var keys=ownKeys(O);var result={};var i=0;var key,desc;while(keys.length>i){desc=getDesc(O,key=keys[i++]);if(desc!==undefined)createProperty(result,key,desc)}return result}});var SPECIES$3=require$$0$3("species");var _arraySpeciesConstructor=function(original){var C;if(require$$0$d(original)){C=original.constructor;if(typeof C=="function"&&(C===Array||require$$0$d(C.prototype)))C=undefined;if(isObject(C)){C=C[SPECIES$3];if(C===null)C=undefined}}return C===undefined?Array:C};var _arraySpeciesConstructor$1=Object.freeze({"default":_arraySpeciesConstructor,__moduleExports:_arraySpeciesConstructor});var speciesConstructor$1=_arraySpeciesConstructor$1&&_arraySpeciesConstructor||_arraySpeciesConstructor$1;var _arraySpeciesCreate=function(original,length){return new(speciesConstructor$1(original))(length)};var _arraySpeciesCreate$1=Object.freeze({"default":_arraySpeciesCreate,__moduleExports:_arraySpeciesCreate});var asc=_arraySpeciesCreate$1&&_arraySpeciesCreate||_arraySpeciesCreate$1;var _arrayMethods=function(TYPE,$create){var IS_MAP=TYPE==1;var IS_FILTER=TYPE==2;var IS_SOME=TYPE==3;var IS_EVERY=TYPE==4;var IS_FIND_INDEX=TYPE==6;var NO_HOLES=TYPE==5||IS_FIND_INDEX;var create=$create||asc;return function($this,callbackfn,that){var O=toObject($this);var self=IObject(O);var f=require$$0$6(callbackfn,that,3);var length=toLength(self.length);var index=0;var result=IS_MAP?create($this,length):IS_FILTER?create($this,0):undefined;var val,res;for(;length>index;index++)if(NO_HOLES||index in self){val=self[index];res=f(val,index,O);if(TYPE){if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return true;case 5:return val;case 6:return index;case 2:result.push(val)}else if(IS_EVERY)return false}}return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:result}};var _arrayMethods$1=Object.freeze({"default":_arrayMethods,__moduleExports:_arrayMethods});var require$$0$f=_arrayMethods$1&&_arrayMethods||_arrayMethods$1;var $forEach=require$$0$f(0);var STRICT=require$$0$9([].forEach,true);$export$1($export$1.P+$export$1.F*!STRICT,"Array",{forEach:function forEach(callbackfn){return $forEach(this,callbackfn,arguments[1])}});var $filter=require$$0$f(2);$export$1($export$1.P+$export$1.F*!require$$0$9([].filter,true),"Array",{filter:function filter(callbackfn){return $filter(this,callbackfn,arguments[1])}});var _meta=createCommonjsModule(function(module){var META=uid("meta");var setDesc=require$$1$2.f;var id=0;var isExtensible=Object.isExtensible||function(){return true};var FREEZE=!require$$1$1(function(){return isExtensible(Object.preventExtensions({}))});var setMeta=function(it){setDesc(it,META,{value:{i:"O"+ ++id,w:{}}})};var fastKey=function(it,create){if(!isObject(it))return typeof it=="symbol"?it:(typeof it=="string"?"S":"P")+it;if(!has(it,META)){if(!isExtensible(it))return"F";if(!create)return"E";setMeta(it)}return it[META].i};var getWeak=function(it,create){if(!has(it,META)){if(!isExtensible(it))return true;if(!create)return false;setMeta(it)}return it[META].w};var onFreeze=function(it){if(FREEZE&&meta.NEED&&isExtensible(it)&&!has(it,META))setMeta(it);return it};var meta=module.exports={KEY:META,NEED:false,fastKey:fastKey,getWeak:getWeak,onFreeze:onFreeze}});var _meta_1=_meta.KEY;var _meta_2=_meta.NEED;var _meta_3=_meta.fastKey;var _meta_4=_meta.getWeak;var _meta_5=_meta.onFreeze;var _meta$1=Object.freeze({"default":_meta,__moduleExports:_meta,KEY:_meta_1,NEED:_meta_2,fastKey:_meta_3,getWeak:_meta_4,onFreeze:_meta_5});var f$5=require$$0$3;var _wksExt={f:f$5};var _wksExt$1=Object.freeze({"default":_wksExt,__moduleExports:_wksExt,f:f$5});var wksExt=_wksExt$1&&_wksExt||_wksExt$1;var defineProperty=require$$1$2.f;var _wksDefine=function(name){var $Symbol=require$$1.Symbol||(require$$1.Symbol=LIBRARY?{}:require$$0$1.Symbol||{});if(name.charAt(0)!="_"&&!(name in $Symbol))defineProperty($Symbol,name,{value:wksExt.f(name)})};var _wksDefine$1=Object.freeze({"default":_wksDefine,__moduleExports:_wksDefine});var _enumKeys=function(it){var result=getKeys(it);var getSymbols=gOPS.f;if(getSymbols){var symbols=getSymbols(it);var isEnum=pIE.f;var i=0;var key;while(symbols.length>i)if(isEnum.call(it,key=symbols[i++]))result.push(key)}return result};var _enumKeys$1=Object.freeze({"default":_enumKeys,__moduleExports:_enumKeys});var gOPN$1=require$$0$c.f;var toString$1={}.toString;var windowNames=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];var getWindowNames=function(it){try{return gOPN$1(it)}catch(e){return windowNames.slice()}};var f$6=function getOwnPropertyNames(it){return windowNames&&toString$1.call(it)=="[object Window]"?getWindowNames(it):gOPN$1(toIObject(it))};var _objectGopnExt={f:f$6};var _objectGopnExt$1=Object.freeze({"default":_objectGopnExt,__moduleExports:_objectGopnExt,f:f$6});var require$$0$g=_meta$1&&_meta||_meta$1;var wksDefine=_wksDefine$1&&_wksDefine||_wksDefine$1;var enumKeys=_enumKeys$1&&_enumKeys||_enumKeys$1;var gOPNExt=_objectGopnExt$1&&_objectGopnExt||_objectGopnExt$1;var META=require$$0$g.KEY;var gOPD$1=require$$1$3.f;var dP$2=require$$1$2.f;var gOPN$2=gOPNExt.f;var $Symbol=require$$0$1.Symbol;var $JSON=require$$0$1.JSON;var _stringify=$JSON&&$JSON.stringify;var PROTOTYPE$2="prototype";var HIDDEN=require$$0$3("_hidden");var TO_PRIMITIVE=require$$0$3("toPrimitive");var isEnum={}.propertyIsEnumerable;var SymbolRegistry=require$$0$2("symbol-registry");var AllSymbols=require$$0$2("symbols");var OPSymbols=require$$0$2("op-symbols");var ObjectProto$1=Object[PROTOTYPE$2];var USE_NATIVE=typeof $Symbol=="function"&&!!gOPS.f;var QObject=require$$0$1.QObject;var setter=!QObject||!QObject[PROTOTYPE$2]||!QObject[PROTOTYPE$2].findChild;var setSymbolDesc=require$$0$4&&require$$1$1(function(){return create(dP$2({},"a",{get:function(){return dP$2(this,"a",{value:7}).a}})).a!=7})?function(it,key,D){var protoDesc=gOPD$1(ObjectProto$1,key);if(protoDesc)delete ObjectProto$1[key];dP$2(it,key,D);if(protoDesc&&it!==ObjectProto$1)dP$2(ObjectProto$1,key,protoDesc)}:dP$2;var wrap=function(tag){var sym=AllSymbols[tag]=create($Symbol[PROTOTYPE$2]);sym._k=tag;return sym};var isSymbol=USE_NATIVE&&typeof $Symbol.iterator=="symbol"?function(it){return typeof it=="symbol"}:function(it){return it instanceof $Symbol};var $defineProperty=function defineProperty(it,key,D){if(it===ObjectProto$1)$defineProperty(OPSymbols,key,D);anObject(it);key=toPrimitive(key,true);anObject(D);if(has(AllSymbols,key)){if(!D.enumerable){if(!has(it,HIDDEN))dP$2(it,HIDDEN,descriptor(1,{}));it[HIDDEN][key]=true}else{if(has(it,HIDDEN)&&it[HIDDEN][key])it[HIDDEN][key]=false;D=create(D,{enumerable:descriptor(0,false)})}return setSymbolDesc(it,key,D)}return dP$2(it,key,D)};var $defineProperties=function defineProperties(it,P){anObject(it);var keys=enumKeys(P=toIObject(P));var i=0;var l=keys.length;var key;while(l>i)$defineProperty(it,key=keys[i++],P[key]);return it};var $create=function create$1(it,P){return P===undefined?create(it):$defineProperties(create(it),P)};var $propertyIsEnumerable=function propertyIsEnumerable(key){var E=isEnum.call(this,key=toPrimitive(key,true));if(this===ObjectProto$1&&has(AllSymbols,key)&&!has(OPSymbols,key))return false;return E||!has(this,key)||!has(AllSymbols,key)||has(this,HIDDEN)&&this[HIDDEN][key]?E:true};var $getOwnPropertyDescriptor=function getOwnPropertyDescriptor(it,key){it=toIObject(it);key=toPrimitive(key,true);if(it===ObjectProto$1&&has(AllSymbols,key)&&!has(OPSymbols,key))return;var D=gOPD$1(it,key);if(D&&has(AllSymbols,key)&&!(has(it,HIDDEN)&&it[HIDDEN][key]))D.enumerable=true;return D};var $getOwnPropertyNames=function getOwnPropertyNames(it){var names=gOPN$2(toIObject(it));var result=[];var i=0;var key;while(names.length>i){if(!has(AllSymbols,key=names[i++])&&key!=HIDDEN&&key!=META)result.push(key)}return result};var $getOwnPropertySymbols=function getOwnPropertySymbols(it){var IS_OP=it===ObjectProto$1;var names=gOPN$2(IS_OP?OPSymbols:toIObject(it));var result=[];var i=0;var key;while(names.length>i){if(has(AllSymbols,key=names[i++])&&(IS_OP?has(ObjectProto$1,key):true))result.push(AllSymbols[key])}return result};if(!USE_NATIVE){$Symbol=function Symbol(){if(this instanceof $Symbol)throw TypeError("Symbol is not a constructor!");var tag=uid(arguments.length>0?arguments[0]:undefined);var $set=function(value){if(this===ObjectProto$1)$set.call(OPSymbols,value);if(has(this,HIDDEN)&&has(this[HIDDEN],tag))this[HIDDEN][tag]=false;setSymbolDesc(this,tag,descriptor(1,value))};if(require$$0$4&&setter)setSymbolDesc(ObjectProto$1,tag,{configurable:true,set:$set});return wrap(tag)};redefine($Symbol[PROTOTYPE$2],"toString",function toString(){return this._k});require$$1$3.f=$getOwnPropertyDescriptor;require$$1$2.f=$defineProperty;require$$0$c.f=gOPNExt.f=$getOwnPropertyNames;pIE.f=$propertyIsEnumerable;gOPS.f=$getOwnPropertySymbols;if(require$$0$4&&!LIBRARY){redefine(ObjectProto$1,"propertyIsEnumerable",$propertyIsEnumerable,true)}wksExt.f=function(name){return wrap(require$$0$3(name))}}$export$1($export$1.G+$export$1.W+$export$1.F*!USE_NATIVE,{Symbol:$Symbol});for(var es6Symbols="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),j=0;es6Symbols.length>j;)require$$0$3(es6Symbols[j++]);for(var wellKnownSymbols=getKeys(require$$0$3.store),k=0;wellKnownSymbols.length>k;)wksDefine(wellKnownSymbols[k++]);$export$1($export$1.S+$export$1.F*!USE_NATIVE,"Symbol",{"for":function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key)},keyFor:function keyFor(sym){if(!isSymbol(sym))throw TypeError(sym+" is not a symbol!");for(var key in SymbolRegistry)if(SymbolRegistry[key]===sym)return key},useSetter:function(){setter=true},useSimple:function(){setter=false}});$export$1($export$1.S+$export$1.F*!USE_NATIVE,"Object",{create:$create,defineProperty:$defineProperty,defineProperties:$defineProperties,getOwnPropertyDescriptor:$getOwnPropertyDescriptor,getOwnPropertyNames:$getOwnPropertyNames,getOwnPropertySymbols:$getOwnPropertySymbols});var FAILS_ON_PRIMITIVES=require$$1$1(function(){gOPS.f(1)});$export$1($export$1.S+$export$1.F*FAILS_ON_PRIMITIVES,"Object",{getOwnPropertySymbols:function getOwnPropertySymbols(it){return gOPS.f(toObject(it))}});$JSON&&$export$1($export$1.S+$export$1.F*(!USE_NATIVE||require$$1$1(function(){var S=$Symbol();return _stringify([S])!="[null]"||_stringify({a:S})!="{}"||_stringify(Object(S))!="{}"})),"JSON",{stringify:function stringify(it){var args=[it];var i=1;var replacer,$replacer;while(arguments.length>i)args.push(arguments[i++]);$replacer=replacer=args[1];if(!isObject(replacer)&&it===undefined||isSymbol(it))return;if(!require$$0$d(replacer))replacer=function(key,value){if(typeof $replacer=="function")value=$replacer.call(this,key,value);if(!isSymbol(value))return value};args[1]=replacer;return _stringify.apply($JSON,args)}});$Symbol[PROTOTYPE$2][TO_PRIMITIVE]||require$$0$5($Symbol[PROTOTYPE$2],TO_PRIMITIVE,$Symbol[PROTOTYPE$2].valueOf);setToStringTag($Symbol,"Symbol");setToStringTag(Math,"Math",true);setToStringTag(require$$0$1.JSON,"JSON",true);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var defineProperty$1=_defineProperty;function ownKeys$1(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable});keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys$1(source,true).forEach(function(key){defineProperty$1(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys$1(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function isInvalidTweet(text){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:configs.defaults;if(!text){return"empty"}var mergedOptions=_objectSpread({},configs.defaults,{},options);var maxLength=mergedOptions.maxWeightedTweetLength;if(getTweetLength(text,mergedOptions)>maxLength){return"too_long"}if(hasInvalidCharacters(text)){return"invalid_characters"}return false}function isValidHashtag(hashtag){if(!hashtag){return false}var extracted=extractHashtags(hashtag);return extracted.length===1&&extracted[0]===hashtag.slice(1)}var VALID_LIST_RE=regexSupplant(/^#{validMentionOrList}$/,{validMentionOrList:validMentionOrList});function isValidList(usernameList){var match=usernameList.match(VALID_LIST_RE);return!!(match&&match[1]==""&&match[4])}function isValidTweetText(text,options){return!isInvalidTweet(text,options)}var validateUrlUnreserved=/[a-z\u0400-\u04FF0-9\-._~]/i;var validateUrlPctEncoded=/(?:%[0-9a-f]{2})/i;var validateUrlSubDelims=/[!$&'()*+,;=]/i;var validateUrlUserinfo=regexSupplant("(?:"+"#{validateUrlUnreserved}|"+"#{validateUrlPctEncoded}|"+"#{validateUrlSubDelims}|"+":"+")*",{validateUrlUnreserved:validateUrlUnreserved,validateUrlPctEncoded:validateUrlPctEncoded,validateUrlSubDelims:validateUrlSubDelims},"i");var validateUrlDomainSegment=/(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?)/i;var validateUrlDomainTld=/(?:[a-z](?:[a-z0-9\-]*[a-z0-9])?)/i;var validateUrlSubDomainSegment=/(?:[a-z0-9](?:[a-z0-9_\-]*[a-z0-9])?)/i;var validateUrlDomain=regexSupplant(/(?:(?:#{validateUrlSubDomainSegment}\.)*(?:#{validateUrlDomainSegment}\.)#{validateUrlDomainTld})/i,{validateUrlSubDomainSegment:validateUrlSubDomainSegment,validateUrlDomainSegment:validateUrlDomainSegment,validateUrlDomainTld:validateUrlDomainTld});var validateUrlDecOctet=/(?:[0-9]|(?:[1-9][0-9])|(?:1[0-9]{2})|(?:2[0-4][0-9])|(?:25[0-5]))/i;var validateUrlIpv4=regexSupplant(/(?:#{validateUrlDecOctet}(?:\.#{validateUrlDecOctet}){3})/i,{validateUrlDecOctet:validateUrlDecOctet});var validateUrlIpv6=/(?:\[[a-f0-9:\.]+\])/i;var validateUrlIp=regexSupplant("(?:"+"#{validateUrlIpv4}|"+"#{validateUrlIpv6}"+")",{validateUrlIpv4:validateUrlIpv4,validateUrlIpv6:validateUrlIpv6},"i");var validateUrlHost=regexSupplant("(?:"+"#{validateUrlIp}|"+"#{validateUrlDomain}"+")",{validateUrlIp:validateUrlIp,validateUrlDomain:validateUrlDomain},"i");var validateUrlPort=/[0-9]{1,5}/;var validateUrlAuthority=regexSupplant("(?:(#{validateUrlUserinfo})@)?"+"(#{validateUrlHost})"+"(?::(#{validateUrlPort}))?",{validateUrlUserinfo:validateUrlUserinfo,validateUrlHost:validateUrlHost,validateUrlPort:validateUrlPort},"i");var validateUrlPchar=regexSupplant("(?:"+"#{validateUrlUnreserved}|"+"#{validateUrlPctEncoded}|"+"#{validateUrlSubDelims}|"+"[:|@]"+")",{validateUrlUnreserved:validateUrlUnreserved,validateUrlPctEncoded:validateUrlPctEncoded,validateUrlSubDelims:validateUrlSubDelims},"i");var validateUrlFragment=regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i,{validateUrlPchar:validateUrlPchar});var validateUrlPath=regexSupplant(/(\/#{validateUrlPchar}*)*/i,{validateUrlPchar:validateUrlPchar});var validateUrlQuery=regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i,{validateUrlPchar:validateUrlPchar});var validateUrlScheme=/(?:[a-z][a-z0-9+\-.]*)/i;var validateUrlUnencoded=regexSupplant("^"+"(?:"+"([^:/?#]+):\\/\\/"+")?"+"([^/?#]*)"+"([^?#]*)"+"(?:"+"\\?([^#]*)"+")?"+"(?:"+"#(.*)"+")?$","i");var validateUrlUnicodeSubDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9_\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;var validateUrlUnicodeDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;var validateUrlUnicodeDomainTld=/(?:(?:[a-z]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;var validateUrlUnicodeDomain=regexSupplant(/(?:(?:#{validateUrlUnicodeSubDomainSegment}\.)*(?:#{validateUrlUnicodeDomainSegment}\.)#{validateUrlUnicodeDomainTld})/i,{validateUrlUnicodeSubDomainSegment:validateUrlUnicodeSubDomainSegment,validateUrlUnicodeDomainSegment:validateUrlUnicodeDomainSegment,validateUrlUnicodeDomainTld:validateUrlUnicodeDomainTld});var validateUrlUnicodeHost=regexSupplant("(?:"+"#{validateUrlIp}|"+"#{validateUrlUnicodeDomain}"+")",{validateUrlIp:validateUrlIp,validateUrlUnicodeDomain:validateUrlUnicodeDomain},"i");var validateUrlUnicodeAuthority=regexSupplant("(?:(#{validateUrlUserinfo})@)?"+"(#{validateUrlUnicodeHost})"+"(?::(#{validateUrlPort}))?",{validateUrlUserinfo:validateUrlUserinfo,validateUrlUnicodeHost:validateUrlUnicodeHost,validateUrlPort:validateUrlPort},"i");function isValidMatch(string,regex,optional){if(!optional){return typeof string==="string"&&string.match(regex)&&RegExp["$&"]===string}return!string||string.match(regex)&&RegExp["$&"]===string}function isValidUrl$1(url,unicodeDomains,requireProtocol){if(unicodeDomains==null){unicodeDomains=true}if(requireProtocol==null){requireProtocol=true}if(!url){return false}var urlParts=url.match(validateUrlUnencoded);if(!urlParts||urlParts[0]!==url){return false}var scheme=urlParts[1],authority=urlParts[2],path=urlParts[3],query=urlParts[4],fragment=urlParts[5];if(!((!requireProtocol||isValidMatch(scheme,validateUrlScheme)&&scheme.match(/^https?$/i))&&isValidMatch(path,validateUrlPath)&&isValidMatch(query,validateUrlQuery,true)&&isValidMatch(fragment,validateUrlFragment,true))){return false}return unicodeDomains&&isValidMatch(authority,validateUrlUnicodeAuthority)||!unicodeDomains&&isValidMatch(authority,validateUrlAuthority)}function isValidUsername(username){if(!username){return false}var extracted=extractMentions(username);return extracted.length===1&&extracted[0]===username.slice(1)}var regexen={astralLetterAndMarks:astralLetterAndMarks,astralNumerals:astralNumerals,atSigns:atSigns,bmpLetterAndMarks:bmpLetterAndMarks,bmpNumerals:bmpNumerals,cashtag:cashtag,codePoint:codePoint,cyrillicLettersAndMarks:cyrillicLettersAndMarks,endHashtagMatch:endHashtagMatch,endMentionMatch:endMentionMatch,extractUrl:extractUrl,hashSigns:hashSigns,hashtagAlpha:hashtagAlpha,hashtagAlphaNumeric:hashtagAlphaNumeric,hashtagBoundary:hashtagBoundary,hashtagSpecialChars:hashtagSpecialChars,invalidChars:invalidChars,invalidCharsGroup:invalidCharsGroup,invalidDomainChars:invalidDomainChars,invalidUrlWithoutProtocolPrecedingChars:invalidUrlWithoutProtocolPrecedingChars,latinAccentChars:latinAccentChars,nonBmpCodePairs:nonBmpCodePairs,punct:punct,rtlChars:rtlChars,spaces:spaces,spacesGroup:spacesGroup,urlHasHttps:urlHasHttps,urlHasProtocol:urlHasProtocol,validAsciiDomain:validAsciiDomain,validateUrlAuthority:validateUrlAuthority,validateUrlDecOctet:validateUrlDecOctet,validateUrlDomain:validateUrlDomain,validateUrlDomainSegment:validateUrlDomainSegment,validateUrlDomainTld:validateUrlDomainTld,validateUrlFragment:validateUrlFragment,validateUrlHost:validateUrlHost,validateUrlIp:validateUrlIp,validateUrlIpv4:validateUrlIpv4,validateUrlIpv6:validateUrlIpv6,validateUrlPath:validateUrlPath,validateUrlPchar:validateUrlPchar,validateUrlPctEncoded:validateUrlPctEncoded,validateUrlPort:validateUrlPort,validateUrlQuery:validateUrlQuery,validateUrlScheme:validateUrlScheme,validateUrlSubDelims:validateUrlSubDelims,validateUrlSubDomainSegment:validateUrlSubDomainSegment,validateUrlUnencoded:validateUrlUnencoded,validateUrlUnicodeAuthority:validateUrlUnicodeAuthority,validateUrlUnicodeDomain:validateUrlUnicodeDomain,validateUrlUnicodeDomainSegment:validateUrlUnicodeDomainSegment,validateUrlUnicodeDomainTld:validateUrlUnicodeDomainTld,validateUrlUnicodeHost:validateUrlUnicodeHost,validateUrlUnicodeSubDomainSegment:validateUrlUnicodeSubDomainSegment,validateUrlUnreserved:validateUrlUnreserved,validateUrlUserinfo:validateUrlUserinfo,validCashtag:validCashtag,validCCTLD:validCCTLD,validDomain:validDomain,validDomainChars:validDomainChars,validDomainName:validDomainName,validGeneralUrlPathChars:validGeneralUrlPathChars,validGTLD:validGTLD,validHashtag:validHashtag,validMentionOrList:validMentionOrList,validMentionPrecedingChars:validMentionPrecedingChars,validPortNumber:validPortNumber,validPunycode:validPunycode,validReply:validReply,validSubdomain:validSubdomain,validTcoUrl:validTcoUrl,validUrlBalancedParens:validUrlBalancedParens,validUrlPath:validUrlPath,validUrlPathEndingChars:validUrlPathEndingChars,validUrlPrecedingChars:validUrlPrecedingChars,validUrlQueryChars:validUrlQueryChars,validUrlQueryEndingChars:validUrlQueryEndingChars};var $at=require$$0(true);require$$1$4(String,"String",function(iterated){this._t=String(iterated);this._i=0},function(){var O=this._t;var index=this._i;var point;if(index>=O.length)return{value:undefined,done:true};point=$at(O,index);this._i+=point.length;return{value:point,done:false}});var _iterCall=function(iterator,fn,value,entries){try{return entries?fn(anObject(value)[0],value[1]):fn(value)}catch(e){var ret=iterator["return"];if(ret!==undefined)anObject(ret.call(iterator));throw e}};var _iterCall$1=Object.freeze({"default":_iterCall,__moduleExports:_iterCall});var ITERATOR$2=require$$0$3("iterator");var ArrayProto$1=Array.prototype;var _isArrayIter=function(it){return it!==undefined&&(Iterators.Array===it||ArrayProto$1[ITERATOR$2]===it)};var _isArrayIter$1=Object.freeze({"default":_isArrayIter,__moduleExports:_isArrayIter});var ITERATOR$3=require$$0$3("iterator");var core_getIteratorMethod=require$$1.getIteratorMethod=function(it){if(it!=undefined)return it[ITERATOR$3]||it["@@iterator"]||Iterators[classof(it)]};var core_getIteratorMethod$1=Object.freeze({"default":core_getIteratorMethod,__moduleExports:core_getIteratorMethod});var ITERATOR$4=require$$0$3("iterator");var SAFE_CLOSING=false;try{var riter=[7][ITERATOR$4]();riter["return"]=function(){SAFE_CLOSING=true}}catch(e){}var _iterDetect=function(exec,skipClosing){if(!skipClosing&&!SAFE_CLOSING)return false;var safe=false;try{var arr=[7];var iter=arr[ITERATOR$4]();iter.next=function(){return{done:safe=true}};arr[ITERATOR$4]=function(){return iter};exec(arr)}catch(e){}return safe};var _iterDetect$1=Object.freeze({"default":_iterDetect,__moduleExports:_iterDetect});var call=_iterCall$1&&_iterCall||_iterCall$1;var isArrayIter=_isArrayIter$1&&_isArrayIter||_isArrayIter$1;var getIterFn=core_getIteratorMethod$1&&core_getIteratorMethod||core_getIteratorMethod$1;var require$$0$h=_iterDetect$1&&_iterDetect||_iterDetect$1;$export$1($export$1.S+$export$1.F*!require$$0$h(function(iter){}),"Array",{from:function from(arrayLike){var O=toObject(arrayLike);var C=typeof this=="function"?this:Array;var aLen=arguments.length;var mapfn=aLen>1?arguments[1]:undefined;var mapping=mapfn!==undefined;var index=0;var iterFn=getIterFn(O);var length,result,step,iterator;if(mapping)mapfn=require$$0$6(mapfn,aLen>2?arguments[2]:undefined,2);if(iterFn!=undefined&&!(C==Array&&isArrayIter(iterFn))){for(iterator=iterFn.call(O),result=new C;!(step=iterator.next()).done;index++){createProperty(result,index,mapping?call(iterator,mapfn,[step.value,index],true):step.value)}}else{length=toLength(O.length);for(result=new C(length);length>index;index++){createProperty(result,index,mapping?mapfn(O[index],index):O[index])}}result.length=index;return result}});function standardizeIndices(text,startIndex,endIndex){var totalUnicodeTextLength=getUnicodeTextLength(text);var encodingDiff=text.length-totalUnicodeTextLength;if(encodingDiff>0){var byCodePair=Array.from(text);var beforeText=startIndex===0?"":byCodePair.slice(0,startIndex).join("");var actualText=byCodePair.slice(startIndex,endIndex).join("");return[beforeText.length,beforeText.length+actualText.length]}return[startIndex,endIndex]}var index={autoLink:autoLink,autoLinkCashtags:autoLinkCashtags,autoLinkEntities:autoLinkEntities,autoLinkHashtags:autoLinkHashtags,autoLinkUrlsCustom:autoLinkUrlsCustom,autoLinkUsernamesOrLists:autoLinkUsernamesOrLists,autoLinkWithJSON:autoLinkWithJSON,configs:configs,convertUnicodeIndices:convertUnicodeIndices$1,extractCashtags:extractCashtags,extractCashtagsWithIndices:extractCashtagsWithIndices,extractEntitiesWithIndices:extractEntitiesWithIndices,extractHashtags:extractHashtags,extractHashtagsWithIndices:extractHashtagsWithIndices,extractHtmlAttrsFromOptions:extractHtmlAttrsFromOptions,extractMentions:extractMentions,extractMentionsOrListsWithIndices:extractMentionsOrListsWithIndices,extractMentionsWithIndices:extractMentionsWithIndices,extractReplies:extractReplies,extractUrls:extractUrls,extractUrlsWithIndices:extractUrlsWithIndices,getTweetLength:getTweetLength,getUnicodeTextLength:getUnicodeTextLength,hasInvalidCharacters:hasInvalidCharacters,hitHighlight:hitHighlight,htmlEscape:htmlEscape,isInvalidTweet:isInvalidTweet,isValidHashtag:isValidHashtag,isValidList:isValidList,isValidTweetText:isValidTweetText,isValidUrl:isValidUrl$1,isValidUsername:isValidUsername,linkTextWithEntity:linkTextWithEntity,linkToCashtag:linkToCashtag,linkToHashtag:linkToHashtag,linkToMentionAndList:linkToMentionAndList,linkToText:linkToText,linkToTextWithSymbol:linkToTextWithSymbol,linkToUrl:linkToUrl,modifyIndicesFromUTF16ToUnicode:modifyIndicesFromUTF16ToUnicode,modifyIndicesFromUnicodeToUTF16:modifyIndicesFromUnicodeToUTF16,regexen:regexen,removeOverlappingEntities:removeOverlappingEntities,parseTweet:parseTweet,splitTags:splitTags,standardizeIndices:standardizeIndices,tagAttrs:tagAttrs};return index});
;pageFuncs.social_funcs={};pageFuncs.social_funcs["facebook"]=function(b){var a=$('*[property="fb:app_id"]').attr("content");var c=encodeURIComponent(app_url+"facebook_callback.php?"+location.hash.substr(1));var d="https://www.facebook.com/dialog/share?app_id="+encodeURIComponent(a)+"&href="+encodeURIComponent(b)+"&redirect_uri="+c+"&display=touch";changeHref(d)};pageFuncs.social_funcs["twitter_mockup_generate"]=function(e,d,c,b){var a="";a+='<div class="tw_post_mockup">';if(typeof b=="string"){a+='<div class="tw_post_mockup_img" style="background-image:url('+b+');"></div>'}a+='<div class="tw_post_mockup_title">'+e+"</div>";a+='<p class="tw_post_mockup_desc">'+d+"</p>";a+='<div class="tw_post_mockup_domain">'+c+"</div>";a+="</div>";a+='<span class="clearall"></span>';return a};pageFuncs.social_funcs["twitter"]=function(c,e,b,d){if(!user_id){jqNotify(display_message.feature_for_logged_in_only)}else{if(typeof c=="undefined"){var c=""}if(typeof c!="string"){c=String(c)}if(!(typeof d=="string"&&d.length)){var d=""}data_put("social_tw_redirect_count",1);var a=jqPrompt(display_message.tweet_prompt,function(f){pageFuncs.social_funcs["twitter_send"](f+" "+b)},"",'<div id="tweet_count"></div>'+d,e);$(".tw_post_mockup_title, .tw_post_mockup_desc").ellipsis();setTimeout(function(){var f=$(".tw_post_mockup").height();if(f>75){$(".tw_post_mockup_img").height(f)}$("#"+a).val(c+" ")},1);pageFuncs.social_funcs["twitter_update_chars"](a,b);$("#"+a).on("keyup",function(){pageFuncs.social_funcs["twitter_update_chars"](a,b)})}};pageFuncs.social_funcs["twitter_send"]=function(c,a){var b="?tweet="+encodeURIComponent(c);$.get("twitter_tweet.php"+b,function(e){if(e.success==1){jqNotify(display_message.tweet_success)}else{if(typeof e.redirect!="undefined"){data_put("social_tw_redirected",c);var d=parseInt(data_get("social_tw_redirect_count"),10);if(d<2){data_put("social_tw_redirect_count",(d+1));changeHref(e.redirect)}else{data_del("social_tw_redirected");pageFuncs.social_funcs["twitter"](c)}}else{if(e.errorcode==186){pageFuncs.social_funcs["twitter"](c);jqNotify(display_message.tweet_too_long)}else{jqNotify(display_message.tweet_general_error)}}}})};pageFuncs.social_funcs["twitter_update_chars"]=function(d,b){if(typeof b=="string"&&b.length){b=" "+(b.trim())}else{b=""}var c=($("#"+d).val()+b).trim();var a=(280-twttr.txt.getTweetLength(c));$("#tweet_count").html(a);if(a<0){$("#tweet_count").addClass("negative")}else{$("#tweet_count").removeClass("negative")}};pageFuncs.social_funcs["check_waiting_posts"]=function(){var b=getQueryVar("fb_post_success");if(typeof b!="undefined"){if(Date.now()-b<10000){jqNotify(display_message.facebook_success)}}var a=data_get("social_tw_redirected");if(typeof a!="undefined"){data_del("social_tw_redirected");pageFuncs.social_funcs["twitter_send"](a)}};pageFuncs.page_header={};var categoriesOpen=false;pageFuncs.page_header["loaded"]=function(){set_feedback_debug_string();$("#main_menu_feedback").on("touchstart mousedown",function(f){set_feedback_debug_string()});$("#search_form > *").height($("#search_form > *").height());if(smallscreen){$("#search").on("focus",function(f){$("#categories").hide();categoriesOpen=false;setTimeout(function(){$("#main_menu_categories").blur()},200)})}$("#search").autocomplete({source:"books_search.php?json=1",minLength:3,open:function(f,g){pageFuncs.page_header["search_val"]=$("#search").val()},select:function(f,g){hideKeyboard();setTimeout(function(){startLoading();if(typeof g.item.author_id!="undefined"){changeHash("view=books_search&quicksearch="+encodeURIComponent(pageFuncs.page_header["search_val"])+"&author_id="+g.item.author_id)}else{changeHash("view=book_info&quicksearch="+encodeURIComponent(pageFuncs.page_header["search_val"])+"&book_id="+g.item.id)}},100)}});$("#search").on("keyup",function(h){var g=h.keyCode;var f={ret:13};switch(g){case f.ret:hideKeyboard();startLoading();return true;break}});$("#main_menu_categories").click(function(){$("#categories").animate({height:"toggle"},fadeTime,function(){categoriesOpen=!categoriesOpen;$("#main_menu_categories").blur()})});var e=navigator.userAgent.match(/iPad/i)!=null,c=!e&&((navigator.userAgent.match(/iPhone/i)!=null)||(navigator.userAgent.match(/iPod/i)!=null)),a=e||c,d=!a&&navigator.userAgent.match(/android/i)!=null,b=a||d;if(b){$("#main_menu_social_facebook").on("click",function(f){f.preventDefault();window.location="fb://profile/168685996488560";setTimeout(function(){if((typeof document.webkitHidden!=="undefined"&&!document.webkitHidden)||(typeof document.hidden!=="undefined"&&!document.hidden)){var g=document.createElement("a");g.setAttribute("href","https://www.facebook.com/168685996488560");g.setAttribute("target","_blank");var h=document.createEvent("HTMLEvents");h.initEvent("click",true,true);g.dispatchEvent(h)}},500)});$("#main_menu_social_twitter").on("click",function(f){if(a){f.preventDefault();window.location="twitter://user?screen_name=mrsamuelfrench";setTimeout(function(){var g=document.createElement("a");
g.setAttribute("href","https://twitter.com/mrsamuelfrench");g.setAttribute("target","_blank");var h=document.createEvent("HTMLEvents");h.initEvent("click",true,true);g.dispatchEvent(h)},500)}});$("#main_menu_social_instagram").on("click",function(f){f.preventDefault();window.location="instagram://user?username=samuelfrenchnyc";setTimeout(function(){var g=document.createElement("a");g.setAttribute("href","https://instagram.com/samuelfrenchnyc");g.setAttribute("target","_blank");var h=document.createEvent("HTMLEvents");h.initEvent("click",true,true);g.dispatchEvent(h)},500)})}};pageFuncs.home={};pageFuncs.home["promo_panel_interval"]=null;pageFuncs.home["promo_panel_touched"]=0;pageFuncs.home["resized"]=function(){var a=$("#main_content").width();pageFuncs.home["panels_container"]=$("#promo_panels_container");pageFuncs.home["panels_container"].css("max-width",a+"px");if($(".promo_panel").width()>a){$(".promo_panel").width(a)}$("#promo_panels").imagesLoaded(function(){$("#promo_panels").width($(".promo_panel:first").width()*pageFuncs.home["panels_count"]*2);pageFuncs.home["panels_container"].fadeTo(fadeTime,1)})};pageFuncs.home["loaded"]=function(){var a=$("#promo_panels");pageFuncs.home["panels_count"]=$(".promo_panel").length;pageFuncs.home["current_panel"]=1;a.append(a.html());setTimeout(function(){pageFuncs.home["resized"]();stopLoading()},250);pageFuncs.home["updatePosDiv"]();$.detectSwipe.preventDefault=false;$(".promo_panel").on("swipeleft",function(){pageFuncs.home["promo_panel_touched"]=Date.now();if(pageFuncs.home["current_panel"]<pageFuncs.home["panels_count"]){pageFuncs.home["changePromoPanel"](1)}}).on("swiperight",function(){pageFuncs.home["promo_panel_touched"]=Date.now();if(pageFuncs.home["current_panel"]>1){pageFuncs.home["changePromoPanel"](-1)}});pageFuncs.home["mouseentered"]=a.is(":hover");a.on("mouseenter",function(){pageFuncs.home["promo_panel_touched"]=Date.now();pageFuncs.home["mouseentered"]=true});a.on("mouseleave",function(){pageFuncs.home["promo_panel_touched"]=Date.now();pageFuncs.home["mouseentered"]=false});clearInterval(pageFuncs.home["promo_panel_interval"]);pageFuncs.home["promo_panel_interval"]=setInterval(function(){if(currentview!="home"){clearInterval(pageFuncs.home["promo_panel_interval"])}else{if(pageFuncs.home["promo_panel_touched"]<(Date.now()-4000)&&pageFuncs.home["mouseentered"]==false){if(pageFuncs.home["current_panel"]>pageFuncs.home["panels_count"]){pageFuncs.home["current_panel"]=1;pageFuncs.home["panels_container"].stop(true).scrollLeft(0);pageFuncs.home["changePromoPanel"](1)}else{pageFuncs.home["changePromoPanel"](1)}}}},6000)};pageFuncs.home["changePromoPanel"]=function(c){var b=pageFuncs.home["current_panel"]+c;var a=Math.floor($(".promo_panel:first").outerWidth()*(b-1));pageFuncs.home["panels_container"].stop(true).animate({scrollLeft:a},fadeTime*2,function(){pageFuncs.home["current_panel"]+=c;pageFuncs.home["updatePosDiv"]()})};pageFuncs.home["goToPromoPanel"]=function(b){pageFuncs.home["promo_panel_touched"]=Date.now();var a=Math.floor($(".promo_panel:first").outerWidth()*(b-1));pageFuncs.home["panels_container"].stop(true).animate({scrollLeft:a},fadeTime*2,function(){pageFuncs.home["current_panel"]=b;pageFuncs.home["updatePosDiv"]()})};pageFuncs.home["updatePosDiv"]=function(){var b="";for(var a=1;a<=pageFuncs.home["panels_count"];a++){b+='<a onclick="pageFuncs.home.goToPromoPanel('+a+');">';if(a==pageFuncs.home["current_panel"]||(a==1&&pageFuncs.home["current_panel"]==pageFuncs.home["panels_count"]+1)){b+="<span>&#x25cf;</span>"}else{b+="&#x25cf;"}b+="</a> "}$("#posDiv").html(b)};pageFuncs.welcome={};pageFuncs.welcome["loaded"]=function(){hideBars();pageFuncs.welcome["intro_panels_count"]=$(".intro_panel").length;pageFuncs.welcome["current_panel"]=1;$("body").append('<div id="posDiv"></div>');pageFuncs.welcome["updatePosDiv"]();var a=$("#main_content").width();$("#intro_panels_container").css("max-width",a+"px");$(".intro_panel").width(a);$("#intro_panels").width(a*pageFuncs.welcome["intro_panels_count"]);pageFuncs.welcome["moving"]=false;$(document).on("swipeleft click",function(){if(pageFuncs.welcome["current_panel"]<pageFuncs.welcome["intro_panels_count"]){pageFuncs.welcome["changeIntroPanel"](1)}}).on("swiperight",function(){if(pageFuncs.welcome["current_panel"]>1){pageFuncs.welcome["changeIntroPanel"](-1)}})};pageFuncs.welcome["keydown"]=function(c){var b=c.keyCode;var a={left:37,right:39};switch(b){case a.left:pageFuncs.welcome["changeIntroPanel"](-1);break;case a.right:pageFuncs.welcome["changeIntroPanel"](1);break}};pageFuncs.welcome["changeIntroPanel"]=function(c){if(pageFuncs.welcome["moving"]==false){var b=pageFuncs.welcome["current_panel"]+c;if(b>0&&b<=pageFuncs.welcome["intro_panels_count"]){pageFuncs.welcome["moving"]=true;var a=Math.floor($(".intro_panel:first").outerWidth()*(b-1));if(smallscreen){$("#main").animate({scrollTop:0},fadeTime)}else{$("body").animate({scrollTop:0},fadeTime)}$("#intro_panels_container").stop(true).animate({scrollLeft:a},fadeTime,function(){pageFuncs.welcome["current_panel"]+=c;
pageFuncs.welcome["moving"]=false;pageFuncs.welcome["updatePosDiv"]();var d=$(".intro_panel:nth-of-type("+pageFuncs.welcome["current_panel"]+") > div > div").prop("id");if(d=="intro_panel_redirect_home"){$("#posDiv").remove();changeHash("view=home");reloadPageHeader()}else{if(d=="intro_panel_redirect_beta_subscribe"){$("#posDiv").remove();changeHash("view=user_subscription_choose_do&subscription_type_id=3")}}})}}};pageFuncs.welcome["updatePosDiv"]=function(){var b="";for(var a=1;a<=pageFuncs.welcome["intro_panels_count"];a++){if(a==pageFuncs.welcome["current_panel"]){b+="<span>&#x25cf;</span> "}else{b+="&#x25cf; "}}$("#posDiv").html(b)};pageFuncs.book_info={};pageFuncs.book_info["resized"]=function(){var a=$("#book_image");if(smallscreen){if($("#book_blurb").height()>($(window).height()/4)){$("#book_blurb").readmore()}a.height("auto")}else{var b=a.height();a.height($("#main_content").height());a.height($("#book_info").height());if(a.height()<b){a.height(b)}}};pageFuncs.book_info["loaded"]=function(){book_id=parseInt(getQueryVar("book_id"),10);pageFuncs.book_info["book_id"]=book_id;pageFuncs.book_info["book_info_url"]=window.location.protocol+"//"+window.location.host+"/app/book_info.php?book_id="+book_id+"#view=book_info&book_id="+book_id;var b=getQueryVar("from_subscription");if(!isNaN(b)&&b==1){var a=data_get("subscription_from_book_id");if(!isNaN(a)&&a>0){data_del("subscription_from_book_id");changeHash("view=book_info&book_id="+a)}else{var c=getQueryVar("new_user");if(!isNaN(c)&&c==1){changeHash("view=home")}else{changeHash("view=user_subscription_choose")}}}else{if(isNaN(pageFuncs.book_info["book_id"])||pageFuncs.book_info["book_id"]<1){changeHash("view=user_books")}}pageFuncs.book_info["resized"]();if(isBookStored(pageFuncs.book_info["book_id"])){$("#bookStorageRemoveButton").show()}else{$("#bookStorageSaveButton").show()}$("#bookStorageWaitButton").hide();user_access=parseInt($("#user_access").text(),10);storageProgressDialog=$("#bookStorageProgressContainer").dialog({autoOpen:false,dialogClass:"no-close",closeOnEscape:false,resizable:false,draggable:false,modal:true,height:"auto",open:function(){$(".ui-widget-overlay").hide().fadeIn(fadeTime);setTimeout(function(){$("#bookStorageProgressContainer").dialog("option","position",{my:"center",at:"center",of:$("#main")})},0)}});pageFuncs.social_funcs["check_waiting_posts"]();$("a.favourite").on("click",function(f){if(!user_id){jqNotify(display_message.feature_for_logged_in_only)}else{var d=this;$("a.favourite").show();$(d).hide();if($(d).hasClass("favourited")){$.get("user_favourite_book_set.php?action=1&book_id="+pageFuncs.book_info["book_id"],function(e){if(e.success!=1){jqNotify(display_message.error_setting_value);$("a.favourite").hide();$(d).show()}})}else{$.get("user_favourite_book_set.php?book_id="+pageFuncs.book_info["book_id"],function(e){if(e.success!=1){jqNotify(display_message.error_setting_value);$("a.favourite").hide();$(d).show()}})}}});$("a.buy").on("click",function(f){if(!user_id){var g=Date.now();jqNotify('You must log in to purchase plays. <a id="'+g+'" href="#external='+app_url+'user_log_in.php">Click here to log in or sign up.</a>',false,"You are not logged in");$("#"+g).blur()}else{var d=this;$("a.buy.in_basket").show();$("a.buy.not_in_basket").hide();if($(d).hasClass("in_basket")){return true}else{$.get("basket_add.php?purchase=1&book_id="+pageFuncs.book_info["book_id"],function(e){if(e.success==1){$(d).show();$("a.not_in_basket").remove();reloadPageHeader()}else{jqNotify(display_message.error_setting_value);$("a.buy").hide();$(d).show()}})}}});$("#bookStorageSaveButton").on("click",function(){var d=book_id+"_book_data";only_load_book_data=true;$.ajax({type:"GET",url:"js/book_data_"+book_id+".js",dataType:"script",timeout:3500}).done(function(e){setOnline(true);data_put(d,e);book_store()}).fail(function(){setOnline(false);jqNotify(display_message.offline_and_no_data)})});$("#bookStorageRemoveButton").on("click",function(){confirm_book_remove()})};$("#options_button").click(function(a){a.preventDefault();$("#access_options").animate({height:"toggle"},500,function(){$("#options_button span.more").toggle();$("#options_button span.fewer").toggle()})});pageFuncs.book_info["social_facebook"]=function(){pageFuncs.social_funcs["facebook"](pageFuncs.book_info["book_info_url"])};pageFuncs.book_info["social_twitter"]=function(){var b=display_message.book_social_share_text.replace("[[book_title]]",pageFuncs.book_info["processed_title"]());var a=pageFuncs.social_funcs["twitter_mockup_generate"]($("#book_title").text(),$("#book_blurb_content").text().trim(),window.location.host,"images/book_image/"+pageFuncs.book_info["book_id"]);pageFuncs.social_funcs["twitter"](b,"#book_social",pageFuncs.book_info["book_info_url"],a)};pageFuncs.book_info["processed_title"]=function(a){if(typeof a!="string"){var a=$("#book_title").text()}if(a.endsWith(", The")){a="The "+a.substr(0,a.length-5)}else{if(a.endsWith(", A")){a="A "+a.substr(0,a.length-3)}}return"â€˜"+a+"â€™"
};pageFuncs.news_feed={};pageFuncs.news_feed.init=function(a){if(typeof a=="undefined"){var a=false}var b=parseInt(getQueryVar("id"),10);if(b){pageFuncs.news_feed.show_article(b)}else{$.ajax({url:"news_feed.json",dataType:"json"}).done(function(c){setOnline(true);if(c){data_put("news_feed",c);data_put("news_feed_updated",Date.now())}}).always(function(){if(!a){pageFuncs.news_feed.show_list()}})}};pageFuncs.news_feed.resized=function(){$(".article_blurb").ellipsis()};pageFuncs.news_feed.show_list=function(){pageFuncs.news_feed.current_article=null;var f=data_get("news_feed");var b={};b.view="news_feed";b.content=$(data_get("template_news_feed"));b.content.find("#page_title").html(f.title.trim());var g=f.articles;var e=b.content.find("#news_feed_top_article").html();e=e.replace("[[article_title]]",g[0].title).replace("[[article_description]]",g[0].description);e=replaceAll(e,"[[id]]",g[0].id);b.content.find("#news_feed_top_article").html(e);if(!g[0].has_image){b.content.find("#news_feed_top_article_image").addClass("no_image").removeAttr("style")}var a=b.content.find("#news_feed_articles").html();var d="";if(g.length){for(var i=1;i<g.length;i++){var h=a.replace("[[article_title]]",g[i].title).replace("[[article_description]]",g[i].description);h=replaceAll(h,"[[id]]",g[i].id);if(!g[i].has_image){var c=$(h);c.find(".news_feed_article_image").addClass("no_image").removeAttr("style");h=c[0].outerHTML}d+=h}}b.content.find("#news_feed_articles").html(d);b.pagetitle=f.title.trim();b.content=$(b.content)[0].outerHTML;displayPage(b);$(".article_blurb").ellipsis()};pageFuncs.news_feed.show_article=function(f){pageFuncs.social_funcs["check_waiting_posts"]();var d=data_get("news_feed");var e=null;for(var a in d.articles){if(d.articles[a].id==f){e=d.articles[a];pageFuncs.news_feed.current_article=e;break}}if(e===null){window.jqNotify(display_message.article_not_found)}else{var c={};c.view="news_feed";c.content=$(data_get("template_news_feed_article"));c.content.find("#article_title").html(e.title.trim());c.content.find("#article_content").html(e.content);var b=c.content.find("#article_creator").html();b=b.replace("[[creator]]",e.creator.trim());b=b.replace("[[pub_date]]",e.date_us);c.content.find("#article_creator").html(b);if(!e.has_image){c.content.find("#article_image").addClass("no_image").removeAttr("style")}c.content=$(c.content)[0].outerHTML;c.content=replaceAll(c.content,"[[article_title]]",e.title.trim().replace("'","\\'"));c.content=replaceAll(c.content,"[[original_url]]",e.original_url.trim().replace("'","\\'"));if(e.has_image){c.content=replaceAll(c.content,"[[id]]",e.id)}c.pagetitle=e.title.trim();displayPage(c)}stopLoading()};pageFuncs.news_feed.social_facebook=function(b,a){pageFuncs.social_funcs["facebook"](a)};pageFuncs.news_feed.social_twitter=function(d,a){var c=display_message.book_social_share_text.replace("[[book_title]]",pageFuncs.book_info["processed_title"]());var b=pageFuncs.social_funcs["twitter_mockup_generate"](d,$("#article_content").text(),"breakingcharactermagazine.com","images/news_feed/"+pageFuncs.news_feed.current_article.id+".jpg");pageFuncs.social_funcs["twitter"](d+", on Breaking Character","",a,b)};pageFuncs.user_books={};pageFuncs.user_books["loaded"]=function(){$(".bookshelf").hide();var a="";if($("#bookshelf_buttons button").length==1){$("#bookshelf_buttons").hide();$("#bookcase .bookshelf, #bookcase .bookshelf h2").css("display","block");$("#bookcase").show()}else{$("#bookshelf_buttons button").on("click",function(){var b=$(this).attr("id").replace("_button","");if(b!=a){$("#bookshelf_buttons button").removeClass("selected");$("#"+b+"_button").addClass("selected");$(".bookshelf").hide();$("#"+b).fadeIn(200,function(){$("#bookcase").show()});a=b}});switch(getQueryVar("bookshelf")){case"rented":$("#bookshelf_buttons #current_rentals_button").click();break;case"purchased":$("#bookshelf_buttons #purchased_ebooks_button").click();break;case"saved":$("#bookshelf_buttons #saved_ebooks_button").click();break;case"expired":$("#bookshelf_buttons #expired_rentals_button").click();break;default:$("#bookshelf_buttons button:first").click();break}}setTimeout(stopLoading,250);if(!online){$("#bookshelves .book").each(function(c){var b=$(this).attr("data-book-id");if(!isBookStored(b)){$(this).addClass("disabled");$(this).find("a").attr("disabled","disabled")}})}};function update_user_books(a){if(typeof a=="undefined"){var a=false}if(a){update_user_books_data(a)}else{$.ajax({url:"user_books.php?ajax=1",dataType:"json",cache:false}).done(function(b){setOnline(true);update_user_books_data(b)})}}function update_user_books_data(b){if(b.view=="user_books"){data_put("user_books_data",b);var a=[];$.each(b.access_data,function(d,c){d=parseInt(d,10);c=parseInt(c,10);data_put(d+"_user_access",c);a.push(d)});remove_expired_books(a)}}pageFuncs.books_list={};pageFuncs.books_search={};pageFuncs.books_list["loaded"]=pageFuncs.books_search["loaded"]=function(a){pageFuncs.books_search["data"]=a;pageFuncs.books_search["more_link"]=$("#main_content #books_list a.more:first")[0].outerHTML.replace("[[more_call]]","pageFuncs['books_search']['show_books']();return false;");
pageFuncs.books_search["book_template"]=$("#main_content").find(".book:first")[0].outerHTML;pageFuncs.books_search["books_html"]="";pageFuncs.books_search["books_shown"]=0;pageFuncs.books_search["page_qty"]=25;pageFuncs.books_search["show_books"]()};pageFuncs.books_search["show_books"]=function(b,a){$("#main_content #books_list a.more").css("visibility","hidden");setTimeout(function(){if(typeof b=="undefined"){b=pageFuncs.books_search["books_shown"]}if(typeof a=="undefined"){a=b+(pageFuncs.books_search["page_qty"]-1)}var f=false;var g=pageFuncs.books_search["data"];for(var e=b;e<=a;e++){var c=g.book_data[e];if(typeof c=="undefined"){f=true;break}var d=replaceAll(pageFuncs.books_search["book_template"],"[[book_id]]",c.id);d=replaceAll(d,"[[title]]",c.value);if(c.bc==2){d=replaceAll(d,"[[book_class]]","premium")}else{if(c.bc==1){d=replaceAll(d,"[[book_class]]","standard")}else{d=replaceAll(d,"[[book_class]]","basic")}}pageFuncs.books_search["books_html"]+=d}if(typeof g.book_data[e+1]=="undefined"){f=true}$("#books_list > .books").html(pageFuncs.books_search["books_html"]).show();if(!f){$("#books_list > .books").append(pageFuncs.books_search["more_link"])}pageFuncs.books_search["books_shown"]=a+1},0);return false};pageFuncs.books_browse={};pageFuncs.books_browse["booksBrowseListVersion"]=4;pageFuncs.books_browse["loaded"]=function(){var a=data_get("booksBrowseListUpdated");var b=data_get("booksBrowseListVersion");if(b!=pageFuncs.books_browse["booksBrowseListVersion"]||isNaN(a)||a<(Date.now()-86400000)){$.ajax({url:"books_browse_load_books.php",dataType:"json",success:function(e){if(e.length){var g=new Object();for(var c in e){var f=new RegExp("^[a-zA-Z]*$");var d=e[c].title.substr(0,1);if(f.test(d)){d=d.toUpperCase();if(typeof g[d]=="undefined"){g[d]=new Array()}g[d].push(e[c])}else{if(typeof g.nonAlpha=="undefined"){g.nonAlpha=new Array()}g.nonAlpha.push(e[c])}}data_put("booksBrowseListUpdated",Date.now());data_put("booksBrowseListVersion",pageFuncs.books_browse["booksBrowseListVersion"]);pageFuncs.books_browse["populate"](g)}}})}else{pageFuncs.books_browse["display_stored"]()}};pageFuncs.books_browse["populate"]=function(h){var m=$("#alphaList");$("body").append(m);m.css("top",($("#topbuttons").height()+7)+"px");var j=$("#books_browse_list > tbody");var k=j.find(".letter").first().prop("outerHTML");var n=j.find(".book_row").first().prop("outerHTML");var l=$("body").find("*[data-no-rent-symbol]").attr("data-no-rent-symbol");var o=$("body").find("*[data-character-highlight-symbol]").attr("data-character-highlight-symbol");var b=$("body").find("*[data-fixed-format-book-symbol]").attr("data-fixed-format-book-symbol");var g=$("body").find("*[data-standard-book-symbol]").attr("data-standard-book-symbol");j.html("");for(var a in h){var e=replaceAll(k,"[[letter]]",a);j.append(e);if(a!="nonAlpha"){m.append("<p>"+a+"</p>")}else{m.append("<p>#</p>")}for(var f in h[a]){var d="";var i=g;if(parseInt(h[a][f].rent,10)==0){d=l}if(h[a][f].fmt=="pdf"){i=b}else{if(parseInt(h[a][f].cdc,10)>=character_highlight_min_confidence){i=o}}var c=n.replace("[[title]]",h[a][f].title).replace("[[author]]",h[a][f].author).replace("[[no_rent]]",d).replace("<!--[[book_feature_type]]-->",i);c=replaceAll(c,"[[book_id]]",h[a][f].id);j.append(c)}}pageFuncs.books_browse["set_alpha_list_select"]();setTimeout(stopLoading,250);data_put("booksBrowseListHTML",$("#books_browse_list")[0].outerHTML);data_put("booksBrowseListAlphaHTML",$("#alphaList")[0].outerHTML);if(user_territory_id!=110){$(".no_rent:not(:empty)").empty()}};pageFuncs.books_browse["display_stored"]=function(){var c=data_get("booksBrowseListHTML");var b=data_get("booksBrowseListAlphaHTML");if(typeof c=="undefined"||!c.length){data_put("booksBrowseListUpdated",0);data_del("booksBrowseList");pageFuncs.books_browse["loaded"]();return false}var a=$("#alphaList");$("body").append(a);a.css("top",($("#topbuttons").height()+7)+"px");a.html(b);pageFuncs.books_browse["set_alpha_list_select"]();$("#books_browse_list").html(c);if(user_territory_id!=110){$(".no_rent:not(:empty)").empty()}setTimeout(stopLoading,250)};pageFuncs.books_browse["set_alpha_list_select"]=function(){$("#alphaList > p").on("touchstart click",function(){var a=$(this).text();if(a=="#"){a="nonAlpha"}topButtons(false);$("body, #main").scrollTo($("#letter_"+a),250,{easing:"swing"})})};pageFuncs.user_subscription_choose={};pageFuncs.user_subscription_choose["loaded"]=function(){var a=getQueryVar("from_book_id");if(!isNaN(a)){data_put("subscription_from_book_id",a)}if(!user_id){$("a.subscription_type").click(function(b){b.preventDefault();var c=Date.now();jqNotify('You must log in to subscribe. <a id="'+c+'" href="#external='+app_url+'user_log_in.php">Click here to log in or sign up.</a>',false,"You are not logged in");$("#"+c).blur();return false})}};
/*!
	Readmore.js jQuery plugin by @jed_foster, http://jedfoster.github.io/Readmore.js | Licensed under the MIT license. Debounce function from http://davidwalsh.name/javascript-debounce-function
*/
(function(d){var k="readmore",c={speed:500,collapsedHeight:90,heightMargin:16,moreLink:'<a class="readmore">'+display_message.read_more+"</a>",lessLink:"",embedCSS:true,blockCSS:"display: block; width: 100%;",startOpen:false,beforeToggle:function(n,m,l){d("#main_content").css("padding-bottom","3em")
},afterToggle:function(){}},b={},g=0;function i(m,o,l){var n;return function(){var s=this,r=arguments;var q=function(){n=null;if(!l){m.apply(s,r)}};var p=l&&!n;clearTimeout(n);n=setTimeout(q,o);if(p){m.apply(s,r)}}}function e(l){var m=++g;return String(l==null?"rmjs-":l)+m}function h(n){var o=n.clone().css({height:"auto",width:n.width(),maxHeight:"none",overflow:"hidden"}).insertAfter(n),m=o.outerHeight(),q=parseInt(o.css({maxHeight:""}).css("max-height").replace(/[^-\d\.]/g,""),10),p=n.data("defaultHeight");o.remove();var l=q||n.data("collapsedHeight")||p;n.data({expandedHeight:m,maxHeight:q,collapsedHeight:l}).css({maxHeight:"none"})}var j=i(function(){d("[data-readmore]").each(function(){var l=d(this),m=(l.attr("aria-expanded")==="true");h(l);l.css({height:l.data((m?"expandedHeight":"collapsedHeight"))})})},100);function a(l){if(!b[l.selector]){var m=" ";if(l.embedCSS&&l.blockCSS!==""){m+=l.selector+" + [data-readmore-toggle], "+l.selector+"[data-readmore]{"+l.blockCSS+"}"}m+=l.selector+"[data-readmore]{transition: height "+l.speed+"ms;overflow: hidden;}";(function(p,n){var o=p.createElement("style");o.type="text/css";if(o.styleSheet){o.styleSheet.cssText=n}else{o.appendChild(p.createTextNode(n))}p.getElementsByTagName("head")[0].appendChild(o)}(document,m));b[l.selector]=true}}function f(m,l){var n=this;this.element=m;this.options=d.extend({},c,l);a(this.options);this._defaults=c;this._name=k;this.init();if(window.addEventListener){window.addEventListener("load",j);window.addEventListener("resize",j)}else{window.attachEvent("load",j);window.attachEvent("resize",j)}}f.prototype={init:function(){var p=this,o=d(this.element);o.data({defaultHeight:this.options.collapsedHeight,heightMargin:this.options.heightMargin});h(o);var l=o.data("collapsedHeight"),n=o.data("heightMargin");if(o.outerHeight(true)<=l+n){return true}else{var q=o.attr("id")||e(),m=p.options.startOpen?p.options.lessLink:p.options.moreLink;o.attr({"data-readmore":"","aria-expanded":false,id:q});o.after(d(m).on("click",function(r){p.toggle(this,o[0],r)}).attr({"data-readmore-toggle":"","aria-controls":q}));if(!p.options.startOpen){o.css({height:l})}}},toggle:function(n,q,m){if(m){m.preventDefault()}if(!n){n=d('[aria-controls="'+this.element.id+'"]')[0]}if(!q){q=this.element}var s=this,t=d(q),l="",o="",r=false,p=t.data("collapsedHeight");if(t.height()<=p){l=t.data("expandedHeight")+"px";o="lessLink";r=true}else{l=p;o="moreLink"}s.options.beforeToggle(n,q,!r);t.css({height:l});t.on("transitionend",function(){s.options.afterToggle(n,q,r);d(this).attr({"aria-expanded":r}).off("transitionend")});d(n).slideUp(Math.floor(s.options.speed/2),function(){d(n).hide()})},destroy:function(){d(this.element).each(function(){var l=d(this);l.attr({"data-readmore":null,"aria-expanded":null}).css({maxHeight:"",height:""}).next("[data-readmore-toggle]").remove();l.removeData()})}};d.fn.readmore=function(n){var m=arguments,l=this.selector;n=n||{};if(typeof n==="object"){return this.each(function(){if(d.data(this,"plugin_"+k)){var o=d.data(this,"plugin_"+k);o.destroy.apply(o)}n.selector=l;d.data(this,"plugin_"+k,new f(this,n))})}else{if(typeof n==="string"&&n[0]!=="_"&&n!=="init"){return this.each(function(){var o=d.data(this,"plugin_"+k);if(o instanceof f&&typeof o[n]==="function"){o[n].apply(o,Array.prototype.slice.call(m,1))}})}}}})(jQuery);
;/*
	imagesLoaded PACKAGED v3.1.8 - by Tomas Sardyha @Darsain and David DeSandro @desandro - MIT License
*/
(function(){function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var i=e.prototype,r=this,o=r.EventEmitter;i.getListeners=function(e){var t,n,i=this._getEvents();if("object"==typeof e){t={};for(n in i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n])}else t=i[e]||(i[e]=[]);return t},i.flattenListeners=function(e){var t,n=[];for(t=0;e.length>t;t+=1)n.push(e[t].listener);return n},i.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},i.addListener=function(e,n){var i,r=this.getListenersAsObject(e),o="object"==typeof n;for(i in r)r.hasOwnProperty(i)&&-1===t(r[i],n)&&r[i].push(o?n:{listener:n,once:!1});return this},i.on=n("addListener"),i.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},i.once=n("addOnceListener"),i.defineEvent=function(e){return this.getListeners(e),this},i.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},i.removeListener=function(e,n){var i,r,o=this.getListenersAsObject(e);for(r in o)o.hasOwnProperty(r)&&(i=t(o[r],n),-1!==i&&o[r].splice(i,1));return this},i.off=n("removeListener"),i.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},i.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},i.manipulateListeners=function(e,t,n){var i,r,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)o.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(r=t[i])&&("function"==typeof r?o.call(this,i,r):s.call(this,i,r));return this},i.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if("object"===n)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},i.removeAllListeners=n("removeEvent"),i.emitEvent=function(e,t){var n,i,r,o,s=this.getListenersAsObject(e);for(r in s)if(s.hasOwnProperty(r))for(i=s[r].length;i--;)n=s[r][i],n.once===!0&&this.removeListener(e,n.listener),o=n.listener.apply(this,t||[]),o===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},i.trigger=n("emitEvent"),i.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},i.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},i._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},i._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return r.EventEmitter=o,e},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.EventEmitter=e}).call(this),function(e){function t(t){var n=e.event;return n.target=n.target||n.srcElement||t,n}var n=document.documentElement,i=function(){};n.addEventListener?i=function(e,t,n){e.addEventListener(t,n,!1)}:n.attachEvent&&(i=function(e,n,i){e[n+i]=i.handleEvent?function(){var n=t(e);i.handleEvent.call(i,n)}:function(){var n=t(e);i.call(e,n)},e.attachEvent("on"+n,e[n+i])});var r=function(){};n.removeEventListener?r=function(e,t,n){e.removeEventListener(t,n,!1)}:n.detachEvent&&(r=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(i){e[t+n]=void 0}});var o={bind:i,unbind:r};"function"==typeof define&&define.amd?define("eventie/eventie",o):e.eventie=o}(this),function(e,t){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(n,i){return t(e,n,i)}):"object"==typeof exports?module.exports=t(e,require("wolfy87-eventemitter"),require("eventie")):e.imagesLoaded=t(e,e.EventEmitter,e.eventie)}(window,function(e,t,n){function i(e,t){for(var n in t)e[n]=t[n];return e}function r(e){return"[object Array]"===d.call(e)}function o(e){var t=[];if(r(e))t=e;else if("number"==typeof e.length)for(var n=0,i=e.length;i>n;n++)t.push(e[n]);else t.push(e);return t}function s(e,t,n){if(!(this instanceof s))return new s(e,t);"string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=o(e),this.options=i({},this.options),"function"==typeof t?n=t:i(this.options,t),n&&this.on("always",n),this.getImages(),a&&(this.jqDeferred=new a.Deferred);var r=this;setTimeout(function(){r.check()})}function f(e){this.img=e}function c(e){this.src=e,v[e]=this}var a=e.jQuery,u=e.console,h=u!==void 0,d=Object.prototype.toString;s.prototype=new t,s.prototype.options={},s.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;t>e;e++){var n=this.elements[e];"IMG"===n.nodeName&&this.addImage(n);var i=n.nodeType;if(i&&(1===i||9===i||11===i))for(var r=n.querySelectorAll("img"),o=0,s=r.length;s>o;o++){var f=r[o];this.addImage(f)}}},s.prototype.addImage=function(e){var t=new f(e);this.images.push(t)},s.prototype.check=function(){function e(e,r){return t.options.debug&&h&&u.log("confirm",e,r),t.progress(e),n++,n===i&&t.complete(),!0}var t=this,n=0,i=this.images.length;if(this.hasAnyBroken=!1,!i)return this.complete(),void 0;for(var r=0;i>r;r++){var o=this.images[r];o.on("confirm",e),o.check()}},s.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e),t.jqDeferred&&t.jqDeferred.notify&&t.jqDeferred.notify(t,e)})},s.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var t=this;setTimeout(function(){if(t.emit(e,t),t.emit("always",t),t.jqDeferred){var n=t.hasAnyBroken?"reject":"resolve";t.jqDeferred[n](t)}})},a&&(a.fn.imagesLoaded=function(e,t){var n=new s(this,e,t);return n.jqDeferred.promise(a(this))}),f.prototype=new t,f.prototype.check=function(){var e=v[this.img.src]||new c(this.img.src);if(e.isConfirmed)return this.confirm(e.isLoaded,"cached was confirmed"),void 0;if(this.img.complete&&void 0!==this.img.naturalWidth)return this.confirm(0!==this.img.naturalWidth,"naturalWidth"),void 0;var t=this;e.on("confirm",function(e,n){return t.confirm(e.isLoaded,n),!0}),e.check()},f.prototype.confirm=function(e,t){this.isLoaded=e,this.emit("confirm",this,t)};var v={};return c.prototype=new t,c.prototype.check=function(){if(!this.isChecked){var e=new Image;n.bind(e,"load",this),n.bind(e,"error",this),e.src=this.src,this.isChecked=!0}},c.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},c.prototype.onload=function(e){this.confirm(!0,"onload"),this.unbindProxyEvents(e)},c.prototype.onerror=function(e){this.confirm(!1,"onerror"),this.unbindProxyEvents(e)},c.prototype.confirm=function(e,t){this.isConfirmed=!0,this.isLoaded=e,this.emit("confirm",this,t)},c.prototype.unbindProxyEvents=function(e){n.unbind(e.target,"load",this),n.unbind(e.target,"error",this)},s});
;/*!
	FastClick copyright The Financial Times Limited [All Rights Reserved] - http://ftlabs.github.io/fastclick/ - MIT License
*/
;(function(){function d(o,k){var p;k=k||{};this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=k.touchBoundary||10;this.layer=o;this.tapDelay=k.tapDelay||200;this.tapTimeout=k.tapTimeout||700;if(d.notNeeded(o)){return}function q(l,i){return function(){return l.apply(i,arguments)}}var j=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"];var n=this;for(var m=0,h=j.length;m<h;m++){n[j[m]]=q(n[j[m]],n)}if(b){o.addEventListener("mouseover",this.onMouse,true);o.addEventListener("mousedown",this.onMouse,true);o.addEventListener("mouseup",this.onMouse,true)}o.addEventListener("click",this.onClick,true);o.addEventListener("touchstart",this.onTouchStart,false);o.addEventListener("touchmove",this.onTouchMove,false);o.addEventListener("touchend",this.onTouchEnd,false);o.addEventListener("touchcancel",this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){o.removeEventListener=function(l,s,i){var r=Node.prototype.removeEventListener;if(l==="click"){r.call(o,l,s.hijacked||s,i)}else{r.call(o,l,s,i)}};o.addEventListener=function(r,s,l){var i=Node.prototype.addEventListener;if(r==="click"){i.call(o,r,s.hijacked||(s.hijacked=function(t){if(!t.propagationStopped){s(t)}}),l)}else{i.call(o,r,s,l)}}}if(typeof o.onclick==="function"){p=o.onclick;o.addEventListener("click",function(i){p(i)},false);o.onclick=null}}var c=navigator.userAgent.indexOf("Windows Phone")>=0;var b=navigator.userAgent.indexOf("Android")>0&&!c;var g=/iP(ad|hone|od)/.test(navigator.userAgent)&&!c;var e=g&&(/OS 4_\d(_\d)?/).test(navigator.userAgent);var f=g&&(/OS [6-7]_\d/).test(navigator.userAgent);var a=navigator.userAgent.indexOf("BB10")>0;d.prototype.needsClick=function(h){switch(h.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(h.disabled){return true}break;case"input":if((g&&h.type==="file")||h.disabled){return true}break;case"label":case"iframe":case"video":return true}return(/\bneedsclick\b/).test(h.className)};d.prototype.needsFocus=function(h){switch(h.nodeName.toLowerCase()){case"textarea":return true;case"select":return !b;case"input":switch(h.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return !h.disabled&&!h.readOnly;default:return(/\bneedsfocus\b/).test(h.className)}};d.prototype.sendClick=function(i,j){var h,k;if(document.activeElement&&document.activeElement!==i){document.activeElement.blur()}k=j.changedTouches[0];h=document.createEvent("MouseEvents");h.initMouseEvent(this.determineEventType(i),true,true,window,1,k.screenX,k.screenY,k.clientX,k.clientY,false,false,false,false,0,null);h.forwardedTouchEvent=true;i.dispatchEvent(h)};d.prototype.determineEventType=function(h){if(b&&h.tagName.toLowerCase()==="select"){return"mousedown"}return"click"};d.prototype.focus=function(h){var i;if(g&&h.setSelectionRange&&h.type.indexOf("date")!==0&&h.type!=="time"&&h.type!=="month"){i=h.value.length;h.setSelectionRange(i,i)}else{h.focus()}};d.prototype.updateScrollParent=function(i){var j,h;j=i.fastClickScrollParent;if(!j||!j.contains(i)){h=i;do{if(h.scrollHeight>h.offsetHeight){j=h;i.fastClickScrollParent=h;break}h=h.parentElement}while(h)}if(j){j.fastClickLastScrollTop=j.scrollTop}};d.prototype.getTargetElementFromEventTarget=function(h){if(h.nodeType===Node.TEXT_NODE){return h.parentNode}return h};d.prototype.onTouchStart=function(j){var h,k,i;if(j.targetTouches.length>1){return true}h=this.getTargetElementFromEventTarget(j.target);k=j.targetTouches[0];if(g){i=window.getSelection();if(i.rangeCount&&!i.isCollapsed){return true}if(!e){if(k.identifier&&k.identifier===this.lastTouchIdentifier){j.preventDefault();return false}this.lastTouchIdentifier=k.identifier;this.updateScrollParent(h)}}this.trackingClick=true;this.trackingClickStart=j.timeStamp;this.targetElement=h;this.touchStartX=k.pageX;this.touchStartY=k.pageY;if((j.timeStamp-this.lastClickTime)<this.tapDelay){j.preventDefault()}return true};d.prototype.touchHasMoved=function(h){var j=h.changedTouches[0],i=this.touchBoundary;if(Math.abs(j.pageX-this.touchStartX)>i||Math.abs(j.pageY-this.touchStartY)>i){return true}return false};d.prototype.onTouchMove=function(h){if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(h.target)||this.touchHasMoved(h)){this.trackingClick=false;this.targetElement=null}return true};d.prototype.findControl=function(h){if(h.control!==undefined){return h.control}if(h.htmlFor){return document.getElementById(h.htmlFor)}return h.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};d.prototype.onTouchEnd=function(j){var l,k,i,n,m,h=this.targetElement;if(!this.trackingClick){return true}if((j.timeStamp-this.lastClickTime)<this.tapDelay){this.cancelNextClick=true;
return true}if((j.timeStamp-this.trackingClickStart)>this.tapTimeout){return true}this.cancelNextClick=false;this.lastClickTime=j.timeStamp;k=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(f){m=j.changedTouches[0];h=document.elementFromPoint(m.pageX-window.pageXOffset,m.pageY-window.pageYOffset)||h;h.fastClickScrollParent=this.targetElement.fastClickScrollParent}i=h.tagName.toLowerCase();if(i==="label"){l=this.findControl(h);if(l){this.focus(h);if(b){return false}h=l}}else{if(this.needsFocus(h)){if((j.timeStamp-k)>100||(g&&window.top!==window&&i==="input")){this.targetElement=null;return false}this.focus(h);this.sendClick(h,j);if(!g||i!=="select"){this.targetElement=null;j.preventDefault()}return false}}if(g&&!e){n=h.fastClickScrollParent;if(n&&n.fastClickLastScrollTop!==n.scrollTop){return true}}if(!this.needsClick(h)){j.preventDefault();this.sendClick(h,j)}return false};d.prototype.onTouchCancel=function(){this.trackingClick=false;this.targetElement=null};d.prototype.onMouse=function(h){if(!this.targetElement){return true}if(h.forwardedTouchEvent){return true}if(!h.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(h.stopImmediatePropagation){h.stopImmediatePropagation()}else{h.propagationStopped=true}h.stopPropagation();h.preventDefault();return false}return true};d.prototype.onClick=function(h){var i;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(h.target.type==="submit"&&h.detail===0){return true}i=this.onMouse(h);if(!i){this.targetElement=null}return i};d.prototype.destroy=function(){var h=this.layer;if(b){h.removeEventListener("mouseover",this.onMouse,true);h.removeEventListener("mousedown",this.onMouse,true);h.removeEventListener("mouseup",this.onMouse,true)}h.removeEventListener("click",this.onClick,true);h.removeEventListener("touchstart",this.onTouchStart,false);h.removeEventListener("touchmove",this.onTouchMove,false);h.removeEventListener("touchend",this.onTouchEnd,false);h.removeEventListener("touchcancel",this.onTouchCancel,false)};d.notNeeded=function(i){var h;var l;var k;var j;if(typeof window.ontouchstart==="undefined"){return true}l=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(l){if(b){h=document.querySelector("meta[name=viewport]");if(h){if(h.content.indexOf("user-scalable=no")!==-1){return true}if(l>31&&document.documentElement.scrollWidth<=window.outerWidth){return true}}}else{return true}}if(a){k=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(k[1]>=10&&k[2]>=3){h=document.querySelector("meta[name=viewport]");if(h){if(h.content.indexOf("user-scalable=no")!==-1){return true}if(document.documentElement.scrollWidth<=window.outerWidth){return true}}}}if(i.style.msTouchAction==="none"||i.style.touchAction==="manipulation"){return true}j=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(j>=27){h=document.querySelector("meta[name=viewport]");if(h&&(h.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth)){return true}}if(i.style.touchAction==="none"||i.style.touchAction==="manipulation"){return true}return false};d.attach=function(i,h){return new d(i,h)};if(typeof define==="function"&&typeof define.amd==="object"&&define.amd){define(function(){return d})}else{if(typeof module!=="undefined"&&module.exports){module.exports=d.attach;module.exports.FastClick=d}else{window.FastClick=d}}}());FFReader={VERSION:"1.0"};FFReader.Controls={};FFReader.Properties={margin:8};FFReader.Reader=function(d,a,j,h){var b=FFReader.Properties;b.bookData=a;b.options=j;b.reader=this;b.parent=$("#"+d);b.parent.addClass("ff_reader");b.pages=a.getMetaData("pages");b.currentPage=1;var g=FFReader.Controls;g.scrubber=FFReader.Scrubber();g.flipper=FFReader.Flipper();b.parent.append('<div id="ff_book"></div>');b.book=$("#ff_book");var e=parseInt(b.options.page,10);if(!isNaN(e)&&e>0&&e<=b.pages){b.currentPage=e}var i="";for(var f=1;f<=b.pages;f++){i+='<div class="ff_page" id="ff_page'+f+'"></div>'}b.book.append(i);g.bookmarks=FFReader.Bookmarks();if(typeof h=="function"){h(this)}this.resized=function(){var k=a.getMetaData("width");var m=a.getMetaData("height");var l=b.parent.height();var c=Math.floor((l/m)*k);$("#"+d+", .ff_page").height(l).width(c);if(c>$(window).width()){c=$(window).width();l=Math.floor((c/k)*m)}$("#"+d+", .ff_page").width(c);$("#ff_book").width((b.pages*c)+b.pages);g.flipper.resized();g.scrubber.resized();b.reader.goToPage(b.currentPage,0)};this.setPageImage=function(c){if($("#ff_page"+c).length&&!$("#ff_page"+c).hasClass("ff_img_loaded")){a.getPage(c,function(l,k){$("#ff_page"+l).css("background-image","url('data:image/png;base64,"+k+"')").addClass("ff_img_loaded")})}};this.movePrevious=function(){this.goToPage(b.currentPage-1);hideArrows()};this.moveNext=function(){this.goToPage(b.currentPage+1);hideArrows()};this.goToPage=function(l,m){if(typeof m=="undefined"){var m=250}if(typeof l!="number"){l=parseInt(l,10)}if(isNaN(l)){l=1
}if(l<1){l=1}if(l>b.pages){l=b.pages}var k=$("#ff_page"+l).position().left;var c=0-($("#ff_book").position().left-k);this.setPageImage(l);$("#reader").animate({scrollLeft:c},m,function(){b.currentPage=l;b.reader.setPageImage(b.currentPage-1);b.reader.setPageImage(b.currentPage+1);g.scrubber.update();window.savePlace()})};setTimeout(function(){b.reader.resized();b.reader.goToPage(b.currentPage)},0);return this};FFReader.Flipper=function(){var b=FFReader.Properties;b.parent.prepend('<div class="ff_flipper" id="ff_flipper-prev"></div><div class="ff_flipper" id="ff_flipper-next"></div>');$(".ff_flipper").on("mouseup touchend",function(){if(!justSwiped){if($(this).prop("id")=="ff_flipper-next"){b.reader.moveNext()}else{b.reader.movePrevious()}}});var a={p:FFReader.Properties,resized:function(){var d=Math.ceil((b.parent.width()/100)*b.margin);$(".ff_flipper").height(b.parent.height()).width(d);var c=(b.parent.offset().left+b.parent.width())-$("#ff_flipper-next").width();$("#ff_flipper-next").css("left",c+"px")}};return a};FFReader.Scrubber=function(){var b=FFReader.Properties;b.parent.append('<div id="controls_scrubber_container" style="display: none"><div id="controls_scrubber_track"><div id="controls_scrubber_trail"></div></div><div id="controls_scrubber_needle_inner"></div><div id="controls_scrubber_needle"></div><div id="controls_scrubber_bubble"></div></div>');var a={p:FFReader.Properties,dragging:null,cntr:$("#controls_scrubber_container"),track:$("#controls_scrubber_track"),needleTrail:$("#controls_scrubber_trail"),needle:$("#controls_scrubber_needle"),needleInner:$("#controls_scrubber_needle_inner"),bubble:$("#controls_scrubber_bubble"),init:function(){this.update();this.cntr.css("position","fixed");this.needle.css("position","fixed");this.needleInner.css("position","fixed");this.bubble.css("position","fixed");var d=this.track.offset().top+(this.track.outerHeight()/2);var e=d-(this.needle.outerHeight()/2);this.needle.css("top",e+"px");var c=d-(this.needleInner.outerHeight()/2);this.needleInner.css("top",c+"px");this.needleInner.css("left","50%")},resized:function(){var c=Math.ceil((b.parent.width()/100)*b.margin);this.cntr.width(b.parent.width()-(c*2)).css("left",(b.parent.offset().left+c)+"px");this.init()},update:function(){var d=(b.currentPage/b.pages)*100;var c=this.track.outerWidth();var e=((c/100)*d);this.needle.css("left",this.track.offset().left+(e-Math.round(this.needle.outerWidth()/2))+"px");this.needleInner.css("left",this.track.offset().left+(e-Math.round(this.needleInner.outerWidth()/2))+"px");this.needleTrail.css("width",e+"px");this.moved(false);this.cntr.show()},moved:function(c){if(typeof c=="undefined"){c=true}var d=this.currentPositionPage();if(c){b.reader.goToPage(d,0)}},setX:function(e){var f=this.track.offset().left;var d=this.track.outerWidth();if(e<0){e=0}if(e>d){e=d}var c=f+(e-(this.needle.outerWidth()/2));this.needle.css("left",c+"px");a.moved()},currentPositionPage:function(){var c=this.track.width();var f=(this.needle.offset().left+Math.round(this.needle.outerWidth()/2))-this.track.offset().left;var d=(f/c)*100;var e=Math.round((this.p.pages/100)*d);if(e<1){e=1}if(e>b.pages){e=b.pages}return e}};a.init();a.cntr.on("click",function(d){var c=d.pageX-a.track.offset().left;a.setX(c)});$("#controls_scrubber_needle").draggable({scroll:false,axis:"x",start:function(){a.bubble.css("display","block").show();a.cntr.addClass("active");a.bubble.css("display","block");swipeIgnore=true},drag:function(e,f){f.position.left=Math.min((a.track.offset().left+a.track.outerWidth())-($(this).outerWidth()/2),f.position.left);f.position.left=Math.max(a.track.offset().left-($(this).outerWidth()/2),f.position.left);var d=f.position.left+(a.needle.outerWidth()/2);var c=d-(a.bubble.outerWidth()/2);a.bubble.html("Page "+a.currentPositionPage());$("#controls_scrubber_bubble").css("left",c+"px");var g=d-(a.needleInner.outerWidth()/2);$("#controls_scrubber_needle_inner").css("left",g+"px")},stop:function(){a.moved();a.bubble.hide();a.cntr.removeClass("active");swipeIgnore=false}});return a};FFReader.Bookmarks=function(){var d=FFReader.Properties;var c=[];d.book.find(".ff_page").each(function(){c.push($(this).append('<div class="ff_bookmark icon-bookmark-used"></div>'));for(var g in componentHighlights){var e=parseInt(g,10);$("#ff_page"+e+" > .ff_bookmark").addClass("set")}});var a={p:FFReader.Properties,list:c,addBookmark:function(){newNoteText=document.getElementById("newNoteText");newNoteText=newNoteText.value;$("#ff_page"+this.p.currentPage+" > .ff_bookmark").addClass("set");var e={};e.text=newNoteText;componentHighlights[this.p.currentPage]=e;this.updateBookmarks()},deleteBookmark:function(){delete componentHighlights[this.p.currentPage];$("#ff_page"+this.p.currentPage+" > .ff_bookmark").removeClass("set");this.updateBookmarks()},updateBookmarks:function(){var e=JSON.stringify(componentHighlights);if(e=="{}"){data_del(book_id+"_ff_bookmarks");data_del(book_id+"_ff_highlights_timestamp");savePlace(null)}else{data_put(book_id+"_ff_bookmarks",e);
data_put(book_id+"_ff_highlights_timestamp",Math.floor(Date.now()/1000));savePlace(e)}$("#note-add-form").dialog("close")}};$("#newNoteText").keydown(function(g){var f=g.keyCode||g.which;if(f==13){window.reader.Controls.bookmarks.addBookmark();return false}});if(smallscreen){var b={my:"top",at:"top+10px",of:$("#reader")}}else{var b={of:$("#reader")}}$("#note-add-form").dialog({title:"Bookmark/note",autoOpen:false,resizable:false,draggable:false,modal:true,appendTo:"#reader_container",position:b,open:function(){setTimeout("$('#newNoteText').focus(); keepselection=false",5)}});$(".ff_bookmark").on("click",function(){if($(this).hasClass("set")){$("#note-add-form").dialog("option","buttons",[{text:"Update",click:function(){window.reader.Controls.bookmarks.addBookmark()}},{text:"Delete",click:function(){window.reader.Controls.bookmarks.deleteBookmark()}}]);$("#note-add-form").dialog("open");$("#newNoteText").val(componentHighlights[d.currentPage].text)}else{$("#note-add-form").dialog("option","buttons",[{text:"Add bookmark",click:function(){window.reader.Controls.bookmarks.addBookmark()}},{text:"Cancel",click:function(){$(this).dialog("close")}}]);$("#note-add-form").dialog("open");$("#newNoteText").val("")}});return a};function create_fixed_format_reader(){log("create_fixed_format_reader() called");componentHighlights={};init_bookmarks_dialog();$("#readerSmallerFontButton, #readerLargerFontButton, #readerContentsButton, #readerCharactersButton, #readerNotesButton, #readerBlackoutsHideButton, #readerHighlightsHideButton, #readerSearchTextButton, #character_step_controls").remove();if(user_has_access()){log("user has access");$(".user_has_no_access").hide()}else{log("user does not have access");$(".user_has_no_access").show()}if(typeof highlights_data!="undefined"){log(JSON.stringify(highlights_data))}else{log("No highlights data")}if(user_has_access()&&typeof highlights_data!="undefined"&&typeof highlights_data.ff!="undefined"&&typeof highlights_data.ff.length=="number"&&highlights_data.ff.length){log("A-start");var b=highlights_data.ff_highlights_timestamp;var d=parseInt(data_get(book_id+"_ff_highlights_timestamp"),10);if(isNaN(d)||d<=b){log("A1-start");data_put(book_id+"_ff_bookmarks",highlights_data.ff);data_put(book_id+"_ff_highlights_timestamp",highlights_data.ff_highlights_timestamp);componentHighlights=JSON.parse(highlights_data.ff);log("A1-end")}else{if(d>b){log("A2-start");var c=data_get(book_id+"_ff_bookmarks");var a={book_id:book_id,componentId:"ff",highlights_string:c,highlights_timestamp:(d*1000)};$.post("book_read_save_highlights_string.php",a,"json");componentHighlights=JSON.parse(c);log("A2-end")}}log("A-end")}localforage.getItem("book_"+book_id+"_user_data").then(function(e){log("B1");if(typeof restore_data=="object"&&restore_data!=null){if(e==null||restore_data.location_timestamp>=e.timestamp){e=restore_data}}log("B2");var f=1;if(e!=null&&typeof e=="object"){log("B3-start");f=parseInt(e.percent,10);if(isNaN(f)){f=1}log("B3-end")}window.reader=FFReader.Reader("reader",bookData,{page:f},function(g){log("B4-start");readerControlsHide();setSwipeHandlers("#reader_container");setTimeout(stopLoading,1000);log("B4-end")})});init_fullscreen();window.spinner=new Object();window.spinner.spin=function(){};window.spinner.spun=function(){};log("create_fixed_format_reader() end")}
/*!
	Monocle - Copyright 2012-2015 Joseph Pearson, who can crash at my place anytime. Seriously, this guy is a programming wizard. MIT license.
*/
;Monocle={VERSION:"3.2.0"};Monocle.Dimensions={};Monocle.Controls={};Monocle.Flippers={};Monocle.Panels={};Monocle.Env=function(){var API={constructor:Monocle.Env};var k=API.constants=API.constructor;var p=API.properties={resultCallback:null};var css=Monocle.Browser.css;var activeTestName=null;var frameLoadCallback=null;var testFrame=null;var testFrameCntr=null;var testFrameSize=100;var surveyCallback=null;function survey(cb){surveyCallback=cb;runNextTest()}function runNextTest(){var test=envTests.shift();if(!test){return completed()}activeTestName=test[0];try{test[1]()}catch(e){result(e)}}function result(val){API[activeTestName]=val;if(p.resultCallback){p.resultCallback(activeTestName,val)}runNextTest();return val}function completed(){Monocle.defer(removeTestFrame);if(typeof surveyCallback=="function"){var fn=surveyCallback;surveyCallback=null;fn(API)}}function testForFunction(str){return function(){result(typeof eval(str)=="function")}}function testNotYetImplemented(rslt){return function(){result(rslt)}}function loadTestFrame(cb,src){if(!testFrame){testFrame=createTestFrame()}frameLoadCallback=cb;src=src||4;if(typeof src=="number"){var pgs=[];for(var i=1,ii=src;i<=ii;++i){pgs.push("<div>Page "+i+"</div>")}var divStyle=["display:inline-block","line-height:"+testFrameSize+"px","width:"+testFrameSize+"px"].join(";");src='javascript:\'<!DOCTYPE html><html><head><meta name="time" content="'+(new Date()).getTime()+'" /><style>div{'+divStyle+"}</style></head><body>"+pgs.join("")+"</body></html>'"
}testFrame.src=src}function createTestFrame(){testFrameCntr=document.createElement("div");testFrameCntr.style.cssText=["width:"+testFrameSize+"px","height:"+testFrameSize+"px","overflow:hidden","position:absolute","visibility:hidden"].join(";");document.body.appendChild(testFrameCntr);var fr=document.createElement("iframe");testFrameCntr.appendChild(fr);fr.setAttribute("scrolling","no");fr.style.cssText=["width:100%","height:100%","border:none","background:#900"].join(";");fr.addEventListener("load",function(){if(!fr.contentDocument||!fr.contentDocument.body){return}var bd=fr.contentDocument.body;bd.style.cssText=(["margin:0","padding:0","position:absolute","height:100%","width:100%","-webkit-column-width:"+testFrameSize+"px","-webkit-column-gap:0","-webkit-column-fill:auto","-moz-column-width:"+testFrameSize+"px","-moz-column-gap:0","-moz-column-fill:auto","-o-column-width:"+testFrameSize+"px","-o-column-gap:0","-o-column-fill:auto","column-width:"+testFrameSize+"px","column-gap:0","column-fill:auto"].join(";"));if(bd.scrollHeight>testFrameSize){bd.style.cssText+=["min-width:200%","overflow:hidden"].join(";");if(bd.scrollHeight<=testFrameSize){bd.className="column-force"}else{bd.className="column-failed "+bd.scrollHeight}}frameLoadCallback(fr)},false);return fr}function removeTestFrame(){if(testFrameCntr&&testFrameCntr.parentNode){testFrameCntr.parentNode.removeChild(testFrameCntr)}}function columnedWidth(fr){var bd=fr.contentDocument.body;var de=fr.contentDocument.documentElement;return Math.max(bd.scrollWidth,de.scrollWidth)}var envTests=[["supportsW3CEvents",testForFunction("window.addEventListener")],["supportsCustomEvents",testForFunction("document.createEvent")],["supportsColumns",function(){result(css.supportsPropertyWithAnyPrefix("column-width"))}],["supportsTransform",function(){result(css.supportsProperty(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"]))}],["supportsTransition",function(){result(css.supportsPropertyWithAnyPrefix("transition"))}],["supportsXPath",testForFunction("document.evaluate")],["supportsQuerySelector",testForFunction("document.querySelector")],["supportsTransform3d",function(){result(css.supportsMediaQueryProperty("transform-3d")&&css.supportsProperty(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"])&&!Monocle.Browser.renders.slow)}],["supportsOfflineCache",function(){result(typeof window.applicationCache!="undefined")}],["supportsLocalStorage",function(){result(typeof window.localStorage!="undefined"&&typeof window.localStorage.getItem=="function")}],["touch",function(){result(Gala.Pointers.ENV.noMouse)}],["embedded",function(){result(top!=window.self)}],["brokenIframeTouchModel",function(){result(Monocle.Browser.iOSVersionBelow("4.2"))}],["floatsIgnoreColumns",function(){if(!Monocle.Browser.is.WebKit){return result(false)}var match=navigator.userAgent.match(/AppleWebKit\/([\d\.]+)/);if(!match){return result(false)}return result(match[1]<"534.30")}],["widthsIgnoreTranslate",function(){loadTestFrame(function(fr){var firstWidth=columnedWidth(fr);var s=fr.contentDocument.body.style;var props=css.toDOMProps("transform");for(var i=0,ii=props.length;i<ii;++i){s[props[i]]="translateX(-600px)"}var secondWidth=columnedWidth(fr);for(i=0,ii=props.length;i<ii;++i){s[props[i]]="none"}result(secondWidth==firstWidth)})}],["relativeIframeExpands",function(){result(navigator.userAgent.indexOf("Android 2")>=0)}],["scrollToApplyStyle",function(){result(Monocle.Browser.iOSVersionBelow("4"))}],["forceColumns",function(){loadTestFrame(function(fr){var bd=fr.contentDocument.body;result(bd.className?true:false)})}],["findNodesByScrolling",function(){result(typeof document.body.getBoundingClientRect!=="function")}],["sheafIsScroller",function(){loadTestFrame(function(fr){result(fr.parentNode.scrollWidth>testFrameSize)})}],["stickySlideOut",function(){result(Monocle.Browser.is.MobileSafari)}],["roundPageDimensions",function(){result(!Monocle.Browser.is.IE)}],["documentElementHasScrollbars",function(){result(Monocle.Browser.is.IE)}],["offscreenRenderingClipped",function(){result(Monocle.Browser.iOSVersionBelow("6"))}],["loadHTMLWithDocWrite",function(){result(Monocle.Browser.is.Gecko||Monocle.Browser.is.Opera)}]];function isCompatible(){return(API.supportsW3CEvents&&API.supportsCustomEvents&&API.supportsColumns&&API.supportsTransform&&!API.brokenIframeTouchModel)}API.survey=survey;API.isCompatible=isCompatible;return API};Monocle.CSS=function(){var b={constructor:Monocle.CSS};var d=b.constants=b.constructor;var a=b.properties={guineapig:document.createElement("div")};function g(o){var m=[o];var n=d.engines.indexOf(Monocle.Browser.engine);if(n){var k=d.prefixes[n];if(k){m.push(k+o)}}return m}function i(p,o){var n=g(p);for(var k=0,m=n.length;k<m;++k){n[k]+=": "+o+";"}return n.join("")}function c(q){var o=q.split("-");for(var m=o.length;m>0;--m){o[m]=f(o[m])}var n=[o.join("")];var p=d.engines.indexOf(Monocle.Browser.engine);if(p){var k=d.domprefixes[p];
if(k){o[0]=f(o[0]);n.push(k+o.join(""))}}return n}function e(m){for(var k in m){if(a.guineapig.style[m[k]]!==undefined){return true}}return false}function l(k){return e(c(k))}function h(o){var m="monocle_guineapig";a.guineapig.id=m;var n=document.createElement("style");n.textContent=o+"{#"+m+"{height:3px}}";(document.head||document.getElementsByTagName("head")[0]).appendChild(n);document.documentElement.appendChild(a.guineapig);var k=a.guineapig.offsetHeight===3;n.parentNode.removeChild(n);a.guineapig.parentNode.removeChild(a.guineapig);return k}function j(k){return h("@media ("+d.prefixes.join(k+"),(")+"monocle__)")}function f(k){return k?k.charAt(0).toUpperCase()+k.substr(1):""}b.toCSSProps=g;b.toCSSDeclaration=i;b.toDOMProps=c;b.supportsProperty=e;b.supportsPropertyWithAnyPrefix=l;b.supportsMediaQuery=h;b.supportsMediaQueryProperty=j;return b};Monocle.CSS.engines=["W3C","WebKit","Gecko","Opera","IE","Konqueror"];Monocle.CSS.prefixes=["","-webkit-","-moz-","-o-","-ms-","-khtml-"];Monocle.CSS.domprefixes=["","Webkit","Moz","O","ms","Khtml"];if(typeof window.console=="undefined"){window.console={messages:[]};window.console.log=function(a){this.messages.push(a)};window.console.warn=window.console.log}window.console.compatDir=function(b){var c=function(f){var e=[];for(var d in f){e.push(d+": "+f[d])}return e.join(";\n")};var a=c(b);window.console.log(a);return a};window.console.deprecation=function(a){console.warn("[DEPRECATION]: "+a);if(typeof console.trace=="function"){console.trace()}};Monocle.defer=function(a,b){if(typeof a=="function"){return setTimeout(a,b||0)}};Monocle.Browser={};Monocle.Browser.uaMatch=function(b){var a=navigator.userAgent;if(typeof b=="string"){return a.indexOf(b)>=0}return !!a.match(b)};Monocle.Browser.is={IE:(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0),Opera:Monocle.Browser.uaMatch("Opera"),WebKit:Monocle.Browser.uaMatch(/Apple\s?WebKit/),Gecko:Monocle.Browser.uaMatch("Gecko")&&!Monocle.Browser.uaMatch("KHTML"),MobileSafari:Monocle.Browser.uaMatch(/OS \d_.*AppleWebKit.*Mobile/)};if(Monocle.Browser.is.IE){Monocle.Browser.engine="IE"}else{if(Monocle.Browser.is.Opera){Monocle.Browser.engine="Opera"}else{if(Monocle.Browser.is.WebKit){Monocle.Browser.engine="WebKit"}else{if(Monocle.Browser.is.Gecko){Monocle.Browser.engine="Gecko"}else{console.warn("Unknown engine; assuming W3C compliant.");Monocle.Browser.engine="W3C"}}}}Monocle.Browser.on={iPhone:Monocle.Browser.is.MobileSafari&&screen.width==320,iPad:Monocle.Browser.is.MobileSafari&&screen.width==768,UIWebView:(Monocle.Browser.is.MobileSafari&&!Monocle.Browser.uaMatch("Safari")&&!navigator.standalone),BlackBerry:Monocle.Browser.uaMatch("BlackBerry"),Android:(Monocle.Browser.uaMatch("Android")||Monocle.Browser.uaMatch("Silk")||Monocle.Browser.uaMatch(/Linux;.*EBRD/)),MacOSX:(Monocle.Browser.uaMatch("Mac OS X")&&!Monocle.Browser.is.MobileSafari),Kindle3:Monocle.Browser.uaMatch(/Kindle\/3/)};if(Monocle.Browser.is.MobileSafari){(function(){var a=navigator.userAgent.match(/ OS ([\d_]+)/);if(a){Monocle.Browser.iOSVersion=a[1].replace(/_/g,".")}else{console.warn("Unknown MobileSafari user agent: "+navigator.userAgent)}})()}Monocle.Browser.iOSVersionBelow=function(a){return !!Monocle.Browser.iOSVersion&&Monocle.Browser.iOSVersion<a};Monocle.Browser.renders=(function(){var a=navigator.userAgent;var b={};b.eInk=Monocle.Browser.on.Kindle3;b.slow=(b.eInk||(Monocle.Browser.on.Android&&!a.match(/Chrome/))||Monocle.Browser.on.Blackberry||a.match(/NintendoBrowser/));return b})();Monocle.Browser.css=new Monocle.CSS();Monocle.Browser.survey=function(a){if(!Monocle.Browser.env){Monocle.Browser.env=new Monocle.Env();Monocle.Browser.env.survey(a)}else{if(typeof a=="function"){a()}}};Gala={};Gala.listen=function(f,g,e,b){f=Gala.$(f);if(f.addEventListener){f.addEventListener(g,e,b||false)}else{if(f.attachEvent){if(g.indexOf(":")<1){f.attachEvent("on"+g,e)}else{var d=(Gala.IE_REGISTRATIONS[f]=Gala.IE_REGISTRATIONS[f]||{});var c=(d[g]=d[g]||[]);c.push(e)}}}};Gala.deafen=function(j,k,g,b){j=Gala.$(j);if(j.removeEventListener){j.removeEventListener(k,g,b||false)}else{if(j.detachEvent){if(k.indexOf(":")<1){j.detachEvent("on"+k,g)}else{var f=(Gala.IE_REGISTRATIONS[j]=Gala.IE_REGISTRATIONS[j]||{});var c=(f[k]=f[k]||[]);for(var d=0,e=c.length;d<e;++d){if(c[d]==g){c.splice(d,1)}}}}}};Gala.dispatch=function(d,k,f,b){d=Gala.$(d);var h;if(d.dispatchEvent){h=document.createEvent("Events");h.initEvent(k,false,b||false);h.m=f;return d.dispatchEvent(h)}else{if(d.attachEvent&&k.indexOf(":")>=0){if(!Gala.IE_REGISTRATIONS[d]){return true}var c=Gala.IE_REGISTRATIONS[d][k];if(!c||c.length<1){return true}h={type:k,currentTarget:d,target:d,m:f,defaultPrevented:false,preventDefault:function(){h.defaultPrevented=true}};var a,g=Gala.IE_INVOCATION_QUEUE.length===0;for(var e=0,j=c.length;e<j;++e){a={elem:d,evtType:k,handler:c[e],evt:h};Gala.IE_INVOCATION_QUEUE.push(a)}if(g){while(a=Gala.IE_INVOCATION_QUEUE.shift()){a.handler(a.evt)}}return !(b&&h.defaultPrevented)
}else{console.warn("[GALA] Cannot dispatch non-namespaced events: "+k);return true}}};Gala.stop=function(a){a=a||window.event;if(a.preventDefault){a.preventDefault()}if(a.stopPropagation){a.stopPropagation()}a.returnValue=false;a.cancelBubble=true;return false};Gala.listenGroup=function(c,b,a){for(var d in b){Gala.listen(c,d,b[d],a||false)}};Gala.deafenGroup=function(c,b,a){for(var d in b){Gala.deafen(c,d,b[d],a||false)}};Gala.replaceGroup=function(d,c,b,a){Gala.deafenGroup(d,c,a||false);for(var e in c){delete c[e]}for(e in b){c[e]=b[e]}Gala.listenGroup(d,c,a||false);return c};Gala.onTap=function(g,f,a){g=Gala.$(g);f=Gala.throttle(f,100);if(typeof a=="undefined"){a=Gala.TAPPING_CLASS}var e={};var d=function(h){var l=Gala.Cursor(h);var k=Math.abs(l.pageX-e.x);var j=Math.abs(l.pageY-e.y);var i=Math.max(k,j);return Gala.TAP_MAX_CONTACT_DISTANCE>=i};var c=function(h){Gala.listen(g,"click",h.click=b.noop)};var b={start:function(h){var i=Gala.Cursor(h);e={x:i.pageX,y:i.pageY};if(a){g.classList.add(a)}},move:function(h){if(!e){return}if(!d(h)){b.cancel(h)}},end:function(h){if(!e){return}b.cancel(h);h.currentTarget=h.currentTarget||h.srcElement;f(h)},noop:function(){},cancel:function(){if(!e){return}e=null;if(a){g.classList.remove(a)}}};Gala.listen(window,Gala.CONTACT_CANCEL,b.cancel);return Gala.onContact(g,b,false,c)};Gala.onContact=function(e,i,c,a){e=Gala.$(e);var d=function(j){return j[typeof j.which=="undefined"?"button":"which"]<2};var f=function(j){return !!(j.touches&&j.touches.length<2)};var h=function(j){return function(k){if(Gala.Pointers.enabled()){Gala.Pointers.trackPointers(k)}var l=(Gala.Pointers.isSinglePointer()||f(k)||d(k));if(l){j(k)}}};var b=function(k){var o=Gala.getEventTypes();var p={};var s=["start","move","end","cancel"];for(var m=0,t=s.length;m<t;++m){var q=s[m];if(k[q]){var r=o[q].split(" ");for(var l=0,n=r.length;l<n;++l){p[r[l]]=h(k[q])}}}return p};var g=b(i);Gala.listenGroup(e,g);if(typeof a=="function"){a(g)}return g};Gala.Pointers={pointers:{},enabled:function(){return Gala.Pointers.ENV.pointer},trackPointers:function(a){var b=Gala.getEventTypes(),c=b.end.slice().concat(b.cancel);if(c.indexOf(a.type)){this.reset()}else{this.pointers[a.pointerId]=a}},isSinglePointer:function(){return !!(this.enabled()&&this.count()<2)},count:function(){return Object.keys?Object.keys(this.pointers).length:0},reset:function(){this.pointers={}}};Gala.Pointers.ENV={pointer:(function(){return !!(navigator.pointerEnabled||navigator.msPointerEnabled)})(),noMouse:(function(){var a=/mobile|tablet|ip(ad|hone|od)|android|silk/i;return(("ontouchstart" in window)&&!!navigator.userAgent.match(a))})()};Gala.getEventTypes=function(){var a;if(Gala.Pointers.enabled()){a=["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup MSPointerUp","pointercancel MSPointerCancel"]}else{if(Gala.Pointers.ENV.noMouse){a=["touchstart","touchmove","touchend","touchcancel"]}else{a=["touchstart mousedown","touchmove mousemove","touchend mouseup","touchcancel"]}}return{start:a[0],move:a[1],end:a[2],cancel:a[3]}};Gala.Cursor=function(b){var c={constructor:Gala.Cursor};function a(){var e=b.type.match(/mouse|pointer/i)?b:["touchstart","touchmove"].indexOf(b.type)>=0?b.targetTouches[0]:["touchend","touchcancel"].indexOf(b.type)>=0?b.changedTouches[0]:null;c.pageX=e.pageX;c.pageY=e.pageY;c.clientX=e.clientX;c.clientY=e.clientY;c.screenX=e.screenX;c.screenY=e.screenY;c.event=b;var g=c.target=b.target||b.srcElement;while(g.nodeType!=1&&g.parentNode){g=g.parentNode}d(g,"offset");var f=b.currentTarget;if(f&&typeof f.offsetLeft!="undefined"){d(f,"registrant")}}function d(g,e){var f;if(g.getBoundingClientRect){var i=g.getBoundingClientRect();var h=document.documentElement.getBoundingClientRect();f={left:i.left-h.left,top:i.top-h.top}}else{f={left:g.offsetLeft,top:g.offsetTop};while(g=g.offsetParent){if(g.offsetLeft||g.offsetTop){f.left+=g.offsetLeft;f.top+=g.offsetTop}}}c[e+"X"]=c.pageX-f.left;c[e+"Y"]=c.pageY-f.top}a();return c};Gala.$=function(a){if(typeof a=="string"){a=document.getElementById(a)}return a};Gala.throttle=function(b,c){var a=0;return function(){var d=new Date();var e=c-(d-a);if(e<=0){a=d;b.apply(this,arguments)}}};Gala.TAPPING_CLASS="tapping";Gala.IE_REGISTRATIONS={};Gala.IE_INVOCATION_QUEUE=[];Gala.CONTACT_CANCEL="gala:contact:cancel";Gala.TAP_MAX_CONTACT_DISTANCE=10;Monocle.bookData=function(a){return{getComponents:function(){return a.components||["anonymous"]},getContents:function(){return a.chapters||[]},getComponent:a.getComponent||function(b){return{url:b}},getMetaData:function(b){return(a.metadata||{})[b]},data:a}};Monocle.bookDataFromIds=function(a){return Monocle.bookData({components:a,getComponent:function(b){return{nodes:[document.getElementById(b)]}}})};Monocle.bookDataFromNodes=function(a){return Monocle.bookData({getComponent:function(b){return{nodes:a}}})};Monocle.Factory=function(e,j,i,a){var q={constructor:Monocle.Factory};var s=q.constants=q.constructor;var o=q.properties={element:e,label:j,index:i,reader:a,prefix:a.properties.classPrefix||""};
function b(){if(!o.label){return}var k=o.reader.properties.graph;k[o.label]=k[o.label]||[];if(typeof o.index=="undefined"&&k[o.label][o.index]){throw ("Element already exists in graph: "+o.label+"["+o.index+"]")}else{o.index=o.index||k[o.label].length}k[o.label][o.index]=o.element;l(o.label)}function n(p,k){if(!o.reader.properties.graph[p]){return null}return o.reader.properties.graph[p][k||0]}function h(k,u,p){return k.dom=new Monocle.Factory(k,u,p,o.reader)}function f(v,z,x,p){var y,k;if(arguments.length==1){z=null,y=0;k={}}else{if(arguments.length==2){y=0;k={}}else{if(arguments.length==4){y=arguments[2];k=arguments[3]}else{if(arguments.length==3){var w=arguments[arguments.length-1];if(typeof w=="number"){y=w;k={}}else{y=0;k=w}}}}}var u=document.createElement(v);h(u,z,y);if(k["class"]){u.className+=" "+o.prefix+k["class"]}if(k.html){u.innerHTML=k.html}if(k.text){u.appendChild(document.createTextNode(k.text))}return u}function t(u,w,v,k){var p=f.apply(this,arguments);o.element.appendChild(p);return p}function g(){return[o.label,o.index,o.reader]}function d(k){return Monocle.Styles.applyRules(o.element,k)}function r(p,k){return Monocle.Styles.affix(o.element,p,k)}function c(p){p=o.prefix+p;var k=o.element.className;if(!k){return false}if(k==p){return true}return new RegExp("(^|\\s)"+p+"(\\s|$)").test(k)}function l(k){if(c(k)){return}var p=o.element.className?" ":"";return o.element.className+=p+o.prefix+k}function m(p){var v=new RegExp("(^|\\s+)"+o.prefix+p+"(\\s+|$)");var u=/^\s+|\s+$/g;var k=o.element.className;o.element.className=k.replace(v," ").replace(u,"");return o.element.className}q.find=n;q.claim=h;q.make=f;q.append=t;q.address=g;q.setStyles=d;q.setBetaStyle=r;q.hasClass=c;q.addClass=l;q.removeClass=m;b();return q};Monocle.Events={};Monocle.Events.wrapper=function(a){return function(b){b.m=new Gala.Cursor(b);a(b)}};Monocle.Events.listen=Gala.listen;Monocle.Events.deafen=Gala.deafen;Monocle.Events.dispatch=Gala.dispatch;Monocle.Events.listenForTap=function(c,b,a){return Gala.onTap(c,Monocle.Events.wrapper(b),a)};Monocle.Events.deafenForTap=Gala.deafenGroup;Monocle.Events.listenForContact=function(c,b,a){a=a||{useCapture:false};var d={};for(var e in b){d[e]=Monocle.Events.wrapper(b[e])}return Gala.onContact(c,d,a.useCapture)};Monocle.Events.deafenForContact=Gala.deafenGroup;Monocle.Events.afterTransition=function(d,b){var e="transitionend";if(Monocle.Browser.is.WebKit){e="webkitTransitionEnd"}else{if(Monocle.Browser.is.Opera){e="oTransitionEnd"}}var a=null,c=null;a=function(){b();c()};c=function(){Monocle.Events.deafen(d,e,a)};Monocle.Events.listen(d,e,a);return c};Monocle.Styles={rulesToString:function(b){if(typeof b!="string"){var a=[];for(var c in b){a.push(c+": "+b[c]+";")}b=a.join(" ")}return b},applyRules:function(a,b){b=Monocle.Styles.rulesToString(b);a.style.cssText+=";"+b;return a.style.cssText},affix:function(b,d,c){var e=b.style?b.style:b;var a=Monocle.Browser.css.toDOMProps(d);while(a.length){e[a.shift()]=c}},setX:function(c,a){var b=c.style;if(typeof a=="number"){a+="px"}var d=Monocle.Browser.env.supportsTransform3d?"translate3d("+a+", 0, 0)":"translateX("+a+")";d=(a=="0px")?"none":d;b.webkitTransform=b.MozTransform=b.OTransform=b.transform=d;return a},setY:function(b,d){var a=b.style;if(typeof d=="number"){d+="px"}var c=Monocle.Browser.env.supportsTransform3d?"translate3d(0, "+d+", 0)":"translateY("+d+")";c=(d=="0px")?"none":c;a.webkitTransform=a.MozTransform=a.OTransform=a.transform=c;return d},getX:function(e){var a=document.defaultView.getComputedStyle(e,null);var d=/matrix\([^,]+,[^,]+,[^,]+,[^,]+,\s*([^,]+),[^\)]+\)/;var c=Monocle.Browser.css.toDOMProps("transform");var b=null;while(c.length&&!b){b=a[c.shift()]}if(b=="none"){return 0}else{return parseInt(b.match(d)[1],10)}},transitionFor:function(d,b,e,c,g){var a=Monocle.Browser.css.toDOMProps("transition");var h=Monocle.Browser.css.toCSSProps(b);c=c||"linear";g=(g||0)+"ms";for(var f=0,j=a.length;f<j;++f){var k="none";if(e){k=[h[f],e+"ms",c,g].join(" ")}d.style[a[f]]=k}}};Monocle.Styles.container={position:"absolute",overflow:"hidden",top:"0",left:"0",bottom:"0",right:"0"};Monocle.Styles.page={position:"absolute","z-index":"1","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none","-webkit-transform":"translate3d(0,0,0)",visibility:"visible"};Monocle.Styles.sheaf={position:"absolute",overflow:"hidden"};Monocle.Styles.component={width:"100%",height:"100%",border:"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"};Monocle.Styles.control={"z-index":"100",cursor:"pointer"};Monocle.Styles.overlay={position:"absolute",display:"none",width:"100%",height:"100%","z-index":"1000"};Monocle.Formatting=function(a,c,e){var m={constructor:Monocle.Formatting};var q=m.constants=m.constructor;var j=m.properties={reader:a,stylesheets:[],fontScale:null};function b(){j.fontScale=e;s(c);j.reader.listen("monocle:componentmodify",n)}function s(k){var p=q.DEFAULT_STYLE_RULES;
if(Monocle.Browser.env.floatsIgnoreColumns){p.push("html#RS\\:monocle * { float: none !important; }")}j.defaultStyles=g(p,false);if(k){j.initialStyles=g(k,false)}}function n(k){var y=k.m.document;y.documentElement.id=j.reader.properties.systemId;r(y,j.fontScale);for(var p=0;p<j.stylesheets.length;++p){if(j.stylesheets[p]){v(y,p)}}}function g(k){return t(function(){j.stylesheets.push(k);var y=j.stylesheets.length-1;var z=0,p=null;while(p=j.reader.dom.find("component",z++)){v(p.contentDocument,y)}return y})}function o(k,p){return t(function(){j.stylesheets[k]=p;if(typeof p.join=="function"){p=p.join("\n")}var A=0,z=null;while(z=j.reader.dom.find("component",A++)){var B=z.contentDocument;var y=B.getElementById("monStylesheet"+k);if(!y){console.warn("No such stylesheet: "+k);return}if(y.styleSheet){y.styleSheet.cssText=p}else{y.replaceChild(B.createTextNode(p),y.firstChild)}}})}function h(k){return t(function(){j.stylesheets[k]=null;var z=0,y=null;while(y=j.reader.dom.find("component",z++)){var A=y.contentDocument;var p=A.getElementById("monStylesheet"+k);p.parentNode.removeChild(p)}})}function t(p){f();var k=p();j.reader.recalculateDimensions(true,i);return k}function f(){j.reader.dispatchEvent("monocle:stylesheetchanging",{})}function i(){j.reader.dispatchEvent("monocle:stylesheetchange",{})}function v(A,p){var z=j.stylesheets[p];if(!z){return}if(!A||!A.documentElement){return}var y=A.getElementsByTagName("head")[0];if(!y){y=A.createElement("head");A.documentElement.appendChild(y)}if(typeof z.join=="function"){z=z.join("\n")}var k=A.createElement("style");k.type="text/css";k.id="monStylesheet"+p;if(k.styleSheet){k.styleSheet.cssText=z}else{k.appendChild(A.createTextNode(z))}y.appendChild(k);return k}function l(y){j.fontScale=y;f();var p=0,k=null;while(k=j.reader.dom.find("component",p++)){r(k.contentDocument,y)}j.reader.recalculateDimensions(true,i)}function r(p,y){if(y){if(!p.body.pfsSwept){x(p)}var k={document:p,scale:parseFloat(y)};j.reader.dispatchEvent("monocle:fontscaling",k);y=k.scale;d(p.body,function(A){if(typeof A.pfsOriginal=="undefined"){return}var z=u(Math.round(A.pfsOriginal*y));if(A.pfsApplied){w(A,z)}else{A.style.cssText+=z}A.pfsApplied=y});j.reader.dispatchEvent("monocle:fontscale",k)}else{if(p.body.pfsApplied){var k={document:p,scale:null};j.reader.dispatchEvent("monocle:fontscaling",k);d(p.body,function(B){if(typeof B.pfsOriginal=="undefined"){return}if(B.pfsApplied){var A=B.pfsOriginalProp;var z=A?"font-size: "+A+" ! important;":"";w(B,z);B.pfsApplied=null}});x(p);j.reader.dispatchEvent("monocle:fontscale",k)}}}function x(k){d(k.body,function(z){if(z.getCTM){return}var y=k.defaultView.getComputedStyle(z,null);var p=parseFloat(y.getPropertyValue("font-size"));z.pfsOriginal=p;z.pfsOriginalProp=z.style.fontSize});k.body.pfsSwept=true}function d(p,k){if(p.nodeType!=1){return}k(p);p=p.firstChild;while(p){d(p,k);p=p.nextSibling}}function u(k){return"font-size: "+k+"px ! important;"}function w(k,p){var y=/font-size:[^;]/;k.style.cssText=k.style.cssText.replace(y,p)}m.addPageStyles=g;m.updatePageStyles=o;m.removePageStyles=h;m.setFontScale=l;b();return m};Monocle.Formatting.DEFAULT_STYLE_RULES=["html#RS\\:monocle * {-webkit-font-smoothing: subpixel-antialiased;text-rendering: auto !important;word-wrap: break-word !important;}","html#RS\\:monocle body {margin: 0 !important;border: none !important;padding: 0 !important;width: 100% !important;position: absolute !important;-webkit-text-size-adjust: none;-ms-touch-action: none;-ms-content-zooming: none;-ms-content-zoom-chaining: chained;-ms-content-zoom-limit-min: 100%;-ms-content-zoom-limit-max: 100%;-ms-touch-select: none;}","html#RS\\:monocle body, html#RS\\:monocle body * {max-width: 100% !important;}","html#RS\\:monocle img, html#RS\\:monocle video, html#RS\\:monocle object, html#RS\\:monocle svg {max-height: 95% !important;height: auto !important;}","a:not([href]) { color: inherit; }"];Monocle.Reader=function(C,I,v,u){var B={constructor:Monocle.Reader};var P=B.constants=B.constructor;var L=B.properties={initialized:false,book:null,graph:{},systemId:(v?v.systemId:null)||P.DEFAULT_SYSTEM_ID,classPrefix:P.DEFAULT_CLASS_PREFIX,controls:[],resizeTimer:null};var d;function g(){v=v||{};Monocle.Browser.survey(j)}function j(){var p=C;if(typeof p=="string"){p=document.getElementById(p)}d=B.dom=p.dom=new Monocle.Factory(p,"box",0,B);B.billboard=new Monocle.Billboard(B);if(!Monocle.Browser.env.isCompatible()){if(m("monocle:incompatible",{},true)){f(P.COMPATIBILITY_INFO)}return}m("monocle:initializing",B);I=I||Monocle.bookDataFromNodes([p.cloneNode(true)]);var k=new Monocle.Book(I,v.preloadWindow||1);p.innerHTML="";o();D(v.flipper);t();B.selection=new Monocle.Selection(B);B.formatting=new Monocle.Formatting(B,v.stylesheet,v.fontScale);F("monocle:turn",w);e(v.primeURL,function(){i();L.flipper.listenForInteraction(v.panels);z(k,v.place,function(){if(u){u(B)}m("monocle:loaded",B)})})}function o(){var p;var W=d.find("box");if(document.defaultView){var k=document.defaultView.getComputedStyle(W,null);
p=k.getPropertyValue("position")}else{if(W.currentStyle){p=W.currentStyle.position}}if(["absolute","relative"].indexOf(p)==-1){W.style.position="relative"}}function D(k){if(!k){if(Monocle.Browser.renders.slow){k=Monocle.Flippers.Instant}else{k=Monocle.Flippers.Slider}}L.flipper=new k(B,null,L.readerOptions)}function t(){var W=d.append("div","container");for(var k=0;k<L.flipper.pageCount;++k){var p=W.dom.append("div","page",k);p.style.visibility="hidden";p.m={reader:B,pageIndex:k,place:null};p.m.sheafDiv=p.dom.append("div","sheaf",k);p.m.activeFrame=p.m.sheafDiv.dom.append("iframe","component",k);p.m.activeFrame.m={pageDiv:p};p.m.activeFrame.setAttribute("frameBorder",0);p.m.activeFrame.setAttribute("scrolling","no");p.m.activeFrame.setAttribute("data-componentid","");L.flipper.addPage(p)}d.append("div","overlay");m("monocle:loading",B)}function e(W,X){W=W||(Monocle.Browser.on.UIWebView?"blank.html":"about:blank");var p=0;var k=function(Y){var Z=Y.target||Y.srcElement;Monocle.Events.deafen(Z,"load",k);m("monocle:frameprimed",{frame:Z,pageIndex:p});if((p+=1)==L.flipper.pageCount){Monocle.defer(X)}};q(function(Y){Monocle.Events.listen(Y.m.activeFrame,"load",k);Y.m.activeFrame.src=W})}function i(){d.find("container").dom.setStyles(Monocle.Styles.container);q(function(W,p){W.dom.setStyles(Monocle.Styles.page);d.find("sheaf",p).dom.setStyles(Monocle.Styles.sheaf);var k=d.find("component",p);k.dom.setStyles(Monocle.Styles.component)});c();d.find("overlay").dom.setStyles(Monocle.Styles.overlay);m("monocle:styles")}function A(){if(Monocle.Browser.env.relativeIframeExpands){for(var p=0,k;k=d.find("component",p);++p){k.style.display="none"}}}function c(){for(var p=0,k;k=d.find("component",p);++p){k.style.width=k.parentNode.offsetWidth+"px";if(Monocle.Browser.env.relativeIframeExpands){k.style.display="block"}}}function z(k,p,aa){L.book=k;var W=0;if(typeof aa=="function"){var Y={"monocle:componentchange":function(ab){m("monocle:firstcomponentchange",ab.m);return(W+=1)==L.flipper.pageCount},"monocle:componentfailed":function(ab){f(P.LOAD_FAILURE_INFO);return true},"monocle:turn":function(ab){N("monocle:componentfailed",X);aa();return true}};var X=function(ab){if(Y[ab.type](ab)){N(ab.type,X)}};for(var Z in Y){F(Z,X)}}L.flipper.moveTo(p||{page:1},n)}function x(){return L.book}function n(){L.initialized=true}function Q(){if(!L.initialized){console.warn("Attempt to resize book before initialization.")}A();if(!m("monocle:resizing",{},true)){return}clearTimeout(L.resizeTimer);L.resizeTimer=Monocle.defer(l,P.RESIZE_DELAY)}function l(){c();s(true,G)}function G(){m("monocle:resize")}function s(W,Y){if(!L.book){return}if(L.onRecalculate){var p=L.onRecalculate;L.onRecalculate=function(){p();if(typeof Y=="function"){Y()}};return}m("monocle:recalculating");L.onRecalculate=function(){if(typeof Y=="function"){Y()}L.onRecalculate=null;m("monocle:recalculated")};var X=function(){Monocle.defer(L.onRecalculate)};var k=X;if(W!==false&&L.lastLocus){k=function(){L.flipper.moveTo(L.lastLocus,X,false)}}q(function(Z){Z.m.activeFrame.m.component.updateDimensions(Z)});Monocle.defer(k)}function w(p){if(L.onRecalculate){}else{var k=a();L.lastLocus={componentId:k.componentId(),percent:k.percentageThrough()};m("monocle:position",{place:k})}}function r(p){var k=a(p);return k?(k.pageNumber()||1):1}function a(k){if(!L.initialized){console.warn("Attempt to access place before initialization.")}return L.flipper.getPlace(k)}function b(k,W){if(!L.initialized){console.warn("Attempt to move place before initialization.")}if(!L.book.isValidLocus(k)){m("monocle:notfound",{href:k?k.componentId:"anonymous"});return false}var p=W;if(!k.direction){m("monocle:turning");m("monocle:jumping",{locus:k});p=function(){m("monocle:jump",{locus:k});if(W){W()}}}L.flipper.moveTo(k,p);return true}function y(p){var k=L.book.locusOfChapter(p);return b(k)}function U(Z,k,p){for(var W=0;W<L.controls.length;++W){if(L.controls[W].control==Z){console.warn("Already added control: %o",Z);return}}p=p||{};var X={control:Z,elements:[],controlType:k};L.controls.push(X);var Y=function(ab){if(ab=="container"){ab=p.container||d.find("container");if(typeof ab=="string"){ab=document.getElementById(ab)}if(!ab.dom){d.claim(ab,"controlContainer")}}else{if(ab=="overlay"){ab=d.find("overlay")}}if(typeof Z.createControlElements!="function"){return}var aa=Z.createControlElements(ab);if(!aa){return}ab.appendChild(aa);X.elements.push(aa);Monocle.Styles.applyRules(aa,Monocle.Styles.control);return aa};if(!k||k=="standard"||k=="invisible"){Y("container")}else{if(k=="page"){q(Y)}else{if(k=="modal"||k=="popover"||k=="hud"){Y("overlay");X.usesOverlay=true}else{if(k=="invisible"){Y("container")}else{console.warn("Unknown control type: "+k)}}}}if(p.hidden){h(Z)}else{M(Z)}if(typeof Z.assignToReader=="function"){Z.assignToReader(B)}return Z}function S(p){for(var k=0;k<L.controls.length;++k){if(L.controls[k].control==p){return L.controls[k]}}}function h(X){var k=S(X);if(!k){console.warn("No data for control: "+X);return
}if(k.hidden){return}for(var W=0;W<k.elements.length;++W){k.elements[W].style.display="none"}if(k.usesOverlay){var p=d.find("overlay");p.style.display="none";Monocle.Events.deafenForContact(p,p.listeners);if(k.controlType!="hud"){m("monocle:modal:off")}}k.hidden=true;if(X.properties){X.properties.hidden=true}m("monocle:controlhide",{control:X},false)}function M(Z){var k=S(Z);if(!k){console.warn("No data for control: "+Z);return false}if(H(Z)){return false}var W=d.find("overlay");var X,Y;if(k.usesOverlay&&k.controlType!="hud"){for(X=0,Y=L.controls.length;X<Y;++X){if(L.controls[X].usesOverlay&&!L.controls[X].hidden){return false}}W.style.display="block";m("monocle:modal:on")}for(X=0;X<k.elements.length;++X){k.elements[X].style.display="block"}if(k.controlType=="popover"){var aa=function(ab){var ac=ab.target;do{if(ac==k.elements[0]){return false}}while(ac&&(ac=ac.parentNode));Gala.stop(ab);return true};var p={start:function(ab){if(aa(ab)){h(Z)}},move:aa};W.listeners=Monocle.Events.listenForContact(W,p)}k.hidden=false;if(Z.properties){Z.properties.hidden=false}m("monocle:controlshow",{control:Z},false);return true}function H(p){var k=S(p);return k.hidden===false}function m(W,p,k){return Monocle.Events.dispatch(d.find("box"),W,p,k)}function F(W,p,k){Monocle.Events.listen(d.find("box"),W,p,k)}function N(p,k){Monocle.Events.deafen(d.find("box"),p,k)}function R(){return L.flipper.visiblePages?L.flipper.visiblePages():[d.find("page")]}function q(X){for(var k=0,p=L.flipper.pageCount;k<p;++k){var W=d.find("page",k);X(W,k)}}function O(k,p){console.deprecation("Use reader.formatting.addPageStyles instead.");return B.formatting.addPageStyles(k,p)}function K(k,p,W){console.deprecation("Use reader.formatting.updatePageStyles instead.");return B.formatting.updatePageStyles(k,p,W)}function E(k,p){console.deprecation("Use reader.formatting.removePageStyles instead.");return B.formatting.removePageStyles(k,p)}function f(W){var p=d.make("div","book_fatality",{html:W});var k=d.find("box");var X=[k.offsetWidth/2,k.offsetHeight/2];B.billboard.show(p,{closeButton:false,from:X})}function V(){L.flipper.flipNextPage()}function T(){L.flipper.flipPreviousPage()}function J(){return(typeof(L.flipper.getActiveIndex)==typeof(Function))?L.flipper.getActiveIndex():0}B.getBook=x;B.getPlace=a;B.moveTo=b;B.skipToChapter=y;B.resized=Q;B.recalculateDimensions=s;B.addControl=U;B.hideControl=h;B.showControl=M;B.showingControl=H;B.dispatchEvent=m;B.listen=F;B.deafen=N;B.visiblePages=R;B.addPageStyles=O;B.updatePageStyles=K;B.removePageStyles=E;B.moveNext=V;B.movePrevious=T;B.getActiveIndex=J;g();return B};Monocle.Reader.RESIZE_DELAY=Monocle.Browser.renders.slow?500:100;Monocle.Reader.DEFAULT_SYSTEM_ID="RS:monocle";Monocle.Reader.DEFAULT_CLASS_PREFIX="monelem_";Monocle.Reader.DEFAULT_STYLE_RULES=Monocle.Formatting.DEFAULT_STYLE_RULES;Monocle.Reader.COMPATIBILITY_INFO="<h1>Incompatible browser</h1><p>Unfortunately, your browser isn't able to display this book. If possible, try again in another browser or on another device.</p>";Monocle.Reader.LOAD_FAILURE_INFO="<h1>Book could not be loaded</h1><p>Sorry, parts of the book could not be retrieved.<br />Please check your connection and refresh to try again.</p>";Monocle.Book=function(s,f){var q={constructor:Monocle.Book};var r=q.constants=q.constructor;var m=q.properties={dataSource:s,preloadWindow:f,cmptLoadQueue:{},components:[],chapters:{}};function b(){m.componentIds=s.getComponents();m.contents=s.getContents();m.lastCIndex=m.componentIds.length-1}function o(z,A){A.load=false;var B=z.m.activeFrame?z.m.activeFrame.m.component:null;var y=null;var p=m.componentIds.indexOf(A.componentId);if(p<0&&!B){A.load=true;A.componentId=m.componentIds[0];return A}else{if(p<0&&A.componentId&&B.properties.id!=A.componentId){z.m.reader.dispatchEvent("monocle:notfound",{href:A.componentId});return null}else{if(p<0){y=B;A.componentId=z.m.activeFrame.m.component.properties.id;p=m.componentIds.indexOf(A.componentId)}else{if(!m.components[p]||m.components[p]!=B){A.load=true;return A}else{y=B}}}}var k={load:false,componentId:A.componentId,page:1};var x=y.lastPageNumber();if(typeof(A.page)=="number"){k.page=A.page}else{if(typeof(A.pagesBack)=="number"){k.page=x+A.pagesBack}else{if(typeof(A.percent)=="number"){var w=new Monocle.Place();w.setPlace(y,1);k.page=w.pageAtPercentageThrough(A.percent)}else{if(typeof(A.direction)=="number"){if(!z.m.place){console.warn("Can't move in a direction if pageDiv has no place.")}k.page=z.m.place.pageNumber();k.page+=A.direction}else{if(typeof(A.anchor)=="string"){k.page=y.pageForChapter(A.anchor,z)}else{if(typeof(A.xpath)=="string"){k.page=y.pageForXPath(A.xpath,z)}else{if(typeof(A.selector)=="string"){k.page=y.pageForSelector(A.selector,z)}else{if(typeof(A.position)=="string"){if(A.position=="start"){k.page=1}else{if(A.position=="end"){k.page=x["new"]}}}else{console.warn("Unrecognised locus: "+A)}}}}}}}}if(k.page<1){if(p===0){k.page=1;k.boundarystart=true}else{k.load=true;k.componentId=m.componentIds[p-1];
k.pagesBack=k.page;k.page=null}}else{if(k.page>x){if(p==m.lastCIndex){k.page=x;k.boundaryend=true}else{k.load=true;k.componentId=m.componentIds[p+1];k.page-=x}}}return k}function d(w,x){x=o(w,x);if(x&&!x.load){var k={locus:x,page:w};if(x.boundarystart){w.m.reader.dispatchEvent("monocle:boundarystart",k)}else{if(x.boundaryend){w.m.reader.dispatchEvent("monocle:boundaryend",k)}else{var p=m.components[m.componentIds.indexOf(x.componentId)];w.m.place=w.m.place||new Monocle.Place();w.m.place.setPlace(p,x.page);k={page:w,locus:x,pageNumber:w.m.place.pageNumber(),componentId:x.componentId};w.m.reader.dispatchEvent("monocle:pagechange",k)}}}return x}function v(x,y,z,A){var k=m.componentIds.indexOf(y.componentId);if(!y.load||k<0){y=o(x,y)}if(!y){return A?A():null}if(!y.load){return z(y)}var p=function(){y=d(x,y);if(!y){return A?A():null}else{if(y.load){v(x,y,z,A)}else{z(y)}}};var w=function(C){C.applyTo(x,p);for(var B=1;B<=m.preloadWindow;++B){g(k+B,B*r.PRELOAD_INTERVAL)}};u(k,w,A,x)}function i(k,p,w,x){p=d(k,p);if(!p){if(x){x()}}else{if(p.load){v(k,p,w,x)}else{w(p)}}}function u(y,z,B,x){if(m.components[y]){return z(m.components[y])}var k=m.components[y];var p={page:x,component:k,index:y};x.m.reader.dispatchEvent("monocle:componentloading",p);var A=function(C){p.component=C;x.m.reader.dispatchEvent("monocle:componentloaded",p);z(C)};var w=function(C){console.warn("Failed to load component: "+C);x.m.reader.dispatchEvent("monocle:componentfailed",p);if(B){B()}};n(y,A,w)}function a(p){if(m.components[p]){return}var k=m.componentIds[p];if(!k){return}if(m.cmptLoadQueue[k]){return}n(p)}function g(p,k){Monocle.defer(function(){a(p)},k)}function n(y,p,A){var k=m.componentIds[y];var B={success:p,failure:A};if(m.cmptLoadQueue[k]){return m.cmptLoadQueue[k]=B}else{m.cmptLoadQueue[k]=B}var x=function(){e(k,"failure",k)};var z=function(C){if(C===false){return x()}m.components[y]=new Monocle.Component(q,k,y,c(k),C);e(k,"success",m.components[y])};var w=m.dataSource.getComponent(k,z);if(w&&!m.components[y]){z(w)}else{if(w===false){x()}}}function e(k,w,p){if(typeof m.cmptLoadQueue[k][w]=="function"){m.cmptLoadQueue[k][w](p)}m.cmptLoadQueue[k]=null}function c(p){if(m.chapters[p]){return m.chapters[p]}m.chapters[p]=[];var y=new RegExp("^"+decodeURIComponent(p)+"(#(.+)|$)");var x;var k=function(A){if(A.componentId==p){m.chapters[p].push({title:A.title,fragment:null})}if(A.children){for(var z=0;z<A.children.length;++z){k(A.children[z])}}};for(var w=0;w<m.contents.length;++w){k(m.contents[w])}return m.chapters[p]}function h(y){var x=new RegExp("^(.+?)(#(.*))?$");var w=y.match(x);if(!w){return null}var k=j(w[1]);if(!k){return null}var p={componentId:k};w[3]?p.anchor=w[3]:p.position="start";return p}function t(k){if(!k){return false}if(k.componentId&&!j(k.componentId)){return false}return true}function j(w){w=decodeURIComponent(w);for(var k=0,p=m.componentIds.length;k<p;++k){if(decodeURIComponent(m.componentIds[k])==w){return w}}return null}function l(){if(!m.weights){m.weights=s.getMetaData("componentWeights")||[];if(!m.weights.length){var w=1/m.componentIds.length;for(var k=0,p=m.componentIds.length;k<p;++k){m.weights.push(w)}}}return m.weights}q.getMetaData=s.getMetaData;q.pageNumberAt=o;q.setPageAt=d;q.loadPageAt=v;q.setOrLoadPageAt=i;q.chaptersForComponent=c;q.locusOfChapter=h;q.isValidLocus=t;q.componentWeights=l;b();return q};Monocle.Book.fromNodes=function(a){console.deprecation("Book.fromNodes() will soon be removed.");return new Monocle.Book(Monocle.bookDataFromNodes(a))};Monocle.Book.PRELOAD_INTERVAL=1000;Monocle.Place=function(){var g={constructor:Monocle.Place};var l=g.constants=g.constructor;var e=g.properties={component:null,percent:null};function s(k,p){e.component=k;e.percent=p/k.lastPageNumber();e.chapter=null}function i(k,p){e.component=k;e.percent=p;e.chapter=null}function r(){return e.component.properties.id}function a(){return e.percent-c()}function u(){return e.percent-(c()/2)}function d(){return e.percent}function n(){return u()}function c(){return 1/e.component.lastPageNumber()}function q(p){var k=j();if(typeof p!="number"){p=0}return Math.max(Math.ceil(Math.round(k*p*1000)/1000),1)}function v(){return q(e.percent)}function j(){return e.component.lastPageNumber()}function w(){if(e.chapter){return e.chapter}return e.chapter=e.component.chapterForPage(v()+1)}function m(){var k=w();return k?k.title:null}function t(){var p=r();var k=w();if(k&&k.fragment){p+="#"+k.fragment}return p}function o(k){k=k||{};var p={page:v(),componentId:r()};if(k.direction){p.page+=k.direction}else{p.percent=n()}return p}function h(){var p=e.component.properties.book;var B=p.properties.componentIds;var A=p.componentWeights();var z=e.component.properties.index;var k=A[z]*e.percent;for(var x=0,y=z;x<y;++x){k+=A[x]}return k}function f(){return e.component.properties.index===0&&v()===1}function b(){return(e.component.properties.index==e.component.properties.book.properties.lastCIndex&&v()==e.component.lastPageNumber())}g.setPlace=s;g.setPercentageThrough=i;
g.componentId=r;g.percentAtTopOfPage=a;g.percentAtMiddleOfPage=u;g.percentAtBottomOfPage=d;g.percentageThrough=n;g.pageSizePercentage=c;g.pageAtPercentageThrough=q;g.pageNumber=v;g.pagesInComponent=j;g.chapterInfo=w;g.chapterTitle=m;g.chapterSrc=t;g.getLocus=o;g.percentageOfBook=h;g.onFirstPageOfBook=f;g.onLastPageOfBook=b;return g};Monocle.Place.FromPageNumber=function(c,b){var a=new Monocle.Place();a.setPlace(c,b);return a};Monocle.Place.FromPercentageThrough=function(b,c){var a=new Monocle.Place();a.setPercentageThrough(b,c);return a};Monocle.Place.percentOfBookToLocus=function(a,g){var c=a.getBook();var h=c.properties.componentIds;var f=c.componentWeights();var e=0,b=0;g=Math.min(g,0.99999);while(g>=0){b=f[e];g-=f[e];if(g>=0){e+=1;if(e>=f.length){console.error("Unable to calculate locus from percentage: "+g);return}}}var d=(g+b)/b;return{componentId:h[e],percent:d}};Monocle.Component=function(n,t,i,g,w){var u={constructor:Monocle.Component};var y=u.constants=u.constructor;var s=u.properties={book:n,id:t,index:i,chapters:g,source:w};function A(p,D){l(p.m.reader);var k={page:p,source:s.source};p.m.reader.dispatchEvent("monocle:componentchanging",k);var C=function(){o(p,p.m.activeFrame,function(){D(p,u)})};Monocle.defer(function(){e(p,C)})}function e(k,C){var p=k.m.activeFrame;p.m.component=u;p.style.visibility="hidden";p.whenDocumentReady=function(){var E=p.contentDocument;var D={page:k,document:E,component:u};k.m.reader.dispatchEvent("monocle:componentmodify",D);p.whenDocumentReady=null};p.setAttribute("data-componentid",s.id);if(s.source.html){return r(s.source.html||s.source,p,C)}else{if(s.source.url){return a(s.source.url,p,C)}else{if(s.source.doc){return f(s.source.doc,p,C)}}}}function r(C,p,D){var k=function(){Monocle.Events.deafen(p,"load",k);p.whenDocumentReady();Monocle.defer(D)};Monocle.Events.listen(p,"load",k);if(Monocle.Browser.env.loadHTMLWithDocWrite){p.contentDocument.open("text/html","replace");p.contentDocument.write(C);p.contentDocument.close()}else{p.contentWindow.monCmptData=C;p.src="javascript:window['monCmptData'];"}}function a(k,D,E){if(!k.match(/^\//)){k=m(k)}var p=function(){Monocle.Events.deafen(D,"load",p);D.whenDocumentReady()};var C=function(){Monocle.Events.deafen(D,"load",C);Monocle.defer(E)};Monocle.Events.listen(D,"load",p);Monocle.Events.listen(D,"load",C);D.contentWindow.location.replace(k)}function f(F,C,K){var J=C.contentDocument;if(Monocle.Browser.is.WebKit){var E=F.querySelector("base");if(E){var I=J.querySelector("head");if(!I){try{I=J.createElement("head");z(J.documentElement,I)}catch(H){I=J.body}}var p=J.createElement("base");p.setAttribute("href",E.href);I.appendChild(p)}}try{J.replaceChild(J.importNode(F.documentElement,true),J.documentElement)}catch(D){var k=(new XMLSerializer()).serializeToString(F.documentElement);k=k.replace("<![CDATA["," ").replace("]]>"," ");var G=(new DOMParser()).parseFromString(k,"text/xml");J.replaceChild(J.importNode(G.documentElement,true),J.documentElement)}Monocle.defer(K)}function o(k,p,C){j(k,function(){p.style.visibility="visible";B(k);if(Monocle.Browser.on.Android){Monocle.Events.listen(p.contentWindow,"scroll",function(){p.contentWindow.scrollTo(0,0)})}var E=p.contentDocument;var D={page:k,document:E,component:u};k.m.reader.dispatchEvent("monocle:componentchange",D);C()})}function j(k,p){k.m.dimensions.update(function(C){s.pageLength=C;if(typeof p=="function"){p()}})}function B(k){if(s.chapters[0]&&typeof s.chapters[0].percent=="number"){return}var E=k.m.activeFrame.contentDocument;for(var p=0;p<s.chapters.length;++p){var D=s.chapters[p];D.percent=0;if(D.fragment){var C=E.getElementById(D.fragment);D.percent=k.m.dimensions.percentageThroughOfNode(C)}}return s.chapters}function h(p){var D=null;var C=(p-1)/s.pageLength;for(var k=0;k<s.chapters.length;++k){if(C>=s.chapters[k].percent){D=s.chapters[k]}else{return D}}return D}function d(p,k){if(!p){return 1}for(var C=0;C<s.chapters.length;++C){if(s.chapters[C].fragment==p){return q(s.chapters[C].percent)}}var F=k.m.activeFrame.contentDocument;var E=F.getElementById(p);var D=k.m.dimensions.percentageThroughOfNode(E);return q(D)}function b(k,p){var E=p.m.activeFrame.contentDocument;var D=0;if(Monocle.Browser.env.supportsXPath){var C=E.evaluate(k,E,null,9,null).singleNodeValue;if(C){D=p.m.dimensions.percentageThroughOfNode(C)}}else{console.warn("XPath not supported in this client.")}return q(D)}function x(k,p){var E=p.m.activeFrame.contentDocument;var D=0;if(Monocle.Browser.env.supportsQuerySelector){var C=E.querySelector(k);if(C){D=p.m.dimensions.percentageThroughOfNode(C)}}else{console.warn("querySelector not supported in this client.")}return q(D)}function q(k){return Math.floor(k*s.pageLength)+1}function v(){return s.pageLength}function l(H){if(s.sourcePrepared){return}s.sourcePrepared=true;if(typeof s.source=="string"){s.source={html:s.source}}if(s.source.javascript){console.deprecation("Loading a component by 'javascript' is deprecated. Use { 'html': src } -- no need to escape or clean the string.");
var k=s.source.javascript;k=k.replace(/\\n/g,"\n");k=k.replace(/\\r/g,"\r");k=k.replace(/\\'/g,"'");s.source={html:k}}if(s.source.nodes){var F=[];for(var G=0,I=s.source.nodes.length;G<I;++G){var D=s.source.nodes[G];if(D.outerHTML){F.push(D.outerHTML)}else{var p=document.createElement("div");p.appendChild(D.cloneNode(true));F.push(p.innerHTML);delete (p)}}s.source={html:F.join("")}}var C;if(s.source.html&&!s.source.html.match(new RegExp("<bases.+>","im"))){C=c(H);if(C){s.source.html=s.source.html.replace(new RegExp("(<head[^>]*>)","im"),'$1<base href="'+C+'" />')}}if(s.source.doc&&!s.source.doc.querySelector("base")){var J=s.source.doc.querySelector("head")||s.source.doc.body;C=c(H);if(J&&C){var E=s.source.doc.createElement("base");E.setAttribute("href",C);z(J,E)}}}function c(k){var p={cmptId:s.id,cmptURI:m(s.id)};if(k.dispatchEvent("monocle:component:baseuri",p,true)){return p.cmptURI}}function m(p){var C=document.createElement("a");C.setAttribute("href",p);var k=C.href;delete (C);return k}function z(p,k){p.firstChild?p.insertBefore(k,p.firstChild):p.appendChild(k)}u.applyTo=A;u.updateDimensions=j;u.chapterForPage=h;u.pageForChapter=d;u.pageForXPath=b;u.pageForSelector=x;u.lastPageNumber=v;return u};Monocle.Selection=function(g){var d={constructor:Monocle.Selection};var e=d.constants=d.constructor;var c=d.properties={reader:g,lastSelection:[]};function f(){if(e.SELECTION_POLLING_INTERVAL){setInterval(n,e.SELECTION_POLLING_INTERVAL)}}function n(){var k=0,o=null;while(o=g.dom.find("component",k++)){if(o.contentWindow){a(o.contentWindow,k)}}}function a(r,o){var q=r.getSelection();if(!q){return}var p=c.lastSelection[o]||{};var k=c.lastSelection[o]={selected:b(r),range:q.rangeCount?q.getRangeAt(0):null,string:q.toString()};if(k.selected){k.rangeStartContainer=k.range.startContainer;k.rangeEndContainer=k.range.endContainer;k.rangeStartOffset=k.range.startOffset;k.rangeEndOffset=k.range.endOffset;if(!j(k,p)){c.reader.dispatchEvent("monocle:selection",k)}}else{if(p.selected){c.reader.dispatchEvent("monocle:deselection",p)}}}function j(o,k){return(o.rangeStartContainer==k.rangeStartContainer&&o.rangeEndContainer==k.rangeEndContainer&&o.rangeStartOffset==k.rangeStartOffset&&o.rangeEndOffset==k.rangeEndOffset)}function i(){var k=0,o=null;while(o=g.dom.find("component",k++)){m(o.contentWindow)}}function m(o){o=o||window;if(!b(o)){return}if(Monocle.Browser.iOSVersion&&!Monocle.Browser.iOSVersionBelow(5)){h(function(){l(function(){var p=document.createElement("input");p.style.cssText=["position: absolute","top: 0","left: 0","width: 0","height: 0"].join(";");document.body.appendChild(p);p.focus();document.body.removeChild(p)})})}var k=o.getSelection();k.removeAllRanges();o.document.body.scrollLeft=0;o.document.body.scrollTop=0}function l(k){var p=window.scrollX,o=window.scrollY;k();window.scrollTo(p,o)}function h(q){var r=document.querySelector("head");var o=r.querySelector("meta[name=viewport]");var s=function(x){var w=document.createElement("meta");w.setAttribute("name","viewport");w.setAttribute("content",x);r.appendChild(w);return w};var u;if(o){var k=o.getAttribute("content");var t=/user-scalable\s*=\s*([^,$\s])*/;var v=k.match(t);if(v&&["no","0"].indexOf(v[1])>=0){q()}else{var p=k.replace(t,"");p+=p?", ":"";p+="user-scalable=no";r.removeChild(o);u=s(p);q();r.removeChild(u);r.appendChild(o)}}else{u=s("user-scalable=no");q();u.setAttribute("content","user-scalable=yes")}}function b(o){var k=o.getSelection();return k&&!k.isCollapsed}d.deselect=i;f();return d};Monocle.Selection.SELECTION_POLLING_INTERVAL=250;Monocle.Billboard=function(h){var c={constructor:Monocle.Billboard};var d=c.constants=c.constructor;var a=c.properties={reader:h,cntr:null};function j(o,m){a.reader.dispatchEvent("monocle:modal:on");if(a.cntr){return console.warn("Modal billboard already showing.")}m=m||{};var n=o;a.cntr=h.dom.append("div",d.CLS.cntr);if(typeof o=="string"){var l=o;a.inner=n=a.cntr.dom.append("iframe",d.CLS.inner);n.setAttribute("src",l)}else{a.inner=a.cntr.dom.append("div",d.CLS.inner);a.inner.appendChild(n)}a.dims=[n.naturalWidth||n.offsetWidth,n.naturalHeight||n.offsetHeight];if(m.closeButton!==false){var k=a.cntr.dom.append("div",d.CLS.closeButton);Monocle.Events.listenForTap(k,g)}i(m.align||"left top");a.reader.listen("monocle:resize",i);e(m.from);Monocle.defer(b)}function g(k){e();Monocle.Events.afterTransition(a.cntr,f)}function b(){Monocle.Styles.transitionFor(a.cntr,"transform",d.ANIM_MS,"ease-in-out");Monocle.Styles.affix(a.cntr,"transform","translate(0, 0) scale(1)")}function e(m){a.from=m||a.from||[0,0];var l="translate("+a.from[0]+"px, "+a.from[1]+"px)";var k="scale(0)";if(typeof a.from[2]==="number"){k="scaleX("+(a.from[2]/a.cntr.offsetWidth)+") ";k+="scaleY("+(a.from[3]/a.cntr.offsetHeight)+")"}Monocle.Styles.affix(a.cntr,"transform",l+" "+k)}function f(){a.cntr.parentNode.removeChild(a.cntr);a.cntr=a.inner=null;a.reader.deafen("monocle:resize",i);a.reader.dispatchEvent("monocle:modal:off")}function i(q){a.alignment=(typeof q=="string")?q:a.alignment;
if(!a.alignment){return}if(a.dims[0]>a.inner.offsetWidth||a.dims[1]>a.inner.offsetHeight){a.cntr.dom.addClass(d.CLS.oversized)}else{a.cntr.dom.removeClass(d.CLS.oversized)}var p=a.alignment.split(/\s+/);var m=0,n=0;var k=(a.inner.scrollWidth-a.inner.offsetWidth);var o=(a.inner.scrollHeight-a.inner.offsetHeight);if(p[0].match(/^\d+$/)){m=Math.max(0,parseInt(p[0],10)-(a.inner.offsetWidth/2))}else{if(p[0]=="center"){m=k/2}else{if(p[0]=="right"){m=k}}}if(p[1]&&p[1].match(/^\d+$/)){n=Math.max(0,parseInt(p[1],10)-(a.inner.offsetHeight/2))}else{if(!p[1]||p[1]=="center"){n=o/2}else{if(p[1]=="bottom"){n=o}}}a.inner.scrollLeft=m;a.inner.scrollTop=n}c.show=j;c.hide=g;c.align=i;return c};Monocle.Billboard.CLS={cntr:"billboard_container",inner:"billboard_inner",closeButton:"billboard_close",oversized:"billboard_oversized"};Monocle.Billboard.ANIM_MS=400;Monocle.Controls.Panel=function(){var d={constructor:Monocle.Controls.Panel};var i=d.constants=d.constructor;var c=d.properties={evtCallbacks:{}};function g(k){c.div=k.dom.make("div",i.CLS.panel);c.div.dom.setStyles(i.DEFAULT_STYLES);Monocle.Events.listenForContact(c.div,{start:b,move:e,end:h,cancel:o},{useCapture:false});return c.div}function a(k){c.direction=k}function f(k){c.evtCallbacks=k}function m(){c.evtCallbacks={}}function b(k){c.contact=true;k.m.offsetX+=c.div.offsetLeft;k.m.offsetY+=c.div.offsetTop;l();j("start",k)}function e(k){if(!c.contact){return}j("move",k)}function h(k){if(!c.contact){return}Monocle.Events.deafenForContact(c.div,c.listeners);n();c.contact=false;j("end",k)}function o(k){if(!c.contact){return}Monocle.Events.deafenForContact(c.div,c.listeners);n();c.contact=false;j("cancel",k)}function j(p,k){if(c.evtCallbacks[p]){c.evtCallbacks[p](c.direction,k.m.offsetX,k.m.offsetY,d)}k.preventDefault()}function l(){if(c.expanded){return}c.div.dom.addClass(i.CLS.expanded);c.expanded=true}function n(k){if(!c.expanded){return}c.div.dom.removeClass(i.CLS.expanded);c.expanded=false}d.createControlElements=g;d.listenTo=f;d.deafen=m;d.expand=l;d.contract=n;d.setDirection=a;return d};Monocle.Controls.Panel.CLS={panel:"panel",expanded:"controls_panel_expanded"};Monocle.Controls.Panel.DEFAULT_STYLES={position:"absolute",height:"100%"};Monocle.Panels.Marginal=function(d,g){var c={constructor:Monocle.Panels.Marginal};var b=c.constants=c.constructor;var f=c.properties={};function a(){f.panels={forwards:new Monocle.Controls.Panel(),backwards:new Monocle.Controls.Panel()};for(var h in f.panels){d.properties.reader.addControl(f.panels[h]);f.panels[h].listenTo(g);f.panels[h].setDirection(d.constants[h.toUpperCase()]);var i=h=="forwards"?"right":"left";f.panels[h].properties.div.style[i]=0}e()}function e(){var i=d.properties.reader.dom.find("page");var k=i.m.sheafDiv;var j=k.offsetLeft;var h=i.offsetWidth-(k.offsetLeft+k.offsetWidth);j=Math.floor(((j-2)/i.offsetWidth)*10000/100)+"%";h=Math.floor(((h-2)/i.offsetWidth)*10000/100)+"%";f.panels.forwards.properties.div.style.width=h;f.panels.backwards.properties.div.style.width=j;f.panels.forwards.properties.div.className+=" page_next";f.panels.backwards.properties.div.className+=" page_prev"}c.setWidths=e;a();return c};Monocle.Dimensions.Columns=function(e){var c={constructor:Monocle.Dimensions.Columns};var g=c.constants=c.constructor;var b=c.properties={page:e,reader:e.m.reader,length:0,width:0};g.GAP=Monocle.Browser.env.forceColumns?0:20;function h(k){n();Monocle.defer(function(){b.length=l();if(Monocle.DEBUG){console.log("page["+b.page.m.pageIndex+"] -> "+b.length+" ("+b.page.m.activeFrame.m.component.properties.id+")")}k(b.length)})}function n(){var q=f();var k=d();b.width=q.width;var p=Monocle.Styles.rulesToString(g.STYLE.columned);p+=Monocle.Browser.css.toCSSDeclaration("column-width",q.col+"px");p+=Monocle.Browser.css.toCSSDeclaration("column-gap",g.GAP+"px");p+=Monocle.Browser.css.toCSSDeclaration("column-fill","auto");p+=Monocle.Browser.css.toCSSDeclaration("transform","none");if(Monocle.Browser.env.forceColumns&&k.scrollHeight>q.height){p+=Monocle.Styles.rulesToString(g.STYLE["column-force"]);if(Monocle.DEBUG){console.warn("Force columns ("+k.scrollHeight+" > "+q.height+")")}}if(k.style.cssText!=p){b.page.m.offset=0;if(Monocle.Browser.env.documentElementHasScrollbars){k.ownerDocument.documentElement.style.overflow="hidden"}k.style.cssText=p;if(Monocle.Browser.env.scrollToApplyStyle){k.scrollLeft=0}}}function d(){return b.page.m.activeFrame.contentDocument.body}function m(){var p=d();var q=b.page.m.activeFrame.contentDocument.documentElement;var k=Math.max(p.scrollWidth,q.scrollWidth);if(!Monocle.Browser.env.widthsIgnoreTranslate&&b.page.m.offset){k+=b.page.m.offset}return k}function f(){var p=b.page.m.sheafDiv;var k=p.clientWidth;if(p.getBoundingClientRect){k=p.getBoundingClientRect().width}if(Monocle.Browser.env.roundPageDimensions){k=Math.round(k)}return{col:k,width:k+g.GAP,height:p.clientHeight}}function l(){return Math.ceil(m()/f().width)}function j(k){return f().width*(k.page-1)}function i(k,q){var p=j(k);b.page.m.offset=p;
o(p,q);return p}function o(q,p){var k=d();if(p){Monocle.Styles.affix(k,"transition",p)}Monocle.Styles.affix(k,"transform","translateX(-"+q+"px)")}function a(t){if(!t){return 0}var w=b.page.m.activeFrame.contentDocument;var k=0;if(Monocle.Browser.env.findNodesByScrolling){o(0);var q,y;q=y=b.page.m.activeFrame.contentWindow;var u=[[q,q.scrollX,q.scrollY],[window,window.scrollX,window.scrollY]];var p,v;if(Monocle.Browser.env.sheafIsScroller){p=b.page.m.sheafDiv;v=p.scrollLeft;t.scrollIntoView();k=p.scrollLeft}else{p=q;v=p.scrollX;t.scrollIntoView();k=p.scrollX}while(y=u.shift()){y[0].scrollTo(y[1],y[2])}o(b.page.m.offset)}else{k=t.getBoundingClientRect().left;k-=w.body.getBoundingClientRect().left}k+=1;var r=k/(b.length*b.width);return r}c.update=h;c.percentageThroughOfNode=a;c.locusToOffset=j;c.translateToLocus=i;return c};Monocle.Dimensions.Columns.STYLE={columned:{margin:"0",padding:"0",height:"100%",width:"100%",position:"absolute"},"column-force":{"min-width":"200%",overflow:"hidden"}};Monocle.Flippers.Scroller=function(a,u){var n={constructor:Monocle.Flippers.Scroller};var q=n.constants=n.constructor;var m=n.properties={pageCount:1,duration:q.speed,frameRate:q.rate,animate:false};function b(){m.reader=a;m.setPageFn=u}function d(k){k.m.dimensions=new Monocle.Dimensions.Columns(k)}function e(){return m.reader.dom.find("page")}function t(k){if(typeof k!="function"){k=q.DEFAULT_PANELS_CLASS}m.panels=new k(n,{end:g})}function g(k){if(!justSwiped){m.animate=true;i(k)}else{return}}function i(k){if(m.turning){return}m.reader.selection.deselect();j({page:s().pageNumber()+k},null);m.reader.dispatchEvent("monocle:turning");hideArrows()}function s(){return e().m.place}function r(){pageDiv=m.reader.dom.find("page");return pageDiv?pageDiv:null}function j(k,v){var p=o;if(typeof v=="function"){p=function(w){o(w);v(w)}}m.reader.getBook().setOrLoadPageAt(e(),k,p)}function o(z){if(z.boundarystart||z.boundaryend){return}m.turning=true;var B=e().m.dimensions;var A=e().m.activeFrame;var x=A.contentDocument.body;var y=true;if(m.activeComponent!=A.m.component){m.activeComponent=A.m.component;setTimeout(function(){m.currX=Monocle.Styles.getX(x)||0},0);B.translateToLocus(z,"none");Monocle.defer(l)}else{var p=0-B.locusToOffset(z);var v=m.currX||0;var w=(p-v)*(m.frameRate/m.duration);var k=function(){var C=v+w;if(!m.animate||(w<0&&C<=p)||(w>0&&(C>=0||C>=p))){Monocle.Styles.setX(x,p);m.currX=p;m.animate=false;l()}else{Monocle.Styles.setX(x,C);v=C;m.currX=C;setTimeout(k,m.frameRate)}};k()}}function l(){m.turning=false;m.reader.dispatchEvent("monocle:turn")}function f(){m.animate=true;i(+1)}function h(){m.animate=true;i(-1)}function c(){return m.currX||0}n.pageCount=m.pageCount;n.addPage=d;n.getPlace=s;n.moveTo=j;n.listenForInteraction=t;n.flipNextPage=f;n.flipPreviousPage=h;n.getPageDiv=r;n.getCurrentXoffset=c;b();return n};Monocle.Flippers.Scroller.speed=200;Monocle.Flippers.Scroller.rate=33;Monocle.Flippers.Scroller.FORWARDS=1;Monocle.Flippers.Scroller.BACKWARDS=-1;Monocle.Flippers.Scroller.DEFAULT_PANELS_CLASS=Monocle.Panels.TwoPane;Monocle.Controls.Contents=function(a){var c={constructor:Monocle.Controls.Contents};var b=c.constants=c.constructor;var f=c.properties={reader:a};function e(){var h=a.dom.make("div","controls_contents_container");d(h,a.getBook());return h}function d(m,h){while(m.hasChildNodes()){m.removeChild(m.firstChild)}var l=m.dom.append("ol","controls_contents_list");var k=h.properties.contents;for(var j=0;j<k.length;++j){g(l,k[j],0)}}function g(p,o,n){var j=p.childNodes.length;var h=p.dom.append("li","controls_contents_chapter",j);var m=h.dom.append("span","controls_contents_chapterTitle",j,{html:o.title});m.style.paddingLeft=n+"em";var l=function(){f.reader.skipToChapter(o.src);f.reader.hideControl(c)};Monocle.Events.listenForTap(h,l,"controls_contents_chapter_active");if(o.children){for(var k=0;k<o.children.length;++k){g(p,o.children[k],n+1)}}}c.createControlElements=e;return c};Monocle.Controls.Magnifier=function(b){var d={constructor:Monocle.Controls.Magnifier};var c=d.constants=d.constructor;var g=d.properties={buttons:[],magnified:false};function a(){g.reader=b}function f(i){var h=i.dom.make("div","controls_magnifier_button");h.smallA=h.dom.append("span","controls_magnifier_a",{text:"A"});h.largeA=h.dom.append("span","controls_magnifier_A",{text:"A"});g.buttons.push(h);Monocle.Events.listenForTap(h,e);return h}function e(h){var k;g.magnified=!g.magnified;if(g.magnified){k=[0.3,1];g.reader.formatting.setFontScale(c.MAGNIFICATION,true)}else{k=[1,0.3];g.reader.formatting.setFontScale(null,true)}for(var j=0;j<g.buttons.length;j++){g.buttons[j].smallA.style.opacity=k[0];g.buttons[j].largeA.style.opacity=k[1]}}d.createControlElements=f;a();return d};Monocle.Controls.Magnifier.MAGNIFICATION=1.2;Monocle.Controls.PlaceSaver=function(m){var b={constructor:Monocle.Controls.PlaceSaver};var d=b.constants=b.constructor;var a=b.properties={};function f(){c(m)}function j(k){a.reader=k;a.reader.listen("monocle:turn",h)}function c(k){a.bkTitle=k.toString().toLowerCase().replace(/[^a-z0-9]/g,"");
a.prefix=d.DATA_NAMESPACE+a.bkTitle+"."}function l(k,n,o){data_put(a.prefix+k,n);return n}function e(k){return data_get(a.prefix+k)}function h(){var k=a.reader.getPlace();l("component",encodeURIComponent(k.componentId()));l("percent",k.percentageThrough());l("readerFontSize",readerFontSize||1);l("timestamp",Math.floor(Date.now()/1000))}function g(){var k={componentId:e("component"),percent:e("percent"),readerFontSize:e("readerFontSize"),timestamp:e("timestamp")};if(k.componentId&&k.percent){k.componentId=decodeURIComponent(k.componentId);k.percent=parseFloat(k.percent);k.readerFontSize=parseFloat(k.readerFontSize);k.timestamp=parseInt(k.timestamp);return k}else{return null}}function i(){var k=g();if(k){a.reader.moveTo(k)}}b.assignToReader=j;b.savedPlace=g;b.restorePlace=i;f();return b};Monocle.Controls.PlaceSaver.DATA_NAMESPACE="monocle.controls.placesaver.";Monocle.Controls.Scrubber=function(g){var b={constructor:Monocle.Controls.Scrubber};var d=b.constants=b.constructor;var a=b.properties={};function e(){a.reader=g;a.reader.listen("monocle:turn",f);f()}function i(k,q){if(!a.componentIds){a.componentIds=a.reader.getBook().properties.componentIds}var r=a.reader.dom.find(d.CLS.needle,0);var n=(k/q.offsetWidth)*100;n=Math.min(n,99.99999);n=Math.max(n,0);var p=bookData.getComponentMetadata();for(var m in p){if((p[m].start_percent+p[m].width_percent)>=n){var l=m;a.componentWidth=p[m].width_percent;a.componentStart=p[m].start_percent;break}}var o=((n-a.componentStart)/a.componentWidth);o=Math.min(o,1);o=Math.max(o,0);return{componentId:l,percentageThrough:o}}function j(k,m){if(!a.componentIds){a.componentIds=a.reader.getBook().properties.componentIds}a.componentWidth=bookData.getComponentMetadata(k.componentId())["width_percent"];a.componentStart=bookData.getComponentMetadata(k.componentId())["start_percent"];var l=a.componentStart+(k.percentageThrough()*a.componentWidth);return Math.round((l/100)*m.offsetWidth)}function f(){if(a.hidden||!a.reader.dom.find(d.CLS.container)){return}var l=a.reader.getPlace();var k=j(l,a.reader.dom.find(d.CLS.container));for(var m=0,n;n=a.reader.dom.find(d.CLS.needle,m);++m){h(n,k-(n.offsetWidth/2));a.reader.dom.find(d.CLS.trail,m).style.width=k+"px"}}function h(l,k){var m=a.reader.dom.find(d.CLS.container);k=Math.min(m.offsetWidth-Math.ceil(l.offsetWidth/2),k);k=Math.max(k,0-Math.floor(l.offsetWidth/2));Monocle.Styles.setX(l,k)}function c(r){var t=r.dom.make("div",d.CLS.container);var k=t.dom.append("div",d.CLS.track);var s=t.dom.append("div",d.CLS.trail);var m=t.dom.append("div",d.CLS.needle);var p=m.dom.append("div",d.CLS.needleInner);var q=t.dom.append("div",d.CLS.bubble);var n,u;var o=function(A,y){A.preventDefault();y=(typeof y=="number")?y:A.m.registrantX;var z=i(y,t);h(m,y-(m.offsetWidth/2));var B=a.reader.getBook();var w=B.chaptersForComponent(z.componentId);var D=w[Math.floor(w.length*z.percentageThrough)];if(D){if(D.title.length){q.innerHTML=D.title}else{q.innerHTML="..."}}else{q.innerHTML="..."}var C=y-(q.offsetWidth/2);C=Math.min(C,t.offsetWidth-q.offsetWidth);C=Math.max(C,0);h(q,C);a.lastX=y;return z};var l=function(x){var w=o(x,a.lastX);a.reader.moveTo({percent:w.percentageThrough,componentId:w.componentId});Monocle.Events.deafenForContact(t,n);Monocle.Events.deafenForContact(document.body,u);q.style.display="none";$(t).removeClass("active")};var v=function(w){w.stopPropagation();$(t).addClass("active");q.style.display="block";o(w);n=Monocle.Events.listenForContact(t,{move:o});u=Monocle.Events.listenForContact(document.body,{end:l})};Monocle.Events.listenForContact(t,{start:v});return t}b.createControlElements=c;b.updateNeedles=f;e();return b};Monocle.Controls.Scrubber.CLS={container:"controls_scrubber_container",track:"controls_scrubber_track",needle:"controls_scrubber_needle",needleInner:"controls_scrubber_needle_inner",trail:"controls_scrubber_trail",bubble:"controls_scrubber_bubble"};Monocle.Controls.Spinner=function(h){var c={constructor:Monocle.Controls.Spinner};var f=c.constants=c.constructor;var b=c.properties={reader:h,divs:[],repeaters:{},showForPages:[]};function e(l){var k=l.dom.make("div","controls_spinner_anim");k.dom.append("div","controls_spinner_inner");b.divs.push(k);return k}function g(k,m){var l=k;b.reader.listen(k,function(n){a(l,n)});b.reader.listen(m,function(n){j(l,n)})}function d(){g("monocle:componentloading","monocle:componentloaded");g("monocle:componentchanging","monocle:componentchange");g("monocle:resizing","monocle:resize");g("monocle:jumping","monocle:jump");g("monocle:recalculating","monocle:recalculated");b.reader.listen("monocle:notfound",i);b.reader.listen("monocle:componentfailed",i)}function a(m,l){m=m||f.GENERIC_LABEL;b.repeaters[m]=true;b.reader.showControl(c);var o=(l&&l.m&&l.m.page)?l.m.page:null;if(o&&b.divs.length>1){b.showForPages[o.m.pageIndex]=true}else{b.global=true;b.reader.dispatchEvent("monocle:modal:on")}for(var n=0;n<b.divs.length;++n){var k=(b.global||b.showForPages[n])?true:false;b.divs[n].dom[k?"removeClass":"addClass"]("dormant")
}}function j(n,m){n=n||f.GENERIC_LABEL;b.repeaters[n]=false;for(var k in b.repeaters){if(b.repeaters[k]){return}}i()}function i(){if(b.global){b.reader.dispatchEvent("monocle:modal:off")}b.global=false;b.repeaters={};b.showForPages=[];for(var k=0;k<b.divs.length;++k){b.divs[k].dom.addClass("dormant")}}c.createControlElements=e;c.registerSpinEvent=g;c.listenForUsualDelays=d;c.spin=a;c.spun=j;c.forceSpun=i;return c};Monocle.Controls.Spinner.GENERIC_LABEL="generic";Monocle.Controls.Stencil=function(a,f){var r={constructor:Monocle.Controls.Stencil};var t=r.constants=r.constructor;var o=r.properties={reader:a,behaviors:[],components:{},masks:[]};function l(p){f=f||t.DEFAULT_BEHAVIORS;for(var k=0,A=f.length;k<A;++k){u(f[k])}o.container=p.dom.make("div",t.CLS.container);o.reader.listen("monocle:turning",i);o.reader.listen("monocle:turn:cancel",x);o.reader.listen("monocle:turn",g);o.reader.listen("monocle:stylesheetchange",g);o.reader.listen("monocle:resize",g);g();return o.container}function u(p){var k=new p(r);if(typeof k.findElements!="function"){console.warn('Missing "findElements" method for behavior: %o',k)}if(typeof k.fitMask!="function"){console.warn('Missing "fitMask" method for behavior: %o',k)}o.behaviors.push(k)}function g(){var p=o.reader.visiblePages();if(!p||!p.length){return}var A=p[0];var k=v(A);if(!k){return}o.components[k]=null;z(A);h()}function i(){o.container.style.display="none"}function x(){o.container.style.display="block"}function q(){while(o.container.childNodes.length){o.container.removeChild(o.container.lastChild)}}function h(){var A=o.reader.visiblePages()[0];var k=v(A);if(!o.components[k]){return}c(A);q();if(!o.disabled){x();var p=o.components[k];if(p&&p.length){s(A,p)}}}function z(F){var D=v(F);if(!o.components[D]){o.components[D]=[]}else{return}var K=o.components[D];var N=F.m.activeFrame.contentDocument;var I=e(F);for(var M=0,L=o.behaviors.length;M<L;++M){var A=o.behaviors[M];var B=A.findElements(N);for(var J=0;J<B.length;++J){var E=B[J];for(var G=0,C=K.length;G<C;++G){if(K[G].element==E){E=null;break}}if(E&&E.getClientRects){var p=E.getClientRects();for(var H=0;H<p.length;H++){K.push({element:E,behavior:A,left:Math.ceil(p[H].left+I.l),top:Math.ceil(p[H].top),width:Math.floor(p[H].width),height:Math.floor(p[H].height)})}}}}return o.components[D]}function s(A,p){var F=e(A);var C=[];for(var B=0;B<p.length;++B){if(y(p[B],F.l,F.l+F.w)){C.push(p[B])}}for(B=0;B<C.length;++B){var E=C[B];var D={left:E.left-F.l,top:E.top,width:E.width,height:E.height};var k=b(E.element,E.behavior);k.dom.setStyles({display:"block",left:D.left+"px",top:D.top+"px",width:D.width+"px",height:D.height+"px",position:"absolute"});k.stencilRect=D}}function e(k){return{l:k.m.offset||0,w:k.m.dimensions.properties.width}}function y(B,k,A){var p=B.left+(B.width*0.5);return p>=k&&p<A}function v(k){k=k||o.reader.visiblePages()[0];if(!k.m.activeFrame.m.component){return}return k.m.activeFrame.m.component.properties.id}function c(p){var k=p.m.activeFrame.parentNode;o.container.dom.setStyles({left:k.offsetLeft+"px",top:k.offsetTop+"px"})}function b(p,A){var k=o.container.dom.append(A.maskTagName||"div",t.CLS.mask);Monocle.Events.listenForContact(k,{start:function(){o.reader.dispatchEvent("monocle:magic:halt")},move:function(B){B.preventDefault()},end:function(){o.reader.dispatchEvent("monocle:magic:init")}});A.fitMask(p,k);return k}function n(){var k=t.CLS.highlights;if(o.container.dom.hasClass(k)){o.container.dom.removeClass(k)}else{o.container.dom.addClass(k)}}function d(){o.disabled=true;h()}function j(){o.disabled=false;h()}function m(p,k){if(typeof k.filterElement=="function"){return k.filterElement(p)}return p}function w(A,k,p){if(typeof p.maskAssigned=="function"){return p.maskAssigned(A,k)}return false}r.createControlElements=l;r.addBehavior=u;r.draw=h;r.update=g;r.toggleHighlights=n;return r};Monocle.Controls.Stencil.CLS={container:"controls_stencil_container",mask:"controls_stencil_mask",highlights:"controls_stencil_highlighted"};Monocle.Controls.Stencil.Links=function(c){var b={constructor:Monocle.Controls.Stencil.Links};b.maskTagName="a";b.findElements=function(d){return d.querySelectorAll("a[href]")};b.fitMask=function(h,e){var g=a(h);var f=c.properties.reader;var d={href:g,link:h,mask:e};if(g.pass){e.onclick=function(i){return h.click()}}else{h.onclick=function(i){i.preventDefault();return false};if(g.internal){e.setAttribute("href",'javascript:"Skip to chapter"');e.onclick=function(i){if(f.dispatchEvent("monocle:link:internal",d,true)){f.skipToChapter(g.internal)}i.preventDefault();return false}}else{e.setAttribute("href",g.external);e.setAttribute("target","_blank");e.onclick=function(i){return f.dispatchEvent("monocle:link:external",d,true)}}}};function a(f){var j=document.location;var l=j.protocol+"//"+j.host;var d=f.href;var n=d.substring(l.length);var e={external:d};if(d.toLowerCase().match(/^javascript:/)){return{pass:true}}if(f.getAttribute("target")){return e}if(d.indexOf(l)!==0){return e}var k=j.pathname.replace(/[^\/]*\.[^\/]+$/,"");
if(k[k.length-1]!="/"){k+="/"}if(n.indexOf(k)===0){return{internal:n.substring(k.length)}}var g=c.properties.reader.getBook().properties.componentIds;for(var h=0,m=g.length;h<m;++h){if(n.indexOf(g[h])===0){return{internal:n}}}return e}return b};Monocle.Controls.Stencil.DEFAULT_BEHAVIORS=[Monocle.Controls.Stencil.Links];
/*!
	localForage Version 1.2.10 - https://mozilla.github.io/localForage - (c) 2013-2015 Mozilla, Apache License 2.0
*/
(function(){var d,a,c,b;(function(){var f={},e={};d=function(g,h,i){f[g]={deps:h,callback:i}};b=c=a=function(g){b._eak_seen=f;if(e[g]){return e[g]}e[g]={};if(!f[g]){throw new Error("Could not find module "+g)}var n=f[g],r=n.deps,q=n.callback,k=[],j;for(var m=0,h=r.length;m<h;m++){if(r[m]==="exports"){k.push(j={})}else{k.push(a(p(r[m])))}}var o=q.apply(this,k);return e[g]=j||o;function p(x){if(x.charAt(0)!=="."){return x}var w=x.split("/");var t=g.split("/").slice(0,-1);for(var v=0,s=w.length;v<s;v++){var u=w[v];if(u===".."){t.pop()}else{if(u==="."){continue}else{t.push(u)}}}return t.join("/")}}})();d("promise/all",["./utils","exports"],function(i,g){var e=i.isArray;var h=i.isFunction;function f(j){var k=this;if(!e(j)){throw new TypeError("You must pass an array to all.")}return new k(function(q,p){var n=[],o=j.length,s;if(o===0){q([])}function r(t){return function(u){l(t,u)}}function l(t,u){n[t]=u;if(--o===0){q(n)}}for(var m=0;m<j.length;m++){s=j[m];if(s&&h(s.then)){s.then(r(m),p)}else{l(m,s)}}})}g.all=f});d("promise/asap",["exports"],function(o){var m=(typeof window!=="undefined")?window:{};var j=m.MutationObserver||m.WebKitMutationObserver;var l=(typeof global!=="undefined")?global:(this===undefined?window:this);function k(){return function(){process.nextTick(n)}}function g(){var r=0;var p=new j(n);var q=document.createTextNode("");p.observe(q,{characterData:true});return function(){q.data=(r=++r%2)}}function i(){return function(){l.setTimeout(n,1)}}var h=[];function n(){for(var r=0;r<h.length;r++){var q=h[r];var s=q[0],p=q[1];s(p)}h=[]}var f;if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){f=k()}else{if(j){f=g()}else{f=i()}}function e(r,p){var q=h.push([r,p]);if(q===1){f()}}o.asap=e});d("promise/config",["exports"],function(g){var f={instrument:false};function e(h,i){if(arguments.length===2){f[h]=i}else{return f[h]}}g.config=f;g.configure=e});d("promise/polyfill",["./promise","./utils","exports"],function(j,f,g){var e=j.Promise;var i=f.isFunction;function h(){var l;if(typeof global!=="undefined"){l=global}else{if(typeof window!=="undefined"&&window.document){l=window}else{l=self}}var k="Promise" in l&&"resolve" in l.Promise&&"reject" in l.Promise&&"all" in l.Promise&&"race" in l.Promise&&(function(){var m;new l.Promise(function(n){m=n});return i(m)}());if(!k){l.Promise=e}}g.polyfill=h});d("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(y,e,A,m,C,r,F,l){var J=y.config;var K=y.configure;var x=e.objectOrFunction;var f=e.isFunction;var i=e.now;var j=A.all;var o=m.race;var q=C.resolve;var h=r.reject;var B=F.asap;var w=0;J.async=B;function k(M){if(!f(M)){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}if(!(this instanceof k)){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}this._subscribers=[];I(M,this)}function I(Q,P){function M(R){D(P,R)}function O(R){p(P,R)}try{Q(M,O)}catch(N){O(N)}}function G(T,V,S,O){var M=f(S),R,Q,U,N;if(M){try{R=S(O);U=true}catch(P){N=true;Q=P}}else{R=O;U=true}if(z(V,R)){return}else{if(M&&U){D(V,R)}else{if(N){p(V,Q)}else{if(T===g){D(V,R)}else{if(T===L){p(V,R)}}}}}}var s=void 0;var v=0;var g=1;var L=2;function u(M,R,Q,P){var O=M._subscribers;var N=O.length;O[N]=R;O[N+g]=Q;O[N+L]=P}function E(Q,M){var S,R,P=Q._subscribers,O=Q._detail;for(var N=0;N<P.length;N+=3){S=P[N];R=P[N+M];G(M,S,R,O)}Q._subscribers=null}k.prototype={constructor:k,_state:undefined,_detail:undefined,_subscribers:undefined,then:function(R,P){var Q=this;var N=new this.constructor(function(){});if(this._state){var O=arguments;J.async(function M(){G(Q._state,N,O[Q._state-1],Q._detail)})}else{u(this,N,R,P)}return N},"catch":function(M){return this.then(null,M)}};k.all=j;k.race=o;k.resolve=q;k.reject=h;function z(Q,O){var P=null,M;try{if(Q===O){throw new TypeError("A promises callback cannot return that same promise.")}if(x(O)){P=O.then;if(f(P)){P.call(O,function(R){if(M){return true}M=true;if(O!==R){D(Q,R)}else{n(Q,R)}},function(R){if(M){return true}M=true;p(Q,R)});return true}}}catch(N){if(M){return true}p(Q,N);return true}return false}function D(N,M){if(N===M){n(N,M)}else{if(!z(N,M)){n(N,M)}}}function n(N,M){if(N._state!==s){return}N._state=v;N._detail=M;J.async(H,N)}function p(N,M){if(N._state!==s){return}N._state=v;N._detail=M;J.async(t,N)}function H(M){E(M,M._state=g)}function t(M){E(M,M._state=L)}l.Promise=k});d("promise/race",["./utils","exports"],function(h,g){var e=h.isArray;
function f(i){var j=this;if(!e(i)){throw new TypeError("You must pass an array to race.")}return new j(function(n,m){var l=[],o;for(var k=0;k<i.length;k++){o=i[k];if(o&&typeof o.then==="function"){o.then(n,m)}else{n(o)}}})}g.race=f});d("promise/reject",["exports"],function(f){function e(h){var g=this;return new g(function(j,i){i(h)})}f.reject=e});d("promise/resolve",["exports"],function(f){function e(h){if(h&&typeof h==="object"&&h.constructor===this){return h}var g=this;return new g(function(i){i(h)})}f.resolve=e});d("promise/utils",["exports"],function(h){function g(j){return i(j)||(typeof j==="object"&&j!==null)}function i(j){return typeof j==="function"}function e(j){return Object.prototype.toString.call(j)==="[object Array]"}var f=Date.now||function(){return new Date().getTime()};h.objectOrFunction=g;h.isFunction=i;h.isArray=e;h.now=f});a("promise/polyfill").polyfill()}());(function(){var k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var w="~~local_forage_type~";var e=/^~~local_forage_type~([^~]+)~/;var n="__lfsc__:";var d=n.length;var u="arbf";var i="blob";var x="si08";var p="ui08";var h="uic8";var c="si16";var v="si32";var m="ur16";var g="ui32";var j="fl32";var b="fl64";var o=d+u.length;var f=this;function r(D,A){D=D||[];A=A||{};try{return new Blob(D,A)}catch(C){if(C.name!=="TypeError"){throw C}var B=f.BlobBuilder||f.MSBlobBuilder||f.MozBlobBuilder||f.WebKitBlobBuilder;var y=new B();for(var z=0;z<D.length;z+=1){y.append(D[z])}return y.getBlob(A.type)}}function q(C,E){var B="";if(C){B=C.toString()}if(C&&(C.toString()==="[object ArrayBuffer]"||C.buffer&&C.buffer.toString()==="[object ArrayBuffer]")){var A;var z=n;if(C instanceof ArrayBuffer){A=C;z+=u}else{A=C.buffer;if(B==="[object Int8Array]"){z+=x}else{if(B==="[object Uint8Array]"){z+=p}else{if(B==="[object Uint8ClampedArray]"){z+=h}else{if(B==="[object Int16Array]"){z+=c}else{if(B==="[object Uint16Array]"){z+=m}else{if(B==="[object Int32Array]"){z+=v}else{if(B==="[object Uint32Array]"){z+=g}else{if(B==="[object Float32Array]"){z+=j}else{if(B==="[object Float64Array]"){z+=b}else{E(new Error("Failed to get type for BinaryArray"))}}}}}}}}}}E(z+l(A))}else{if(B==="[object Blob]"){var y=new FileReader();y.onload=function(){var F=w+C.type+"~"+l(this.result);E(n+i+F)};y.readAsArrayBuffer(C)}else{try{E(JSON.stringify(C))}catch(D){console.error("Couldn't convert value into a JSON string: ",C);E(null,D)}}}}function s(C){if(C.substring(0,d)!==n){return JSON.parse(C)}var B=C.substring(o);var A=C.substring(d,o);var z;if(A===i&&e.test(B)){var D=B.match(e);z=D[1];B=B.substring(D[0].length)}var y=a(B);switch(A){case u:return y;case i:return r([y],{type:z});case x:return new Int8Array(y);case p:return new Uint8Array(y);case h:return new Uint8ClampedArray(y);case c:return new Int16Array(y);case m:return new Uint16Array(y);case v:return new Int32Array(y);case g:return new Uint32Array(y);case j:return new Float32Array(y);case b:return new Float64Array(y);default:throw new Error("Unkown type: "+A)}}function a(z){var A=z.length*0.75;var G=z.length;var F;var C=0;var D,B,y,I;if(z[z.length-1]==="="){A--;if(z[z.length-2]==="="){A--}}var E=new ArrayBuffer(A);var H=new Uint8Array(E);for(F=0;F<G;F+=4){D=k.indexOf(z[F]);B=k.indexOf(z[F+1]);y=k.indexOf(z[F+2]);I=k.indexOf(z[F+3]);H[C++]=(D<<2)|(B>>4);H[C++]=((B&15)<<4)|(y>>2);H[C++]=((y&3)<<6)|(I&63)}return E}function l(z){var y=new Uint8Array(z);var B="";var A;for(A=0;A<y.length;A+=3){B+=k[y[A]>>2];B+=k[((y[A]&3)<<4)|(y[A+1]>>4)];B+=k[((y[A+1]&15)<<2)|(y[A+2]>>6)];B+=k[y[A+2]&63]}if((y.length%3)===2){B=B.substring(0,B.length-1)+"="}else{if(y.length%3===1){B=B.substring(0,B.length-2)+"=="}}return B}var t={serialize:q,deserialize:s,stringToBuffer:a,bufferToString:l};if(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined"){module.exports=t}else{if(typeof define==="function"&&define.amd){define("localforageSerializer",function(){return t})}else{this.localforageSerializer=t}}}).call(window);(function(){var d=(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined")?require("promise"):this.Promise;var v=v||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(!v){return}var i="local-forage-detect-blob-support";var s;function p(C,z){C=C||[];z=z||{};try{return new Blob(C,z)}catch(B){if(B.name!=="TypeError"){throw B}var A=window.BlobBuilder||window.MSBlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder;var x=new A();for(var y=0;y<C.length;y+=1){x.append(C[y])}return x.getBlob(z.type)}}function t(A){var B=A.length;var y=new ArrayBuffer(B);var x=new Uint8Array(y);for(var z=0;z<B;z++){x[z]=A.charCodeAt(z)}return y}function b(x){return new d(function(z,y){var A=new XMLHttpRequest();A.open("GET",x);A.withCredentials=true;A.responseType="arraybuffer";A.onreadystatechange=function(){if(A.readyState!==4){return}if(A.status===200){return z({response:A.response,type:A.getResponseHeader("Content-Type")})}y({status:A.status,response:A.response})
};A.send()})}function r(x){return new d(function(B,A){var y=p([""],{type:"image/png"});var z=x.transaction([i],"readwrite");z.objectStore(i).put(y,"key");z.oncomplete=function(){var C=x.transaction([i],"readwrite");var D=C.objectStore(i).get("key");D.onerror=A;D.onsuccess=function(G){var F=G.target.result;var E=URL.createObjectURL(F);b(E).then(function(H){B(!!(H&&H.type==="image/png"))},function(){B(false)}).then(function(){URL.revokeObjectURL(E)})}}})["catch"](function(){return false})}function a(x){if(typeof s==="boolean"){return d.resolve(s)}return r(x).then(function(y){s=y;return s})}function e(x){return new d(function(A,z){var y=new FileReader();y.onerror=z;y.onloadend=function(C){var B=btoa(C.target.result||"");A({__local_forage_encoded_blob:true,data:B,type:x.type})};y.readAsBinaryString(x)})}function k(y){var x=t(atob(y.data));return p([x],{type:y.type})}function n(x){return x&&x.__local_forage_encoded_blob}function j(z){var y=this;var x={db:null};if(z){for(var A in z){x[A]=z[A]}}return new d(function(D,C){var B=v.open(x.name,x.version);B.onerror=function(){C(B.error)};B.onupgradeneeded=function(E){B.result.createObjectStore(x.storeName);if(E.oldVersion<=1){B.result.createObjectStore(i)}};B.onsuccess=function(){x.db=B.result;y._dbInfo=x;D()}})}function h(y,A){var x=this;if(typeof y!=="string"){window.console.warn(y+" used as a key, but it is not a string.");y=String(y)}var z=new d(function(C,B){x.ready().then(function(){var D=x._dbInfo;var E=D.db.transaction(D.storeName,"readonly").objectStore(D.storeName);var F=E.get(y);F.onsuccess=function(){var G=F.result;if(G===undefined){G=null}if(n(G)){G=k(G)}C(G)};F.onerror=function(){B(F.error)}})["catch"](B)});q(z,A);return z}function g(y,A){var x=this;var z=new d(function(C,B){x.ready().then(function(){var D=x._dbInfo;var E=D.db.transaction(D.storeName,"readonly").objectStore(D.storeName);var G=E.openCursor();var F=1;G.onsuccess=function(){var J=G.result;if(J){var I=J.value;if(n(I)){I=k(I)}var H=y(I,J.key,F++);if(H!==void (0)){C(H)}else{J["continue"]()}}else{C()}};G.onerror=function(){B(G.error)}})["catch"](B)});q(z,A);return z}function c(y,z,B){var x=this;if(typeof y!=="string"){window.console.warn(y+" used as a key, but it is not a string.");y=String(y)}var A=new d(function(E,D){var C;x.ready().then(function(){C=x._dbInfo;return a(C.db)}).then(function(F){if(!F&&z instanceof Blob){return e(z)}return z}).then(function(H){var I=C.db.transaction(C.storeName,"readwrite");var F=I.objectStore(C.storeName);if(H===null){H=undefined}var G=F.put(H,y);I.oncomplete=function(){if(H===undefined){H=null}E(H)};I.onabort=I.onerror=function(){var J=G.error?G.error:G.transaction.error;D(J)}})["catch"](D)});q(A,B);return A}function u(y,A){var x=this;if(typeof y!=="string"){window.console.warn(y+" used as a key, but it is not a string.");y=String(y)}var z=new d(function(C,B){x.ready().then(function(){var D=x._dbInfo;var G=D.db.transaction(D.storeName,"readwrite");var E=G.objectStore(D.storeName);var F=E["delete"](y);G.oncomplete=function(){C()};G.onerror=function(){B(F.error)};G.onabort=function(){var H=F.error?F.error:F.transaction.error;B(H)}})["catch"](B)});q(z,A);return z}function o(z){var x=this;var y=new d(function(B,A){x.ready().then(function(){var C=x._dbInfo;var F=C.db.transaction(C.storeName,"readwrite");var D=F.objectStore(C.storeName);var E=D.clear();F.oncomplete=function(){B()};F.onabort=F.onerror=function(){var G=E.error?E.error:E.transaction.error;A(G)}})["catch"](A)});q(y,z);return y}function f(z){var x=this;var y=new d(function(B,A){x.ready().then(function(){var C=x._dbInfo;var D=C.db.transaction(C.storeName,"readonly").objectStore(C.storeName);var E=D.count();E.onsuccess=function(){B(E.result)};E.onerror=function(){A(E.error)}})["catch"](A)});q(y,z);return y}function w(A,z){var x=this;var y=new d(function(C,B){if(A<0){C(null);return}x.ready().then(function(){var D=x._dbInfo;var E=D.db.transaction(D.storeName,"readonly").objectStore(D.storeName);var G=false;var F=E.openCursor();F.onsuccess=function(){var H=F.result;if(!H){C(null);return}if(A===0){C(H.key)}else{if(!G){G=true;H.advance(A)}else{C(H.key)}}};F.onerror=function(){B(F.error)}})["catch"](B)});q(y,z);return y}function m(z){var x=this;var y=new d(function(B,A){x.ready().then(function(){var C=x._dbInfo;var D=C.db.transaction(C.storeName,"readonly").objectStore(C.storeName);var F=D.openCursor();var E=[];F.onsuccess=function(){var G=F.result;if(!G){B(E);return}E.push(G.key);G["continue"]()};F.onerror=function(){A(F.error)}})["catch"](A)});q(y,z);return y}function q(x,y){if(y){x.then(function(z){y(null,z)},function(z){y(z)})}}var l={_driver:"asyncStorage",_initStorage:j,iterate:g,getItem:h,setItem:c,removeItem:u,clear:o,length:f,key:w,keys:m};if(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined"){module.exports=l}else{if(typeof define==="function"&&define.amd){define("asyncStorage",function(){return l})}else{this.asyncStorage=l}}}).call(window);(function(){var b=(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined")?require("promise"):this.Promise;
var h=this;var o=null;var n=null;try{if(!this.localStorage||!("setItem" in this.localStorage)){return}n=this.localStorage}catch(q){return}var f={DEFINE:1,EXPORT:2,WINDOW:3};var p=f.WINDOW;if(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined"){p=f.EXPORT}else{if(typeof define==="function"&&define.amd){p=f.DEFINE}}function j(u){var t=this;var e={};if(u){for(var v in u){e[v]=u[v]}}e.keyPrefix=e.name+"/";t._dbInfo=e;var w=new b(function(x){if(p===f.DEFINE){require(["localforageSerializer"],x)}else{if(p===f.EXPORT){x(require("./../utils/serializer"))}else{x(h.localforageSerializer)}}});return w.then(function(x){o=x;return b.resolve()})}function l(u){var e=this;var t=e.ready().then(function(){var x=e._dbInfo.keyPrefix;for(var w=n.length-1;w>=0;w--){var v=n.key(w);if(v.indexOf(x)===0){n.removeItem(v)}}});m(t,u);return t}function i(t,v){var e=this;if(typeof t!=="string"){window.console.warn(t+" used as a key, but it is not a string.");t=String(t)}var u=e.ready().then(function(){var x=e._dbInfo;var w=n.getItem(x.keyPrefix+t);if(w){w=o.deserialize(w)}return w});m(u,v);return u}function g(t,v){var e=this;var u=e.ready().then(function(){var A=e._dbInfo.keyPrefix;var C=A.length;var z=n.length;var y=1;for(var x=0;x<z;x++){var w=n.key(x);if(w.indexOf(A)!==0){continue}var B=n.getItem(w);if(B){B=o.deserialize(B)}B=t(B,w.substring(C),y++);if(B!==void (0)){return B}}});m(u,v);return u}function s(v,u){var e=this;var t=e.ready().then(function(){var x=e._dbInfo;var w;try{w=n.key(v)}catch(y){w=null}if(w){w=w.substring(x.keyPrefix.length)}return w});m(t,u);return t}function k(u){var e=this;var t=e.ready().then(function(){var v=e._dbInfo;var y=n.length;var x=[];for(var w=0;w<y;w++){if(n.key(w).indexOf(v.keyPrefix)===0){x.push(n.key(w).substring(v.keyPrefix.length))}}return x});m(t,u);return t}function d(u){var e=this;var t=e.keys().then(function(v){return v.length});m(t,u);return t}function r(t,v){var e=this;if(typeof t!=="string"){window.console.warn(t+" used as a key, but it is not a string.");t=String(t)}var u=e.ready().then(function(){var w=e._dbInfo;n.removeItem(w.keyPrefix+t)});m(u,v);return u}function a(t,u,w){var e=this;if(typeof t!=="string"){window.console.warn(t+" used as a key, but it is not a string.");t=String(t)}var v=e.ready().then(function(){if(u===undefined){u=null}var x=u;return new b(function(z,y){o.serialize(u,function(C,B){if(B){y(B)}else{try{var A=e._dbInfo;n.setItem(A.keyPrefix+t,C);z(x)}catch(D){if(D.name==="QuotaExceededError"||D.name==="NS_ERROR_DOM_QUOTA_REACHED"){y(D)}y(D)}}})})});m(v,w);return v}function m(e,t){if(t){e.then(function(u){t(null,u)},function(u){t(u)})}}var c={_driver:"localStorageWrapper",_initStorage:j,iterate:g,getItem:i,setItem:a,removeItem:r,clear:l,length:d,key:s,keys:k};if(p===f.EXPORT){module.exports=c}else{if(p===f.DEFINE){define("localStorageWrapper",function(){return c})}else{this.localStorageWrapper=c}}}).call(window);(function(){var j=(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined")?require("promise"):this.Promise;var g=this;var l=null;var i=this.openDatabase;if(!i){return}var h={DEFINE:1,EXPORT:2,WINDOW:3};var k=h.WINDOW;if(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined"){k=h.EXPORT}else{if(typeof define==="function"&&define.amd){k=h.DEFINE}}function f(t){var s=this;var r={db:null};if(t){for(var u in t){r[u]=typeof(t[u])!=="string"?t[u].toString():t[u]}}var w=new j(function(x){if(k===h.DEFINE){require(["localforageSerializer"],x)}else{if(k===h.EXPORT){x(require("./../utils/serializer"))}else{x(g.localforageSerializer)}}});var v=new j(function(y,x){try{r.db=i(r.name,String(r.version),r.description,r.size)}catch(z){return s.setDriver(s.LOCALSTORAGE).then(function(){return s._initStorage(t)}).then(y)["catch"](x)}r.db.transaction(function(A){A.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){s._dbInfo=r;y()},function(C,B){x(B)})})});return w.then(function(x){l=x;return v})}function p(s,u){var r=this;if(typeof s!=="string"){window.console.warn(s+" used as a key, but it is not a string.");s=String(s)}var t=new j(function(w,v){r.ready().then(function(){var x=r._dbInfo;x.db.transaction(function(y){y.executeSql("SELECT * FROM "+x.storeName+" WHERE key = ? LIMIT 1",[s],function(B,A){var z=A.rows.length?A.rows.item(0).value:null;if(z){z=l.deserialize(z)}w(z)},function(A,z){v(z)})})})["catch"](v)});e(t,u);return t}function b(s,u){var r=this;var t=new j(function(w,v){r.ready().then(function(){var x=r._dbInfo;x.db.transaction(function(y){y.executeSql("SELECT * FROM "+x.storeName,[],function(C,B){var F=B.rows;var E=F.length;for(var A=0;A<E;A++){var D=F.item(A);var z=D.value;if(z){z=l.deserialize(z)}z=s(z,D.key,A+1);if(z!==void (0)){w(z);return}}w()},function(A,z){v(z)})})})["catch"](v)});e(t,u);return t}function d(s,t,v){var r=this;if(typeof s!=="string"){window.console.warn(s+" used as a key, but it is not a string.");s=String(s)}var u=new j(function(x,w){r.ready().then(function(){if(t===undefined){t=null
}var y=t;l.serialize(t,function(B,A){if(A){w(A)}else{var z=r._dbInfo;z.db.transaction(function(C){C.executeSql("INSERT OR REPLACE INTO "+z.storeName+" (key, value) VALUES (?, ?)",[s,B],function(){x(y)},function(E,D){w(D)})},function(C){if(C.code===C.QUOTA_ERR){w(C)}})}})})["catch"](w)});e(u,v);return u}function n(s,u){var r=this;if(typeof s!=="string"){window.console.warn(s+" used as a key, but it is not a string.");s=String(s)}var t=new j(function(w,v){r.ready().then(function(){var x=r._dbInfo;x.db.transaction(function(y){y.executeSql("DELETE FROM "+x.storeName+" WHERE key = ?",[s],function(){w()},function(A,z){v(z)})})})["catch"](v)});e(t,u);return t}function c(t){var r=this;var s=new j(function(v,u){r.ready().then(function(){var w=r._dbInfo;w.db.transaction(function(x){x.executeSql("DELETE FROM "+w.storeName,[],function(){v()},function(z,y){u(y)})})})["catch"](u)});e(s,t);return s}function a(t){var r=this;var s=new j(function(v,u){r.ready().then(function(){var w=r._dbInfo;w.db.transaction(function(x){x.executeSql("SELECT COUNT(key) as c FROM "+w.storeName,[],function(A,z){var y=z.rows.item(0).c;v(y)},function(z,y){u(y)})})})["catch"](u)});e(s,t);return s}function m(u,t){var r=this;var s=new j(function(w,v){r.ready().then(function(){var x=r._dbInfo;x.db.transaction(function(y){y.executeSql("SELECT key FROM "+x.storeName+" WHERE id = ? LIMIT 1",[u+1],function(B,A){var z=A.rows.length?A.rows.item(0).key:null;w(z)},function(A,z){v(z)})})})["catch"](v)});e(s,t);return s}function o(t){var r=this;var s=new j(function(v,u){r.ready().then(function(){var w=r._dbInfo;w.db.transaction(function(x){x.executeSql("SELECT key FROM "+w.storeName,[],function(A,z){var B=[];for(var y=0;y<z.rows.length;y++){B.push(z.rows.item(y).key)}v(B)},function(z,y){u(y)})})})["catch"](u)});e(s,t);return s}function e(r,s){if(s){r.then(function(t){s(null,t)},function(t){s(t)})}}var q={_driver:"webSQLStorage",_initStorage:f,iterate:b,getItem:p,setItem:d,removeItem:n,clear:c,length:a,key:m,keys:o};if(k===h.DEFINE){define("webSQLStorage",function(){return q})}else{if(k===h.EXPORT){module.exports=q}else{this.webSQLStorage=q}}}).call(window);(function(){var n=(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined")?require("promise"):this.Promise;var d={};var j={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"};var h=[j.WEBSQL,j.INDEXEDDB,j.LOCALSTORAGE];var e=["clear","getItem","iterate","key","keys","length","removeItem","setItem"];var i={DEFINE:1,EXPORT:2,WINDOW:3};var a={description:"",driver:h.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};var o=i.WINDOW;if(typeof module!=="undefined"&&module.exports&&typeof require!=="undefined"){o=i.EXPORT}else{if(typeof define==="function"&&define.amd){o=i.DEFINE}}var m=(function(s){var r=r||s.indexedDB||s.webkitIndexedDB||s.mozIndexedDB||s.OIndexedDB||s.msIndexedDB;var q={};q[j.WEBSQL]=!!s.openDatabase;q[j.INDEXEDDB]=!!(function(){if(typeof s.openDatabase!=="undefined"&&s.navigator&&s.navigator.userAgent&&/Safari/.test(s.navigator.userAgent)&&!/Chrome/.test(s.navigator.userAgent)){return false}try{return r&&typeof r.open==="function"&&typeof s.IDBKeyRange!=="undefined"}catch(t){return false}})();q[j.LOCALSTORAGE]=!!(function(){try{return(s.localStorage&&("setItem" in s.localStorage)&&(s.localStorage.setItem))}catch(t){return false}})();return q})(this);var f=Array.isArray||function(q){return Object.prototype.toString.call(q)==="[object Array]"};function p(q,r){q[r]=function(){var s=arguments;return q.ready().then(function(){return q[r].apply(q,s)})}}function k(){for(var s=1;s<arguments.length;s++){var q=arguments[s];if(q){for(var r in q){if(q.hasOwnProperty(r)){if(f(q[r])){arguments[0][r]=q[r].slice()}else{arguments[0][r]=q[r]}}}}}return arguments[0]}function c(q){for(var r in j){if(j.hasOwnProperty(r)&&j[r]===q){return true}}return false}var g=this;function l(q){this._config=k({},a,q);this._driverSet=null;this._ready=false;this._dbInfo=null;for(var r=0;r<e.length;r++){p(this,e[r])}this.setDriver(this._config.driver)}l.prototype.INDEXEDDB=j.INDEXEDDB;l.prototype.LOCALSTORAGE=j.LOCALSTORAGE;l.prototype.WEBSQL=j.WEBSQL;l.prototype.config=function(q){if(typeof(q)==="object"){if(this._ready){return new Error("Can't call config() after localforage has been used.")}for(var r in q){if(r==="storeName"){q[r]=q[r].replace(/\W/g,"_")}this._config[r]=q[r]}if("driver" in q&&q.driver){this.setDriver(this._config.driver)}return true}else{if(typeof(q)==="string"){return this._config[q]}else{return this._config}}};l.prototype.defineDriver=function(r,t,q){var s=new n(function(C,D){try{var v=r._driver;var u=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");var w=new Error("Custom driver name already in use: "+r._driver);if(!r._driver){D(u);return}if(c(r._driver)){D(w);return}var B=e.concat("_initStorage");for(var z=0;z<B.length;z++){var x=B[z];if(!x||!r[x]||typeof r[x]!=="function"){D(u);return
}}var y=n.resolve(true);if("_support" in r){if(r._support&&typeof r._support==="function"){y=r._support()}else{y=n.resolve(!!r._support)}}y.then(function(E){m[v]=E;d[v]=r;C()},D)}catch(A){D(A)}});s.then(t,q);return s};l.prototype.driver=function(){return this._driver||null};l.prototype.ready=function(s){var q=this;var r=new n(function(u,t){q._driverSet.then(function(){if(q._ready===null){q._ready=q._initStorage(q._config)}q._ready.then(u,t)})["catch"](t)});r.then(s,s);return r};l.prototype.setDriver=function(q,u,s){var r=this;if(typeof q==="string"){q=[q]}this._driverSet=new n(function(y,x){var w=r._getFirstSupportedDriver(q);var v=new Error("No available storage method found.");if(!w){r._driverSet=n.reject(v);x(v);return}r._dbInfo=null;r._ready=null;if(c(w)){var z=new n(function(A){if(o===i.DEFINE){require([w],A)}else{if(o===i.EXPORT){switch(w){case r.INDEXEDDB:A(require("./drivers/indexeddb"));break;case r.LOCALSTORAGE:A(require("./drivers/localstorage"));break;case r.WEBSQL:A(require("./drivers/websql"));break}}else{A(g[w])}}});z.then(function(A){r._extend(A);y()})}else{if(d[w]){r._extend(d[w]);y()}else{r._driverSet=n.reject(v);x(v)}}});function t(){r._config.driver=r.driver()}this._driverSet.then(t,t);this._driverSet.then(u,s);return this._driverSet};l.prototype.supports=function(q){return !!m[q]};l.prototype._extend=function(q){k(this,q)};l.prototype._getFirstSupportedDriver=function(q){if(q&&f(q)){for(var r=0;r<q.length;r++){var s=q[r];if(this.supports(s)){return s}}}return null};l.prototype.createInstance=function(q){return new l(q)};var b=new l();if(o===i.DEFINE){define("localforage",function(){return b})}else{if(o===i.EXPORT){module.exports=b}else{this.localforage=b}}}).call(window);
;/*
	Amplify Core & Store 1.1.2 Copyright 2011-2013 appendTo LLC. (http://appendto.com/team) Dual licensed under the MIT or GPL licenses. http://amplifyjs.com
*/
(function(e,t){var n=[].slice,r={},i=e.amplify={publish:function(e){if(typeof e!="string")throw new Error("You must provide a valid topic to publish.");var t=n.call(arguments,1),i,s,o,u=0,a;if(!r[e])return!0;i=r[e].slice();for(o=i.length;u<o;u++){s=i[u],a=s.callback.apply(s.context,t);if(a===!1)break}return a!==!1},subscribe:function(e,t,n,i){if(typeof e!="string")throw new Error("You must provide a valid topic to create a subscription.");arguments.length===3&&typeof n=="number"&&(i=n,n=t,t=null),arguments.length===2&&(n=t,t=null),i=i||10;var s=0,o=e.split(/\s/),u=o.length,a;for(;s<u;s++){e=o[s],a=!1,r[e]||(r[e]=[]);var f=r[e].length-1,l={callback:n,context:t,priority:i};for(;f>=0;f--)if(r[e][f].priority<=i){r[e].splice(f+1,0,l),a=!0;break}a||r[e].unshift(l)}return n},unsubscribe:function(e,t,n){if(typeof e!="string")throw new Error("You must provide a valid topic to remove a subscription.");arguments.length===2&&(n=t,t=null);if(!r[e])return;var i=r[e].length,s=0;for(;s<i;s++)r[e][s].callback===n&&(!t||r[e][s].context===t)&&(r[e].splice(s,1),s--,i--)}}})(this);(function(e,t){function i(e,i){n.addType(e,function(s,o,u){var a,f,l,c,h=o,p=(new Date).getTime();if(!s){h={},c=[],l=0;try{s=i.length;while(s=i.key(l++))r.test(s)&&(f=JSON.parse(i.getItem(s)),f.expires&&f.expires<=p?c.push(s):h[s.replace(r,"")]=f.data);while(s=c.pop())i.removeItem(s)}catch(d){}return h}s="__er_"+s;if(o===t){a=i.getItem(s),f=a?JSON.parse(a):{expires:-1};if(!(f.expires&&f.expires<=p))return f.data;i.removeItem(s)}else if(o===null)i.removeItem(s);else{f=JSON.stringify({data:o,expires:u.expires?p+u.expires:null});try{i.setItem(s,f)}catch(d){n[e]();try{i.setItem(s,f)}catch(d){throw n.error()}}}return h})}var n=e.store=function(e,t,r){var i=n.type;return r&&r.type&&r.type in n.types&&(i=r.type),n.types[i](e,t,r||{})};n.types={},n.type=null,n.addType=function(e,t){n.type||(n.type=e),n.types[e]=t,n[e]=function(t,r,i){return i=i||{},i.type=e,n(t,r,i)}},n.error=function(){return"amplify.store quota exceeded"};var r=/^__er_/;for(var s in{localStorage:1,sessionStorage:1})try{window[s].setItem("__er_","x"),window[s].removeItem("__er_"),i(s,window[s])}catch(o){}if(!n.types.localStorage&&window.globalStorage)try{i("globalStorage",window.globalStorage[window.location.hostname]),n.type==="sessionStorage"&&(n.type="globalStorage")}catch(o){}(function(){if(n.types.localStorage)return;var e=document.createElement("div"),r="amplify";e.style.display="none",document.getElementsByTagName("head")[0].appendChild(e);try{e.addBehavior("#default#userdata"),e.load(r)}catch(i){e.parentNode.removeChild(e);return}n.addType("userData",function(i,s,o){e.load(r);var u,a,f,l,c,h=s,p=(new Date).getTime();if(!i){h={},c=[],l=0;while(u=e.XMLDocument.documentElement.attributes[l++])a=JSON.parse(u.value),a.expires&&a.expires<=p?c.push(u.name):h[u.name]=a.data;while(i=c.pop())e.removeAttribute(i);return e.save(r),h}i=i.replace(/[^\-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-"),i=i.replace(/^-/,"_-");if(s===t){u=e.getAttribute(i),a=u?JSON.parse(u):{expires:-1};if(!(a.expires&&a.expires<=p))return a.data;e.removeAttribute(i)}else s===null?e.removeAttribute(i):(f=e.getAttribute(i),a=JSON.stringify({data:s,expires:o.expires?p+o.expires:null}),e.setAttribute(i,a));try{e.save(r)}catch(d){f===null?e.removeAttribute(i):e.setAttribute(i,f),n.userData();try{e.setAttribute(i,a),e.save(r)}catch(d){throw f===null?e.removeAttribute(i):e.setAttribute(i,f),n.error()}}return h})})(),function(){function i(e){return e===t?t:JSON.parse(JSON.stringify(e))}var e={},r={};n.addType("memory",function(n,s,o){return n?s===t?i(e[n]):(r[n]&&(clearTimeout(r[n]),delete r[n]),s===null?(delete e[n],null):(e[n]=s,o.expires&&(r[n]=setTimeout(function(){delete e[n],delete r[n]},o.expires)),s)):i(e)})}()})(this.amplify=this.amplify||{});
;var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},i={compressToBase64:function(o){if(null==o)return"";var r=i._compress(o,6,function(o){return n.charAt(o)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(r){return null==r?"":""==r?null:i._decompress(r.length,32,function(e){return o(n,r.charAt(e))})},compressToUTF16:function(o){return null==o?"":i._compress(o,15,function(o){return r(o+32)})+" "},decompressFromUTF16:function(o){return null==o?"":""==o?null:i._decompress(o.length,16384,function(r){return o.charCodeAt(r)-32})},compressToUint8Array:function(o){for(var r=i.compress(o),n=new Uint8Array(2*r.length),e=0,t=r.length;t>e;e++){var s=r.charCodeAt(e);n[2*e]=s>>>8,n[2*e+1]=s%256}return n},decompressFromUint8Array:function(o){if(null===o||void 0===o)return i.decompress(o);for(var n=new Array(o.length/2),e=0,t=n.length;t>e;e++)n[e]=256*o[2*e]+o[2*e+1];var s=[];return n.forEach(function(o){s.push(r(o))}),i.decompress(s.join(""))},compressToEncodedURIComponent:function(o){return null==o?"":i._compress(o,6,function(o){return e.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?"":""==r?null:(r=r.replace(/ /g,"+"),i._decompress(r.length,32,function(n){return o(e,r.charAt(n))}))},compress:function(o){return i._compress(o,16,function(o){return r(o)})},_compress:function(o,r,n){if(null==o)return"";var e,t,i,s={},p={},u="",c="",a="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),c=a+u,Object.prototype.hasOwnProperty.call(s,c))a=c;else{if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++),s[c]=f++,a=String(u)}if(""!==a){if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++)}for(t=2,e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;for(;;){if(m<<=1,v==r-1){d.push(n(m));break}v++}return d.join("")},decompress:function(o){return null==o?"":""==o?null:i._decompress(o.length,32768,function(r){return o.charCodeAt(r)})},_decompress:function(o,n,e){var t,i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v="",w=[],A={val:e(0),position:n,index:1};for(i=0;3>i;i+=1)f[i]=i;for(p=0,c=Math.pow(2,2),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(t=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 2:return""}for(f[3]=l,s=l,w.push(l);;){if(A.index>o)return"";for(p=0,c=Math.pow(2,m),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(l=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 2:return w.join("")}if(0==h&&(h=Math.pow(2,m),m++),f[l])v=f[l];else{if(l!==d)return null;v=s+s.charAt(0)}w.push(v),f[d++]=s+v.charAt(0),h--,s=v,0==h&&(h=Math.pow(2,m),m++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);

;(function(a){if(typeof module==="object"&&typeof module.exports==="object"){a(require("jquery"),window,document)}else{a(jQuery,window,document)}}(function(c,b,a){c.fn.highlightText=function(){var g,h,e,d=c.type(arguments[0]),f=c.fn.highlightText.defaultTagName;if(d==="regexp"){g=arguments[0]}else{if(d==="array"){e=arguments[0].join("|")}else{if(d==="string"){e=arguments[0]}else{return}}}d=c.type(arguments[1]);if(d==="string"){h=arguments[1]}else{if(d==="boolean"){h="highlight";if(e){e="\\b"+e+"\\b"}}else{h="highlight"}}if(arguments[2]&&e){e=e="\\b"+e+"\\b"}if(!g){g=new RegExp("("+escapeRegExp(e)+")","ig")}return this.each(function(){c(this).find("*").andSelf().contents().filter(function(){return this.nodeType===3&&c(this).closest("."+h).length===0}).each(function(){var i;i=this.nodeValue.replace(g,"<"+f+" class='"+h+"'>$1</"+f+">");if(i!==this.nodeValue){c(this).wrap("<p></p>").parent().html(i).contents().unwrap()}})})};c.fn.highlightText.defaultTagName="span"}));$.fn.findText=function(e){var a=e.query,d=e.ignorecase;wrapper=$(this);var c=wrapper.html();selection_class_name=e.style;c=c.replace(/[\n|\t]+/,"");c=c.replace(/\s+/," ");a.forEach(function(g){var f=makeRegexp(g);c=c.replace(f,function(h){return(emulateSelection(h))})});wrapper.html(c);var b=wrapper.find("[search=er_character_name_found]");return(b)};function makeRegexp(b){var c="( )?(<(/)?span[^>]*>)*( )?";var a=b.replace(/\s/,c);a=new RegExp(c+a+c);return(a)}function emulateSelection(a){a=a.replace(/(?!=>)[^><]+(?=<)/g,function(b){return(wrapWords(b))});a=a.replace(/^[^><]+/,function(b){return(wrapWords(b))});a=a.replace(/[^><]+$/,function(b){return(wrapWords(b))});a=a.replace(/^[^><]+$/,function(b){return(wrapWords(b))});return(a)}function wrapWords(b){var c='<span search="er_character_name_found">',a="</span>";return(c+b+a)};
;/*!
	jquery.autoellipsis - Copyright (c) 2011 Peter van der Spek
	MIT License - http://pvdspek.github.io/jquery.autoellipsis/
 */(function(a){function m(){if(!d){d=!0;for(var c in b)a(c).each(function(){var d,e;d=a(this),e=d.data("jqae"),(e.containerWidth!=d.width()||e.containerHeight!=d.height())&&f(d,b[c])});d=!1}}function l(a){b[a]&&(delete b[a],b.length||c&&(window.clearInterval(c),c=undefined))}function k(a,d){b[a]=d,c||(c=window.setInterval(function(){m()},200))}function j(){return this.nodeType===3}function i(b){if(b.contents().length){var c=b.contents(),d=c.eq(c.length-1);if(d.filter(j).length){var e=d.get(0).nodeValue;e=a.trim(e);if(e==""){d.remove();return!0}return!1}while(i(d));if(d.contents().length)return!1;d.remove();return!0}return!1}function h(a){if(a.contents().length){var b=a.contents(),c=b.eq(b.length-1);return c.filter(j).length?c:h(c)}a.append("");var b=a.contents();return b.eq(b.length-1)}function g(b){var c=h(b);if(c.length){var d=c.get(0).nodeValue,e=d.lastIndexOf(" ");e>-1?(d=a.trim(d.substring(0,e)),c.get(0).nodeValue=d):c.get(0).nodeValue="";return!0}return!1}function f(b,c){var d=b.data("jqae");d||(d={});var e=d.wrapperElement;e||(e=b.wrapInner("<div/>").find(">div"),e.css({margin:0,padding:0,border:0}));var f=e.data("jqae");f||(f={});var j=f.originalContent;j?e=f.originalContent.clone(!0).data("jqae",{originalContent:j}).replaceAll(e):e.data("jqae",{originalContent:e.clone(!0)}),b.data("jqae",{wrapperElement:e,containerWidth:b.width(),containerHeight:b.height()});var k=b.height(),l=(parseInt(b.css("padding-top"),10)||0)+(parseInt(b.css("border-top-width"),10)||0)-(e.offset().top-b.offset().top),m=!1,n=e;c.selector&&(n=a(e.find(c.selector).get().reverse())),n.each(function(){var b=a(this),d=b.text(),f=!1;if(e.innerHeight()-b.innerHeight()>k+l)b.remove();else{i(b);if(b.contents().length){m&&(h(b).get(0).nodeValue+=c.ellipsis,m=!1);while(e.innerHeight()>k+l){f=g(b);if(!f){m=!0,b.remove();break}i(b);if(b.contents().length)h(b).get(0).nodeValue+=c.ellipsis;else{m=!0,b.remove();break}}c.setTitle=="onEllipsis"&&f||c.setTitle=="always"?b.attr("title",d):c.setTitle!="never"&&b.removeAttr("title")}}})}var b={},c,d=!1,e={ellipsis:"â€¦",setTitle:"never",live:!1};a.fn.ellipsis=function(b,c){var d,g;d=a(this),typeof b!="string"&&(c=b,b=undefined),g=a.extend({},e,c),g.selector=b,d.each(function(){var b=a(this);f(b,g)}),g.live?k(d.selector,g):l(d.selector);return this}})(jQuery)
;function checkForInserts(b){var a=b.match(/<!--\[INSERT_CSS_FILE=["\']?([^"\']*)["\']\]-->/g);if(a){$.each(a,function(d,e){var c=e.match(/<!--\[INSERT_CSS_FILE=["\']?([^"\']*)["\']\]-->/);var f=bookData.getFile(c[1]);if(typeof f!="undefined"&&typeof f.source!="undefined"){f.source=f.source.replace("&","&amp;");b=b.replace(e,'<style type="text/css">/*<![CDATA[*/\r\n'+f.source+"\r\n/*]]>*/</style>")}})}return b}function createComponentObj(a,c,b){var d=new Object();d.html=xmlToString($.parseXML(c));d.source=c;d.componentId=a;if(typeof b==="function"){b(d)}else{return d}}var user_access;var readerBookType;var monocleInstantiated=false;var readerFontSize=1;var readerFontSizeMinimum=0.5;var readerFontSizeMaximum=2.5;var content_iframe_class="monelem_component";var content_iframe;var content_iframe_id;var lastComponentId=[];var placeSaver;var savedPlace;var delayedRestorePlace=false;var savePlaceTimeout;var componentHighlights;var only_load_book_data=null;var arrowsHidden=false;var swipeIgnore=false;pageFuncs.book_read={};pageFuncs.book_read["resized"]=function(){resizeReader()};function user_has_access(){if(user_access==1||user_access>unixTimestamp()){return true}else{return false}}function book_init(a){user_access=0;readerBookType=null;monocleInstantiated=false;readerFontSize=1;content_iframe=null;content_iframe_id=null;lastComponentId=[];placeSaver=null;savedPlace=null;delayedRestorePlace=false;savePlaceTimeout=null;arrowsHidden=false;componentHighlights={};book_data_loaded_called=false;only_load_book_data=false;a=Math.floor(a);var b=a+"_book_data";$.ajax({type:"GET",url:"js/book_data_"+a+".js",dataType:"script",timeout:3500}).done(function(c){setOnline(true);data_put(b,c)}).fail(function(){setOnline(false);if(isBookStored(a)){$.globalEval(data_get(b))}else{changeHash("view=user_books")}}).always(function(){readerBookType=bookData.getMetaData("_er_format");setTimeout(function(){if(!book_data_loaded_called){book_data_loaded()}},1000)})}var book_data_loaded_called=null;function book_data_loaded(){book_data_loaded_called=true;if(isBookStored(book_id)&&!localforage_LocalStorage){localforage.iterate(function(c,b,a){if((b.substring(0,(book_id.toString().length)+11)==book_id+"_component_")||(b.substring(0,(book_id.toString().length)+6)==book_id+"_file_")){data_put(b,c)}}).then(function(){load_book_user_data()})}else{load_book_user_data()}}function load_book_user_data(){$.ajax({type:"GET",url:"js/book_user_data_"+book_id+".js",dataType:"script",timeout:3500}).done(function(a){setOnline(true);data_put(book_id+"_user_access",user_access)}).fail(function(){setOnline(false);user_access=data_get(book_id+"_user_access");create_book_page()})}function book_not_available(){changeHash("view=user_books");notify(display_message.book_not_available)}function book_user_data_loaded(){if(smallscreen&&typeof data_get("book_read_info_reveal_menu")=="undefined"){data_put("book_read_info_reveal_menu",1);notify('<img src="images/icon-drag-down.png" title="" alt="" style="float:right;max-height:150px;">'+display_message.book_read_info_reveal_menu,true)}if(user_has_access()&&typeof data_get("book_read_info_downloading")=="undefined"){data_put("book_read_info_downloading",1);notify('<span class="help_icon"><i class="icon-save-to-device"></i></span>'+display_message.offline_access_info,true)}create_book_page()}function create_book_page(){var b={};b.view="book_read";b.content=$(data_get("template_book_read"));var h=bookData.getMetaData("_er_title_in_database").trim();b.content.find("#book_title").html(h);var k=bookData.getAuthors();var i=b.content.find("#authors").html();var f="";if(k.length){for(var l in k){f+=i.replace("[[author_name]]",k[l].author_name).replace("[[author_id]]",k[l].author_id);if(l<(k.length-1)){f+=", "}}}b.content.find("#authors").html(f);if(readerBookType=="epub"){var j=bookData.getContents();var o=b.content.find("#toc_container #toc").html();var n="";var a=false;for(var l in j){if(j[l].title.length&&j[l].componentId.length){var e=(a)?"even":"odd";n+=o.replace("[[title]]",j[l].title).replace("[[componentId]]",j[l].componentId).replace("[[odd_even]]",e);a=!a}}b.content.find("#toc_container #toc").html(n);var d=bookData.getCharacters();var g=b.content.find("#characters_container #characters_list").html();var m="";var a=false;m+='<a class="no_ajaxify even embolden" id="character_autohighlights_remove" onclick="charactersEntryClicked(null); return false;">'+display_message.remove_current_auto_highlights+"</a>";for(var l in d){if(d[l].name.length&&d[l].lines){var e=(a)?"even":"odd";m+=g.replace("[[name]]",d[l].name).replace("[[token]]",d[l].token).replace("[[lines]]",d[l].lines).replace("[[odd_even]]",e);a=!a}}b.content.find("#characters_container #characters_list").html(m)}var c=h+" â€“ ";if(k.length){c+=k[0].author_name;if(k.length>1){c+=" "+display_message.and_others}}c+=" | "+sitename;b.pagetitle=c;b.content=$(b.content).html();displayPage(b,true);resizeReader(false);init_book_content_storage();updateStorageStatus();if(!user_has_access()){$("#readerNotesButton, #readerBookmarksButton, #readerBlackoutsHideButton, #readerHighlightsHideButton").prop("disabled",true).prop("title",display_message.buy_or_rent_book_to_use);
if(isBookStored()){book_remove(true);data_del(book_id+"_user_access");data_put(book_id+"_auto_removed",true)}if(data_get(book_id+"_auto_removed")==true){data_del(book_id+"_auto_removed",true);notify(display_message.book_auto_expired,true)}}else{if(data_get(book_id+"_auto_removed")==true){data_del(book_id+"_auto_removed",true);jqConfirm(display_message.book_auto_expired_new_access,function(){book_store()})}}if(readerBookType=="epub"){create_reader()}else{if(readerBookType=="imgs"){create_fixed_format_reader()}}}function create_reader(){if(user_has_access()&&typeof(highlights_data)!="undefined"){var d=bookData.getComponents();for(componentId in d){if(highlights_data[(d[componentId])]!==undefined){var b=highlights_data[d[componentId]+"_highlights_timestamp"];var e=parseInt(data_get(book_id+"_selection_"+d[componentId]+"_highlights_timestamp"),10);if(isNaN(e)||e<=b){data_put(book_id+"_selection_"+d[componentId],highlights_data[d[componentId]]);data_put(book_id+"_selection_"+d[componentId]+"_highlights_timestamp",highlights_data[d[componentId]+"_highlights_timestamp"])}else{if(e>b){var c=data_get(book_id+"_selection_"+d[componentId]);var a={book_id:book_id,componentId:d[componentId],highlights_string:c,highlights_timestamp:(e*1000)};$.post("book_read_save_highlights_string.php",a,"json")}}}}}else{}setTimeout(function(){var f=null;placeSaver=new Monocle.Controls.PlaceSaver(book_id);savedPlace=placeSaver.savedPlace();if(typeof restore_data=="object"&&restore_data!=null){if(savedPlace==null||restore_data.location_timestamp>=savedPlace.timestamp){savedPlace=restore_data}}if(typeof savedPlace=="object"&&savedPlace!=null){if(savedPlace.readerFontSize<readerFontSizeMinimum||isNaN(savedPlace.readerFontSize)){savedPlace.readerFontSize=1}if(savedPlace.readerFontSize==1){f=savedPlace}else{delayedRestorePlace=true;$("#reader").stop(true).fadeTo(0,0.01)}}monocleInstantiated=false;window.reader=Monocle.Reader("reader",bookData,{panels:Monocle.Panels.Marginal,flipper:Monocle.Flippers.Scroller,place:f},function(h){if(monocleInstantiated==false){monocleInstantiated=true;h.addControl(placeSaver,"invisible");window.spinner=Monocle.Controls.Spinner(h);h.addControl(spinner,"page",{hidden:true});if(delayedRestorePlace){window.spinner.spin();$("#reader").stop(true).fadeTo(0,1);readerFontSize=savedPlace.readerFontSize;h.formatting.setFontScale(readerFontSize);var i=window.reader.getPlace().getLocus();if(savedPlace.componentId!=i.componentId){window.reader.moveTo({componentId:savedPlace.componentId,percent:savedPlace.percent},window.spinner.spun)}else{window.reader.moveTo({percent:savedPlace.percent},window.spinner.spun)}}var k=new Monocle.Controls.Scrubber(h);h.addControl(k);k.updateNeedles();$("iframe."+content_iframe_class).each(function(m){var n=content_iframe_class+"_"+m;$(this).attr("id",n);$(document.getElementById(n).contentWindow.document).keydown(function(o){pageFuncs.book_read["keydown"](o)});lastComponentId[m]=this.getAttribute("data-componentid")});var g=(isFunction(h.getActiveIndex))?h.getActiveIndex():0;content_iframe_id=content_iframe_class+"_"+g;content_iframe=document.getElementById(content_iframe_id);init_range_selection_done=false;if(user_has_access()){init_range_selection();init_text_search();$(".user_has_no_access").hide()}else{$("#readerBlackoutsHideButton, #readerHighlightsHideButton, #readerNotesButton, #readerBookmarksButton, #readerSearchTextButton, #bookStorage").remove();$(".monelem_controls_scrubber_container").hide();$(".user_has_no_access").show();var j=bookData.getMetaData("_er_title_in_database").trim();var l=[];l.push(display_message.preview_of.replace("[[book_title]]",j));l.push(display_message.preview_restricted);jqNotify(l,false,display_message.preview_book,display_message.preview_begin)}init_fullscreen();init_contents_dialog();init_characters_dialog();init_notes_dialog();init_bookmarks_dialog();Monocle.Events.listen("reader","monocle:loaded",function(m){stopLoading();setSwipeOnReaderIframe()});Monocle.Events.listen("reader","monocle:turn",function(n){savePlace();var m=(isFunction(h.getActiveIndex))?h.getActiveIndex():0;content_iframe_id=content_iframe_class+"_"+m;content_iframe=document.getElementById(content_iframe_id)});h.listen("monocle:pagechange",function(m){$("iframe."+content_iframe_class).each(function(n){var o=this.getAttribute("data-componentid");if(o!=lastComponentId[n]){if(user_has_access()){init_range_selection()}characterHighlightsSet()}lastComponentId[n]=o})});h.listen("monocle:componentmodify",function(m){setSwipeOnReaderIframe()});setSwipeHandlers("#reader");if(smallscreen){topButtons(false,0);$("#main").scrollTop(readerTop())}}})},100)}function readerControlsShow(a){if(typeof a=="undefined"){a=150}if(smallscreen&&$("#reader_text_search_form").is(":hidden")){$("#main").stop(true).animate({scrollTop:0},a,function(){if(smallscreen&&typeof data_get("book_read_info_buttons")=="undefined"){data_put("book_read_info_buttons",1);notify('<a href="#view=help_page"><span class="help_icon"><i class="icon-info"></i></span></a>'+display_message.book_read_info_buttons,true)
}});topButtons(true,a);if(bookCharacterHighlight.charHighlighted!==null){$("#character_step_controls").fadeTo(a,0)}}}function readerControlsHide(a){if(typeof a=="undefined"){a=150}if(smallscreen){$("#main").stop(true).animate({scrollTop:readerTop()},a);topButtons(false,a);if(bookCharacterHighlight.charHighlighted!==null){$("#character_step_controls").fadeTo(a,1)}}}function savePlace(a,c){if(user_id){var e=0;if((typeof c=="undefined"||!c)&&a==undefined){e=1500}clearTimeout(savePlaceTimeout);if(readerBookType=="imgs"){var d="ff";var f=window.reader.Properties.currentPage}else{var b=window.reader.getPlace().getLocus();var d=b.componentId;var f=b.percent}savePlaceTimeout=setTimeout(function(){var h=Date.now();var g={book_id:book_id,componentId:d,percent:f,readerFontSize:readerFontSize,location_timestamp:h};if(a!==undefined){g.highlights_string=a;g.highlights_timestamp=h}$.post("book_read_save_data.php",g,"json")},e)}}function readerMoveTo(b,a){if(b=="componentId"){window.reader.moveTo({componentId:a,percent:0});searchVars.componentMatchNumber=0}else{if(b=="page"){window.reader.moveTo({page:a})}else{if(b=="component+element"){a=a.split("+");window.reader.moveTo({componentId:a[0],anchor:a[1]})}}}}pageFuncs.book_read["keydown"]=function(c){var b=c.keyCode;var a={left:37,up:38,right:39,down:40,esc:27,t:84,g:71};if(!$("input[type=text]").is(":focus")&&!$("textarea").is(":focus")){switch(b){case a.left:reader.movePrevious();break;case a.right:reader.moveNext();break;case a.up:c.preventDefault();increaseFontSize();break;case a.down:decreaseFontSize();c.preventDefault();break}}};function setFontSize(a){if(readerBookType=="epub"){a=Math.round(a*10)/10;if(a<=readerFontSizeMaximum&&a>=readerFontSizeMinimum){spinner.spin();readerFontSize=a;reader.formatting.setFontScale(readerFontSize);setTimeout(setNoteIcons,250);setTimeout(setBookmarkIcons,250);window.reader.resized();setTimeout("spinner.spun()",750)}}}function increaseFontSize(){setFontSize(readerFontSize+0.1)}function decreaseFontSize(){setFontSize(readerFontSize-0.1)}function setSwipeOnReaderIframe(){$("iframe."+content_iframe_class).each(function(b){var a=$(this).contents().find("html")[0];setSwipeHandlers(a)})}function setSwipeHandlers(a){$(a).on("swipeleft",function(){if(!swipeIgnore){reader.moveNext()}}).on("swiperight",function(){if(!swipeIgnore){reader.movePrevious()}}).on("swipeup",function(){if(!swipeIgnore){readerControlsHide()}}).on("swipedown",function(){if(!swipeIgnore){readerControlsShow()}})}function hideArrows(){if(!arrowsHidden){$(".monelem_panel, .ff_flipper").fadeTo(fadeTime,0);arrowsHidden=true}}var useGala=false;var componentHighlights={};var selectedElement;var rangy;var highlighters=[];var highlighter;var newNoteText;var sel;var blackoutDisplay=true;var highlightDisplay=true;var keepselection=false;var readerContact=0;var noteDivider="%/";var noteDividerReplacement="% /";var serializedHighlightDivider="|";var serializedHighlightDividerReplacement="!";var serializedHighlightDataDivider="`";var serializedHighlightDataDividerReplacement="'";var highlightClass="___ERhighlight";var highlightsOffClass=highlightClass+"_off";var blackoutClass="___ERblackout";var blackoutsOffClass=blackoutClass+"_off";var noteClass="___ERnote";var noteIconClass="___ERnote_icon";var bookmarkClass="___ERbookmark";var bookmarkIconClass="___ERbookmark_icon";var characterClassPrefix="_er_ch_";var characterStageDirectionClassPrefix="_er_sd_";var characterHighlightClass="___ERhighlightCharacter";var characterBlackoutClass="___ERblackoutCharacter";var characterBlackoutNameClass="___ERblackoutCharacterName";var characterStepHighlightClass="___ERstepHighlightCharacter";var init_range_selection_done=false;function getElementContainerId(a){if(a.nodeName.toUpperCase()=="BODY"){return false}else{var b=a.id;if(typeof b=="undefined"||b==""){b=getElementContainerId(a.parentNode)}return b}}function getParentElement(a,b){if(a.nodeName.toUpperCase()==b.toUpperCase()){return a}else{return getParentElement(a.parentNode,b)}}function closeTextSelectMenu(){$("#text_select_menu").dialog("close")}function storeHighlights(){var a=reader.getPlace().componentId();var b=JSON.stringify(componentHighlights);if(b=="{}"){data_del(book_id+"_selection_"+a);data_del(book_id+"_selection_"+a+"_highlights_timestamp");savePlace(null)}else{data_put(book_id+"_selection_"+a,b);data_put(book_id+"_selection_"+a+"_highlights_timestamp",Math.floor(Date.now()/1000));savePlace(b)}}function init_range_selection(c){var f=reader.getPlace().componentId();var a=data_get(book_id+"_selection_"+f);if(a){componentHighlights=JSON.parse(a)}else{componentHighlights={}}var e=[];if(typeof c=="undefined"){$("iframe."+content_iframe_class).each(function(g){e[g]=g})}else{if(typeof c=="number"){e[0]=c}}$("#text_select_menu").dialog({autoOpen:false,resizable:false,draggable:false,modal:true,appendTo:"#reader_container",position:{of:$("#reader")},close:function(g,h){if(!keepselection){}}});$(window).bind("message",function(g){if(g.originalEvent.data=="readercontactoff"){sel=rangy.getSelection(content_iframe);
$("#text_select_menu").dialog("open");$("."+content_iframe_class).contents().scrollLeft(0).scrollTop(0)}});$("#newNoteText").keydown(function(h){var g=h.keyCode||h.which;if(g==13){doAddNote();return false}});if(smallscreen){var d={my:"top",at:"top+10px",of:$("#reader")}}else{var d={of:$("#reader")}}$("#note-add-form").dialog({autoOpen:false,resizable:false,draggable:false,modal:true,appendTo:"#reader_container",position:d,open:function(){setTimeout("$('#newNoteText').focus(); keepselection=false",5)},close:function(){},buttons:{"Add note":function(){doAddNote()},Cancel:function(){$(this).dialog("close")}}});var b=$("#text_select_menu");b.empty();createButton(b,setHighlight,display_message.highlight,"setHighlightButton","","icon-highlight");createButton(b,setBlackout,display_message.blackout,"setBlackoutButton","","icon-blackout");b.append(document.createElement("br"));createButton(b,addNote,display_message.note,"addNoteButton","","icon-note");createButton(b,addBookmark,display_message.bookmark,"addBookmarkButton","","icon-bookmark");init_range_selection_done=true;setReaderEvents(e)}function setReaderEvents(a){$(a).each(function(c){var d=content_iframe_class+"_"+c;var e=document.getElementById(d);var b=$(e).contents().find("body")[0];$(b).find("p").on("mousedown touchstart",function(){$(this).on("mouseup touchend",touchParagraph)});$(e).contents().on("scroll",function(f){f.preventDefault();f.stopPropagation();$(this).scrollLeft(0).scrollTop(0)})});setTimeout(setExistingHighlights(a),50)}function setExistingHighlights(a){if(typeof a=="undefined"){var a=$("iframe."+content_iframe_class)}$(a).each(function(c){var g=content_iframe_class+"_"+c;var h=document.getElementById(g);var f=h.getAttribute("data-componentid");if(f==reader.getPlace().componentId()){var b=$(h).contents().find("body")[0];$(b).find("."+highlightClass).removeClass("."+highlightClass);for(var j in componentHighlights){for(var e in componentHighlights[j]){for(var d in componentHighlights[j][e]){$(b).find("#"+j).addClass(e).attr("data-"+(e.toSafeDataAttrName())+"-id",d)}}}setNoteIcons();setBookmarkIcons()}})}var touchedParagraph=false;function touchParagraph(a){if(justSwiped){a.preventDefault();return false}if(!touchedParagraph){touchedParagraph=true;setTimeout(function(){touchedParagraph=false},50);if(!$(this).hasClass(highlightClass)&&!$(this).hasClass(blackoutClass)&&!$(this).hasClass(noteClass)&&!$(this).hasClass(bookmarkClass)&&!$(this).find("."+highlightClass).length&&!$(this).find("."+blackoutClass).length&&!$(this).find("."+noteClass).length&&!$(this).find("."+bookmarkClass).length){a.preventDefault();selectedElement=this;if($(selectedElement).prop("id")){$("#text_select_menu").dialog("open")}}else{if(!$(".ui-dialog:visible").length){if($(this).hasClass(highlightClass)||$(this).find("."+highlightClass).length){a.preventDefault();highlightClicked(a,this)}if($(this).hasClass(blackoutClass)||$(this).find("."+blackoutClass).length){a.preventDefault();blackoutClicked(a,this)}if($(this).hasClass(noteClass)||$(this).find("."+noteClass).length){a.preventDefault();noteClicked(a,this)}if($(this).hasClass(bookmarkClass)||$(this).find("."+bookmarkClass).length){a.preventDefault();bookmarkClicked(a,this)}}}}}function highlightTypeSet(b,c){if(typeof c=="undefined"||c.length==0){c=""}var a=Date.now();var d=$(selectedElement).prop("id");if(typeof componentHighlights[d]=="undefined"){componentHighlights[d]={}}if(typeof componentHighlights[d][b]=="undefined"){componentHighlights[d][b]={}}componentHighlights[d][b][a]=c;$(selectedElement).addClass(b).attr("data-"+(b.toSafeDataAttrName())+"-id",a);storeHighlights();$("#text_select_menu").dialog("close")}function highlightTypeRemove(b){var a=$(selectedElement).attr("data-"+(b.toSafeDataAttrName())+"-id");$(selectedElement).removeAttr("data-"+(b.toSafeDataAttrName())+"-id");$(selectedElement).removeClass(b);var c=$(selectedElement).prop("id");delete componentHighlights[c][b][a];if($.isEmptyObject(componentHighlights[c][b])){delete componentHighlights[c][b]}if($.isEmptyObject(componentHighlights[c])){delete componentHighlights[c]}storeHighlights();$("#text_select_menu").dialog("close")}function highlightClicked(b,c){b.preventDefault();if(typeof c=="undefined"){c=this}selectedElement=c;if(!justSwiped){var a=display_message.highlight;$("#highlight-dialog").html("<p>"+display_message.delete_highlight_ask+"</p>");$("#highlight-dialog").dialog({resizable:false,draggable:false,modal:true,appendTo:"#reader_container",title:a,position:{of:$("#reader")},buttons:{Delete:function(){highlightTypeRemove(highlightClass);storeHighlights();$(this).dialog("close")},Close:function(){$(this).dialog("close")}}})}return false}function setHighlight(){var a={};highlightTypeSet(highlightClass,a)}function toggleHighlightDisplay(a){if(highlightDisplay){$("."+content_iframe_class).contents().find("."+highlightClass).addClass(highlightsOffClass);$("#readerHighlightsHideButton").hide();$("#readerHighlightsShowButton").show()}else{$("."+content_iframe_class).contents().find("."+highlightClass).removeClass(highlightsOffClass);
$("#readerHighlightsShowButton").hide();$("#readerHighlightsHideButton").show()}highlightDisplay=!highlightDisplay;return highlightDisplay}function blackoutClicked(b,c){b.preventDefault();if(typeof c=="undefined"){c=this}selectedElement=c;if(!justSwiped){var a=display_message.blackout;$("#highlight-dialog").html("<p>"+display_message.delete_blackout_ask+"</p>");$("#highlight-dialog").dialog({resizable:false,draggable:false,modal:true,appendTo:"#reader_container",title:a,position:{of:$("#reader")},buttons:{Delete:function(){highlightTypeRemove(blackoutClass);storeHighlights();$(this).dialog("close")},Close:function(){$(this).dialog("close")}}})}return false}function setBlackout(){var a={};highlightTypeSet(blackoutClass,a)}function toggleBlackoutDisplay(a){if(blackoutDisplay){$("."+content_iframe_class).contents().find("."+blackoutClass).addClass(blackoutsOffClass);$("#readerBlackoutsHideButton").hide();$("#readerBlackoutsShowButton").show()}else{$("."+content_iframe_class).contents().find("."+blackoutClass).removeClass(blackoutsOffClass);$("#readerBlackoutsShowButton").hide();$("#readerBlackoutsHideButton").show()}blackoutDisplay=!blackoutDisplay;return blackoutDisplay}function noteClicked(i,c){i.preventDefault();if(typeof c=="undefined"){c=this}if(!justSwiped){var f=parseInt(c.getAttribute("data-"+(noteClass.toSafeDataAttrName())+"-id"),10);var g=new Date(f);var a=display_message.note+": "+getLocaleShortDateString(g)+", "+getTime(g);var b="#note-dialog";if(typeof $(c).data("paragraphId")==="string"){var e=$(c).data("paragraphId");var d=componentHighlights[e][noteClass][f].text;var h=getParentElement(c,"body");selectedElement=$(h).find("#"+e)[0]}else{var d=componentHighlights[$(c).prop("id")][noteClass][f].text;selectedElement=c}var j={};j[display_message["delete"]]=function(){$(b).dialog("close");jqConfirm(display_message.delete_note_confirm,function(){removeNoteIcon(selectedElement);highlightTypeRemove(noteClass);storeHighlights()})};j[display_message.close]=function(){$(b).dialog("close")};$(b).html("<p>"+d.replace(/\n+/g,"</p><p>")+"</p>");$(b).dialog({resizable:false,draggable:false,modal:true,title:a,appendTo:"#reader_container",position:{of:$("#reader")},buttons:j})}return false}function addNote(){$("#note-add-form").dialog("open");$("#text_select_menu").dialog("close");$("#newNoteText").val("")}function doAddNote(){newNoteText=document.getElementById("newNoteText");if(newNoteText.value.length){newNoteText=newNoteText.value;newNoteText=replaceAll(newNoteText,serializedHighlightDataDivider,serializedHighlightDataDividerReplacement);var b=Date.now();var a={};a.text=newNoteText;highlightTypeSet(noteClass,a);createNoteIcon(selectedElement);$("#note-add-form").dialog("close")}}function setNoteIcons(){var a=$(content_iframe).contents().find("body")[0];var b=$(a).find("."+noteClass);if(b.length){$(a).find("."+noteIconClass).remove();b.each(function(c){createNoteIcon(this)})}}function createNoteIcon(f){var k=getParentElement(f,"body");var g=parseInt(f.getAttribute("data-"+(noteClass.toSafeDataAttrName())+"-id"),10);var a=noteIconClass+"_"+g;if(!$(k).find("#"+a).length){var d=$(f).prop("id");var l=$('<a class="'+noteIconClass+'" data-paragraph-id="'+d+'" data-'+(noteClass.toSafeDataAttrName())+'-id="'+g+'" id="'+a+'" style="display:none"><img src="images/icon-note-established.png" title="" alt="" style="width: 18px"></a>');var c=getParentElement(f,"p");var h="n"+Date.now();$(c).prepend('<span id="'+h+'"></span>');var j=$(c).find("#"+h).position();var b=j.left-25;var i=j.top;$(c).remove("#"+h);$(k).append(l);l.css({position:"absolute",left:b+"px",top:i+"px","z-index":"999"}).show();l.on("mouseup touchend",function(m){noteClicked(m,this)})}}function removeNoteIcon(d){if(typeof d=="undefined"){d=selectedElement}var a=getParentElement(d,"body");var b=parseInt(d.getAttribute("data-"+(noteClass.toSafeDataAttrName())+"-id"),10);var c=noteIconClass+"_"+b;$(a).find("#"+c).remove()}function bookmarkClicked(c,e){c.preventDefault();if(typeof e=="undefined"){e=this}if(!justSwiped){var f=parseInt(e.getAttribute("data-"+(bookmarkClass.toSafeDataAttrName())+"-id"),10);var d=new Date(f);var b=display_message.bookmark+": "+getLocaleShortDateString(d)+", "+d.toLocaleTimeString();if(typeof $(e).data("paragraphId")==="string"){var g=$(e).data("paragraphId");var a=getParentElement(e,"body");selectedElement=$(a).find("#"+g)[0]}else{selectedElement=e}$("#bookmark-dialog").html("<p>"+display_message.delete_bookmark_ask+"</p>");$("#bookmark-dialog").dialog({resizable:false,draggable:false,modal:true,appendTo:"#reader_container",title:b,position:{of:$("#reader")},buttons:{Delete:function(){removeBookmarkIcon(selectedElement);highlightTypeRemove(bookmarkClass);storeHighlights();$("#bookmark-dialog").dialog("close")},Close:function(){$(this).dialog("close")}}})}return false}function addBookmark(){var a=$(selectedElement).text().substr(0,37).trim()+"â€¦";$("#text_select_menu").dialog("close");a=replaceAll(a,serializedHighlightDataDivider,serializedHighlightDataDividerReplacement);
var c=Date.now();var b={};b.text=a;highlightTypeSet(bookmarkClass,b);createBookmarkIcon(selectedElement);storeHighlights()}function setBookmarkIcons(){var a=$(content_iframe).contents().find("body")[0];var b=$(a).find("."+bookmarkClass);if(b.length){$(a).find("."+bookmarkIconClass).remove();b.each(function(c){createBookmarkIcon(this)})}}function createBookmarkIcon(g){var l=getParentElement(g,"body");var h=parseInt(g.getAttribute("data-"+(bookmarkClass.toSafeDataAttrName())+"-id"),10);var c=bookmarkIconClass+"_"+h;if(!$(l).find("#"+c).length){var f=$(g).prop("id");var d=$('<a class="'+bookmarkIconClass+'" data-paragraph-id="'+f+'" data-'+(bookmarkClass.toSafeDataAttrName())+'-id="'+h+'" id="'+c+'" style="display:none"><img src="images/icon-bookmark-red.png" title="" alt="" style="width: 12px"></a>');var b=getParentElement(g,"p");var i="n"+Date.now();$(b).prepend('<span id="'+i+'"></span>');var k=$(b).find("#"+i).position();var a=k.left-25;var j=k.top;$(b).remove("#"+i);$(l).append(d);d.css({position:"absolute",left:a+"px",top:j+"px","z-index":"999"}).show();d.on("mouseup touchend",function(m){bookmarkClicked(m,this)})}}function removeBookmarkIcon(d){if(typeof d=="undefined"){d=selectedElement}var a=getParentElement(d,"body");var b=parseInt(d.getAttribute("data-"+(bookmarkClass.toSafeDataAttrName())+"-id"),10);var c=bookmarkIconClass+"_"+b;$(a).find("#"+c).remove()}var bookmarksVisible=false;function init_bookmarks_dialog(){if(user_has_access()){$("#readerBookmarksButton").prop("disabled",false).prop("title",display_message.show_bookmarks);$("#bookmarks_container").dialog({autoOpen:false,resizable:false,draggable:false,modal:true,hide:{duration:fadeTime},show:{duration:fadeTime},height:$("#reader").height()-50,appendTo:"#reader_container",position:{my:"center",at:"center",of:$("#reader")},open:function(a,b){bookmarksVisible=true;$(".ui-widget-overlay").hide().fadeIn(fadeTime);setTimeout(function(){if(smallscreen){readerControlsHide();$("#bookmarks_container").dialog("option","position",{my:"center",at:"center",of:$("#main")})}else{$("#bookmarks_container").dialog("option","position",{my:"center",at:"center",of:$("#reader")})}if($("#bookmarks_container").height()>$("#bookmarks").height()+5){$("#bookmarks_container").height($("#bookmarks").height()+5)}},0)},close:function(){bookmarksVisible=false;$("#reader").fadeTo(0,0.99).fadeTo(0,1)}})}}function toggleBookmarks(){$("#readerBookmarksButton").blur();if(bookmarksVisible){$("#bookmarks_container").dialog("close")}else{var d=getBookmarks();if(typeof d=="object"&&d.length){var g=$(data_get("template_book_read")).find("#bookmarks_container #bookmarks").html();var a="";var e=false;for(var b in d){if(d[b].length){for(var c in d[b]){var f=(e)?"even":"odd";a+=g.replace("[[bookmark]]",d[b][c].bookmarkText).replace("[[componentId]]",b).replace("[[containerElementId]]",d[b][c].containerElementId).replace("[[odd_even]]",f);e=!e}}}$("#bookmarks_container #bookmarks").html(a);$("#bookmarks_container").dialog("option","maxHeight",$("#reader").height()-50);$("#bookmarks_container").dialog("open")}else{notify(display_message.no_bookmarks,true)}}}function bookmarksEntryClicked(a,b){if(readerBookType=="imgs"){window.reader.goToPage(b,0);$("#bookmarks_container").dialog("close")}else{window.spinner.spin();readerMoveTo("component+element",a+"+"+b);$("#bookmarks_container").dialog("close");setTimeout("window.spinner.spun()",500)}}function sortChapterBookmarksByPosition(d,c){d=parseInt(d.containerElementId.replace("_er_",""),10);c=parseInt(c.containerElementId.replace("_er_",""),10);if(d<c){return -1}if(d>c){return 1}return 0}function getBookmarks(){var c={};c.length=0;if(readerBookType=="imgs"){c.ff=[];for(var f=1;f<=window.reader.Properties.pages;f++){if(typeof componentHighlights[f]!="undefined"){c.ff[f]={};c.ff[f]["bookmarkText"]="Page "+f+": "+componentHighlights[f].text;c.ff[f]["containerElementId"]=f;c.length++}}}else{var e=bookData.getComponents();for(var b in e){var d=data_get(book_id+"_selection_"+e[b]);if(typeof d!=="undefined"){var a=deserializeChapterBookmarks(d);if(a.length){a.sort(sortChapterBookmarksByPosition);c[e[b]]=a;c.length++}}}}if(c.length){return c}return false}function deserializeChapterBookmarks(a){var f=JSON.parse(a);var e=[];for(var g in f){for(var d in f[g]){if(d==bookmarkClass){for(var c in f[g][d]){var b={};b.containerElementId=g;b.timestamp=c;b.bookmarkText=f[g][d][c].text;e.push(b)}}}}if(e.length){return e}return false}var bookNotesVisible=false;function init_notes_dialog(){if(user_has_access()){$("#readerNotesButton").prop("disabled",false).prop("title",display_message.show_notes);$("#notes_container").dialog({autoOpen:false,resizable:false,draggable:false,modal:true,hide:{duration:fadeTime},show:{duration:fadeTime},height:$("#reader").height()-50,appendTo:"#reader_container",position:{my:"center",at:"center",of:$("#reader")},open:function(a,b){bookNotesVisible=true;$(".ui-widget-overlay").hide().fadeIn(fadeTime);setTimeout(function(){if(smallscreen){readerControlsHide();
$("#notes_container").dialog("option","position",{my:"center",at:"center",of:$("#main")})}else{$("#notes_container").dialog("option","position",{my:"center",at:"center",of:$("#reader")})}if($("#notes_container").height()>$("#notes").height()+5){$("#notes_container").height($("#notes").height()+5)}},0)},close:function(a,b){bookNotesVisible=false}})}}function toggleNotes(){$("#readerNotesButton").blur();if(bookNotesVisible){$("#notes_container").dialog("close")}else{var g=getBookNotes();if(typeof g=="object"){var c=$(data_get("template_book_read")).find("#notes_container #notes").html();var a="";var e=false;for(var b in g){if(g[b].length){for(var d in g[b]){var f=(e)?"even":"odd";a+=c.replace("[[note]]",g[b][d].noteText).replace("[[componentId]]",b).replace("[[containerElementId]]",g[b][d].containerElementId).replace("[[odd_even]]",f);e=!e}}}$("#notes_container #notes").html(a);$("#notes_container").dialog("option","maxHeight",$("#reader").height()-50);$("#notes_container").dialog("open")}else{notify(display_message.no_notes,true)}}}function notesEntryClicked(a,b){window.spinner.spin();readerMoveTo("component+element",a+"+"+b);$("#notes_container").dialog("close");setTimeout("window.spinner.spun()",500)}function sortChapterNotesByPosition(d,c){d=parseInt(d.containerElementId.replace("_er_",""),10);c=parseInt(c.containerElementId.replace("_er_",""),10);if(d<c){return -1}if(d>c){return 1}return 0}function getBookNotes(){var c=bookData.getComponents();var e={};e.length=0;for(var a in c){var d=data_get(book_id+"_selection_"+c[a]);if(typeof d!=="undefined"){var b=deserializeChapterNotes(d);if(b.length){b.sort(sortChapterNotesByPosition);e[c[a]]=b;e.length++}}}if(e.length){return e}return false}function deserializeChapterNotes(a){var f=JSON.parse(a);var b=[];for(var g in f){for(var e in f[g]){if(e==noteClass){for(var d in f[g][e]){var c={};c.containerElementId=g;c.timestamp=d;c.noteText=f[g][e][d].text;b.push(c)}}}}if(b.length){return b}return false}var canStoreOffline=null;var localStorageAvailable=null;var localforage_LocalStorage=null;var jsonAvailable=null;var useLZstring=true;var progresscount;var progressmult;var progressbar;var progressUpdateInterval;var storageProgressDialog;function init_book_content_storage(){storageProgressDialog=$("#bookStorageProgressContainer").dialog({autoOpen:false,dialogClass:"no-close",closeOnEscape:false,resizable:false,draggable:false,modal:true,height:"auto",appendTo:"body",position:{of:window},open:function(){$(".ui-widget-overlay").hide().fadeIn(fadeTime);setTimeout(function(){if(smallscreen){readerControlsHide();$("#bookStorageProgressContainer").dialog("option","position",{my:"center",at:"center",of:$("#main")})}else{$("#bookStorageProgressContainer").dialog("option","position",{my:"center",at:"center",of:window})}},0)}})}function updateStorageStatus(){if(currentview=="book_info"||currentview=="book_read"){$("#bookStorageWaitButton").hide();if(!canStoreOffline){$("#bookStorage, #readerSearchTextButton").hide()}else{if(!user_has_access()){$("#bookStorageRemoveButton").hide();$("#bookStorageSaveButton").show().prop("disabled",true).prop("title",display_message.buy_or_rent_book_to_use);$("#readerSearchTextButton").prop("disabled",true).prop("title",display_message.store_book_to_use)}else{if(isBookStored(book_id)){$("#bookStorageRemoveButton").show();$("#bookStorageSaveButton").hide();$("#readerSearchTextButton").removeClass("pseudo_disabled").prop("title",display_message.search_this_book)}else{$("#bookStorageSaveButton").show();$("#bookStorageRemoveButton").hide();$("#readerSearchTextButton").addClass("pseudo_disabled").prop("title",display_message.store_book_to_use)}if($("#bookStorageProgressContainer").dialog("isOpen")){$("#bookStorageProgressContainer").dialog("close")}}}}}function updateProgressbar(){var a=progresscount*progressmult;if(Math.floor(a)>0){progressbar.progressbar("option","value",Math.floor(a))}if(a>99.9){clearInterval(progressUpdateInterval);progressbar.progressbar("option","value",false);data_put(book_id+"_stored",true);window.setTimeout("updateStorageStatus();",1000)}}function isBookStored(a){if(typeof a=="undefined"){var a=book_id}if(data_get(a+"_stored")){return true}else{return false}}function book_store(){var a=0;progresscount=0;if(bookData.getMetaData("_er_format")=="epub"){var c=bookData.getComponents();var b=bookData.getManifest();$.each(c,function(d,e){a++});$.each(b,function(d,e){if(e.match(/\.css/)){a++}});progressmult=100/a;$("#bookStorageProgressContainer").dialog("option","title",display_message.storing_book);$("#bookStorageWaitButton").show();$("#bookStorageSaveButton").hide();progressbar=$("#bookStorageProgress");progressbar.progressbar({value:3});$("#bookStorageProgressContainer").dialog("open");progressUpdateInterval=setInterval("updateProgressbar();",250);$.each(b,function(d,e){if(e.match(/\.css/)){bookData.getFile(e,storeFile)}});$.each(c,function(d,e){window.setTimeout("bookData.getComponent('"+e+"', storeChapter, true);",(300*(d+1)))})}else{if(bookData.getMetaData("_er_format")=="imgs"){window.jqConfirm(display_message.store_book_confirm.replace("[[size]]",bookData.getMetaData("filesize_formatted")),function(){var d=bookData.getMetaData("pages");
progressmult=100/d;$("#bookStorageProgressContainer").dialog("option","title",display_message.storing_book);$("#bookStorageWaitButton").show();$("#bookStorageSaveButton").hide();progressbar=$("#bookStorageProgress");progressbar.progressbar({value:1});$("#bookStorageProgressContainer").dialog("open");progressUpdateInterval=setInterval("updateProgressbar();",250);for(var e=1;e<=d;e++){window.setTimeout("bookData.getPage("+e+", storePage);",(25*(e+1)))}})}}}function storeChapter(c){progresscount++;var b=(useLZstring)?LZString.compressToUTF16(c.source):c.source;var a=c.componentId;if(!localforage_LocalStorage){localforage.setItem(book_id+"_component_"+a,b)}if(currentview=="book_read"){data_put(book_id+"_component_"+a,b)}}function storeFile(c){progresscount++;var b=(useLZstring)?LZString.compressToUTF16(c.source):c.source;var a=c.filename;if(!localforage_LocalStorage){localforage.setItem(book_id+"_file_"+a,b)}if(currentview=="book_read"){data_put(book_id+"_file_"+a,b)}}function storePage(b,a){progresscount++;if(!localforage_LocalStorage){localforage.setItem(book_id+"_page_"+b,a)}}function retrieveChapter(a){var b=data_get(book_id+"_component_"+a);if(b&&useLZstring){b=LZString.decompressFromUTF16(b)}return b}function retrieveFile(a){var b=data_get(book_id+"_file_"+a);if(b&&useLZstring){b=LZString.decompressFromUTF16(b)}return b}function confirm_book_remove(){window.jqConfirm(display_message.remove_book_confirm,function(){book_remove()})}function book_remove(a,b){if(typeof b=="undefined"){var b=book_id}if(typeof a=="undefined"){var a=false}if(!a){if(currentview=="book_read"&&smallscreen){readerControlsHide()}$("#bookStorageProgressContainer").dialog("option","title",display_message.deleting_book);$("#bookStorageWaitButton").show();$("#bookStorageRemoveButton").hide();$("#readerSearchTextButton").addClass("pseudo_disabled").prop("title",display_message.store_book_to_use);progressbar=$("#bookStorageProgress");progressbar.progressbar({value:false,complete:function(){$("bookStorageProgressContainer").dialog("close")}});$("#bookStorageProgressContainer").dialog("open")}localforage.iterate(function(e,d,c){if((d.substring(0,(b.toString().length)+11)==b+"_component_")||(d.substring(0,(b.toString().length)+6)==b+"_file_")||(d.substring(0,(b.toString().length)+6)==b+"_page_")){localforage.removeItem(d)}}).then(function(){data_del(b+"_stored");setTimeout(function(){updateStorageStatus()},1000)})}function books_data_remove_from_LocalStorage(){if(!localforage_LocalStorage){var a=amplify.store();$.each(a,function(b,c){if(b.indexOf("_component_")>=0||b.indexOf("_file_")>=0){data_del(b)}})}}function remove_expired_books(b){var a=amplify.store();$.each(a,function(d,e){if(d.indexOf("_stored")>0){var c=parseInt(d.replace("_stored",""),10);if(b.indexOf(c)<0){book_remove(true,c);data_del(c+"_user_access");data_put(c+"_auto_removed",true)}}})}var searchText="";var searchVars={};var nudge={};nudge.bm=7;var topspacer_height;function init_text_search(){$.expr[":"].contains=$.expr.createPseudo(function(a){return function(b){return $(b).text().toUpperCase().indexOf(a.toUpperCase())>=0}});jQuery.fn.reverse=Array.prototype.reverse;$("#searchText").keydown(function(b){var a=b.keyCode||b.which;if(a==13){doTextSearch();return false}else{searchVars.searchBeforeKeyDown=b.target.value}});$("#searchText").keyup(function(b){var a=b.keyCode||b.which;if(a!=13&&b.target.value!=searchVars.searchBeforeKeyDown){clearTextSearch()}})}function showTextSearchForm(){if(!isBookStored(book_id)){notify(display_message.store_book_to_use,true)}else{topButtons(false,150);readerControlsHide(150);if(smallscreen){readerControlsHide(0);$("#book_buttons_container").hide();topspacer_height=$("#topspacer").height();$("#topspacer").height(0);$("div.monelem_controls_scrubber_container").css("opacity","0");nudge.ot=parseInt($(".monelem_sheaf:first").css("top").replace("px",""),10);nudge.ob=parseInt($(".monelem_sheaf:first").css("bottom").replace("px",""),10);nudge.nt=(nudge.ot+nudge.ob)-nudge.bm;$(".monelem_sheaf").css({bottom:nudge.bm+"px",top:nudge.nt+"px"})}else{$("#book_buttons_container").hide()}$("#reader_text_search_form").show();$("#searchText").height(Math.floor($("#reader_text_search_form button:first").height()));setTimeout(function(){$("#searchText").focus();keepselection=false;$("#searchText").on("blur",function(){if($("#searchText").val().trim()==""){closeTextSearchForm()}})},50)}}function closeTextSearchForm(){clearTextSearch();$("#reader_text_search_form").hide();$("#searchText").val("");if(smallscreen){$(".monelem_sheaf").css({bottom:nudge.ob+"px",top:nudge.ot+"px"});$("div.monelem_controls_scrubber_container").css("opacity","1");$("#book_buttons_container").show();readerControlsHide(0);$("#topspacer").height(topspacer_height)}else{$("#book_buttons_container").show()}}function clearTextSearch(){searchVars.begun=false;searchVars.componentMatchNumber=null;$("."+content_iframe_class).each(function(){var a=$(this).contents().find("body");a.find("#searchTextSelected").attr("id","");
a.find(".searchTextMatch").each(function(){$(this).replaceWith($(this).text())})})}function beginTextSearch(){searchVars={};searchVars.begun=false;searchVars.startComponentId=null;searchVars.firstResultComponentId=null;searchVars.searchComponentId=null;searchVars.componentMatchNumber=null;searchVars.firstResultDone=false;searchVars.matchFound=false;clearTextSearch();searchVars.searchText=document.getElementById("searchText").value.toLowerCase().trim();if(searchVars.searchText.length){hideKeyboard();$("#main").scrollTop(readerTop());searchVars.searchRegex=new RegExp("("+escapeRegExp(searchVars.searchText)+")","gi");var a=reader.getPlace().componentId();searchVars.startComponentId=a;searchVars.searchComponentId=a;searchVars.begun=true;$("#main").scrollTop(readerTop())}return searchVars.begun}function highlightComponent(){var a=null;if(searchVars.firstResultDone===false){a=firstSearch();if(a){searchVars.firstResultDone=true}}else{a=furtherSearch()}if(a===false){searchNextComponent()}}function doTextSearch(c){if(!searchVars.begun){beginTextSearch()}if(searchVars.begun){searchVars.dir=(c<0)?-1:1;var e=null;var a=searchComponentText(searchVars.searchComponentId);if(a){searchVars.matchFound=true;var d=reader.getPlace().componentId();searchVars.firstResultComponentId=searchVars.searchComponentId;if(searchVars.componentMatchNumber===null){searchVars.componentMatchNumber=(searchVars.dir<0)?a-1:0}if(d!=searchVars.searchComponentId){var b=(searchVars.dir<0)?1:0;window.reader.moveTo({componentId:searchVars.searchComponentId,percent:b},function(){highlightComponent()})}else{highlightComponent()}}else{searchNextComponent()}}}function searchNextComponent(){searchVars.componentMatchNumber=null;searchVars.firstResultDone=false;var c=bookData.getComponents();var a=c[($.inArray(searchVars.searchComponentId,c))+searchVars.dir];if(!a){if(searchVars.dir<0){a=c[c.length-1]}else{a=c[0]}}if((searchVars.firstResultComponentId!==null&&a==searchVars.firstResultComponentId)||(searchVars.firstResultComponentId===null&&a==searchVars.startComponentId)){if(!searchVars.matchFound){spinner.spun();notify(display_message.search_term_not_found,true)}else{spinner.spin();searchVars.searchComponentId=a;var b=(searchVars.dir<0)?1:0;window.reader.moveTo({percent:b},function(){setTimeout("doTextSearch("+searchVars.dir+");",3)})}}else{spinner.spin();searchVars.searchComponentId=a;if(isBookStored(book_id)){setTimeout("doTextSearch("+searchVars.dir+");",3)}else{var b=(searchVars.dir<0)?1:0;window.reader.moveTo({componentId:searchVars.searchComponentId,percent:b},function(){setTimeout("doTextSearch("+searchVars.dir+");",3)})}}}function firstSearch(){highlightMatches();searchVars.doMove=false;searchVars.superhighlight=false;$("."+content_iframe_class).each(function(){var f=$(this).contents().find("body");var b=f.find(".searchTextMatch");for(var a=(searchVars.dir<0)?b.length-1:0;((searchVars.dir<0&&a>=0)||(searchVars.dir>0&&a<b.length));a+=searchVars.dir){var g=b[a];$(g).attr("id","searchTextSelected");var e=reader.getPlace().pageNumber();var d=reader.properties.flipper.getPageDiv();var c=reader.getPlace().properties.component;searchVars.resultPage=c.pageForSelector("#searchTextSelected",d);if(searchVars.resultPage===null){break}if((searchVars.dir>0&&searchVars.resultPage>e)||(searchVars.dir<0&&searchVars.resultPage<e)){searchVars.componentMatchNumber=a;searchVars.doMove=true;searchVars.superhighlight=true;break}else{if(searchVars.resultPage==e){searchVars.componentMatchNumber=a;searchVars.superhighlight=true;break}else{$(g).attr("id","")}}}if(searchVars.superhighlight){return false}});if(!searchVars.superhighlight){return false}else{window.reader.moveTo({componentId:searchVars.searchComponentId,selector:"#searchTextSelected"},function(){window.spinner.spun()})}return true}function furtherSearch(){searchVars.doMove=false;searchVars.superhighlight=false;searchVars.componentMatchNumber+=searchVars.dir;$("."+content_iframe_class).each(function(){var c=$(this).contents().find("body");c.find("#searchTextSelected").attr("id","");var b=c.find(".searchTextMatch");var a=$(b)[searchVars.componentMatchNumber];$(a).attr("id","searchTextSelected");if(c.find("#searchTextSelected").length){searchVars.superhighlight=true;searchVars.doMove=true}});if(!searchVars.superhighlight){return false}else{window.reader.moveTo({componentId:searchVars.searchComponentId,selector:"#searchTextSelected"},function(){window.spinner.spun()})}return true}function highlightMatches(){$("."+content_iframe_class).each(function(){var b=$(this).contents().find("body");b.find("#searchTextSelected").attr("id","");if(b.find(".searchTextMatch").length==0){var a=searchVars.searchText;$(b).find('*:contains("'+a+'")').each(function(c,d){$(this).highlightText(a,"searchTextMatch")})}})}function searchComponentText(d){var f=reader.getPlace().componentId();if(f==searchVars.searchComponentId){var a=(isFunction(reader.getActiveIndex))?reader.getActiveIndex():0;var e=$("#"+content_iframe_class+"_"+a).contents().find("body").text()
}else{var c=bookData.getComponent(searchVars.searchComponentId);var e=$(c.html).text()}var b=e.match(searchVars.searchRegex);if(b){b=b.length}else{b=0}return b}var fullscreenCapable=null;var fullscreen=false;var reader_width;var reader_height;var reader_ratio=0.7;function init_fullscreen(){if(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled){fullscreenCapable=true;document.addEventListener("fullscreenchange",fullscreenChanged,false);document.addEventListener("webkitfullscreenchange",fullscreenChanged,false);document.addEventListener("msfullscreenchange",fullscreenChanged,false);document.addEventListener("mozfullscreenchange",fullscreenChanged,false)}else{fullscreenCapable=false;$("#readerFullscreenButton, #readerFullscreenExitButton").remove()}if(smallscreen){fullscreenCapable=false;setTimeout("toggleFullscreen()",100)}Monocle.Events.listen("reader","monocle:resize",function(a){setTimeout("window.spinner.spun();",100)})}function resizeReader(a){setTimeout(function(){var c,d;var b=$("#book_buttons_container").height();if($(window).height()>$(window).width()){$("#reader").width("100%");d=Math.floor($("#reader").width()/reader_ratio);if($(window).height()<=(d+b)){d=$(window).height();if(!smallscreen){d-=b}c=Math.floor(d*reader_ratio)}}else{d=$(window).height();if(!smallscreen){d-=b}c=Math.floor(d*reader_ratio)}if(smallscreen){c=$(window).width();d=$(window).height()}$("#reader").height(d).width(c);setTimeout(setNoteIcons,250);setTimeout(setBookmarkIcons,250);characterHighlightButtons();if(typeof a=="undefined"||a==true){window.reader.resized()}},10)}function isFullscreen(){return(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement)}function fullscreenChanged(){if(fullscreenCapable){window.spinner.spin()}if(isFullscreen()||smallscreen){if(fullscreenCapable){$("html").addClass("fullscreen")}fullscreen=true;if(!smallscreen){$("#readerFullscreenButton").hide();$("#readerFullscreenExitButton").show()}if(smallscreen){stopLoading()}}else{$("html").removeClass("fullscreen");fullscreen=false;if(!smallscreen){$("#readerFullscreenExitButton").hide();$("#readerFullscreenButton").show()}}if(fullscreenCapable){resizeReader()}}function toggleFullscreen(){if(fullscreenCapable){window.spinner.spin();if(isFullscreen()){if(document.exitFullscreen){document.exitFullscreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else{if(document.webkitCancelFullscreen){document.webkitCancelFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}}}}}}else{var a=document.getElementById("reader_container");if(a.requestFullscreen){a.requestFullscreen()}else{if(a.webkitRequestFullscreen){a.webkitRequestFullscreen()}else{if(a.msRequestFullscreen){a.msRequestFullscreen()}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen()}}}}}}else{if(smallscreen){$("#book_title_author").hide();$("#main").scrollTop(readerTop())}fullscreenChanged()}}var bookContentsVisible=false;function init_contents_dialog(){if($("#toc").children().length==0){$("#readerContentsButton").addClass("pseudo_disabled").prop("title",display_message.no_toc)}else{$("#readerContentsButton").prop("disabled",false).prop("title",display_message.show_contents);$("#toc_container").dialog({autoOpen:false,resizable:false,draggable:false,modal:true,hide:{duration:fadeTime},show:{duration:fadeTime},height:$("#reader").height()-50,appendTo:"#reader_container",position:{my:"center",at:"center",of:$("#reader")},open:function(a,b){bookContentsVisible=true;$(".ui-widget-overlay").hide().fadeIn(fadeTime);setTimeout(function(){if(smallscreen){readerControlsHide();$("#toc_container").dialog("option","position",{my:"center",at:"center",of:$("#main")})}else{$("#toc_container").dialog("option","position",{my:"center",at:"center",of:$("#reader")})}if($("#toc_container").height()>$("#toc").height()+5){$("#toc_container").height($("#toc").height()+5)}},0)},close:function(a,b){bookContentsVisible=false}})}}function toggleContents(){$("#readerContentsButton").blur();if($("#toc").children().length==0){notify(display_message.no_toc,true)}else{if(bookContentsVisible){$("#toc_container").dialog("close")}else{$("#toc_container").dialog("option","maxHeight",$("#reader").height()-50);$("#toc_container").dialog("open")}}}function tocEntryClicked(a){$("#toc_container").dialog("close");window.spinner.spin();readerMoveTo("componentId",a);setTimeout("window.spinner.spun()",500)}var bookCharactersVisible=false;var bookCharacterHighlight={};function init_characters_dialog(){bookCharactersVisible=false;bookCharacterHighlight={};bookCharacterHighlight.charSelected=null;bookCharacterHighlight.charHighlighted=null;bookCharacterHighlight.highlightType=null;bookCharacterHighlight.stepParagraph=null;characterHighlightButtons(false);if(bookData.getMetaData("_er_characters_confidence")<character_highlight_min_confidence||bookData.getMetaData("_er_characters_count")<2){$("#readerCharactersButton").hide()
}else{$("#readerCharactersButton").show().prop("disabled",false).prop("title",display_message.show_characters);$("#characters_container").dialog({autoOpen:false,resizable:false,draggable:false,modal:true,hide:{duration:fadeTime},show:{duration:fadeTime},height:$("#reader").height()-50,appendTo:"#reader_container",position:{my:"center",at:"center",of:$("#reader")},open:function(a,b){bookCharactersVisible=true;$(".ui-widget-overlay").hide().fadeIn(fadeTime);setTimeout(function(){if(smallscreen){readerControlsHide();$("#characters_container").dialog("option","position",{my:"center",at:"center",of:$("#main")})}else{$("#characters_container").dialog("option","position",{my:"center",at:"center",of:$("#reader")})}if($("#characters_container").height()>$("#characters_list").height()+5){$("#characters_container").height($("#characters_list").height()+5)}},0)},close:function(a,b){bookCharactersVisible=false}});$("#character_select_menu").dialog({autoOpen:false,resizable:false,draggable:false,modal:true,appendTo:"#reader_container",position:{of:$("#reader")},close:function(a,b){}})}}function toggleCharacters(){$("#readerCharactersButton").blur();if($("#characters_list").children().length<2){notify(display_message.no_characters,true)}else{if(bookCharactersVisible){$("#characters_container").dialog("close")}else{if(bookCharacterHighlight.charHighlighted){$("#character_autohighlights_remove").show()}else{$("#character_autohighlights_remove").hide()}$("#characters_container").dialog("option","maxHeight",$("#reader").height()-50);$("#characters_container").dialog("open")}}}function charactersEntryClicked(a){bookCharacterHighlight.charSelected=a;$("#characters_container").dialog("close");if(bookCharacterHighlight.charSelected){$("#character_select_menu").dialog("open")}else{characterHighlightsClear()}}function characterHighlightClicked(){if(bookCharacterHighlight.charHighlighted){characterHighlightsClear()}bookCharacterHighlight.charHighlighted=bookCharacterHighlight.charSelected;bookCharacterHighlight.highlightType="highlight";bookCharacterHighlight.stepParagraph=null;$("#character_select_menu").dialog("close");var a=characterClassPrefix+bookCharacterHighlight.charHighlighted;$("."+content_iframe_class).contents().find("."+a).addClass(characterHighlightClass);var b=bookData.getCharacters(bookCharacterHighlight.charHighlighted).name;$("."+content_iframe_class).contents().find("p:not(."+a+")").each(function(){$(this).findText({query:[b]}).each(function(){$(this).addClass(characterHighlightClass)})});characterHighlightButtons(true)}function characterBlackoutClicked(){if(bookCharacterHighlight.charHighlighted){characterHighlightsClear()}bookCharacterHighlight.charHighlighted=bookCharacterHighlight.charSelected;bookCharacterHighlight.highlightType="blackout";bookCharacterHighlight.stepParagraph=null;$("#character_select_menu").dialog("close");var a=characterClassPrefix+bookCharacterHighlight.charHighlighted;var b=characterStageDirectionClassPrefix+bookCharacterHighlight.charHighlighted;$("."+content_iframe_class).contents().find("."+a).addClass(characterBlackoutClass);var c=bookData.getCharacters(bookCharacterHighlight.charHighlighted).name;$("."+content_iframe_class).contents().find("."+characterBlackoutClass).each(function(){$(this).findText({query:[c]}).each(function(){$(this).addClass(characterBlackoutNameClass)})});var c=bookData.getCharacters(bookCharacterHighlight.charHighlighted).name;$("."+content_iframe_class).contents().find("."+b).each(function(){$(this).findText({query:[c]}).each(function(){$(this).addClass(characterHighlightClass)})});characterHighlightButtons(true)}function characterHighlightsClear(){var a=$("."+content_iframe_class).contents();a.find("."+characterHighlightClass).removeClass(characterHighlightClass).removeAttr("search");a.find("."+characterBlackoutNameClass).removeClass(characterBlackoutNameClass).removeAttr("search");a.find("."+characterBlackoutClass).removeClass(characterBlackoutClass).removeAttr("search");a.find("."+characterStepHighlightClass).removeClass(characterStepHighlightClass);bookCharacterHighlight.charHighlighted=null;characterHighlightButtons(false)}function characterHighlightsSet(){characterHighlightButtons(false);if(bookCharacterHighlight.charHighlighted&&bookCharacterHighlight.highlightType){var b=window.reader.getPlace().getLocus();var a=bookData.getComponentMetadata(b.componentId);if(a.main_content){if(bookCharacterHighlight.highlightType=="blackout"){characterBlackoutClicked()}else{if(bookCharacterHighlight.highlightType=="highlight"){characterHighlightClicked()}}}}}function characterHighlightButtons(a){if(typeof a=="undefined"){var a=true;if(bookCharacterHighlight.charHighlighted==null){a=false}}if(a){if(smallscreen){var e=0;var d=$(document).width()-$("#character_step_controls").width()}else{var c=$("#reader").offset();var b=$("#reader").width();var e=c.top;var d=(c.left+b)-$("#character_step_controls").width()}$("#character_step_controls").css({left:d+"px",top:e+"px"}).fadeTo(fadeTime,1)
}else{$("#character_step_controls").fadeTo(fadeTime,0)}}function characterHighlightStep(e){if(e==1||e==-1){var k;if(bookCharacterHighlight.highlightType=="blackout"){k=characterBlackoutClass}else{if(bookCharacterHighlight.highlightType=="highlight"){k=characterHighlightClass}}var c=reader.getPlace().componentId();var j=$(".monelem_component[data-componentid='"+c+"']").contents().find("body");var h=j.find("."+characterClassPrefix+bookCharacterHighlight.charHighlighted);var i=reader.getPlace().pageNumber();if(bookCharacterHighlight.stepParagraph===null){if(e==1){bookCharacterHighlight.stepParagraph=0;var f=reader.properties.flipper.getPageDiv();var l=reader.getPlace().properties.component;var n=null;if(h.length>0){n=h[(bookCharacterHighlight.stepParagraph)].id}if(n){bookCharacterHighlight.resultPage=l.pageForSelector("#"+n,f)}else{bookCharacterHighlight.resultPage=0}while(bookCharacterHighlight.resultPage<i||h.length==0){bookCharacterHighlight.stepParagraph++;if(bookCharacterHighlight.stepParagraph<h.length){n=h[(bookCharacterHighlight.stepParagraph)].id;if(n){bookCharacterHighlight.resultPage=l.pageForSelector("#"+n,f)}}else{bookCharacterHighlight.resultPage=null;var m=bookData.getCharacters(bookCharacterHighlight.charHighlighted).components;var g=bookData.getComponents();var b=g.indexOf(c);var a=m[0];for(var d=b+1;d<g.length;d++){if(m.indexOf(g[d])>-1){a=g[d];break}}window.reader.moveTo({componentId:a,percent:0},function(){bookCharacterHighlight.stepParagraph=null;characterHighlightStep(e)});return false}}}else{bookCharacterHighlight.stepParagraph=h.length-1;var f=reader.properties.flipper.getPageDiv();var l=reader.getPlace().properties.component;var n=null;if(h.length>0){n=h[(bookCharacterHighlight.stepParagraph)].id}if(n){bookCharacterHighlight.resultPage=l.pageForSelector("#"+n,f)}else{bookCharacterHighlight.resultPage=0}while(bookCharacterHighlight.resultPage>i||h.length==0){bookCharacterHighlight.stepParagraph--;if(bookCharacterHighlight.stepParagraph>=0){n=h[(bookCharacterHighlight.stepParagraph)].id;if(n){bookCharacterHighlight.resultPage=l.pageForSelector("#"+n,f)}}else{bookCharacterHighlight.resultPage=null;var m=bookData.getCharacters(bookCharacterHighlight.charHighlighted).components;var g=bookData.getComponents();var b=g.indexOf(c);var a=m[(m.length-1)];for(var d=b-1;d>=0;d--){if(m.indexOf(g[d])>-1){a=g[d];break}}window.reader.moveTo({componentId:a,percent:0.9999999999999},function(){bookCharacterHighlight.stepParagraph=null;characterHighlightStep(e)});return false}}}}else{$(h[bookCharacterHighlight.stepParagraph]).removeClass(characterStepHighlightClass);var f=reader.properties.flipper.getPageDiv();var l=reader.getPlace().properties.component;if(e==1){bookCharacterHighlight.stepParagraph++;if(bookCharacterHighlight.stepParagraph<h.length){n=h[(bookCharacterHighlight.stepParagraph)].id;if(n){bookCharacterHighlight.resultPage=l.pageForSelector("#"+n,f)}}else{bookCharacterHighlight.resultPage=null;var m=bookData.getCharacters(bookCharacterHighlight.charHighlighted).components;var g=bookData.getComponents();var b=g.indexOf(c);var a=m[0];for(var d=b+1;d<g.length;d++){if(m.indexOf(g[d])>-1){a=g[d];break}}window.reader.moveTo({componentId:a,percent:0},function(){bookCharacterHighlight.stepParagraph=null;characterHighlightStep(e)});return false}}else{bookCharacterHighlight.stepParagraph--;if(bookCharacterHighlight.stepParagraph>=0){n=h[(bookCharacterHighlight.stepParagraph)].id;if(n){bookCharacterHighlight.resultPage=l.pageForSelector("#"+n,f)}}else{bookCharacterHighlight.resultPage=null;var m=bookData.getCharacters(bookCharacterHighlight.charHighlighted).components;var g=bookData.getComponents();var b=g.indexOf(c);var a=m[(m.length-1)];for(var d=b-1;d>=0;d--){if(m.indexOf(g[d])>-1){a=g[d];break}}window.reader.moveTo({componentId:a,percent:0.9999999999999},function(){bookCharacterHighlight.stepParagraph=null;characterHighlightStep(e)});return false}}}$(h[bookCharacterHighlight.stepParagraph]).addClass(characterStepHighlightClass);if(bookCharacterHighlight.resultPage!=null&&i!=bookCharacterHighlight.resultPage){window.reader.moveTo({page:bookCharacterHighlight.resultPage})}}}function createButton(a,g,e,f,b,d){var c=document.createElement("button");c.id=f;c.unselectable=true;c.className="unselectable site_button textselectedbutton";if(typeof d!="undefined"){c.className+=" "+d}selectButton=function(){g();return false};c.onclick=selectButton;c.title=e;if(typeof b!="undefined"){if(b!=""){c.innerHTML='<img src="images/'+b+'" alt="'+e+'">'}}a.append(c);c=null};